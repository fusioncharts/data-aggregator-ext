(function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={exports:{},id:moduleId,loaded:false };modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.loaded=true;return module.exports;}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.p="";return __webpack_require__(0);})([function(module,exports,__webpack_require__){module.exports=__webpack_require__(1);},function(module,exports,__webpack_require__){'use strict';const Aggregator=__webpack_require__(2);;(function(factory){factory(FusionCharts)})(function(FC){FC.register('extension',['data-aggregator',function(id){var global=this;var extAPI=global.extAPI;console.log(id);window.Aggregator=new Aggregator();extAPI(window.Aggregator)}])});},function(module,exports){'use strict';class Aggregator{constructor(){this.appliedAggregation={timePeriod:null,timePeriodMultiplier:1,aggregationMethod:null};this.config={}}get aggregation(){return this.appliedAggregation}set aggregation(obj){this.appliedAggregation.timePeriod=obj.timePeriod;this.appliedAggregation.timePeriodMultiplier=obj.timePeriodMultiplier;this.appliedAggregation.aggregationMethod=obj.aggregationMethod}getAvailablelAggreagation(){var config=this.config,chart=this.chart,avlTimePeriods,i,len;config.avlAggMethods=chart.getAvailableAggregationMethod();avlTimePeriods=config.avlTimePeriods=chart.getAvailableTimePeriod();config.avlTimeMultiplier=[];len=avlTimePeriods.length;for(i=0;i<len;i+=1){config.avlTimeMultiplier.push(avlTimePeriods[i].multipliers)}}getValidAggregation(){var chartConfig=this.chart.config,config=this.config,xAxis=this.x,i,j,len1,len2,avlTimePeriods,avlTimeMultiplier,minNumOfPlot=chartConfig.minNumOfPlot,maxNumOfPlot=chartConfig.maxNumOfPlot,multipliersArr,currentTimeLength,timePeriod,time,expectedTime,multiplier,minTime,maxTime,currentVisibleRange;config.currentVisibleRange=currentVisibleRange=xAxis.getCurrentVisibleRange();config.currentTimeLength=currentVisibleRange.endDate-currentVisibleRange.startDate;avlTimePeriods=config.avlTimePeriods;avlTimeMultiplier=config.avlTimeMultiplier;currentTimeLength=config.currentTimeLength;config.minTime=minTime=currentTimeLength/maxNumOfPlot;config.maxTime=maxTime=currentTimeLength/minNumOfPlot;config.validTimePeriod=[];config.validTimePeriodMultiplier=[];for(i=0,len1=avlTimePeriods.length;i<len1;i+=1){timePeriod=Object.keys(avlTimePeriods[i])[0];time=avlTimePeriods[i][Object.keys(avlTimePeriods[i])[0]];multipliersArr=[];for(j=0,len2=avlTimeMultiplier[i].length;j<len2;j+=1){multiplier=avlTimeMultiplier[i][j];expectedTime=multiplier*time;if((expectedTime>=minTime)&&(expectedTime<=maxTime)){multipliersArr.push(avlTimeMultiplier[i][j])}}if(multipliersArr.length>0){config.validTimePeriodMultiplier.push(multipliersArr);config.validTimePeriod.push(timePeriod)}}console.log('Time Period: ',config.validTimePeriod);console.log('Number Of Multipliers: ',config.validTimePeriodMultiplier);console.log('Methods: ',config.avlAggMethods)}setAggregation(obj){var avlAggMethods,validTimePeriod,timePeriodIndex,validTimePeriodMultiplier,config=this.config;avlAggMethods=config.avlAggMethods;validTimePeriod=config.validTimePeriod;validTimePeriodMultiplier=config.validTimePeriodMultiplier;if(avlAggMethods.includes(obj.aggregationMethod)&&validTimePeriod.includes(obj.timePeriod)){timePeriodIndex=validTimePeriod.indexOf(obj.timePeriod);if(validTimePeriodMultiplier[timePeriodIndex].includes(obj.timePeriodMultiplier)){this.aggregation=obj;console.log(this.aggregation);return true}else{console.log(this.aggregation);return false}}else{console.log(this.aggregation);return false}}resetAggregation(){}init(require){var self=this;require('X-Axis','chart',function(x,chart){self.x=x;self.chart=chart});this.getAvailablelAggreagation();this.getValidAggregation()}placeInCanvas(){}draw(){var multiplierFld,timePeriodFld,AggMethodFld,config=this.config,label,mainCont=$('#mainCont'),validTimePeriod=config.validTimePeriod,validTimePeriodMultiplier=config.validTimePeriodMultiplier,indexOfTimeUnit,avlAggMethods=config.avlAggMethods,timePeriodOnChange=function(){var timePeriodVal=$('#time_period').val(),timePeriodMultiplierVal=$('#mul').val(),indexOfTimeUnit,indexOfTimeMul;indexOfTimeUnit=validTimePeriod.indexOf(timePeriodVal);indexOfTimeMul=validTimePeriodMultiplier[indexOfTimeUnit].indexOf(Number(timePeriodMultiplierVal));$('#mul').empty();console.log(indexOfTimeUnit,indexOfTimeMul);for(var mulVal of validTimePeriodMultiplier[indexOfTimeUnit]){$('<option />',{text:mulVal}).appendTo(multiplierFld)}if(indexOfTimeMul<0){$('#mul').val(validTimePeriodMultiplier[indexOfTimeUnit][0])}else{$('#mul').val(timePeriodMultiplierVal)}};if(mainCont.length===0){return}mainCont.empty();label=$('<label>').text('Aggregate Data: ');label.appendTo(mainCont);multiplierFld=$('<select id="mul"/>');timePeriodFld=$('<select id="time_period"/>');AggMethodFld=$('<select id="agg_method"/>');for(var unitVal of validTimePeriod){$('<option />',{text:unitVal}).appendTo(timePeriodFld)}indexOfTimeUnit=validTimePeriod.indexOf(validTimePeriod[0]);if(indexOfTimeUnit>=0){for(var mulVal of validTimePeriodMultiplier[indexOfTimeUnit]){$('<option />',{text:mulVal}).appendTo(multiplierFld)}}for(var aggVal of avlAggMethods){$('<option />',{text:aggVal}).appendTo(AggMethodFld)}multiplierFld.appendTo(mainCont);timePeriodFld.appendTo(mainCont);AggMethodFld.appendTo(mainCont);$('<button/>').text('Apply').appendTo(mainCont);$('<button/>').text('Reset').appendTo(mainCont);$('#time_period').change(timePeriodOnChange)}rangeChangeCallback(){this.getValidAggregation();this.draw()}dispose(){}}module.exports=Aggregator;}]);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAgOTg5ODNjZDIxNzE4YjA1NzFiNTYiLCJ3ZWJwYWNrOi8vLy4vc3JjL2luZGV4LmpzIiwid2VicGFjazovLy8uL3NyYy9mY3RzLWV4dC1hZ2dyZWdhdG9yLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSx1QkFBZTtBQUNmO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOzs7QUFHQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOzs7Ozs7Ozs7Ozs7OztBQ3RDQTtBQUNBOztBQUVBLEVBQUM7QUFDRDtBQUNBLEVBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0EsSUFBRztBQUNILEVBQUM7Ozs7Ozs7QUNsQkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZSxPQUFPO0FBQ3RCLGlCQUFnQixPQUFPO0FBQ3ZCLGlCQUFnQixPQUFPO0FBQ3ZCLGlCQUFnQixPQUFPO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsYUFBWTtBQUNaO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBLGdCQUFlLFNBQVM7QUFDeEI7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQSw4Q0FBNkMsVUFBVTtBQUN2RDtBQUNBO0FBQ0E7O0FBRUEsc0RBQXFELFVBQVU7QUFDL0Q7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsZUFBYyxPQUFPO0FBQ3JCLGlCQUFnQixPQUFPO0FBQ3ZCLGlCQUFnQixPQUFPO0FBQ3ZCLGlCQUFnQixPQUFPO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0EsTUFBSztBQUNMO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsTUFBSzs7QUFFTDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQSw0QkFBMkIsYUFBYTtBQUN4Qzs7QUFFQTtBQUNBO0FBQ0EsVUFBUztBQUNUO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSx3QkFBdUIsY0FBYztBQUNyQzs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsMEJBQXlCLGFBQWE7QUFDdEM7QUFDQTs7QUFFQTtBQUNBLHdCQUF1QixhQUFhO0FBQ3BDOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUEiLCJmaWxlIjoiZmN0cy1leHQtZGF0YWFnZ3JlZ2F0b3ItZXM2Lm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKVxuIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuXG4gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbiBcdFx0XHRleHBvcnRzOiB7fSxcbiBcdFx0XHRpZDogbW9kdWxlSWQsXG4gXHRcdFx0bG9hZGVkOiBmYWxzZVxuIFx0XHR9O1xuXG4gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4gXHRcdG1vZHVsZS5sb2FkZWQgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiO1xuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKDApO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHdlYnBhY2svYm9vdHN0cmFwIDk4OTgzY2QyMTcxOGIwNTcxYjU2IiwiJ3VzZSBzdHJpY3QnO1xuY29uc3QgQWdncmVnYXRvciA9IHJlcXVpcmUoJy4vZmN0cy1leHQtYWdncmVnYXRvcicpO1xuXG47KGZ1bmN0aW9uIChmYWN0b3J5KSB7XG4gIGZhY3RvcnkoRnVzaW9uQ2hhcnRzKTtcbn0pKGZ1bmN0aW9uIChGQykge1xuICBGQy5yZWdpc3RlcignZXh0ZW5zaW9uJywgWydkYXRhLWFnZ3JlZ2F0b3InLCBmdW5jdGlvbiAoaWQpIHtcbiAgICB2YXIgZ2xvYmFsID0gdGhpcztcbiAgICB2YXIgZXh0QVBJID0gZ2xvYmFsLmV4dEFQSTtcbiAgICBjb25zb2xlLmxvZyhpZCk7XG5cbiAgICAvLyB2YXIgb3RoZXJBUEkgPSBGdXNpb25DaGFydHMuZ2V0RXh0Q29tcG9uZW50KGlkLCAnYXBpJywgJ2xlZ2FjeWV4dGFwaScpO1xuICAgIC8vIHZhciB0b29sQm94QXBpID0gRnVzaW9uQ2hhcnRzLmdldENvbXBvbmVudCgnYXBpJywgJ3Rvb2xib3gnKTtcblxuICAgIHdpbmRvdy5BZ2dyZWdhdG9yID0gbmV3IEFnZ3JlZ2F0b3IoKTtcblxuICAgIGV4dEFQSSh3aW5kb3cuQWdncmVnYXRvcik7XG4gIH1dKTtcbn0pO1xuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9zcmMvaW5kZXguanNcbi8vIG1vZHVsZSBpZCA9IDFcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiJ3VzZSBzdHJpY3QnO1xuLyoqXG4gKiBDbGFzcyByZXByZXNlbnRpbmcgdGhlIERhdGEgQWdncmVnYXRvci5cbiAqL1xuY2xhc3MgQWdncmVnYXRvciB7XG4gIC8qKlxuICAgKiBDcmVhdGUgYSBBZ2dyZWdhdG9yLlxuICAgKiBAdHlwZWRlZiB7b2JqZWN0fSBBZ2dyZWdhdG9yLmFnZ3JlZ2F0aW9uXG4gICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSB0aW1lUGVyaW9kIC0gVGhlIHRpbWUgaW50ZXJ2YWwgb2YgYWdncmVnYXRpb24uXG4gICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSB0aW1lUGVyaW9kTXVsdGlwbGllciAtIFRoZSBtdWx0aXBsaWVyIG9mIHRpbWUgaW50ZXJ2YWwuXG4gICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBhZ2dyZWdhdGlvbk1ldGhvZCAtIFRoZSBtZXRob2QgYXBwbGllZCB0byBhZ2dyZWdhdGUuXG4gICAqL1xuICBjb25zdHJ1Y3RvciAoKSB7XG4gICAgLyoqXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICB0aGlzLmFwcGxpZWRBZ2dyZWdhdGlvbiA9IHtcbiAgICAgIHRpbWVQZXJpb2Q6IG51bGwsXG4gICAgICB0aW1lUGVyaW9kTXVsdGlwbGllcjogMSxcbiAgICAgIGFnZ3JlZ2F0aW9uTWV0aG9kOiBudWxsXG4gICAgfTtcbiAgICB0aGlzLmNvbmZpZyA9IHt9O1xuICB9XG5cbiAgLyoqXG4gICAqIEFuIG9iamVjdCByZXByZXNlbnRpbmcgdGhlIHRpbWVQZXJpb2QsIHRpbWVQZXJpb2RNdWx0aXBsaWVyLCBhZ2dyZWdhdGlvbk1ldGhvZC5cbiAgICogQHR5cGUge0FnZ3JlZ2F0b3IuYWdncmVnYXRpb259XG4gICAqL1xuICBnZXQgYWdncmVnYXRpb24gKCkge1xuICAgIHJldHVybiB0aGlzLmFwcGxpZWRBZ2dyZWdhdGlvbjtcbiAgfVxuXG4gIHNldCBhZ2dyZWdhdGlvbiAob2JqKSB7XG4gICAgdGhpcy5hcHBsaWVkQWdncmVnYXRpb24udGltZVBlcmlvZCA9IG9iai50aW1lUGVyaW9kO1xuICAgIHRoaXMuYXBwbGllZEFnZ3JlZ2F0aW9uLnRpbWVQZXJpb2RNdWx0aXBsaWVyID0gb2JqLnRpbWVQZXJpb2RNdWx0aXBsaWVyO1xuICAgIHRoaXMuYXBwbGllZEFnZ3JlZ2F0aW9uLmFnZ3JlZ2F0aW9uTWV0aG9kID0gb2JqLmFnZ3JlZ2F0aW9uTWV0aG9kO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldHMgYXZhaWxhYmxlIGFnZ3JlZ2F0aW9uIG9wdGlvbnMgaW4gY29uZmlndXJhdGlvbiBvZiBleHRlbnNpb25cbiAgICogQHByaXZhdGVcbiAgICovXG4gIGdldEF2YWlsYWJsZWxBZ2dyZWFnYXRpb24gKCkge1xuICAgIHZhciBjb25maWcgPSB0aGlzLmNvbmZpZyxcbiAgICAgIGNoYXJ0ID0gdGhpcy5jaGFydCxcbiAgICAgIGF2bFRpbWVQZXJpb2RzLFxuICAgICAgaSxcbiAgICAgIGxlbjtcblxuICAgIGNvbmZpZy5hdmxBZ2dNZXRob2RzID0gY2hhcnQuZ2V0QXZhaWxhYmxlQWdncmVnYXRpb25NZXRob2QoKTtcbiAgICBhdmxUaW1lUGVyaW9kcyA9IGNvbmZpZy5hdmxUaW1lUGVyaW9kcyA9IGNoYXJ0LmdldEF2YWlsYWJsZVRpbWVQZXJpb2QoKTtcblxuICAgIGNvbmZpZy5hdmxUaW1lTXVsdGlwbGllciA9IFtdO1xuICAgIGxlbiA9IGF2bFRpbWVQZXJpb2RzLmxlbmd0aDtcblxuICAgIGZvciAoaSA9IDA7IGkgPCBsZW47IGkrKykge1xuICAgICAgY29uZmlnLmF2bFRpbWVNdWx0aXBsaWVyLnB1c2goYXZsVGltZVBlcmlvZHNbaV0ubXVsdGlwbGllcnMpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDYWxjdWxhdGVzIHZhbGlkIGFnZ3JlZ2F0aW9uIHRpbWUgcGVyaW9kcyBhbmQgY29ycmVzcG9uZGluZyBtdWx0aXBsaWVyc1xuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgZ2V0VmFsaWRBZ2dyZWdhdGlvbiAoKSB7XG4gICAgdmFyIGNoYXJ0Q29uZmlnID0gdGhpcy5jaGFydC5jb25maWcsXG4gICAgICBjb25maWcgPSB0aGlzLmNvbmZpZyxcbiAgICAgIHhBeGlzID0gdGhpcy54LFxuICAgICAgaSxcbiAgICAgIGosXG4gICAgICBsZW4xLFxuICAgICAgbGVuMixcbiAgICAgIGF2bFRpbWVQZXJpb2RzLFxuICAgICAgYXZsVGltZU11bHRpcGxpZXIsXG4gICAgICBtaW5OdW1PZlBsb3QgPSBjaGFydENvbmZpZy5taW5OdW1PZlBsb3QsXG4gICAgICBtYXhOdW1PZlBsb3QgPSBjaGFydENvbmZpZy5tYXhOdW1PZlBsb3QsXG4gICAgICBtdWx0aXBsaWVyc0FycixcbiAgICAgIGN1cnJlbnRUaW1lTGVuZ3RoLFxuICAgICAgdGltZVBlcmlvZCxcbiAgICAgIHRpbWUsXG4gICAgICBleHBlY3RlZFRpbWUsXG4gICAgICBtdWx0aXBsaWVyLFxuICAgICAgbWluVGltZSxcbiAgICAgIG1heFRpbWUsXG4gICAgICBjdXJyZW50VmlzaWJsZVJhbmdlO1xuXG4gICAgY29uZmlnLmN1cnJlbnRWaXNpYmxlUmFuZ2UgPSBjdXJyZW50VmlzaWJsZVJhbmdlID0geEF4aXMuZ2V0Q3VycmVudFZpc2libGVSYW5nZSgpO1xuICAgIGNvbmZpZy5jdXJyZW50VGltZUxlbmd0aCA9IGN1cnJlbnRWaXNpYmxlUmFuZ2UuZW5kRGF0ZSAtIGN1cnJlbnRWaXNpYmxlUmFuZ2Uuc3RhcnREYXRlO1xuXG4gICAgYXZsVGltZVBlcmlvZHMgPSBjb25maWcuYXZsVGltZVBlcmlvZHM7XG4gICAgYXZsVGltZU11bHRpcGxpZXIgPSBjb25maWcuYXZsVGltZU11bHRpcGxpZXI7XG4gICAgY3VycmVudFRpbWVMZW5ndGggPSBjb25maWcuY3VycmVudFRpbWVMZW5ndGg7XG5cbiAgICBjb25maWcubWluVGltZSA9IG1pblRpbWUgPSBjdXJyZW50VGltZUxlbmd0aCAvIG1heE51bU9mUGxvdDtcbiAgICBjb25maWcubWF4VGltZSA9IG1heFRpbWUgPSBjdXJyZW50VGltZUxlbmd0aCAvIG1pbk51bU9mUGxvdDtcblxuICAgIGNvbmZpZy52YWxpZFRpbWVQZXJpb2QgPSBbXTtcbiAgICBjb25maWcudmFsaWRUaW1lUGVyaW9kTXVsdGlwbGllciA9IFtdO1xuXG4gICAgZm9yIChpID0gMCwgbGVuMSA9IGF2bFRpbWVQZXJpb2RzLmxlbmd0aDsgaSA8IGxlbjE7IGkrKykge1xuICAgICAgdGltZVBlcmlvZCA9IE9iamVjdC5rZXlzKGF2bFRpbWVQZXJpb2RzW2ldKVswXTtcbiAgICAgIHRpbWUgPSBhdmxUaW1lUGVyaW9kc1tpXVtPYmplY3Qua2V5cyhhdmxUaW1lUGVyaW9kc1tpXSlbMF1dO1xuICAgICAgbXVsdGlwbGllcnNBcnIgPSBbXTtcblxuICAgICAgZm9yIChqID0gMCwgbGVuMiA9IGF2bFRpbWVNdWx0aXBsaWVyW2ldLmxlbmd0aDsgaiA8IGxlbjI7IGorKykge1xuICAgICAgICBtdWx0aXBsaWVyID0gYXZsVGltZU11bHRpcGxpZXJbaV1bal07XG4gICAgICAgIGV4cGVjdGVkVGltZSA9IG11bHRpcGxpZXIgKiB0aW1lO1xuXG4gICAgICAgIGlmICgoZXhwZWN0ZWRUaW1lID49IG1pblRpbWUpICYmIChleHBlY3RlZFRpbWUgPD0gbWF4VGltZSkpIHtcbiAgICAgICAgICBtdWx0aXBsaWVyc0Fyci5wdXNoKGF2bFRpbWVNdWx0aXBsaWVyW2ldW2pdKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKG11bHRpcGxpZXJzQXJyLmxlbmd0aCA+IDApIHtcbiAgICAgICAgY29uZmlnLnZhbGlkVGltZVBlcmlvZE11bHRpcGxpZXIucHVzaChtdWx0aXBsaWVyc0Fycik7XG4gICAgICAgIGNvbmZpZy52YWxpZFRpbWVQZXJpb2QucHVzaCh0aW1lUGVyaW9kKTtcbiAgICAgIH1cbiAgICB9XG4gICAgY29uc29sZS5sb2coJ1RpbWUgUGVyaW9kOiAnLCBjb25maWcudmFsaWRUaW1lUGVyaW9kKTtcbiAgICBjb25zb2xlLmxvZygnTnVtYmVyIE9mIE11bHRpcGxpZXJzOiAnLCBjb25maWcudmFsaWRUaW1lUGVyaW9kTXVsdGlwbGllcik7XG4gICAgY29uc29sZS5sb2coJ01ldGhvZHM6ICcsIGNvbmZpZy5hdmxBZ2dNZXRob2RzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgQWdncmVnYXRpb24gb24gdGltZSBzZXJpZXNcbiAgICogQHBhcmFtICB7b2JqZWN0fSBvYmpcbiAgICogQHByb3BlcnR5IHtzdHJpbmd9IHRpbWVQZXJpb2QgLSBUaGUgdGltZSBpbnRlcnZhbCBvZiBhZ2dyZWdhdGlvbi5cbiAgICogQHByb3BlcnR5IHtudW1iZXJ9IHRpbWVQZXJpb2RNdWx0aXBsaWVyIC0gVGhlIG11bHRpcGxpZXIgb2YgdGltZSBpbnRlcnZhbC5cbiAgICogQHByb3BlcnR5IHtzdHJpbmd9IGFnZ3JlZ2F0aW9uTWV0aG9kIC0gVGhlIG1ldGhvZCBhcHBsaWVkIHRvIGFnZ3JlZ2F0ZS5cbiAgICovXG4gIHNldEFnZ3JlZ2F0aW9uIChvYmopIHtcbiAgICB2YXIgYXZsQWdnTWV0aG9kcyxcbiAgICAgIHZhbGlkVGltZVBlcmlvZCxcbiAgICAgIHRpbWVQZXJpb2RJbmRleCxcbiAgICAgIHZhbGlkVGltZVBlcmlvZE11bHRpcGxpZXIsXG4gICAgICBjb25maWcgPSB0aGlzLmNvbmZpZztcblxuICAgIGF2bEFnZ01ldGhvZHMgPSBjb25maWcuYXZsQWdnTWV0aG9kcztcbiAgICB2YWxpZFRpbWVQZXJpb2QgPSBjb25maWcudmFsaWRUaW1lUGVyaW9kO1xuICAgIHZhbGlkVGltZVBlcmlvZE11bHRpcGxpZXIgPSBjb25maWcudmFsaWRUaW1lUGVyaW9kTXVsdGlwbGllcjtcblxuICAgIGlmIChhdmxBZ2dNZXRob2RzLmluY2x1ZGVzKG9iai5hZ2dyZWdhdGlvbk1ldGhvZCkgJiYgdmFsaWRUaW1lUGVyaW9kLmluY2x1ZGVzKG9iai50aW1lUGVyaW9kKSkge1xuICAgICAgdGltZVBlcmlvZEluZGV4ID0gdmFsaWRUaW1lUGVyaW9kLmluZGV4T2Yob2JqLnRpbWVQZXJpb2QpO1xuICAgICAgaWYgKHZhbGlkVGltZVBlcmlvZE11bHRpcGxpZXJbdGltZVBlcmlvZEluZGV4XS5pbmNsdWRlcyhvYmoudGltZVBlcmlvZE11bHRpcGxpZXIpKSB7XG4gICAgICAgIHRoaXMuYWdncmVnYXRpb24gPSBvYmo7XG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXMuYWdncmVnYXRpb24pO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXMuYWdncmVnYXRpb24pO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnNvbGUubG9nKHRoaXMuYWdncmVnYXRpb24pO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBSZXNldCBBcHBsaWVkIEFnZ3JlZ2F0aW9uXG4gICAqL1xuICByZXNldEFnZ3JlZ2F0aW9uICgpIHtcblxuICB9XG5cbiAgaW5pdCAocmVxdWlyZSkge1xuICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgIHJlcXVpcmUoJ1gtQXhpcycsICdjaGFydCcsIGZ1bmN0aW9uICh4LCBjaGFydCkge1xuICAgICAgc2VsZi54ID0geDtcbiAgICAgIHNlbGYuY2hhcnQgPSBjaGFydDtcbiAgICB9KTtcblxuICAgIHRoaXMuZ2V0QXZhaWxhYmxlbEFnZ3JlYWdhdGlvbigpO1xuICAgIHRoaXMuZ2V0VmFsaWRBZ2dyZWdhdGlvbigpO1xuICB9XG5cbiAgcGxhY2VJbkNhbnZhcyAoKSB7XG4gICAgLy8gc3BhY2UgbWFuYWdlbWVudFxuICB9XG5cbiAgZHJhdyAoKSB7XG4gICAgdmFyIG11bHRpcGxpZXJGbGQsXG4gICAgICB0aW1lUGVyaW9kRmxkLFxuICAgICAgQWdnTWV0aG9kRmxkLFxuICAgICAgLy8gY2hhcnQgPSB0aGlzLmNoYXJ0LFxuICAgICAgY29uZmlnID0gdGhpcy5jb25maWcsXG4gICAgICAvLyBjdXJyZW50QWdncmVnYXRpb24sXG4gICAgICBsYWJlbCxcbiAgICAgIG1haW5Db250ID0gJCgnI21haW5Db250JyksXG4gICAgICB2YWxpZFRpbWVQZXJpb2QgPSBjb25maWcudmFsaWRUaW1lUGVyaW9kLFxuICAgICAgdmFsaWRUaW1lUGVyaW9kTXVsdGlwbGllciA9IGNvbmZpZy52YWxpZFRpbWVQZXJpb2RNdWx0aXBsaWVyLFxuICAgICAgaW5kZXhPZlRpbWVVbml0LFxuICAgICAgYXZsQWdnTWV0aG9kcyA9IGNvbmZpZy5hdmxBZ2dNZXRob2RzLFxuICAgICAgdGltZVBlcmlvZE9uQ2hhbmdlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdGltZVBlcmlvZFZhbCA9ICQoJyN0aW1lX3BlcmlvZCcpLnZhbCgpLFxuICAgICAgICAgIHRpbWVQZXJpb2RNdWx0aXBsaWVyVmFsID0gJCgnI211bCcpLnZhbCgpLFxuICAgICAgICAgIGluZGV4T2ZUaW1lVW5pdCxcbiAgICAgICAgICBpbmRleE9mVGltZU11bDtcblxuICAgICAgICBpbmRleE9mVGltZVVuaXQgPSB2YWxpZFRpbWVQZXJpb2QuaW5kZXhPZih0aW1lUGVyaW9kVmFsKTtcbiAgICAgICAgaW5kZXhPZlRpbWVNdWwgPSB2YWxpZFRpbWVQZXJpb2RNdWx0aXBsaWVyW2luZGV4T2ZUaW1lVW5pdF0uaW5kZXhPZihOdW1iZXIodGltZVBlcmlvZE11bHRpcGxpZXJWYWwpKTtcblxuICAgICAgICAkKCcjbXVsJykuZW1wdHkoKTtcbiAgICAgICAgY29uc29sZS5sb2coaW5kZXhPZlRpbWVVbml0LCBpbmRleE9mVGltZU11bCk7XG5cbiAgICAgICAgZm9yICh2YXIgbXVsVmFsIG9mIHZhbGlkVGltZVBlcmlvZE11bHRpcGxpZXJbaW5kZXhPZlRpbWVVbml0XSkge1xuICAgICAgICAgICQoJzxvcHRpb24gLz4nLCB7dGV4dDogbXVsVmFsfSkuYXBwZW5kVG8obXVsdGlwbGllckZsZCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoaW5kZXhPZlRpbWVNdWwgPCAwKSB7XG4gICAgICAgICAgJCgnI211bCcpLnZhbCh2YWxpZFRpbWVQZXJpb2RNdWx0aXBsaWVyW2luZGV4T2ZUaW1lVW5pdF1bMF0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICQoJyNtdWwnKS52YWwodGltZVBlcmlvZE11bHRpcGxpZXJWYWwpO1xuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgLy8gY3VycmVudEFnZ3JlZ2F0aW9uID0gY2hhcnQuZ2V0QWdncmVnYXRpb24oKTtcblxuICAgIGlmIChtYWluQ29udC5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBtYWluQ29udC5lbXB0eSgpO1xuXG4gICAgbGFiZWwgPSAkKCc8bGFiZWw+JykudGV4dCgnQWdncmVnYXRlIERhdGE6ICcpO1xuICAgIGxhYmVsLmFwcGVuZFRvKG1haW5Db250KTtcblxuICAgIG11bHRpcGxpZXJGbGQgPSAkKCc8c2VsZWN0IGlkPVwibXVsXCIvPicpO1xuICAgIHRpbWVQZXJpb2RGbGQgPSAkKCc8c2VsZWN0IGlkPVwidGltZV9wZXJpb2RcIi8+Jyk7XG4gICAgQWdnTWV0aG9kRmxkID0gJCgnPHNlbGVjdCBpZD1cImFnZ19tZXRob2RcIi8+Jyk7XG5cbiAgICBmb3IgKHZhciB1bml0VmFsIG9mIHZhbGlkVGltZVBlcmlvZCkge1xuICAgICAgJCgnPG9wdGlvbiAvPicsIHt0ZXh0OiB1bml0VmFsfSkuYXBwZW5kVG8odGltZVBlcmlvZEZsZCk7XG4gICAgfVxuXG4gICAgaW5kZXhPZlRpbWVVbml0ID0gdmFsaWRUaW1lUGVyaW9kLmluZGV4T2YodmFsaWRUaW1lUGVyaW9kWzBdKTtcblxuICAgIGlmIChpbmRleE9mVGltZVVuaXQgPj0gMCkge1xuICAgICAgZm9yICh2YXIgbXVsVmFsIG9mIHZhbGlkVGltZVBlcmlvZE11bHRpcGxpZXJbaW5kZXhPZlRpbWVVbml0XSkge1xuICAgICAgICAkKCc8b3B0aW9uIC8+Jywge3RleHQ6IG11bFZhbH0pLmFwcGVuZFRvKG11bHRpcGxpZXJGbGQpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGZvciAodmFyIGFnZ1ZhbCBvZiBhdmxBZ2dNZXRob2RzKSB7XG4gICAgICAkKCc8b3B0aW9uIC8+Jywge3RleHQ6IGFnZ1ZhbH0pLmFwcGVuZFRvKEFnZ01ldGhvZEZsZCk7XG4gICAgfVxuXG4gICAgbXVsdGlwbGllckZsZC5hcHBlbmRUbyhtYWluQ29udCk7XG4gICAgLy8gJCgnI211bCcpLnZhbChjdXJyZW50QWdncmVnYXRpb24udGltZVBlcmlvZE11bHRpcGxpZXIpO1xuICAgIHRpbWVQZXJpb2RGbGQuYXBwZW5kVG8obWFpbkNvbnQpO1xuICAgIC8vICQoJyN0aW1lX3BlcmlvZCcpLnZhbChjdXJyZW50QWdncmVnYXRpb24udGltZVBlcmlvZCk7XG4gICAgQWdnTWV0aG9kRmxkLmFwcGVuZFRvKG1haW5Db250KTtcbiAgICAvLyAkKCcjYWdnX21ldGhvZCcpLnZhbChjdXJyZW50QWdncmVnYXRpb24uYWdncmVnYXRpb25NZXRob2QpO1xuXG4gICAgJCgnPGJ1dHRvbi8+JykudGV4dCgnQXBwbHknKS5hcHBlbmRUbyhtYWluQ29udCk7XG4gICAgJCgnPGJ1dHRvbi8+JykudGV4dCgnUmVzZXQnKS5hcHBlbmRUbyhtYWluQ29udCk7XG5cbiAgICAkKCcjdGltZV9wZXJpb2QnKS5jaGFuZ2UodGltZVBlcmlvZE9uQ2hhbmdlKTtcbiAgfVxuXG4gIHJhbmdlQ2hhbmdlQ2FsbGJhY2sgKCkge1xuICAgIHRoaXMuZ2V0VmFsaWRBZ2dyZWdhdGlvbigpO1xuICAgIHRoaXMuZHJhdygpO1xuICB9XG5cbiAgZGlzcG9zZSAoKSB7XG4gICAgLy8gZGlzcG9zZSBleHRlbnNpb25cbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IEFnZ3JlZ2F0b3I7XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL3NyYy9mY3RzLWV4dC1hZ2dyZWdhdG9yLmpzXG4vLyBtb2R1bGUgaWQgPSAyXG4vLyBtb2R1bGUgY2h1bmtzID0gMCJdfQ==