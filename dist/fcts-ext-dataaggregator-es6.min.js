(function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={exports:{},id:moduleId,loaded:false };modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.loaded=true;return module.exports;}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.p="";return __webpack_require__(0);})([function(module,exports,__webpack_require__){module.exports=__webpack_require__(1);},function(module,exports,__webpack_require__){'use strict';const Aggregator=__webpack_require__(2);;(function(factory){factory(FusionCharts)})(function(FC){FC.register('extension',['data-aggregator',function(id){var global=this;var extAPI=global.extAPI;console.log(id);window.Aggregator=new Aggregator();extAPI(window.Aggregator)}])});},function(module,exports){(function(global){'use strict';class Aggregator{constructor(){this.appliedAggregation={timePeriod:null,timePeriodMultiplier:1,aggregationMethod:null};this.config={}}get aggregation(){return this.appliedAggregation}set aggregation(obj){this.appliedAggregation.timePeriod=obj.timePeriod;this.appliedAggregation.timePeriodMultiplier=obj.timePeriodMultiplier;this.appliedAggregation.aggregationMethod=obj.aggregationMethod}getTimeMultiplier(){}getAvailablelAggreagation(){var config=this.config,avlAggMethods,avlTimePeriods,currentVisibleRange,currentTimeLength,xAxis=global.x,chart=global.chart;avlAggMethods=chart.getAvailableAggregationMethod();avlTimePeriods=avlTimePeriods=chart.getAvailableTimePeriod();currentVisibleRange=xAxis.getCurrentVisibleRange();currentTimeLength=currentVisibleRange.endDate-currentVisibleRange.startDate;config.avlTimePeriods=avlTimePeriods;config.avlAggMethods=avlAggMethods;config.currentTimeLength=currentTimeLength}getValidTimeMultiplier(){var config=this.config,xAxis=global.x,i,len,currTimePeriod,nextTimePeriod,numOfMultiplier,currentTimeLength=xAxis.max-xAxis.min,avlTimePeriods=config.avlTimePeriods,getMultiplierArray=num=>Array.from({length:num},(v,k)=>k+1);config.avlTimeMultiplier=[];len=avlTimePeriods.length;for(i=0;i<len;i+=1){currTimePeriod=avlTimePeriods[i];nextTimePeriod=avlTimePeriods[(i+1)];if(nextTimePeriod){numOfMultiplier=nextTimePeriod[Object.keys(nextTimePeriod)[0]]/currTimePeriod[Object.keys(currTimePeriod)[0]]}else{numOfMultiplier=currentTimeLength/currTimePeriod[Object.keys(currTimePeriod)[0]]}config.avlTimeMultiplier.push(getMultiplierArray(numOfMultiplier))}}getValidAggregation(){var chartConfig=global.chart.config,config=this.config,i,j,len1,len2,avlTimePeriods,avlTimeMultiplier,minNumOfPlot=chartConfig.minNumOfPlot,minPlotWidth=chartConfig.minPlotWidth,canvasWidth=chartConfig.canvasWidth,currentTimeLength,timePeriod,time,expectedTime,multiplier,multiplierCounter,getMultiplierArray=num=>Array.from({length:num},(v,k)=>k+1),minTime,maxTime;avlTimePeriods=config.avlTimePeriods;avlTimeMultiplier=config.avlTimeMultiplier;currentTimeLength=config.currentTimeLength;config.minTime=minTime=(currentTimeLength/canvasWidth)*minPlotWidth;config.maxTime=maxTime=currentTimeLength/minNumOfPlot;config.validTimePeriod=[];config.validTimePeriodMultiplier=[];for(i=0,len1=avlTimePeriods.length;i<len1;i+=1){timePeriod=Object.keys(avlTimePeriods[i])[0];time=avlTimePeriods[i][Object.keys(avlTimePeriods[i])[0]];multiplierCounter=0;for(j=0,len2=avlTimeMultiplier[i].length;j<len2;j+=1){multiplier=avlTimeMultiplier[i][j];expectedTime=multiplier*time;if((expectedTime>=minTime)&&(expectedTime<=maxTime)){multiplierCounter+=1}}if(multiplierCounter){config.validTimePeriodMultiplier.push(getMultiplierArray(multiplierCounter));config.validTimePeriod.push(timePeriod)}}console.log(config.validTimePeriod,config.validTimePeriodMultiplier,config.avlAggMethods)}setAggregation(obj){var avlAggMethods,validTimePeriod,timePeriodIndex,validTimePeriodMultiplier,config=this.config;this.getValidAggregation();avlAggMethods=config.avlAggMethods;validTimePeriod=config.validTimePeriod;validTimePeriodMultiplier=config.validTimePeriodMultiplier;if(avlAggMethods.includes(obj.aggregationMethod)&&validTimePeriod.includes(obj.timePeriod)){timePeriodIndex=validTimePeriod.indexOf(obj.timePeriod);if(validTimePeriodMultiplier[timePeriodIndex].includes(obj.timePeriodMultiplier)){this.aggregation=obj;console.log(this.aggregation,true);return true}else{console.log(this.aggregation,false);return false}}else{console.log(this.aggregation,false);return false}}resetAggregation(){}init(require){require('X-Axis','chart',function(x,chart){global.x=x;global.chart=chart});this.getAvailablelAggreagation();this.getValidTimeMultiplier();}placeInCanvas(){}draw(){}dispose(){}}module.exports=Aggregator;}.call(exports,(function(){return this}())));}]);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAgZTdkNzMwMGI4YTQ3ZTZhYTM3OTIiLCJ3ZWJwYWNrOi8vLy4vc3JjL2luZGV4LmpzIiwid2VicGFjazovLy8uL3NyYy9mY3RzLWV4dC1hZ2dyZWdhdG9yLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSx1QkFBZTtBQUNmO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOzs7QUFHQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOzs7Ozs7Ozs7Ozs7OztBQ3RDQTtBQUNBOztBQUVBLEVBQUM7QUFDRDtBQUNBLEVBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0EsSUFBRztBQUNILEVBQUM7Ozs7Ozs7QUNsQkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZSxPQUFPO0FBQ3RCLGlCQUFnQixPQUFPO0FBQ3ZCLGlCQUFnQixPQUFPO0FBQ3ZCLGlCQUFnQixPQUFPO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsYUFBWTtBQUNaO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQ0FBOEMsWUFBWTs7QUFFMUQ7QUFDQTs7QUFFQSxnQkFBZSxTQUFTO0FBQ3hCO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsUUFBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQ0FBOEMsWUFBWTtBQUMxRDtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUEsOENBQTZDLFVBQVU7QUFDdkQ7QUFDQTtBQUNBOztBQUVBLHNEQUFxRCxVQUFVO0FBQy9EO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQU87QUFDUDtBQUNBO0FBQ0E7QUFDQSxNQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUEiLCJmaWxlIjoiZmN0cy1leHQtZGF0YWFnZ3JlZ2F0b3ItZXM2Lm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKVxuIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuXG4gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbiBcdFx0XHRleHBvcnRzOiB7fSxcbiBcdFx0XHRpZDogbW9kdWxlSWQsXG4gXHRcdFx0bG9hZGVkOiBmYWxzZVxuIFx0XHR9O1xuXG4gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4gXHRcdG1vZHVsZS5sb2FkZWQgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiO1xuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKDApO1xuXG5cblxuLyoqIFdFQlBBQ0sgRk9PVEVSICoqXG4gKiogd2VicGFjay9ib290c3RyYXAgZTdkNzMwMGI4YTQ3ZTZhYTM3OTJcbiAqKi8iLCIndXNlIHN0cmljdCc7XG5jb25zdCBBZ2dyZWdhdG9yID0gcmVxdWlyZSgnLi9mY3RzLWV4dC1hZ2dyZWdhdG9yJyk7XG5cbjsoZnVuY3Rpb24gKGZhY3RvcnkpIHtcbiAgZmFjdG9yeShGdXNpb25DaGFydHMpO1xufSkoZnVuY3Rpb24gKEZDKSB7XG4gIEZDLnJlZ2lzdGVyKCdleHRlbnNpb24nLCBbJ2RhdGEtYWdncmVnYXRvcicsIGZ1bmN0aW9uIChpZCkge1xuICAgIHZhciBnbG9iYWwgPSB0aGlzO1xuICAgIHZhciBleHRBUEkgPSBnbG9iYWwuZXh0QVBJO1xuICAgIGNvbnNvbGUubG9nKGlkKTtcblxuICAgIC8vIHZhciBvdGhlckFQSSA9IEZ1c2lvbkNoYXJ0cy5nZXRFeHRDb21wb25lbnQoaWQsICdhcGknLCAnbGVnYWN5ZXh0YXBpJyk7XG4gICAgLy8gdmFyIHRvb2xCb3hBcGkgPSBGdXNpb25DaGFydHMuZ2V0Q29tcG9uZW50KCdhcGknLCAndG9vbGJveCcpO1xuXG4gICAgd2luZG93LkFnZ3JlZ2F0b3IgPSBuZXcgQWdncmVnYXRvcigpO1xuXG4gICAgZXh0QVBJKHdpbmRvdy5BZ2dyZWdhdG9yKTtcbiAgfV0pO1xufSk7XG5cblxuXG4vKioqKioqKioqKioqKioqKipcbiAqKiBXRUJQQUNLIEZPT1RFUlxuICoqIC4vc3JjL2luZGV4LmpzXG4gKiogbW9kdWxlIGlkID0gMVxuICoqIG1vZHVsZSBjaHVua3MgPSAwXG4gKiovIiwiJ3VzZSBzdHJpY3QnO1xuLyoqXG4gKiBDbGFzcyByZXByZXNlbnRpbmcgdGhlIERhdGEgQWdncmVnYXRvci5cbiAqL1xuY2xhc3MgQWdncmVnYXRvciB7XG4gIC8qKlxuICAgKiBDcmVhdGUgYSBBZ2dyZWdhdG9yLlxuICAgKiBAdHlwZWRlZiB7b2JqZWN0fSBBZ2dyZWdhdG9yLmFnZ3JlZ2F0aW9uXG4gICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSB0aW1lUGVyaW9kIC0gVGhlIHRpbWUgaW50ZXJ2YWwgb2YgYWdncmVnYXRpb24uXG4gICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSB0aW1lUGVyaW9kTXVsdGlwbGllciAtIFRoZSBtdWx0aXBsaWVyIG9mIHRpbWUgaW50ZXJ2YWwuXG4gICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBhZ2dyZWdhdGlvbk1ldGhvZCAtIFRoZSBtZXRob2QgYXBwbGllZCB0byBhZ2dyZWdhdGUuXG4gICAqL1xuICBjb25zdHJ1Y3RvciAoKSB7XG4gICAgLyoqXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICB0aGlzLmFwcGxpZWRBZ2dyZWdhdGlvbiA9IHtcbiAgICAgIHRpbWVQZXJpb2Q6IG51bGwsXG4gICAgICB0aW1lUGVyaW9kTXVsdGlwbGllcjogMSxcbiAgICAgIGFnZ3JlZ2F0aW9uTWV0aG9kOiBudWxsXG4gICAgfTtcbiAgICB0aGlzLmNvbmZpZyA9IHt9O1xuICB9XG5cbiAgLyoqXG4gICAqIEFuIG9iamVjdCByZXByZXNlbnRpbmcgdGhlIHRpbWVQZXJpb2QsIHRpbWVQZXJpb2RNdWx0aXBsaWVyLCBhZ2dyZWdhdGlvbk1ldGhvZC5cbiAgICogQHR5cGUge0FnZ3JlZ2F0b3IuYWdncmVnYXRpb259XG4gICAqL1xuICBnZXQgYWdncmVnYXRpb24gKCkge1xuICAgIHJldHVybiB0aGlzLmFwcGxpZWRBZ2dyZWdhdGlvbjtcbiAgfVxuXG4gIHNldCBhZ2dyZWdhdGlvbiAob2JqKSB7XG4gICAgdGhpcy5hcHBsaWVkQWdncmVnYXRpb24udGltZVBlcmlvZCA9IG9iai50aW1lUGVyaW9kO1xuICAgIHRoaXMuYXBwbGllZEFnZ3JlZ2F0aW9uLnRpbWVQZXJpb2RNdWx0aXBsaWVyID0gb2JqLnRpbWVQZXJpb2RNdWx0aXBsaWVyO1xuICAgIHRoaXMuYXBwbGllZEFnZ3JlZ2F0aW9uLmFnZ3JlZ2F0aW9uTWV0aG9kID0gb2JqLmFnZ3JlZ2F0aW9uTWV0aG9kO1xuICB9XG5cbiAgZ2V0VGltZU11bHRpcGxpZXIgKCkge1xuXG4gIH1cblxuICBnZXRBdmFpbGFibGVsQWdncmVhZ2F0aW9uICgpIHtcbiAgICB2YXIgY29uZmlnID0gdGhpcy5jb25maWcsXG4gICAgICBhdmxBZ2dNZXRob2RzLFxuICAgICAgYXZsVGltZVBlcmlvZHMsXG4gICAgICBjdXJyZW50VmlzaWJsZVJhbmdlLFxuICAgICAgY3VycmVudFRpbWVMZW5ndGgsXG4gICAgICB4QXhpcyA9IGdsb2JhbC54LFxuICAgICAgY2hhcnQgPSBnbG9iYWwuY2hhcnQ7XG5cbiAgICBhdmxBZ2dNZXRob2RzID0gY2hhcnQuZ2V0QXZhaWxhYmxlQWdncmVnYXRpb25NZXRob2QoKTtcbiAgICBhdmxUaW1lUGVyaW9kcyA9IGF2bFRpbWVQZXJpb2RzID0gY2hhcnQuZ2V0QXZhaWxhYmxlVGltZVBlcmlvZCgpO1xuXG4gICAgY3VycmVudFZpc2libGVSYW5nZSA9IHhBeGlzLmdldEN1cnJlbnRWaXNpYmxlUmFuZ2UoKTtcbiAgICBjdXJyZW50VGltZUxlbmd0aCA9IGN1cnJlbnRWaXNpYmxlUmFuZ2UuZW5kRGF0ZSAtIGN1cnJlbnRWaXNpYmxlUmFuZ2Uuc3RhcnREYXRlO1xuXG4gICAgY29uZmlnLmF2bFRpbWVQZXJpb2RzID0gYXZsVGltZVBlcmlvZHM7XG4gICAgY29uZmlnLmF2bEFnZ01ldGhvZHMgPSBhdmxBZ2dNZXRob2RzO1xuICAgIGNvbmZpZy5jdXJyZW50VGltZUxlbmd0aCA9IGN1cnJlbnRUaW1lTGVuZ3RoO1xuICB9XG5cbiAgZ2V0VmFsaWRUaW1lTXVsdGlwbGllciAoKSB7XG4gICAgdmFyIGNvbmZpZyA9IHRoaXMuY29uZmlnLFxuICAgICAgeEF4aXMgPSBnbG9iYWwueCxcbiAgICAgIGksXG4gICAgICBsZW4sXG4gICAgICBjdXJyVGltZVBlcmlvZCxcbiAgICAgIG5leHRUaW1lUGVyaW9kLFxuICAgICAgbnVtT2ZNdWx0aXBsaWVyLFxuICAgICAgY3VycmVudFRpbWVMZW5ndGggPSB4QXhpcy5tYXggLSB4QXhpcy5taW4sXG4gICAgICBhdmxUaW1lUGVyaW9kcyA9IGNvbmZpZy5hdmxUaW1lUGVyaW9kcyxcbiAgICAgIGdldE11bHRpcGxpZXJBcnJheSA9IG51bSA9PiBBcnJheS5mcm9tKHtsZW5ndGg6IG51bX0sICh2LCBrKSA9PiBrICsgMSk7XG5cbiAgICBjb25maWcuYXZsVGltZU11bHRpcGxpZXIgPSBbXTtcbiAgICBsZW4gPSBhdmxUaW1lUGVyaW9kcy5sZW5ndGg7XG5cbiAgICBmb3IgKGkgPSAwOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgIGN1cnJUaW1lUGVyaW9kID0gYXZsVGltZVBlcmlvZHNbaV07XG4gICAgICBuZXh0VGltZVBlcmlvZCA9IGF2bFRpbWVQZXJpb2RzWyhpICsgMSldO1xuXG4gICAgICBpZiAobmV4dFRpbWVQZXJpb2QpIHtcbiAgICAgICAgbnVtT2ZNdWx0aXBsaWVyID1cbiAgICAgICAgICBuZXh0VGltZVBlcmlvZFtPYmplY3Qua2V5cyhuZXh0VGltZVBlcmlvZClbMF1dIC8gY3VyclRpbWVQZXJpb2RbT2JqZWN0LmtleXMoY3VyclRpbWVQZXJpb2QpWzBdXTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG51bU9mTXVsdGlwbGllciA9XG4gICAgICAgICAgY3VycmVudFRpbWVMZW5ndGggLyBjdXJyVGltZVBlcmlvZFtPYmplY3Qua2V5cyhjdXJyVGltZVBlcmlvZClbMF1dO1xuICAgICAgfVxuICAgICAgY29uZmlnLmF2bFRpbWVNdWx0aXBsaWVyLnB1c2goZ2V0TXVsdGlwbGllckFycmF5KG51bU9mTXVsdGlwbGllcikpO1xuICAgIH1cbiAgfVxuXG4gIGdldFZhbGlkQWdncmVnYXRpb24gKCkge1xuICAgIHZhciBjaGFydENvbmZpZyA9IGdsb2JhbC5jaGFydC5jb25maWcsXG4gICAgICBjb25maWcgPSB0aGlzLmNvbmZpZyxcbiAgICAgIGksXG4gICAgICBqLFxuICAgICAgbGVuMSxcbiAgICAgIGxlbjIsXG4gICAgICBhdmxUaW1lUGVyaW9kcyxcbiAgICAgIGF2bFRpbWVNdWx0aXBsaWVyLFxuICAgICAgbWluTnVtT2ZQbG90ID0gY2hhcnRDb25maWcubWluTnVtT2ZQbG90LFxuICAgICAgbWluUGxvdFdpZHRoID0gY2hhcnRDb25maWcubWluUGxvdFdpZHRoLFxuICAgICAgY2FudmFzV2lkdGggPSBjaGFydENvbmZpZy5jYW52YXNXaWR0aCxcbiAgICAgIGN1cnJlbnRUaW1lTGVuZ3RoLFxuICAgICAgdGltZVBlcmlvZCxcbiAgICAgIHRpbWUsXG4gICAgICBleHBlY3RlZFRpbWUsXG4gICAgICBtdWx0aXBsaWVyLFxuICAgICAgbXVsdGlwbGllckNvdW50ZXIsXG4gICAgICBnZXRNdWx0aXBsaWVyQXJyYXkgPSBudW0gPT4gQXJyYXkuZnJvbSh7bGVuZ3RoOiBudW19LCAodiwgaykgPT4gayArIDEpLFxuICAgICAgbWluVGltZSxcbiAgICAgIG1heFRpbWU7XG5cbiAgICBhdmxUaW1lUGVyaW9kcyA9IGNvbmZpZy5hdmxUaW1lUGVyaW9kcztcbiAgICBhdmxUaW1lTXVsdGlwbGllciA9IGNvbmZpZy5hdmxUaW1lTXVsdGlwbGllcjtcbiAgICBjdXJyZW50VGltZUxlbmd0aCA9IGNvbmZpZy5jdXJyZW50VGltZUxlbmd0aDtcblxuICAgIGNvbmZpZy5taW5UaW1lID0gbWluVGltZSA9IChjdXJyZW50VGltZUxlbmd0aCAvIGNhbnZhc1dpZHRoKSAqIG1pblBsb3RXaWR0aDtcbiAgICBjb25maWcubWF4VGltZSA9IG1heFRpbWUgPSBjdXJyZW50VGltZUxlbmd0aCAvIG1pbk51bU9mUGxvdDtcblxuICAgIGNvbmZpZy52YWxpZFRpbWVQZXJpb2QgPSBbXTtcbiAgICBjb25maWcudmFsaWRUaW1lUGVyaW9kTXVsdGlwbGllciA9IFtdO1xuXG4gICAgZm9yIChpID0gMCwgbGVuMSA9IGF2bFRpbWVQZXJpb2RzLmxlbmd0aDsgaSA8IGxlbjE7IGkrKykge1xuICAgICAgdGltZVBlcmlvZCA9IE9iamVjdC5rZXlzKGF2bFRpbWVQZXJpb2RzW2ldKVswXTtcbiAgICAgIHRpbWUgPSBhdmxUaW1lUGVyaW9kc1tpXVtPYmplY3Qua2V5cyhhdmxUaW1lUGVyaW9kc1tpXSlbMF1dO1xuICAgICAgbXVsdGlwbGllckNvdW50ZXIgPSAwO1xuXG4gICAgICBmb3IgKGogPSAwLCBsZW4yID0gYXZsVGltZU11bHRpcGxpZXJbaV0ubGVuZ3RoOyBqIDwgbGVuMjsgaisrKSB7XG4gICAgICAgIG11bHRpcGxpZXIgPSBhdmxUaW1lTXVsdGlwbGllcltpXVtqXTtcbiAgICAgICAgZXhwZWN0ZWRUaW1lID0gbXVsdGlwbGllciAqIHRpbWU7XG5cbiAgICAgICAgaWYgKChleHBlY3RlZFRpbWUgPj0gbWluVGltZSkgJiYgKGV4cGVjdGVkVGltZSA8PSBtYXhUaW1lKSkge1xuICAgICAgICAgIG11bHRpcGxpZXJDb3VudGVyKys7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChtdWx0aXBsaWVyQ291bnRlcikge1xuICAgICAgICBjb25maWcudmFsaWRUaW1lUGVyaW9kTXVsdGlwbGllci5wdXNoKGdldE11bHRpcGxpZXJBcnJheShtdWx0aXBsaWVyQ291bnRlcikpO1xuICAgICAgICBjb25maWcudmFsaWRUaW1lUGVyaW9kLnB1c2godGltZVBlcmlvZCk7XG4gICAgICB9XG4gICAgfVxuICAgIGNvbnNvbGUubG9nKGNvbmZpZy52YWxpZFRpbWVQZXJpb2QsIGNvbmZpZy52YWxpZFRpbWVQZXJpb2RNdWx0aXBsaWVyLCBjb25maWcuYXZsQWdnTWV0aG9kcyk7XG4gIH1cblxuICAvKipcbiAgICogU2V0IEFnZ3JlZ2F0aW9uIG9uIHRpbWUgc2VyaWVzXG4gICAqL1xuICBzZXRBZ2dyZWdhdGlvbiAob2JqKSB7XG4gICAgdmFyIGF2bEFnZ01ldGhvZHMsXG4gICAgICB2YWxpZFRpbWVQZXJpb2QsXG4gICAgICB0aW1lUGVyaW9kSW5kZXgsXG4gICAgICB2YWxpZFRpbWVQZXJpb2RNdWx0aXBsaWVyLFxuICAgICAgY29uZmlnID0gdGhpcy5jb25maWc7XG5cbiAgICB0aGlzLmdldFZhbGlkQWdncmVnYXRpb24oKTtcblxuICAgIGF2bEFnZ01ldGhvZHMgPSBjb25maWcuYXZsQWdnTWV0aG9kcztcbiAgICB2YWxpZFRpbWVQZXJpb2QgPSBjb25maWcudmFsaWRUaW1lUGVyaW9kO1xuICAgIHZhbGlkVGltZVBlcmlvZE11bHRpcGxpZXIgPSBjb25maWcudmFsaWRUaW1lUGVyaW9kTXVsdGlwbGllcjtcblxuICAgIGlmIChhdmxBZ2dNZXRob2RzLmluY2x1ZGVzKG9iai5hZ2dyZWdhdGlvbk1ldGhvZCkgJiYgdmFsaWRUaW1lUGVyaW9kLmluY2x1ZGVzKG9iai50aW1lUGVyaW9kKSkge1xuICAgICAgdGltZVBlcmlvZEluZGV4ID0gdmFsaWRUaW1lUGVyaW9kLmluZGV4T2Yob2JqLnRpbWVQZXJpb2QpO1xuICAgICAgaWYgKHZhbGlkVGltZVBlcmlvZE11bHRpcGxpZXJbdGltZVBlcmlvZEluZGV4XS5pbmNsdWRlcyhvYmoudGltZVBlcmlvZE11bHRpcGxpZXIpKSB7XG4gICAgICAgIHRoaXMuYWdncmVnYXRpb24gPSBvYmo7XG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXMuYWdncmVnYXRpb24sIHRydWUpO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXMuYWdncmVnYXRpb24sIGZhbHNlKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBjb25zb2xlLmxvZyh0aGlzLmFnZ3JlZ2F0aW9uLCBmYWxzZSk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFJlc2V0IEFwcGxpZWQgQWdncmVnYXRpb25cbiAgICovXG4gIHJlc2V0QWdncmVnYXRpb24gKCkge1xuXG4gIH1cblxuICBpbml0IChyZXF1aXJlKSB7XG4gICAgcmVxdWlyZSgnWC1BeGlzJywgJ2NoYXJ0JywgZnVuY3Rpb24gKHgsIGNoYXJ0KSB7XG4gICAgICBnbG9iYWwueCA9IHg7XG4gICAgICBnbG9iYWwuY2hhcnQgPSBjaGFydDtcbiAgICB9KTtcblxuICAgIHRoaXMuZ2V0QXZhaWxhYmxlbEFnZ3JlYWdhdGlvbigpO1xuICAgIHRoaXMuZ2V0VmFsaWRUaW1lTXVsdGlwbGllcigpO1xuICAgIC8vIHRoaXMuZ2V0VmFsaWRBZ2dyZWdhdGlvbigpO1xuICB9XG5cbiAgcGxhY2VJbkNhbnZhcyAoKSB7XG4gICAgLy8gc3BhY2UgbWFuYWdlbWVudFxuICB9XG5cbiAgZHJhdyAoKSB7XG4gICAgLy8gZHJhdyBleHRlbnNpb25cbiAgfVxuXG4gIGRpc3Bvc2UgKCkge1xuICAgIC8vIGRpc3Bvc2UgZXh0ZW5zaW9uXG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBBZ2dyZWdhdG9yO1xuXG5cblxuLyoqKioqKioqKioqKioqKioqXG4gKiogV0VCUEFDSyBGT09URVJcbiAqKiAuL3NyYy9mY3RzLWV4dC1hZ2dyZWdhdG9yLmpzXG4gKiogbW9kdWxlIGlkID0gMlxuICoqIG1vZHVsZSBjaHVua3MgPSAwXG4gKiovIl19