(function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p='',b(0)})([function(a,b,c){'use strict';const d=c(1);(function(e,f){'object'==typeof a&&a.exports?a.exports=e.document?f(e):function(g){if(!g.document)throw new Error('Window with document not present');return f(g,!0)}:e.Aggregator=f(e,!0)})('undefined'==typeof window?this:window,function(e){var f=e.FusionCharts;f.register('extension',['private','data-aggregator',function(){f.registerComponent('extensions','data-aggregator',d({FC:f}))}])})},function(a){'use strict';a.exports=function(b){var c=function(g){return g.charAt(0).toUpperCase()+g.slice(1)},d=function(g){return'object'==typeof g&&g.constructor===Object},e=function g(h,k,l){for(var m in k)m in h?'object'==typeof k[m]&&g(h[m],k[m],l):h[m]=d(k[m])?l.extend2({},k[m]):k[m]};class f{constructor(){this.appliedAggregation={binSize:null,aggregationMethod:null},this.config={}}get aggregation(){return this.appliedAggregation}set aggregation(g){this.appliedAggregation.timePeriod=g.timePeriod,this.appliedAggregation.timePeriodMultiplier=g.timePeriodMultiplier,this.appliedAggregation.aggregationMethod=g.aggregationMethod}getAvailablelAggreagation(){var l,m,g=this.config,h=g.dataAgg,k=g.avlTimePeriods=h.getAggregationTimeRules();for(g.avlTimeMultiplier=[],m=k.length,l=0;l<m;l++)g.avlTimeMultiplier.push(k[l].possibleFactors)}getValidAggregation(){var m,n,p,q,r,s,v,w,z,A,B,C,F,g=this,h=g.config,k=g.tsObject,l=h.dataAgg,t=h.composition.reactiveModel.model['max-plot-point'],u=h.composition.dataset.category.minimumConsecutiveDifference,D=k.globalReactiveModel,E=D.prop('x-axis-maximum-allowed-ticks');for(h.currentTimeLength=D.model['x-axis-visible-range-end']-D.model['x-axis-visible-range-start'],r=h.avlTimePeriods,s=h.avlTimeMultiplier,w=h.currentTimeLength,F=w/t,h.validTimePeriod=[],h.validTimePeriodMultiplier=[],h.avlAggMethods=l.getAllAggregationMethod(),(m=0,p=r.length);m<p;m++){for(z=r[m].name,A=r[m].interval,v=[],(n=0,q=s[m].length);n<q;n++)C=s[m][n],B=C*A,B>=F&&B>u&&w>0.5*(E*B)&&v.push(s[m][n]);0<v.length&&(h.validTimePeriodMultiplier.push(v),h.validTimePeriod.push(z))}}getCurrentAggreation(){var n,p,q,g=this,h=g.config,k=h.dataAgg,l=h.composition,m=l.reactiveModel;return q=m.prop('bin-size')-1,isFinite(q)&&(p=k.timeRules.getSuitableInterval(q),n=m.prop('aggregation-fn')),{timePeriod:p&&p.name,timePeriodMultiplier:p&&p.step,aggregationMethod:{value:n&&n.nickName,text:n&&n.formalName}}}init(g){var l,n,p,q,h=this,k=h.config,m=k.toolboxComponent={},r='tsObject',s=['graphics','globalReactiveModel','chart','spaceManagerInstance','chartInstance','smartLabel','extData','parentGroup','lib',function(){let u=0,v=s.length-1,w='';for(h[r]=h[r]||{},h.requiredParams={},u=0;u<v;++u)w=s[u],h[r][w]=arguments[u]}];return g(s),l=h.tsObject,k.usrConfig=l.extData,n=l.chartInstance.apiInstance,p=n.getComponentStore(),k.composition=q=p.getCanvasByIndex(0).composition,k.dataAgg=q.impl.getDataAggregator(),m.toolbox=b.FC.getComponent('api','toolbox'),m.config={},h.toolbars=[],h.measurement={},h.toolbars.push(h.createToolbar()),q.reactiveModel.onPropsChange(['bin-size','aggregation-fn'],function(){k.execute&&(k.execute=!1,setTimeout(()=>{h.rangeOnChange()},200))}),window.Aggregator=h,h}createToolbar(){function g(Y,Z,$){var _;for(var aa in Y)Q[Z][aa]&&($&&Q[Z][aa].states&&Q[Z][aa].states[$]?_=Q[Z][aa].states[$]:_=Q[Z][aa].style),_&&I.cssAddRule('.'+Y[aa],_)}function h(Y,Z,$){var _=E[Y]=Z($).setConfig(Q[Y].attrs);_.setParentGroup(W),_.setConfig({className:Q[Y].className}),_.namespace('fusioncharts'),_.appendSelector('ext1-'+X++),g(_.getIndividualClassNames(_.getClassName()),Y);var aa=_.config.states;for(var ba in aa)g(_.getIndividualClassNames(aa[ba]),Y,ba);var ca=_.config.dropDownMenu;for(var da in ca){var ea=ca[da];switch(da){case'container':I.cssAddRule('.'+ea.className,Q.dropDown.container.style);break;case'listItem':I.cssAddRule('.'+ea.className,Q.dropDown.listItem.style);var fa=ea.states;for(var ga in fa)I.cssAddRule('.'+fa[ga],Q.dropDown.listItem.states[ga].style);}}var ha=Q[Y].eventListeners;for(var ia=0,ja=ha.length;ia<ja;ia+=1){var ka=ha[ia],la={};la[ka.type]=ka.cb,_.attachEventHandlers(la)}return _}function k(Y){return h(Y,J.selectButton,[])}function l(Y){return h(Y,J.button,Q[Y].attrs.label)}var n,p,q,r,s,t,u,v,w,B,N,O,P,Q,m=this,z=m.config,A=m.tsObject,C=z.toolboxComponent,D=C.toolbox,E=C.config,F=D.HorizontalToolbar,G=D.ComponentGroup,H=A.graphics,I=H.paper,J=I.getInstances().d3,K=H.container,L=A.chart,M=A.smartLabel,R={paper:I,chart:L,smartLabel:M,chartContainer:K},S=()=>{var aa,ba,Y=t.value(),Z=s.value(),$=z.validTimePeriod,_=z.validTimePeriodMultiplier;aa=$.indexOf(Y),ba=_[aa].indexOf(+Z),O=[];for(N of _[aa])O.push({name:N.toString(),value:N.toString()});s.updateList(O),0>ba?s.value(_[aa][0].toString()):s.value(Z)},T=()=>{var Y=m.getCurrentAggreation();Y.timePeriodMultiplier=Y.timePeriodMultiplier&&Y.timePeriodMultiplier.toString(),Y.timePeriodMultiplier!==s.value()||Y.timePeriod!==t.value()||Y.aggregationMethod.value!==u.value()?w.removeState('disabled'):w.setState('disabled'),u.value()||u.value(z.defaultAggMethod),t.value()||s.value()||(t.value(z.validTimePeriod[0]),S())};n=new G(R,{hPadding:4}),p=new G(R,{hPadding:0}),q=new G(R,{hPadding:0}),r=new F(R),P=z.usrConfig;var U={container:{style:{fill:'#fff',stroke:'#c8cecd','stroke-width':'1'},states:{selected:{stroke:'#1e1f1f'},hover:{cursor:'pointer'}}},text:{style:{fill:'#696969',fontSize:'11px',fontFamily:'"Lucida Grande", sans-serif'}},arrow:{style:{fill:'#696969'}},attrs:{radius:2,width:50,height:22,margin:{right:3}}},V={label:{container:{height:22,style:{}},text:{style:{'font-size':13,'font-family':'"Lucida Grande", sans-serif','font-weight':'normal',fill:'#4b4b4b'}}},timeMulSelectMenu:{container:U.container,text:U.text,arrow:U.arrow,attrs:{radius:2,width:50,height:22,margin:{right:3}},eventListeners:[{type:'change',cb:T}]},timePeriodSelectMenu:{container:U.container,text:U.text,arrow:U.arrow,attrs:{radius:2,width:90,height:22,margin:{right:8}},eventListeners:[{type:'change',cb:function(){S(),T()}}]},aggMethodSelectMenu:{container:U.container,text:U.text,arrow:U.arrow,attrs:{radius:2,width:100,height:22,margin:{right:11}},eventListeners:[{type:'change',cb:T}]},dropDown:{container:{style:{background:'#fff','border-color':'#898b8b','border-radius':'1px','border-style':'solid','border-width':'2px','font-size':'11px','font-family':'"Lucida Grande", sans-serif'}},listItem:{style:{},states:{hover:{className:void 0,style:{background:'#e6e8e8',color:'#696969',cursor:'pointer'}},selected:{className:void 0,style:{background:'#898b8b',color:'#fff'}}}}},applyButton:{container:{style:{fill:'#555',stroke:'#ced5d4','stroke-width':0},states:{disabled:{fill:'#bebebe','stroke-width':0,stroke:'#ced5d4'}}},text:{style:{fill:'#f3f3f3',fontSize:'11px',fontFamily:'"Lucida Grande", sans-serif'},states:{hover:{fill:'#555','stroke-width':0,stroke:''},disabled:{fill:'#f3f3f3'}}},attrs:{radius:1,width:54,height:22,margin:{right:3},label:'APPLY'},eventListeners:[{type:'click',cb:function(){m.apply(1)}}]},resetButton:{container:{style:{fill:'#898b8b',stroke:'#ced5d4',strokeWidth:0},states:{hover:{cursor:'pointer'},disabled:{fill:'#bebebe','stroke-width':0,stroke:'#ced5d4',cursor:'default'}}},text:{style:{fill:'#f3f3f3',fontSize:'11px',fontFamily:'"Lucida Grande", sans-serif'},states:{disabled:{fill:'#f3f3f3'}}},attrs:{radius:1,shadow:{fill:'#000',opacity:0.35},width:54,height:22,margin:{right:3},label:'RESET'},eventListeners:[{type:'click',cb:function(){m.apply(0)}}]}};Q=V,P.styles&&(e(P.styles,V,this.tsObject.lib),Q=P.styles),B=new D.Label('Aggregate Data:',R,Q.label),B.setConfig({className:Q.label.className}),g(B.getIndividualClassNames(B.getClassName()),'label');var W=A.parentGroup,X=0;return n.addSymbol(B),s=k('timeMulSelectMenu'),t=k('timePeriodSelectMenu'),u=k('aggMethodSelectMenu'),w=l('applyButton'),v=l('resetButton'),p.addSymbol(s),p.addSymbol(t),p.addSymbol(u),q.addSymbol(w),q.addSymbol(v),r.addComponent(n),r.addComponent(p),r.addComponent(q),r}getLogicalSpace(g,h){var k,n,p,l=0,m=0;for(n=0,p=this.toolbars.length;n<p;n++)k=this.toolbars[n].getLogicalSpace(g,h),l=Math.max(k.width,l),m+=k.height,this.toolbars[n].width=k.width,this.toolbars[n].height=k.height;return m+=this.padding,{width:l,height:m}}placeInCanvas(){var g=this,h=g.tsObject,k=g.config.usrConfig;g.padding=5,h.spaceManagerInstance.add([{name:function(){return'data-aggregator'},ref:function(l){return l['0']},self:function(){return g},priority:function(){return 2},layout:function(l){return l[k.layout||'inline']},orientation:[{type:function(l){return l[k.orientation||'horizontal']},position:[{type:function(l){return l[k.position||'bottom']},alignment:[{type:function(l){return l[k.alignment||'right']},dimensions:[function(){var l=this.getParentComponentGroup();return g.getLogicalSpace(l.getWidth(),l.getHeight())}]}]}]}]}])}setDrawingConfiguration(g,h,k,l,m){var n=this.measurement;return n.x=g,n.y=h,n.width=k,n.height=l,this.parentGroup=m,this}apply(g){var t,u,v,w,z,A,C,D,E,F,G,H,h=this,k=h.config,l=k.toolboxComponent.config,m=l.timePeriodSelectMenu,n=l.timeMulSelectMenu,p=l.aggMethodSelectMenu,q=l.applyButton,r=l.resetButton,s=h.tsObject.extData.aggregate||{},B=k.composition.reactiveModel,I=h.aggregation,J=k.composition.impl;if(!g)J.resetAggregation(),I.binSize=null,I.aggregationMethod=null,r.setState('disabled');else if(!!k.drawn){C=m.value(),D=n.value(),E=p.value();for(F of k.avlTimePeriods)if(F.name===C){H=F.interval;break}G=H*+D,B.lock().prop('bin-size-ext',G).prop('aggregation-fn-ext',k.avlAggMethods[E]).unlock(),I.binSize=G,I.aggregationMethod=E,q.setState('disabled'),r.removeState('disabled')}else if(C=s.timeUnit&&s.timeUnit.toString().toLowerCase(),D=s.timeMultiplier,E=s.method&&s.method.toString(),h.getValidAggregation(),t=k.validTimePeriod,u=k.validTimePeriodMultiplier,v=k.avlAggMethods,t.includes(C)&&(w=t.indexOf(C),!u[w].includes(+D)&&(D=u[w][0]),z=!0),v[E]&&(A=!0),z||A){if(z){for(F of k.avlTimePeriods)if(F.name===C){H=F.interval;break}G=H*+D,B.lock().prop('bin-size-ext',G).unlock(),I.binSize=G}A&&(B.lock().prop('aggregation-fn-ext',k.avlAggMethods[E]).unlock(),I.aggregationMethod=E),q.setState('disabled'),r.removeState('disabled')}}rangeOnChange(){var s,t,u,v,w,z,A,B,C,D,F,G,H,I,g=this,h=g.config,k=h.toolboxComponent.config,l=k.timePeriodSelectMenu,m=k.timeMulSelectMenu,n=k.aggMethodSelectMenu,p=k.applyButton,q=k.resetButton,r=h.composition.reactiveModel,E=g.aggregation;g.getValidAggregation(),F=g.getCurrentAggreation(),G=F.timePeriod,H=F.timePeriodMultiplier,I=F.aggregationMethod,t=[],z=[],C=[],u=h.validTimePeriod,A=h.validTimePeriodMultiplier,D=h.avlAggMethods,p.setState('disabled'),E.binSize===r.prop('bin-size')||I.value!==h.defaultAggMethod&&I.value?q.removeState('disabled'):(E.binSize=null,E.aggregationMethod=null,q.setState('disabled'));for(s of u)t.push({name:c(s),value:s});if(l.updateList(t),G?l.value(G):l.setPlaceHolderValue(''),v=u.indexOf(G),0<=v)for(w of A[v])z.push({name:w.toString(),value:w.toString()});for(B in m.updateList(z),H?m.value(H.toString()):m.setPlaceHolderValue(''),D)C.push({name:c(D[B].formalName),value:D[B].nickName});n.updateList(C),I.value?n.value(I.value):n.setPlaceHolderValue(''),h.execute=!0}draw(g,h,k,l,m){var s,t,u,n=this,p=n.config,q=n.measurement,r=n.toolbars,v=p.dataAgg;if(n.getAvailablelAggreagation(),g=void 0===g?q.x:g,h=void 0===h?q.y:h,k=void 0===k?q.width:k,l=void 0===l?q.height:l,m=void 0===m?n.parentGroup:m,k&&l){for(t=0,s=r.length;t<s;t++)u=r[t],u.draw(g,h,m);p.defaultAggMethod=v.getDefaultAggregationMethod().nickName,p.drawn||n.apply(1),n.rangeOnChange(),p.drawn=!0}}dispose(){}}return f}}]);
//# sourceMappingURL=data-aggregator.min.js.map