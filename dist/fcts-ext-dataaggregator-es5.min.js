!function(e){function i(n){if(t[n])return t[n].exports;var r=t[n]={exports:{},id:n,loaded:!1};return e[n].call(r.exports,r,r.exports,i),r.loaded=!0,r.exports}var t={};return i.m=e,i.c=t,i.p="",i(0)}([function(e,i,t){"use strict";var n=t(1);!function(e){e(FusionCharts)}(function(e){e.register("extension",["data-aggregator",function(e){var i=this,t=i.extAPI;console.log(e),window.Aggregator=new n,t(window.Aggregator)}])})},function(e,i){"use strict";function t(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,i){for(var t=0;t<i.length;t++){var n=i[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(i,t,n){return t&&e(i.prototype,t),n&&e(i,n),i}}(),r=function(){function e(){t(this,e),this.appliedAggregation={timePeriod:null,timePeriodMultiplier:1,aggregationMethod:null},this.config={}}return n(e,[{key:"getAvailablelAggreagation",value:function(){var e,i=this.config,t=this.x,n=this.chart;i.avlAggMethods=n.getAvailableAggregationMethod(),i.avlTimePeriods=n.getAvailableTimePeriod(),e=t.getCurrentVisibleRange(),i.currentTimeLength=e.endDate-e.startDate}},{key:"getValidTimeMultiplier",value:function(){var e,i,t,n,r,o=this.config,a=this.x,l=a.max-a.min,g=o.avlTimePeriods,u=function(e){return Array.from({length:e},function(e,i){return i+1})};for(o.avlTimeMultiplier=[],i=g.length,e=0;e<i;e++)t=g[e],n=g[e+1],r=n?n[Object.keys(n)[0]]/t[Object.keys(t)[0]]:l/t[Object.keys(t)[0]],o.avlTimeMultiplier.push(u(r))}},{key:"getValidAggregation",value:function(){var e,i,t,n,r,o,a,l,g,u,s,c,d,h,f=this.chart.config,v=this.config,m=f.minNumOfPlot,p=f.minPlotWidth,A=f.canvasWidth,P=function(e){return Array.from({length:e},function(e,i){return i+1})};for(r=v.avlTimePeriods,o=v.avlTimeMultiplier,a=v.currentTimeLength,v.minTime=d=a/A*p,v.maxTime=h=a/m,v.validTimePeriod=[],v.validTimePeriodMultiplier=[],e=0,t=r.length;e<t;e++){for(l=Object.keys(r[e])[0],g=r[e][Object.keys(r[e])[0]],c=0,i=0,n=o[e].length;i<n;i++)s=o[e][i],u=s*g,u>=d&&u<=h&&c++;c&&(v.validTimePeriodMultiplier.push(P(c)),v.validTimePeriod.push(l))}console.log("Months: ",v.validTimePeriod),console.log("Number Of Multipliers: ",v.validTimePeriodMultiplier),console.log("Methods: ",v.avlAggMethods)}},{key:"setAggregation",value:function(e){var i,t,n,r,o=this.config;return i=o.avlAggMethods,t=o.validTimePeriod,r=o.validTimePeriodMultiplier,i.includes(e.aggregationMethod)&&t.includes(e.timePeriod)?(n=t.indexOf(e.timePeriod),r[n].includes(e.timePeriodMultiplier)?(this.aggregation=e,console.log(this.aggregation),!0):(console.log(this.aggregation),!1)):(console.log(this.aggregation),!1)}},{key:"resetAggregation",value:function(){}},{key:"init",value:function(e){var i=this;e("X-Axis","chart",function(e,t){i.x=e,i.chart=t}),this.getAvailablelAggreagation(),this.getValidTimeMultiplier(),this.getValidAggregation()}},{key:"placeInCanvas",value:function(){}},{key:"draw",value:function(){}},{key:"dispose",value:function(){}},{key:"aggregation",get:function(){return this.appliedAggregation},set:function(e){this.appliedAggregation.timePeriod=e.timePeriod,this.appliedAggregation.timePeriodMultiplier=e.timePeriodMultiplier,this.appliedAggregation.aggregationMethod=e.aggregationMethod}}]),e}();e.exports=r}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vZmN0cy1leHQtZGF0YWFnZ3JlZ2F0b3ItZXM1Lm1pbi5qcyIsIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAgMGQxNzI2MDY2ZWZkZDIzZWQ5NjAiLCJ3ZWJwYWNrOi8vLy4vc3JjL2luZGV4LmpzIiwid2VicGFjazovLy8uL3NyYy9mY3RzLWV4dC1hZ2dyZWdhdG9yLmpzIl0sIm5hbWVzIjpbIm1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJpbnN0YWxsZWRNb2R1bGVzIiwiZXhwb3J0cyIsIm1vZHVsZSIsImlkIiwibG9hZGVkIiwiY2FsbCIsIm0iLCJjIiwicCIsIkFnZ3JlZ2F0b3IiLCJmYWN0b3J5IiwiRnVzaW9uQ2hhcnRzIiwiRkMiLCJyZWdpc3RlciIsImdsb2JhbCIsInRoaXMiLCJleHRBUEkiLCJjb25zb2xlIiwibG9nIiwid2luZG93IiwiX2NsYXNzQ2FsbENoZWNrIiwiaW5zdGFuY2UiLCJDb25zdHJ1Y3RvciIsIlR5cGVFcnJvciIsIl9jcmVhdGVDbGFzcyIsImRlZmluZVByb3BlcnRpZXMiLCJ0YXJnZXQiLCJwcm9wcyIsImkiLCJsZW5ndGgiLCJkZXNjcmlwdG9yIiwiZW51bWVyYWJsZSIsImNvbmZpZ3VyYWJsZSIsIndyaXRhYmxlIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJrZXkiLCJwcm90b1Byb3BzIiwic3RhdGljUHJvcHMiLCJwcm90b3R5cGUiLCJhcHBsaWVkQWdncmVnYXRpb24iLCJ0aW1lUGVyaW9kIiwidGltZVBlcmlvZE11bHRpcGxpZXIiLCJhZ2dyZWdhdGlvbk1ldGhvZCIsImNvbmZpZyIsInZhbHVlIiwiY3VycmVudFZpc2libGVSYW5nZSIsInhBeGlzIiwieCIsImNoYXJ0IiwiYXZsQWdnTWV0aG9kcyIsImdldEF2YWlsYWJsZUFnZ3JlZ2F0aW9uTWV0aG9kIiwiYXZsVGltZVBlcmlvZHMiLCJnZXRBdmFpbGFibGVUaW1lUGVyaW9kIiwiZ2V0Q3VycmVudFZpc2libGVSYW5nZSIsImN1cnJlbnRUaW1lTGVuZ3RoIiwiZW5kRGF0ZSIsInN0YXJ0RGF0ZSIsImxlbiIsImN1cnJUaW1lUGVyaW9kIiwibmV4dFRpbWVQZXJpb2QiLCJudW1PZk11bHRpcGxpZXIiLCJtYXgiLCJtaW4iLCJnZXRNdWx0aXBsaWVyQXJyYXkiLCJudW0iLCJBcnJheSIsImZyb20iLCJ2IiwiayIsImF2bFRpbWVNdWx0aXBsaWVyIiwia2V5cyIsInB1c2giLCJqIiwibGVuMSIsImxlbjIiLCJ0aW1lIiwiZXhwZWN0ZWRUaW1lIiwibXVsdGlwbGllciIsIm11bHRpcGxpZXJDb3VudGVyIiwibWluVGltZSIsIm1heFRpbWUiLCJjaGFydENvbmZpZyIsIm1pbk51bU9mUGxvdCIsIm1pblBsb3RXaWR0aCIsImNhbnZhc1dpZHRoIiwidmFsaWRUaW1lUGVyaW9kIiwidmFsaWRUaW1lUGVyaW9kTXVsdGlwbGllciIsIm9iaiIsInRpbWVQZXJpb2RJbmRleCIsImluY2x1ZGVzIiwiaW5kZXhPZiIsImFnZ3JlZ2F0aW9uIiwicmVxdWlyZSIsInNlbGYiLCJnZXRBdmFpbGFibGVsQWdncmVhZ2F0aW9uIiwiZ2V0VmFsaWRUaW1lTXVsdGlwbGllciIsImdldFZhbGlkQWdncmVnYXRpb24iLCJnZXQiLCJzZXQiXSwibWFwcGluZ3MiOiJDQUFTLFNBQVVBLEdDSW5CLFFBQUFDLEdBQUFDLEdBR0EsR0FBQUMsRUFBQUQsR0FDQSxNQUFBQyxHQUFBRCxHQUFBRSxPQUdBLElBQUFDLEdBQUFGLEVBQUFELElBQ0FFLFdBQ0FFLEdBQUFKLEVBQ0FLLFFBQUEsRUFVQSxPQU5BUCxHQUFBRSxHQUFBTSxLQUFBSCxFQUFBRCxRQUFBQyxJQUFBRCxRQUFBSCxHQUdBSSxFQUFBRSxRQUFBLEVBR0FGLEVBQUFELFFBdkJBLEdBQUFELEtBcUNBLE9BVEFGLEdBQUFRLEVBQUFULEVBR0FDLEVBQUFTLEVBQUFQLEVBR0FGLEVBQUFVLEVBQUEsR0FHQVYsRUFBQSxLRE1NLFNBQVNJLEVBQVFELEVBQVNILEdFNUNoQyxZ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MEJFLEdBQWlCQyxTQUFTRixFQUFJOUMsdUJBQzFEM0IsS0FBSzZFLFlBQWNKLEVBQ25CdkUsUUFBUUMsSUFBSUgsS0FBSzZFLGNBQ1YsSUFFUDNFLFFBQVFDLElBQUlILEtBQUs2RSxjQUNWLEtBR1QzRSxRQUFRQyxJQUFJSCxLQUFLNkUsY0FDVixNSGtHUnhELElBQUssbUJBQ0xTLE1BQU8sZUFFUFQsSUFBSyxPQUNMUyxNQUFPLFNHM0ZKZ0QsR0FDSixHQUFJQyxHQUFPL0UsSUFFWDhFLEdBQVEsU0FBVSxRQUFTLFNBQVU3QyxFQUFHQyxHQUN0QzZDLEVBQUs5QyxFQUFJQSxFQUNUOEMsRUFBSzdDLE1BQVFBLElBR2ZsQyxLQUFLZ0YsNEJBQ0xoRixLQUFLaUYseUJBQ0xqRixLQUFLa0YseUJIOEZKN0QsSUFBSyxnQkFDTFMsTUFBTyxlQUlQVCxJQUFLLE9BQ0xTLE1BQU8sZUFJUFQsSUFBSyxVQUNMUyxNQUFPLGVBSVBULElBQUssY0FDTDhELElBQUssV0d4Uk4sTUFBT25GLE1BQUt5QixvQkgyUlgyRCxJQUFLLFNHeFJTWCxHQUNmekUsS0FBS3lCLG1CQUFtQkMsV0FBYStDLEVBQUkvQyxXQUN6QzFCLEtBQUt5QixtQkFBbUJFLHFCQUF1QjhDLEVBQUk5QyxxQkFDbkQzQixLQUFLeUIsbUJBQW1CRyxrQkFBb0I2QyxFQUFJN0Msc0JINFIxQ2xDLElHeEdWUCxHQUFPRCxRQUFVUSIsImZpbGUiOiJmY3RzLWV4dC1kYXRhYWdncmVnYXRvci1lczUubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqKioqKi8gKGZ1bmN0aW9uKG1vZHVsZXMpIHsgLy8gd2VicGFja0Jvb3RzdHJhcFxuLyoqKioqKi8gXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4vKioqKioqLyBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG4vKioqKioqL1xuLyoqKioqKi8gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuLyoqKioqKi8gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG4vKioqKioqL1xuLyoqKioqKi8gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuLyoqKioqKi8gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKVxuLyoqKioqKi8gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4vKioqKioqL1xuLyoqKioqKi8gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4vKioqKioqLyBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuLyoqKioqKi8gXHRcdFx0ZXhwb3J0czoge30sXG4vKioqKioqLyBcdFx0XHRpZDogbW9kdWxlSWQsXG4vKioqKioqLyBcdFx0XHRsb2FkZWQ6IGZhbHNlXG4vKioqKioqLyBcdFx0fTtcbi8qKioqKiovXG4vKioqKioqLyBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4vKioqKioqLyBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG4vKioqKioqL1xuLyoqKioqKi8gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbi8qKioqKiovIFx0XHRtb2R1bGUubG9hZGVkID0gdHJ1ZTtcbi8qKioqKiovXG4vKioqKioqLyBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbi8qKioqKiovIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4vKioqKioqLyBcdH1cbi8qKioqKiovXG4vKioqKioqL1xuLyoqKioqKi8gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuLyoqKioqKi8gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuLyoqKioqKi9cbi8qKioqKiovIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbi8qKioqKiovIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcbi8qKioqKiovXG4vKioqKioqLyBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4vKioqKioqLyBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG4vKioqKioqL1xuLyoqKioqKi8gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbi8qKioqKiovIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oMCk7XG4vKioqKioqLyB9KVxuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cbi8qKioqKiovIChbXG4vKiAwICovXG4vKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHtcblxuXHQndXNlIHN0cmljdCc7XG5cdFxuXHR2YXIgQWdncmVnYXRvciA9IF9fd2VicGFja19yZXF1aXJlX18oMSk7XG5cdFxuXHQ7KGZ1bmN0aW9uIChmYWN0b3J5KSB7XG5cdCAgZmFjdG9yeShGdXNpb25DaGFydHMpO1xuXHR9KShmdW5jdGlvbiAoRkMpIHtcblx0ICBGQy5yZWdpc3RlcignZXh0ZW5zaW9uJywgWydkYXRhLWFnZ3JlZ2F0b3InLCBmdW5jdGlvbiAoaWQpIHtcblx0ICAgIHZhciBnbG9iYWwgPSB0aGlzO1xuXHQgICAgdmFyIGV4dEFQSSA9IGdsb2JhbC5leHRBUEk7XG5cdCAgICBjb25zb2xlLmxvZyhpZCk7XG5cdFxuXHQgICAgLy8gdmFyIG90aGVyQVBJID0gRnVzaW9uQ2hhcnRzLmdldEV4dENvbXBvbmVudChpZCwgJ2FwaScsICdsZWdhY3lleHRhcGknKTtcblx0ICAgIC8vIHZhciB0b29sQm94QXBpID0gRnVzaW9uQ2hhcnRzLmdldENvbXBvbmVudCgnYXBpJywgJ3Rvb2xib3gnKTtcblx0XG5cdCAgICB3aW5kb3cuQWdncmVnYXRvciA9IG5ldyBBZ2dyZWdhdG9yKCk7XG5cdFxuXHQgICAgZXh0QVBJKHdpbmRvdy5BZ2dyZWdhdG9yKTtcblx0ICB9XSk7XG5cdH0pO1xuXG4vKioqLyB9LFxuLyogMSAqL1xuLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzKSB7XG5cblx0J3VzZSBzdHJpY3QnO1xuXHQvKipcblx0ICogQ2xhc3MgcmVwcmVzZW50aW5nIHRoZSBEYXRhIEFnZ3JlZ2F0b3IuXG5cdCAqL1xuXHRcblx0dmFyIF9jcmVhdGVDbGFzcyA9IGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmIChcInZhbHVlXCIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9IHJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH07IH0oKTtcblx0XG5cdGZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvblwiKTsgfSB9XG5cdFxuXHR2YXIgQWdncmVnYXRvciA9IGZ1bmN0aW9uICgpIHtcblx0ICAvKipcblx0ICAgKiBDcmVhdGUgYSBBZ2dyZWdhdG9yLlxuXHQgICAqIEB0eXBlZGVmIHtvYmplY3R9IEFnZ3JlZ2F0b3IuYWdncmVnYXRpb25cblx0ICAgKiBAcHJvcGVydHkge3N0cmluZ30gdGltZVBlcmlvZCAtIFRoZSB0aW1lIGludGVydmFsIG9mIGFnZ3JlZ2F0aW9uLlxuXHQgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSB0aW1lUGVyaW9kTXVsdGlwbGllciAtIFRoZSBtdWx0aXBsaWVyIG9mIHRpbWUgaW50ZXJ2YWwuXG5cdCAgICogQHByb3BlcnR5IHtzdHJpbmd9IGFnZ3JlZ2F0aW9uTWV0aG9kIC0gVGhlIG1ldGhvZCBhcHBsaWVkIHRvIGFnZ3JlZ2F0ZS5cblx0ICAgKi9cblx0ICBmdW5jdGlvbiBBZ2dyZWdhdG9yKCkge1xuXHQgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEFnZ3JlZ2F0b3IpO1xuXHRcblx0ICAgIC8qKlxuXHQgICAgICogQHByaXZhdGVcblx0ICAgICAqL1xuXHQgICAgdGhpcy5hcHBsaWVkQWdncmVnYXRpb24gPSB7XG5cdCAgICAgIHRpbWVQZXJpb2Q6IG51bGwsXG5cdCAgICAgIHRpbWVQZXJpb2RNdWx0aXBsaWVyOiAxLFxuXHQgICAgICBhZ2dyZWdhdGlvbk1ldGhvZDogbnVsbFxuXHQgICAgfTtcblx0ICAgIHRoaXMuY29uZmlnID0ge307XG5cdCAgfVxuXHRcblx0ICAvKipcblx0ICAgKiBBbiBvYmplY3QgcmVwcmVzZW50aW5nIHRoZSB0aW1lUGVyaW9kLCB0aW1lUGVyaW9kTXVsdGlwbGllciwgYWdncmVnYXRpb25NZXRob2QuXG5cdCAgICogQHR5cGUge0FnZ3JlZ2F0b3IuYWdncmVnYXRpb259XG5cdCAgICovXG5cdFxuXHRcblx0ICBfY3JlYXRlQ2xhc3MoQWdncmVnYXRvciwgW3tcblx0ICAgIGtleTogJ2dldEF2YWlsYWJsZWxBZ2dyZWFnYXRpb24nLFxuXHRcblx0XG5cdCAgICAvKipcblx0ICAgICAqIFNldHMgYXZhaWxhYmxlIGFnZ3JlZ2F0aW9uIG9wdGlvbnMgaW4gY29uZmlndXJhdGlvbiBvZiBleHRlbnNpb25cblx0ICAgICAqIEBwcml2YXRlXG5cdCAgICAgKi9cblx0ICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRBdmFpbGFibGVsQWdncmVhZ2F0aW9uKCkge1xuXHQgICAgICB2YXIgY29uZmlnID0gdGhpcy5jb25maWcsXG5cdCAgICAgICAgICBjdXJyZW50VmlzaWJsZVJhbmdlLFxuXHQgICAgICAgICAgeEF4aXMgPSB0aGlzLngsXG5cdCAgICAgICAgICBjaGFydCA9IHRoaXMuY2hhcnQ7XG5cdFxuXHQgICAgICBjb25maWcuYXZsQWdnTWV0aG9kcyA9IGNoYXJ0LmdldEF2YWlsYWJsZUFnZ3JlZ2F0aW9uTWV0aG9kKCk7XG5cdCAgICAgIGNvbmZpZy5hdmxUaW1lUGVyaW9kcyA9IGNoYXJ0LmdldEF2YWlsYWJsZVRpbWVQZXJpb2QoKTtcblx0XG5cdCAgICAgIGN1cnJlbnRWaXNpYmxlUmFuZ2UgPSB4QXhpcy5nZXRDdXJyZW50VmlzaWJsZVJhbmdlKCk7XG5cdCAgICAgIGNvbmZpZy5jdXJyZW50VGltZUxlbmd0aCA9IGN1cnJlbnRWaXNpYmxlUmFuZ2UuZW5kRGF0ZSAtIGN1cnJlbnRWaXNpYmxlUmFuZ2Uuc3RhcnREYXRlO1xuXHQgICAgfVxuXHRcblx0ICAgIC8qKlxuXHQgICAgICogQ2FsY3VsYXRlcyB2YWxpZCB0aW1lIG11bHRpcGxpZXJzIG9mIGF2YWlsYWJsZSB0aW1lIHBlcmlvZHNcblx0ICAgICAqIEBwcml2YXRlXG5cdCAgICAgKi9cblx0XG5cdCAgfSwge1xuXHQgICAga2V5OiAnZ2V0VmFsaWRUaW1lTXVsdGlwbGllcicsXG5cdCAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0VmFsaWRUaW1lTXVsdGlwbGllcigpIHtcblx0ICAgICAgdmFyIGNvbmZpZyA9IHRoaXMuY29uZmlnLFxuXHQgICAgICAgICAgeEF4aXMgPSB0aGlzLngsXG5cdCAgICAgICAgICBpLFxuXHQgICAgICAgICAgbGVuLFxuXHQgICAgICAgICAgY3VyclRpbWVQZXJpb2QsXG5cdCAgICAgICAgICBuZXh0VGltZVBlcmlvZCxcblx0ICAgICAgICAgIG51bU9mTXVsdGlwbGllcixcblx0ICAgICAgICAgIGN1cnJlbnRUaW1lTGVuZ3RoID0geEF4aXMubWF4IC0geEF4aXMubWluLFxuXHQgICAgICAgICAgYXZsVGltZVBlcmlvZHMgPSBjb25maWcuYXZsVGltZVBlcmlvZHMsXG5cdCAgICAgICAgICBnZXRNdWx0aXBsaWVyQXJyYXkgPSBmdW5jdGlvbiBnZXRNdWx0aXBsaWVyQXJyYXkobnVtKSB7XG5cdCAgICAgICAgcmV0dXJuIEFycmF5LmZyb20oeyBsZW5ndGg6IG51bSB9LCBmdW5jdGlvbiAodiwgaykge1xuXHQgICAgICAgICAgcmV0dXJuIGsgKyAxO1xuXHQgICAgICAgIH0pO1xuXHQgICAgICB9O1xuXHRcblx0ICAgICAgY29uZmlnLmF2bFRpbWVNdWx0aXBsaWVyID0gW107XG5cdCAgICAgIGxlbiA9IGF2bFRpbWVQZXJpb2RzLmxlbmd0aDtcblx0XG5cdCAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW47IGkrKykge1xuXHQgICAgICAgIGN1cnJUaW1lUGVyaW9kID0gYXZsVGltZVBlcmlvZHNbaV07XG5cdCAgICAgICAgbmV4dFRpbWVQZXJpb2QgPSBhdmxUaW1lUGVyaW9kc1tpICsgMV07XG5cdFxuXHQgICAgICAgIGlmIChuZXh0VGltZVBlcmlvZCkge1xuXHQgICAgICAgICAgbnVtT2ZNdWx0aXBsaWVyID0gbmV4dFRpbWVQZXJpb2RbT2JqZWN0LmtleXMobmV4dFRpbWVQZXJpb2QpWzBdXSAvIGN1cnJUaW1lUGVyaW9kW09iamVjdC5rZXlzKGN1cnJUaW1lUGVyaW9kKVswXV07XG5cdCAgICAgICAgfSBlbHNlIHtcblx0ICAgICAgICAgIG51bU9mTXVsdGlwbGllciA9IGN1cnJlbnRUaW1lTGVuZ3RoIC8gY3VyclRpbWVQZXJpb2RbT2JqZWN0LmtleXMoY3VyclRpbWVQZXJpb2QpWzBdXTtcblx0ICAgICAgICB9XG5cdCAgICAgICAgY29uZmlnLmF2bFRpbWVNdWx0aXBsaWVyLnB1c2goZ2V0TXVsdGlwbGllckFycmF5KG51bU9mTXVsdGlwbGllcikpO1xuXHQgICAgICB9XG5cdCAgICB9XG5cdFxuXHQgICAgLyoqXG5cdCAgICAgKiBDYWxjdWxhdGVzIHZhbGlkIGFnZ3JlZ2F0aW9uIHRpbWUgcGVyaW9kcyBhbmQgY29ycmVzcG9uZGluZyBtdWx0aXBsaWVyc1xuXHQgICAgICogQHByaXZhdGVcblx0ICAgICAqL1xuXHRcblx0ICB9LCB7XG5cdCAgICBrZXk6ICdnZXRWYWxpZEFnZ3JlZ2F0aW9uJyxcblx0ICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRWYWxpZEFnZ3JlZ2F0aW9uKCkge1xuXHQgICAgICB2YXIgY2hhcnRDb25maWcgPSB0aGlzLmNoYXJ0LmNvbmZpZyxcblx0ICAgICAgICAgIGNvbmZpZyA9IHRoaXMuY29uZmlnLFxuXHQgICAgICAgICAgaSxcblx0ICAgICAgICAgIGosXG5cdCAgICAgICAgICBsZW4xLFxuXHQgICAgICAgICAgbGVuMixcblx0ICAgICAgICAgIGF2bFRpbWVQZXJpb2RzLFxuXHQgICAgICAgICAgYXZsVGltZU11bHRpcGxpZXIsXG5cdCAgICAgICAgICBtaW5OdW1PZlBsb3QgPSBjaGFydENvbmZpZy5taW5OdW1PZlBsb3QsXG5cdCAgICAgICAgICBtaW5QbG90V2lkdGggPSBjaGFydENvbmZpZy5taW5QbG90V2lkdGgsXG5cdCAgICAgICAgICBjYW52YXNXaWR0aCA9IGNoYXJ0Q29uZmlnLmNhbnZhc1dpZHRoLFxuXHQgICAgICAgICAgY3VycmVudFRpbWVMZW5ndGgsXG5cdCAgICAgICAgICB0aW1lUGVyaW9kLFxuXHQgICAgICAgICAgdGltZSxcblx0ICAgICAgICAgIGV4cGVjdGVkVGltZSxcblx0ICAgICAgICAgIG11bHRpcGxpZXIsXG5cdCAgICAgICAgICBtdWx0aXBsaWVyQ291bnRlcixcblx0ICAgICAgICAgIGdldE11bHRpcGxpZXJBcnJheSA9IGZ1bmN0aW9uIGdldE11bHRpcGxpZXJBcnJheShudW0pIHtcblx0ICAgICAgICByZXR1cm4gQXJyYXkuZnJvbSh7IGxlbmd0aDogbnVtIH0sIGZ1bmN0aW9uICh2LCBrKSB7XG5cdCAgICAgICAgICByZXR1cm4gayArIDE7XG5cdCAgICAgICAgfSk7XG5cdCAgICAgIH0sXG5cdCAgICAgICAgICBtaW5UaW1lLFxuXHQgICAgICAgICAgbWF4VGltZTtcblx0XG5cdCAgICAgIGF2bFRpbWVQZXJpb2RzID0gY29uZmlnLmF2bFRpbWVQZXJpb2RzO1xuXHQgICAgICBhdmxUaW1lTXVsdGlwbGllciA9IGNvbmZpZy5hdmxUaW1lTXVsdGlwbGllcjtcblx0ICAgICAgY3VycmVudFRpbWVMZW5ndGggPSBjb25maWcuY3VycmVudFRpbWVMZW5ndGg7XG5cdFxuXHQgICAgICBjb25maWcubWluVGltZSA9IG1pblRpbWUgPSBjdXJyZW50VGltZUxlbmd0aCAvIGNhbnZhc1dpZHRoICogbWluUGxvdFdpZHRoO1xuXHQgICAgICBjb25maWcubWF4VGltZSA9IG1heFRpbWUgPSBjdXJyZW50VGltZUxlbmd0aCAvIG1pbk51bU9mUGxvdDtcblx0XG5cdCAgICAgIGNvbmZpZy52YWxpZFRpbWVQZXJpb2QgPSBbXTtcblx0ICAgICAgY29uZmlnLnZhbGlkVGltZVBlcmlvZE11bHRpcGxpZXIgPSBbXTtcblx0XG5cdCAgICAgIGZvciAoaSA9IDAsIGxlbjEgPSBhdmxUaW1lUGVyaW9kcy5sZW5ndGg7IGkgPCBsZW4xOyBpKyspIHtcblx0ICAgICAgICB0aW1lUGVyaW9kID0gT2JqZWN0LmtleXMoYXZsVGltZVBlcmlvZHNbaV0pWzBdO1xuXHQgICAgICAgIHRpbWUgPSBhdmxUaW1lUGVyaW9kc1tpXVtPYmplY3Qua2V5cyhhdmxUaW1lUGVyaW9kc1tpXSlbMF1dO1xuXHQgICAgICAgIG11bHRpcGxpZXJDb3VudGVyID0gMDtcblx0XG5cdCAgICAgICAgZm9yIChqID0gMCwgbGVuMiA9IGF2bFRpbWVNdWx0aXBsaWVyW2ldLmxlbmd0aDsgaiA8IGxlbjI7IGorKykge1xuXHQgICAgICAgICAgbXVsdGlwbGllciA9IGF2bFRpbWVNdWx0aXBsaWVyW2ldW2pdO1xuXHQgICAgICAgICAgZXhwZWN0ZWRUaW1lID0gbXVsdGlwbGllciAqIHRpbWU7XG5cdFxuXHQgICAgICAgICAgaWYgKGV4cGVjdGVkVGltZSA+PSBtaW5UaW1lICYmIGV4cGVjdGVkVGltZSA8PSBtYXhUaW1lKSB7XG5cdCAgICAgICAgICAgIG11bHRpcGxpZXJDb3VudGVyKys7XG5cdCAgICAgICAgICB9XG5cdCAgICAgICAgfVxuXHQgICAgICAgIGlmIChtdWx0aXBsaWVyQ291bnRlcikge1xuXHQgICAgICAgICAgY29uZmlnLnZhbGlkVGltZVBlcmlvZE11bHRpcGxpZXIucHVzaChnZXRNdWx0aXBsaWVyQXJyYXkobXVsdGlwbGllckNvdW50ZXIpKTtcblx0ICAgICAgICAgIGNvbmZpZy52YWxpZFRpbWVQZXJpb2QucHVzaCh0aW1lUGVyaW9kKTtcblx0ICAgICAgICB9XG5cdCAgICAgIH1cblx0ICAgICAgY29uc29sZS5sb2coJ01vbnRoczogJywgY29uZmlnLnZhbGlkVGltZVBlcmlvZCk7XG5cdCAgICAgIGNvbnNvbGUubG9nKCdOdW1iZXIgT2YgTXVsdGlwbGllcnM6ICcsIGNvbmZpZy52YWxpZFRpbWVQZXJpb2RNdWx0aXBsaWVyKTtcblx0ICAgICAgY29uc29sZS5sb2coJ01ldGhvZHM6ICcsIGNvbmZpZy5hdmxBZ2dNZXRob2RzKTtcblx0ICAgIH1cblx0XG5cdCAgICAvKipcblx0ICAgICAqIFNldCBBZ2dyZWdhdGlvbiBvbiB0aW1lIHNlcmllc1xuXHQgICAgICogQHBhcmFtICB7b2JqZWN0fSBvYmpcblx0ICAgICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSB0aW1lUGVyaW9kIC0gVGhlIHRpbWUgaW50ZXJ2YWwgb2YgYWdncmVnYXRpb24uXG5cdCAgICAgKiBAcHJvcGVydHkge251bWJlcn0gdGltZVBlcmlvZE11bHRpcGxpZXIgLSBUaGUgbXVsdGlwbGllciBvZiB0aW1lIGludGVydmFsLlxuXHQgICAgICogQHByb3BlcnR5IHtzdHJpbmd9IGFnZ3JlZ2F0aW9uTWV0aG9kIC0gVGhlIG1ldGhvZCBhcHBsaWVkIHRvIGFnZ3JlZ2F0ZS5cblx0ICAgICAqL1xuXHRcblx0ICB9LCB7XG5cdCAgICBrZXk6ICdzZXRBZ2dyZWdhdGlvbicsXG5cdCAgICB2YWx1ZTogZnVuY3Rpb24gc2V0QWdncmVnYXRpb24ob2JqKSB7XG5cdCAgICAgIHZhciBhdmxBZ2dNZXRob2RzLFxuXHQgICAgICAgICAgdmFsaWRUaW1lUGVyaW9kLFxuXHQgICAgICAgICAgdGltZVBlcmlvZEluZGV4LFxuXHQgICAgICAgICAgdmFsaWRUaW1lUGVyaW9kTXVsdGlwbGllcixcblx0ICAgICAgICAgIGNvbmZpZyA9IHRoaXMuY29uZmlnO1xuXHRcblx0ICAgICAgYXZsQWdnTWV0aG9kcyA9IGNvbmZpZy5hdmxBZ2dNZXRob2RzO1xuXHQgICAgICB2YWxpZFRpbWVQZXJpb2QgPSBjb25maWcudmFsaWRUaW1lUGVyaW9kO1xuXHQgICAgICB2YWxpZFRpbWVQZXJpb2RNdWx0aXBsaWVyID0gY29uZmlnLnZhbGlkVGltZVBlcmlvZE11bHRpcGxpZXI7XG5cdFxuXHQgICAgICBpZiAoYXZsQWdnTWV0aG9kcy5pbmNsdWRlcyhvYmouYWdncmVnYXRpb25NZXRob2QpICYmIHZhbGlkVGltZVBlcmlvZC5pbmNsdWRlcyhvYmoudGltZVBlcmlvZCkpIHtcblx0ICAgICAgICB0aW1lUGVyaW9kSW5kZXggPSB2YWxpZFRpbWVQZXJpb2QuaW5kZXhPZihvYmoudGltZVBlcmlvZCk7XG5cdCAgICAgICAgaWYgKHZhbGlkVGltZVBlcmlvZE11bHRpcGxpZXJbdGltZVBlcmlvZEluZGV4XS5pbmNsdWRlcyhvYmoudGltZVBlcmlvZE11bHRpcGxpZXIpKSB7XG5cdCAgICAgICAgICB0aGlzLmFnZ3JlZ2F0aW9uID0gb2JqO1xuXHQgICAgICAgICAgY29uc29sZS5sb2codGhpcy5hZ2dyZWdhdGlvbik7XG5cdCAgICAgICAgICByZXR1cm4gdHJ1ZTtcblx0ICAgICAgICB9IGVsc2Uge1xuXHQgICAgICAgICAgY29uc29sZS5sb2codGhpcy5hZ2dyZWdhdGlvbik7XG5cdCAgICAgICAgICByZXR1cm4gZmFsc2U7XG5cdCAgICAgICAgfVxuXHQgICAgICB9IGVsc2Uge1xuXHQgICAgICAgIGNvbnNvbGUubG9nKHRoaXMuYWdncmVnYXRpb24pO1xuXHQgICAgICAgIHJldHVybiBmYWxzZTtcblx0ICAgICAgfVxuXHQgICAgfVxuXHRcblx0ICAgIC8qKlxuXHQgICAgICogUmVzZXQgQXBwbGllZCBBZ2dyZWdhdGlvblxuXHQgICAgICovXG5cdFxuXHQgIH0sIHtcblx0ICAgIGtleTogJ3Jlc2V0QWdncmVnYXRpb24nLFxuXHQgICAgdmFsdWU6IGZ1bmN0aW9uIHJlc2V0QWdncmVnYXRpb24oKSB7fVxuXHQgIH0sIHtcblx0ICAgIGtleTogJ2luaXQnLFxuXHQgICAgdmFsdWU6IGZ1bmN0aW9uIGluaXQocmVxdWlyZSkge1xuXHQgICAgICB2YXIgc2VsZiA9IHRoaXM7XG5cdFxuXHQgICAgICByZXF1aXJlKCdYLUF4aXMnLCAnY2hhcnQnLCBmdW5jdGlvbiAoeCwgY2hhcnQpIHtcblx0ICAgICAgICBzZWxmLnggPSB4O1xuXHQgICAgICAgIHNlbGYuY2hhcnQgPSBjaGFydDtcblx0ICAgICAgfSk7XG5cdFxuXHQgICAgICB0aGlzLmdldEF2YWlsYWJsZWxBZ2dyZWFnYXRpb24oKTtcblx0ICAgICAgdGhpcy5nZXRWYWxpZFRpbWVNdWx0aXBsaWVyKCk7XG5cdCAgICAgIHRoaXMuZ2V0VmFsaWRBZ2dyZWdhdGlvbigpO1xuXHQgICAgfVxuXHQgIH0sIHtcblx0ICAgIGtleTogJ3BsYWNlSW5DYW52YXMnLFxuXHQgICAgdmFsdWU6IGZ1bmN0aW9uIHBsYWNlSW5DYW52YXMoKSB7XG5cdCAgICAgIC8vIHNwYWNlIG1hbmFnZW1lbnRcblx0ICAgIH1cblx0ICB9LCB7XG5cdCAgICBrZXk6ICdkcmF3Jyxcblx0ICAgIHZhbHVlOiBmdW5jdGlvbiBkcmF3KCkge1xuXHQgICAgICAvLyBkcmF3IGV4dGVuc2lvblxuXHQgICAgfVxuXHQgIH0sIHtcblx0ICAgIGtleTogJ2Rpc3Bvc2UnLFxuXHQgICAgdmFsdWU6IGZ1bmN0aW9uIGRpc3Bvc2UoKSB7XG5cdCAgICAgIC8vIGRpc3Bvc2UgZXh0ZW5zaW9uXG5cdCAgICB9XG5cdCAgfSwge1xuXHQgICAga2V5OiAnYWdncmVnYXRpb24nLFxuXHQgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7XG5cdCAgICAgIHJldHVybiB0aGlzLmFwcGxpZWRBZ2dyZWdhdGlvbjtcblx0ICAgIH0sXG5cdCAgICBzZXQ6IGZ1bmN0aW9uIHNldChvYmopIHtcblx0ICAgICAgdGhpcy5hcHBsaWVkQWdncmVnYXRpb24udGltZVBlcmlvZCA9IG9iai50aW1lUGVyaW9kO1xuXHQgICAgICB0aGlzLmFwcGxpZWRBZ2dyZWdhdGlvbi50aW1lUGVyaW9kTXVsdGlwbGllciA9IG9iai50aW1lUGVyaW9kTXVsdGlwbGllcjtcblx0ICAgICAgdGhpcy5hcHBsaWVkQWdncmVnYXRpb24uYWdncmVnYXRpb25NZXRob2QgPSBvYmouYWdncmVnYXRpb25NZXRob2Q7XG5cdCAgICB9XG5cdCAgfV0pO1xuXHRcblx0ICByZXR1cm4gQWdncmVnYXRvcjtcblx0fSgpO1xuXHRcblx0bW9kdWxlLmV4cG9ydHMgPSBBZ2dyZWdhdG9yO1xuXG4vKioqLyB9XG4vKioqKioqLyBdKTtcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gZmN0cy1leHQtZGF0YWFnZ3JlZ2F0b3ItZXM1Lm1pbi5qcyIsIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKVxuIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuXG4gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbiBcdFx0XHRleHBvcnRzOiB7fSxcbiBcdFx0XHRpZDogbW9kdWxlSWQsXG4gXHRcdFx0bG9hZGVkOiBmYWxzZVxuIFx0XHR9O1xuXG4gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4gXHRcdG1vZHVsZS5sb2FkZWQgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiO1xuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKDApO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHdlYnBhY2svYm9vdHN0cmFwIDBkMTcyNjA2NmVmZGQyM2VkOTYwIiwiJ3VzZSBzdHJpY3QnO1xuY29uc3QgQWdncmVnYXRvciA9IHJlcXVpcmUoJy4vZmN0cy1leHQtYWdncmVnYXRvcicpO1xuXG47KGZ1bmN0aW9uIChmYWN0b3J5KSB7XG4gIGZhY3RvcnkoRnVzaW9uQ2hhcnRzKTtcbn0pKGZ1bmN0aW9uIChGQykge1xuICBGQy5yZWdpc3RlcignZXh0ZW5zaW9uJywgWydkYXRhLWFnZ3JlZ2F0b3InLCBmdW5jdGlvbiAoaWQpIHtcbiAgICB2YXIgZ2xvYmFsID0gdGhpcztcbiAgICB2YXIgZXh0QVBJID0gZ2xvYmFsLmV4dEFQSTtcbiAgICBjb25zb2xlLmxvZyhpZCk7XG5cbiAgICAvLyB2YXIgb3RoZXJBUEkgPSBGdXNpb25DaGFydHMuZ2V0RXh0Q29tcG9uZW50KGlkLCAnYXBpJywgJ2xlZ2FjeWV4dGFwaScpO1xuICAgIC8vIHZhciB0b29sQm94QXBpID0gRnVzaW9uQ2hhcnRzLmdldENvbXBvbmVudCgnYXBpJywgJ3Rvb2xib3gnKTtcblxuICAgIHdpbmRvdy5BZ2dyZWdhdG9yID0gbmV3IEFnZ3JlZ2F0b3IoKTtcblxuICAgIGV4dEFQSSh3aW5kb3cuQWdncmVnYXRvcik7XG4gIH1dKTtcbn0pO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIC4vc3JjL2luZGV4LmpzIiwiJ3VzZSBzdHJpY3QnO1xuLyoqXG4gKiBDbGFzcyByZXByZXNlbnRpbmcgdGhlIERhdGEgQWdncmVnYXRvci5cbiAqL1xuY2xhc3MgQWdncmVnYXRvciB7XG4gIC8qKlxuICAgKiBDcmVhdGUgYSBBZ2dyZWdhdG9yLlxuICAgKiBAdHlwZWRlZiB7b2JqZWN0fSBBZ2dyZWdhdG9yLmFnZ3JlZ2F0aW9uXG4gICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSB0aW1lUGVyaW9kIC0gVGhlIHRpbWUgaW50ZXJ2YWwgb2YgYWdncmVnYXRpb24uXG4gICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSB0aW1lUGVyaW9kTXVsdGlwbGllciAtIFRoZSBtdWx0aXBsaWVyIG9mIHRpbWUgaW50ZXJ2YWwuXG4gICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBhZ2dyZWdhdGlvbk1ldGhvZCAtIFRoZSBtZXRob2QgYXBwbGllZCB0byBhZ2dyZWdhdGUuXG4gICAqL1xuICBjb25zdHJ1Y3RvciAoKSB7XG4gICAgLyoqXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICB0aGlzLmFwcGxpZWRBZ2dyZWdhdGlvbiA9IHtcbiAgICAgIHRpbWVQZXJpb2Q6IG51bGwsXG4gICAgICB0aW1lUGVyaW9kTXVsdGlwbGllcjogMSxcbiAgICAgIGFnZ3JlZ2F0aW9uTWV0aG9kOiBudWxsXG4gICAgfTtcbiAgICB0aGlzLmNvbmZpZyA9IHt9O1xuICB9XG5cbiAgLyoqXG4gICAqIEFuIG9iamVjdCByZXByZXNlbnRpbmcgdGhlIHRpbWVQZXJpb2QsIHRpbWVQZXJpb2RNdWx0aXBsaWVyLCBhZ2dyZWdhdGlvbk1ldGhvZC5cbiAgICogQHR5cGUge0FnZ3JlZ2F0b3IuYWdncmVnYXRpb259XG4gICAqL1xuICBnZXQgYWdncmVnYXRpb24gKCkge1xuICAgIHJldHVybiB0aGlzLmFwcGxpZWRBZ2dyZWdhdGlvbjtcbiAgfVxuXG4gIHNldCBhZ2dyZWdhdGlvbiAob2JqKSB7XG4gICAgdGhpcy5hcHBsaWVkQWdncmVnYXRpb24udGltZVBlcmlvZCA9IG9iai50aW1lUGVyaW9kO1xuICAgIHRoaXMuYXBwbGllZEFnZ3JlZ2F0aW9uLnRpbWVQZXJpb2RNdWx0aXBsaWVyID0gb2JqLnRpbWVQZXJpb2RNdWx0aXBsaWVyO1xuICAgIHRoaXMuYXBwbGllZEFnZ3JlZ2F0aW9uLmFnZ3JlZ2F0aW9uTWV0aG9kID0gb2JqLmFnZ3JlZ2F0aW9uTWV0aG9kO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldHMgYXZhaWxhYmxlIGFnZ3JlZ2F0aW9uIG9wdGlvbnMgaW4gY29uZmlndXJhdGlvbiBvZiBleHRlbnNpb25cbiAgICogQHByaXZhdGVcbiAgICovXG4gIGdldEF2YWlsYWJsZWxBZ2dyZWFnYXRpb24gKCkge1xuICAgIHZhciBjb25maWcgPSB0aGlzLmNvbmZpZyxcbiAgICAgIGN1cnJlbnRWaXNpYmxlUmFuZ2UsXG4gICAgICB4QXhpcyA9IHRoaXMueCxcbiAgICAgIGNoYXJ0ID0gdGhpcy5jaGFydDtcblxuICAgIGNvbmZpZy5hdmxBZ2dNZXRob2RzID0gY2hhcnQuZ2V0QXZhaWxhYmxlQWdncmVnYXRpb25NZXRob2QoKTtcbiAgICBjb25maWcuYXZsVGltZVBlcmlvZHMgPSBjaGFydC5nZXRBdmFpbGFibGVUaW1lUGVyaW9kKCk7XG5cbiAgICBjdXJyZW50VmlzaWJsZVJhbmdlID0geEF4aXMuZ2V0Q3VycmVudFZpc2libGVSYW5nZSgpO1xuICAgIGNvbmZpZy5jdXJyZW50VGltZUxlbmd0aCA9IGN1cnJlbnRWaXNpYmxlUmFuZ2UuZW5kRGF0ZSAtIGN1cnJlbnRWaXNpYmxlUmFuZ2Uuc3RhcnREYXRlO1xuICB9XG5cbiAgLyoqXG4gICAqIENhbGN1bGF0ZXMgdmFsaWQgdGltZSBtdWx0aXBsaWVycyBvZiBhdmFpbGFibGUgdGltZSBwZXJpb2RzXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBnZXRWYWxpZFRpbWVNdWx0aXBsaWVyICgpIHtcbiAgICB2YXIgY29uZmlnID0gdGhpcy5jb25maWcsXG4gICAgICB4QXhpcyA9IHRoaXMueCxcbiAgICAgIGksXG4gICAgICBsZW4sXG4gICAgICBjdXJyVGltZVBlcmlvZCxcbiAgICAgIG5leHRUaW1lUGVyaW9kLFxuICAgICAgbnVtT2ZNdWx0aXBsaWVyLFxuICAgICAgY3VycmVudFRpbWVMZW5ndGggPSB4QXhpcy5tYXggLSB4QXhpcy5taW4sXG4gICAgICBhdmxUaW1lUGVyaW9kcyA9IGNvbmZpZy5hdmxUaW1lUGVyaW9kcyxcbiAgICAgIGdldE11bHRpcGxpZXJBcnJheSA9IG51bSA9PiBBcnJheS5mcm9tKHtsZW5ndGg6IG51bX0sICh2LCBrKSA9PiBrICsgMSk7XG5cbiAgICBjb25maWcuYXZsVGltZU11bHRpcGxpZXIgPSBbXTtcbiAgICBsZW4gPSBhdmxUaW1lUGVyaW9kcy5sZW5ndGg7XG5cbiAgICBmb3IgKGkgPSAwOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgIGN1cnJUaW1lUGVyaW9kID0gYXZsVGltZVBlcmlvZHNbaV07XG4gICAgICBuZXh0VGltZVBlcmlvZCA9IGF2bFRpbWVQZXJpb2RzWyhpICsgMSldO1xuXG4gICAgICBpZiAobmV4dFRpbWVQZXJpb2QpIHtcbiAgICAgICAgbnVtT2ZNdWx0aXBsaWVyID1cbiAgICAgICAgICBuZXh0VGltZVBlcmlvZFtPYmplY3Qua2V5cyhuZXh0VGltZVBlcmlvZClbMF1dIC8gY3VyclRpbWVQZXJpb2RbT2JqZWN0LmtleXMoY3VyclRpbWVQZXJpb2QpWzBdXTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG51bU9mTXVsdGlwbGllciA9XG4gICAgICAgICAgY3VycmVudFRpbWVMZW5ndGggLyBjdXJyVGltZVBlcmlvZFtPYmplY3Qua2V5cyhjdXJyVGltZVBlcmlvZClbMF1dO1xuICAgICAgfVxuICAgICAgY29uZmlnLmF2bFRpbWVNdWx0aXBsaWVyLnB1c2goZ2V0TXVsdGlwbGllckFycmF5KG51bU9mTXVsdGlwbGllcikpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDYWxjdWxhdGVzIHZhbGlkIGFnZ3JlZ2F0aW9uIHRpbWUgcGVyaW9kcyBhbmQgY29ycmVzcG9uZGluZyBtdWx0aXBsaWVyc1xuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgZ2V0VmFsaWRBZ2dyZWdhdGlvbiAoKSB7XG4gICAgdmFyIGNoYXJ0Q29uZmlnID0gdGhpcy5jaGFydC5jb25maWcsXG4gICAgICBjb25maWcgPSB0aGlzLmNvbmZpZyxcbiAgICAgIGksXG4gICAgICBqLFxuICAgICAgbGVuMSxcbiAgICAgIGxlbjIsXG4gICAgICBhdmxUaW1lUGVyaW9kcyxcbiAgICAgIGF2bFRpbWVNdWx0aXBsaWVyLFxuICAgICAgbWluTnVtT2ZQbG90ID0gY2hhcnRDb25maWcubWluTnVtT2ZQbG90LFxuICAgICAgbWluUGxvdFdpZHRoID0gY2hhcnRDb25maWcubWluUGxvdFdpZHRoLFxuICAgICAgY2FudmFzV2lkdGggPSBjaGFydENvbmZpZy5jYW52YXNXaWR0aCxcbiAgICAgIGN1cnJlbnRUaW1lTGVuZ3RoLFxuICAgICAgdGltZVBlcmlvZCxcbiAgICAgIHRpbWUsXG4gICAgICBleHBlY3RlZFRpbWUsXG4gICAgICBtdWx0aXBsaWVyLFxuICAgICAgbXVsdGlwbGllckNvdW50ZXIsXG4gICAgICBnZXRNdWx0aXBsaWVyQXJyYXkgPSBudW0gPT4gQXJyYXkuZnJvbSh7bGVuZ3RoOiBudW19LCAodiwgaykgPT4gayArIDEpLFxuICAgICAgbWluVGltZSxcbiAgICAgIG1heFRpbWU7XG5cbiAgICBhdmxUaW1lUGVyaW9kcyA9IGNvbmZpZy5hdmxUaW1lUGVyaW9kcztcbiAgICBhdmxUaW1lTXVsdGlwbGllciA9IGNvbmZpZy5hdmxUaW1lTXVsdGlwbGllcjtcbiAgICBjdXJyZW50VGltZUxlbmd0aCA9IGNvbmZpZy5jdXJyZW50VGltZUxlbmd0aDtcblxuICAgIGNvbmZpZy5taW5UaW1lID0gbWluVGltZSA9IChjdXJyZW50VGltZUxlbmd0aCAvIGNhbnZhc1dpZHRoKSAqIG1pblBsb3RXaWR0aDtcbiAgICBjb25maWcubWF4VGltZSA9IG1heFRpbWUgPSBjdXJyZW50VGltZUxlbmd0aCAvIG1pbk51bU9mUGxvdDtcblxuICAgIGNvbmZpZy52YWxpZFRpbWVQZXJpb2QgPSBbXTtcbiAgICBjb25maWcudmFsaWRUaW1lUGVyaW9kTXVsdGlwbGllciA9IFtdO1xuXG4gICAgZm9yIChpID0gMCwgbGVuMSA9IGF2bFRpbWVQZXJpb2RzLmxlbmd0aDsgaSA8IGxlbjE7IGkrKykge1xuICAgICAgdGltZVBlcmlvZCA9IE9iamVjdC5rZXlzKGF2bFRpbWVQZXJpb2RzW2ldKVswXTtcbiAgICAgIHRpbWUgPSBhdmxUaW1lUGVyaW9kc1tpXVtPYmplY3Qua2V5cyhhdmxUaW1lUGVyaW9kc1tpXSlbMF1dO1xuICAgICAgbXVsdGlwbGllckNvdW50ZXIgPSAwO1xuXG4gICAgICBmb3IgKGogPSAwLCBsZW4yID0gYXZsVGltZU11bHRpcGxpZXJbaV0ubGVuZ3RoOyBqIDwgbGVuMjsgaisrKSB7XG4gICAgICAgIG11bHRpcGxpZXIgPSBhdmxUaW1lTXVsdGlwbGllcltpXVtqXTtcbiAgICAgICAgZXhwZWN0ZWRUaW1lID0gbXVsdGlwbGllciAqIHRpbWU7XG5cbiAgICAgICAgaWYgKChleHBlY3RlZFRpbWUgPj0gbWluVGltZSkgJiYgKGV4cGVjdGVkVGltZSA8PSBtYXhUaW1lKSkge1xuICAgICAgICAgIG11bHRpcGxpZXJDb3VudGVyKys7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChtdWx0aXBsaWVyQ291bnRlcikge1xuICAgICAgICBjb25maWcudmFsaWRUaW1lUGVyaW9kTXVsdGlwbGllci5wdXNoKGdldE11bHRpcGxpZXJBcnJheShtdWx0aXBsaWVyQ291bnRlcikpO1xuICAgICAgICBjb25maWcudmFsaWRUaW1lUGVyaW9kLnB1c2godGltZVBlcmlvZCk7XG4gICAgICB9XG4gICAgfVxuICAgIGNvbnNvbGUubG9nKCdNb250aHM6ICcsIGNvbmZpZy52YWxpZFRpbWVQZXJpb2QpO1xuICAgIGNvbnNvbGUubG9nKCdOdW1iZXIgT2YgTXVsdGlwbGllcnM6ICcsIGNvbmZpZy52YWxpZFRpbWVQZXJpb2RNdWx0aXBsaWVyKTtcbiAgICBjb25zb2xlLmxvZygnTWV0aG9kczogJywgY29uZmlnLmF2bEFnZ01ldGhvZHMpO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldCBBZ2dyZWdhdGlvbiBvbiB0aW1lIHNlcmllc1xuICAgKiBAcGFyYW0gIHtvYmplY3R9IG9ialxuICAgKiBAcHJvcGVydHkge3N0cmluZ30gdGltZVBlcmlvZCAtIFRoZSB0aW1lIGludGVydmFsIG9mIGFnZ3JlZ2F0aW9uLlxuICAgKiBAcHJvcGVydHkge251bWJlcn0gdGltZVBlcmlvZE11bHRpcGxpZXIgLSBUaGUgbXVsdGlwbGllciBvZiB0aW1lIGludGVydmFsLlxuICAgKiBAcHJvcGVydHkge3N0cmluZ30gYWdncmVnYXRpb25NZXRob2QgLSBUaGUgbWV0aG9kIGFwcGxpZWQgdG8gYWdncmVnYXRlLlxuICAgKi9cbiAgc2V0QWdncmVnYXRpb24gKG9iaikge1xuICAgIHZhciBhdmxBZ2dNZXRob2RzLFxuICAgICAgdmFsaWRUaW1lUGVyaW9kLFxuICAgICAgdGltZVBlcmlvZEluZGV4LFxuICAgICAgdmFsaWRUaW1lUGVyaW9kTXVsdGlwbGllcixcbiAgICAgIGNvbmZpZyA9IHRoaXMuY29uZmlnO1xuXG4gICAgYXZsQWdnTWV0aG9kcyA9IGNvbmZpZy5hdmxBZ2dNZXRob2RzO1xuICAgIHZhbGlkVGltZVBlcmlvZCA9IGNvbmZpZy52YWxpZFRpbWVQZXJpb2Q7XG4gICAgdmFsaWRUaW1lUGVyaW9kTXVsdGlwbGllciA9IGNvbmZpZy52YWxpZFRpbWVQZXJpb2RNdWx0aXBsaWVyO1xuXG4gICAgaWYgKGF2bEFnZ01ldGhvZHMuaW5jbHVkZXMob2JqLmFnZ3JlZ2F0aW9uTWV0aG9kKSAmJiB2YWxpZFRpbWVQZXJpb2QuaW5jbHVkZXMob2JqLnRpbWVQZXJpb2QpKSB7XG4gICAgICB0aW1lUGVyaW9kSW5kZXggPSB2YWxpZFRpbWVQZXJpb2QuaW5kZXhPZihvYmoudGltZVBlcmlvZCk7XG4gICAgICBpZiAodmFsaWRUaW1lUGVyaW9kTXVsdGlwbGllclt0aW1lUGVyaW9kSW5kZXhdLmluY2x1ZGVzKG9iai50aW1lUGVyaW9kTXVsdGlwbGllcikpIHtcbiAgICAgICAgdGhpcy5hZ2dyZWdhdGlvbiA9IG9iajtcbiAgICAgICAgY29uc29sZS5sb2codGhpcy5hZ2dyZWdhdGlvbik7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5sb2codGhpcy5hZ2dyZWdhdGlvbik7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgY29uc29sZS5sb2codGhpcy5hZ2dyZWdhdGlvbik7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFJlc2V0IEFwcGxpZWQgQWdncmVnYXRpb25cbiAgICovXG4gIHJlc2V0QWdncmVnYXRpb24gKCkge1xuXG4gIH1cblxuICBpbml0IChyZXF1aXJlKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgcmVxdWlyZSgnWC1BeGlzJywgJ2NoYXJ0JywgZnVuY3Rpb24gKHgsIGNoYXJ0KSB7XG4gICAgICBzZWxmLnggPSB4O1xuICAgICAgc2VsZi5jaGFydCA9IGNoYXJ0O1xuICAgIH0pO1xuXG4gICAgdGhpcy5nZXRBdmFpbGFibGVsQWdncmVhZ2F0aW9uKCk7XG4gICAgdGhpcy5nZXRWYWxpZFRpbWVNdWx0aXBsaWVyKCk7XG4gICAgdGhpcy5nZXRWYWxpZEFnZ3JlZ2F0aW9uKCk7XG4gIH1cblxuICBwbGFjZUluQ2FudmFzICgpIHtcbiAgICAvLyBzcGFjZSBtYW5hZ2VtZW50XG4gIH1cblxuICBkcmF3ICgpIHtcbiAgICAvLyBkcmF3IGV4dGVuc2lvblxuICB9XG5cbiAgZGlzcG9zZSAoKSB7XG4gICAgLy8gZGlzcG9zZSBleHRlbnNpb25cbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IEFnZ3JlZ2F0b3I7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gLi9zcmMvZmN0cy1leHQtYWdncmVnYXRvci5qcyJdLCJzb3VyY2VSb290IjoiIn0=