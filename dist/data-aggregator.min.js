(function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p='',b(0)})([function(a,b,c){'use strict';const d=c(1);(function(e,f){'object'==typeof a&&a.exports?a.exports=e.document?f(e):function(g){if(!g.document)throw new Error('Window with document not present');return f(g,!0)}:e.Aggregator=f(e,!0)})('undefined'==typeof window?this:window,function(e){var f=e.FusionCharts;f.register('extension',['private','data-aggregator',function(){f.registerComponent('extensions','data-aggregator',d({FC:f}))}])})},function(a){'use strict';a.exports=function(b){var c=function(e){return e.charAt(0).toUpperCase()+e.slice(1)};class d{constructor(){this.appliedAggregation={binSize:null,aggregationMethod:null},this.config={}}get aggregation(){return this.appliedAggregation}set aggregation(e){this.appliedAggregation.timePeriod=e.timePeriod,this.appliedAggregation.timePeriodMultiplier=e.timePeriodMultiplier,this.appliedAggregation.aggregationMethod=e.aggregationMethod}getAvailablelAggreagation(){var k,l,e=this.config,f=e.dataAgg,g=e.avlTimePeriods=f.getAggregationTimeRules();for(e.avlTimeMultiplier=[],l=g.length,k=0;k<l;k++)e.avlTimeMultiplier.push(g[k].possibleFactors)}getValidAggregation(){var l,m,n,o,p,q,t,u,v,z,A,B,C,e=this,f=e.config,g=e.tsObject,k=f.dataAgg,r=f.composition.reactiveModel.model['max-plot-point'],s=f.composition.dataset.category.minimumConsecutiveDifference;for(f.currentTimeLength=g.globalReactiveModel.model['x-axis-visible-range-end']-g.globalReactiveModel.model['x-axis-visible-range-start'],p=f.avlTimePeriods,q=f.avlTimeMultiplier,u=f.currentTimeLength,f.minBinSize=C=u/r,f.validTimePeriod=[],f.validTimePeriodMultiplier=[],f.avlAggMethods=k.getAllAggregationMethod(),(l=0,n=p.length);l<n;l++){for(v=p[l].name,z=p[l].interval,t=[],(m=0,o=q[l].length);m<o;m++)B=q[l][m],A=B*z,A>=C&&A>s&&t.push(q[l][m]);0<t.length&&(f.validTimePeriodMultiplier.push(t),f.validTimePeriod.push(v))}}getCurrentAggreation(){var m,n,o,e=this,f=e.config,g=f.dataAgg,k=f.composition,l=k.reactiveModel;return o=l.prop('bin-size')-1,isFinite(o)&&(n=g.timeRules.getSuitableInterval(o),m=l.prop('aggregation-fn')),{timePeriod:n&&n.name,timePeriodMultiplier:n&&n.step,aggregationMethod:{value:m&&m.nickName,text:m&&m.formalName}}}init(e){var k,m,n,o,f=this,g=f.config,l=g.toolboxComponent={},p='tsObject',q=['graphics','globalReactiveModel','chart','spaceManagerInstance','chartInstance','smartLabel','extData',function(){let s=0,t=q.length-1,u='';for(f[p]=f[p]||{},f.requiredParams={},s=0;s<t;++s)u=q[s],f[p][u]=arguments[s]}];return e(q),k=f.tsObject,g.usrConfig=k.extData,m=k.chartInstance.apiInstance,n=m.getComponentStore(),g.composition=o=n.getCanvasByIndex(0).composition,g.dataAgg=o.impl.getDataAggregator(),l.toolbox=b.FC.getComponent('api','toolbox'),l.config={},f.toolbars=[],f.measurement={},f.toolbars.push(f.createToolbar()),o.reactiveModel.onPropsChange(['bin-size','aggregation-fn'],function(){g.execute&&(g.execute=!1,setTimeout(()=>{f.rangeOnChange()},200))}),window.Aggregator=f,f}createToolbar(){var f,g,k,l,m,n,o,p,q,t,I,J,K,L,M,N,O,P,Q,R,S,e=this,r=e.config,s=e.tsObject,u=r.toolboxComponent,v=u.toolbox,z=u.config,A=v.HorizontalToolbar,B=v.ComponentGroup,C=v.SymbolStore,D=s.graphics,E=D.paper,F=D.container,G=s.chart,H=s.smartLabel,T={paper:E,chart:G,smartLabel:H,chartContainer:F},U=()=>{var $,_,W=n.value(),X=m.value(),Y=r.validTimePeriod,Z=r.validTimePeriodMultiplier;$=Y.indexOf(W),_=Z[$].indexOf(+X),J=[];for(I of Z[$])J.push({name:I.toString(),value:I.toString()});m.updateList(J),0>_?m.value(Z[$][0].toString()):m.value(X)},V=()=>{var W=e.getCurrentAggreation();W.timePeriodMultiplier=W.timePeriodMultiplier&&W.timePeriodMultiplier.toString(),W.timePeriodMultiplier!==m.value()||W.timePeriod!==n.value()||W.aggregationMethod.value!==o.value()?q.updateVisual('enabled'):q.updateVisual('disabled'),o.value()||o.value(r.defaultAggMethod),n.value()||m.value()||(n.value(r.validTimePeriod[0]),U())};return f=new B(T,{hPadding:4}),g=new B(T,{hPadding:0}),k=new B(T,{hPadding:0}),l=new A(T),O=r.usrConfig,P=O.position||'bottom',Q=O.alignment||'right','top'===P||'top'===Q?N='bottom':('bottom'==P||'bottom'==Q)&&(N='top'),S=O.styles||{label:{'font-size':13,'font-family':'"Lucida Grande", sans-serif','font-weight':'normal',fill:'#4b4b4b',height:22},timeMultiplierInputField:{active:{fill:'#fff',labelFill:'#696969',stroke:'#c8cecd',strokeWidth:1,radius:1,shadow:{fill:'#000',opacity:0.35},width:50,height:22}},timePeriodInputField:{active:{fill:'#fff',labelFill:'#696969',stroke:'#c8cecd',strokeWidth:1,radius:1,shadow:{fill:'#000',opacity:0.35},width:90,height:22}},aggregationMethodInputField:{active:{fill:'#fff',labelFill:'#696969',stroke:'#c8cecd',strokeWidth:1,radius:1,shadow:{fill:'#000',opacity:0.35},width:100,height:22}},dropDown:{active:{fill:'#898b8b',labelFill:'#fff'},normal:{fill:'#fff',stroke:'#898b8b',radius:2,labelFill:'#000',hoverFill:'#e6e8e8',hoverLabelFill:'#696969'}},applyButton:{active:{fill:'#555',labelFill:'#f3f3f3',stroke:'#ced5d4',strokeWidth:0,hoverFill:'#555',hoverStrokeWidth:0,hoverStroke:'',radius:1,shadow:{fill:'#000',opacity:0.35},width:54,height:22},inactive:{fill:'#bebebe','stroke-width':0,stroke:'#ced5d4',labelFill:'#f3f3f3'}},resetButton:{active:{fill:'#898b8b',labelFill:'#f3f3f3',stroke:'#ced5d4',strokeWidth:0,hoverFill:'#898b8b',hoverStrokeWidth:0,hoverStroke:'',radius:1,shadow:{fill:'#000',opacity:0.35},width:54,height:22},inactive:{fill:'#bebebe','stroke-width':0,stroke:'#ced5d4',labelFill:'#f3f3f3'}},base:{font:{fontSize:11,fontFamily:'"Lucida Grande", sans-serif'}}},R=S||{},R={label:R.label||{},timeMultiplierInputField:{active:R.timeMultiplierInputField&&R.timeMultiplierInputField.active||{}},timePeriodInputField:{active:R.timePeriodInputField&&R.timePeriodInputField.active||{}},aggregationMethodInputField:{active:R.aggregationMethodInputField&&R.aggregationMethodInputField.active||{}},dropDown:{active:R.dropDown&&R.dropDown.active||{},normal:R.dropDown&&R.dropDown.normal||{}},applyButton:{active:R.applyButton&&R.applyButton.active||{},inactive:R.applyButton&&R.applyButton.inactive||{}},resetButton:{active:R.resetButton&&R.resetButton.active||{},inactive:R.resetButton&&R.resetButton.inactive||{}},base:{font:R.base&&R.base.font||{}}},f.setConfig({fill:'#fff',borderThickness:0}),g.setConfig({fill:'#fff',borderThickness:0}),k.setConfig({fill:'#fff',borderThickness:0}),l.setConfig({fill:'#fff',borderThickness:0}),L={disabled:{config:{disabled:R.applyButton.inactive}}},M={disabled:{config:{disabled:R.resetButton.inactive}}},K={selected:{container:{style:{fill:R.dropDown.active.fill}},text:{style:{fill:R.dropDown.active.labelFill}}},normal:{container:{style:{fill:R.dropDown.normal.fill,stroke:R.dropDown.normal.stroke,radius:R.dropDown.normal.radius}},text:{style:{fill:R.dropDown.normal.labelFill}}},hover:{container:{style:{fill:R.dropDown.normal.hoverFill}},text:{style:{fill:R.dropDown.normal.hoverLabelFill}}}},t=new v.Label('Aggregate Data:',T,{container:{height:R.label.height},text:{style:R.label}}),z.timePeriodSelectMenu=n=new v.SelectSymbol({},T,[],Object.assign(R.timePeriodInputField.active,{btnTextStyle:R.base.font,dropDownMenu:K,displayListAt:R.timePeriodInputField.active.displayListAt||N,margin:{right:8}})),z.timeMulSelectMenu=m=new v.SelectSymbol({},T,[],Object.assign(R.timeMultiplierInputField.active,{btnTextStyle:R.base.font,dropDownMenu:K,displayListAt:R.timeMultiplierInputField.active.displayListAt||N,margin:{right:3}})),z.aggMethodSelectMenu=o=new v.SelectSymbol({},T,[],Object.assign(R.aggregationMethodInputField.active,{btnTextStyle:R.base.font,displayListAt:R.aggregationMethodInputField.active.displayListAt||N,margin:{right:11},dropDownMenu:K})),z.applyButton=q=new v.Symbol('APPLY',!0,T,Object.assign(R.applyButton.active,{btnTextStyle:R.base.font,margin:{right:3}})).attachEventHandlers({click:function(){e.apply(1)}}),q.setStateConfig(L),z.resetButton=p=new v.Symbol('RESET',!0,T,Object.assign(R.resetButton.active,{btnTextStyle:R.base.font,margin:{right:3}})).attachEventHandlers({click:function(){e.apply(0)}}),p.setStateConfig(M),f.addSymbol(t),g.addSymbol(m),g.addSymbol(n),g.addSymbol(o),k.addSymbol(q),k.addSymbol(p),C.register('textBoxIcon',function(W,X,Y,Z,$,_,aa){var ba=W-Z/2+_/2,ca=W+Z/2-_/2,da=X-$/2+aa/2,ea=X+$/2-aa/2;return['M',ba,da,'L',ca,da,'L',ca,ea,'L',ba,ea,'Z']}),n.attachEventHandlers({textOnChange:function(){U(),V()}}),m.attachEventHandlers({textOnChange:function(){V()}}),o.attachEventHandlers({textOnChange:function(){V()}}),l.addComponent(f),l.addComponent(g),l.addComponent(k),l}getLogicalSpace(e,f){var g,m,n,k=0,l=0;for(m=0,n=this.toolbars.length;m<n;m++)g=this.toolbars[m].getLogicalSpace(e,f),k=Math.max(g.width,k),l+=g.height,this.toolbars[m].width=g.width,this.toolbars[m].height=g.height;return l+=this.padding,{width:k,height:l}}placeInCanvas(){var e=this,f=e.tsObject,g=e.config.usrConfig;e.padding=5,f.spaceManagerInstance.add([{name:function(){return'data-aggregator'},ref:function(k){return k['0']},self:function(){return e},priority:function(){return 2},layout:function(k){return k[g.layout||'inline']},orientation:[{type:function(k){return k[g.orientation||'horizontal']},position:[{type:function(k){return k[g.position||'bottom']},alignment:[{type:function(k){return k[g.alignment||'right']},dimensions:[function(){var k=this.getParentComponentGroup();return e.getLogicalSpace(k.getWidth(),k.getHeight())}]}]}]}]}])}setDrawingConfiguration(e,f,g,k,l){var m=this.measurement;return m.x=e,m.y=f,m.width=g,m.height=k,this.parentGroup=l,this}apply(e){var r,s,t,u,v,z,B,C,D,E,F,G,f=this,g=f.config,k=g.toolboxComponent.config,l=k.timePeriodSelectMenu,m=k.timeMulSelectMenu,n=k.aggMethodSelectMenu,o=k.applyButton,p=k.resetButton,q=f.tsObject.extData.aggregate||{},A=g.composition.reactiveModel,H=f.aggregation,I=g.composition.impl;if(!e)I.resetAggregation(),H.binSize=null,H.aggregationMethod=null,p.updateVisual('disabled');else if(!!g.drawn){B=l.value(),C=m.value(),D=n.value();for(E of g.avlTimePeriods)if(E.name===B){G=E.interval;break}F=G*+C,A.lock().prop('bin-size-ext',F).prop('aggregation-fn-ext',g.avlAggMethods[D]).unlock(),H.binSize=F,H.aggregationMethod=D,o.updateVisual('disabled'),p.updateVisual('enabled')}else if(B=q.timeUnit&&q.timeUnit.toString().toLowerCase(),C=q.timeMultiplier,D=q.method&&q.method.toString().toLowerCase(),f.getValidAggregation(),r=g.validTimePeriod,s=g.validTimePeriodMultiplier,t=g.avlAggMethods,r.includes(B)&&(u=r.indexOf(B),!s[u].includes(+C)&&(C=s[u][0]),v=!0),t[D]&&(z=!0),v||z){if(v){for(E of g.avlTimePeriods)if(E.name===B){G=E.interval;break}F=G*+C,A.lock().prop('bin-size-ext',F).unlock(),H.binSize=F}z&&(A.lock().prop('aggregation-fn-ext',g.avlAggMethods[D]).unlock(),H.aggregationMethod=D),o.updateVisual('disabled'),p.updateVisual('enabled')}}rangeOnChange(){var q,r,s,t,u,v,z,A,B,C,E,F,G,H,e=this,f=e.config,g=f.toolboxComponent.config,k=g.timePeriodSelectMenu,l=g.timeMulSelectMenu,m=g.aggMethodSelectMenu,n=g.applyButton,o=g.resetButton,p=f.composition.reactiveModel,D=e.aggregation;e.getValidAggregation(),E=e.getCurrentAggreation(),F=E.timePeriod,G=E.timePeriodMultiplier,H=E.aggregationMethod,r=[],v=[],B=[],s=f.validTimePeriod,z=f.validTimePeriodMultiplier,C=f.avlAggMethods,n.updateVisual('disabled'),D.binSize===p.prop('bin-size')||H.value!==f.defaultAggMethod&&H.value?o.updateVisual('enabled'):(D.binSize=null,D.aggregationMethod=null,o.updateVisual('disabled'));for(q of s)r.push({name:c(q),value:q});if(k.updateList(r),F?k.value(F):k.setPlaceHolderValue(''),t=s.indexOf(F),0<=t)for(u of z[t])v.push({name:u.toString(),value:u.toString()});for(A in l.updateList(v),G?l.value(G.toString()):l.setPlaceHolderValue(''),C)B.push({name:c(C[A].formalName),value:C[A].nickName});m.updateList(B),H.value?m.value(H.value):m.setPlaceHolderValue(''),f.execute=!0}draw(e,f,g,k,l){var q,r,s,m=this,n=m.config,o=m.measurement,p=m.toolbars,t=n.dataAgg;if(m.getAvailablelAggreagation(),e=void 0===e?o.x:e,f=void 0===f?o.y:f,g=void 0===g?o.width:g,k=void 0===k?o.height:k,l=void 0===l?m.parentGroup:l,g&&k){for(r=0,q=p.length;r<q;r++)s=p[r],s.draw(e,f,l);n.defaultAggMethod=t.getDefaultAggregationMethod().nickName,n.drawn||m.apply(1),m.rangeOnChange(),n.drawn=!0}}dispose(){}}return d}}]);
//# sourceMappingURL=data-aggregator.min.js.map