/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId])
/******/ 			return installedModules[moduleId].exports;
/******/
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			exports: {},
/******/ 			id: moduleId,
/******/ 			loaded: false
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.loaded = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(0);
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ function(module, exports, __webpack_require__) {

	module.exports = __webpack_require__(1);


/***/ },
/* 1 */
/***/ function(module, exports, __webpack_require__) {

	'use strict';
	const AggregatorGetter = __webpack_require__(2);
	
	;(function (env, factory) {
	  if (typeof module === 'object' && module.exports) {
	    module.exports = env.document
	       ? factory(env) : function (win) {
	         if (!win.document) {
	           throw new Error('Window with document not present');
	         }
	         return factory(win, true);
	       };
	  } else {
	    env.Aggregator = factory(env, true);
	  }
	})(typeof window !== 'undefined' ? window : this, function (_window, windowExists) {
	  var FC = _window.FusionCharts;
	
	  FC.register('extension', ['private', 'data-aggregator', function () {
	    FC.registerComponent('extensions', 'data-aggregator', AggregatorGetter({FC: FC}));
	  }]);
	});


/***/ },
/* 2 */
/***/ function(module, exports) {

	'use strict';
	
	module.exports = function (dep) {
	  /**
	   * Class representing the Data Aggregator.
	   */
	  class Aggregator {
	    /**
	     * Create a Aggregator.
	     * @typedef {object} Aggregator.aggregation
	     * @property {string} timePeriod - The time interval of aggregation.
	     * @property {number} timePeriodMultiplier - The multiplier of time interval.
	     * @property {string} aggregationMethod - The method applied to aggregate.
	     */
	    constructor () {
	      /**
	       * @private
	       */
	      this.appliedAggregation = {
	        binSize: null,
	        aggregationMethod: null
	      };
	      this.config = {};
	    }
	
	    /**
	     * An object representing the timePeriod, timePeriodMultiplier, aggregationMethod.
	     * @type {Aggregator.aggregation}
	     */
	    get aggregation () {
	      return this.appliedAggregation;
	    }
	
	    set aggregation (obj) {
	      this.appliedAggregation.timePeriod = obj.timePeriod;
	      this.appliedAggregation.timePeriodMultiplier = obj.timePeriodMultiplier;
	      this.appliedAggregation.aggregationMethod = obj.aggregationMethod;
	    }
	
	    /**
	     * Sets available aggregation options in configuration of extension
	     * @private
	     */
	    getAvailablelAggreagation () {
	      var config = this.config,
	        dataAgg = config.dataAgg,
	        avlTimePeriods = config.avlTimePeriods = dataAgg.getAggregationTimeRules(),
	        i,
	        len;
	
	      config.avlTimeMultiplier = [];
	      len = avlTimePeriods.length;
	
	      for (i = 0; i < len; i++) {
	        config.avlTimeMultiplier.push(avlTimePeriods[i].possibleFactors);
	      }
	    }
	
	    /**
	     * Calculates valid aggregation time periods and corresponding multipliers
	     * @private
	     */
	    getValidAggregation () {
	      var self = this,
	        config = self.config,
	        tsObject = self.tsObject,
	        dataAgg = config.dataAgg,
	        i,
	        j,
	        len1,
	        len2,
	        avlTimePeriods,
	        avlTimeMultiplier,
	        // minNumOfPlot = 5,
	        maxNumOfPlot = config.composition.reactiveModel.model['max-plot-point'],
	        multipliersArr,
	        currentTimeLength,
	        timePeriod,
	        time,
	        expectedTime,
	        multiplier,
	        minBinSize;
	        // maxBinSize;
	
	      config.currentTimeLength = tsObject.globalReactiveModel.model['x-axis-visible-range-end'] -
	        tsObject.globalReactiveModel.model['x-axis-visible-range-start'];
	
	      avlTimePeriods = config.avlTimePeriods;
	      avlTimeMultiplier = config.avlTimeMultiplier;
	      currentTimeLength = config.currentTimeLength;
	
	      config.minBinSize = minBinSize = currentTimeLength / maxNumOfPlot;
	      // config.maxBinSize = maxBinSize = currentTimeLength / minNumOfPlot;
	
	      config.validTimePeriod = [];
	      config.validTimePeriodMultiplier = [];
	      config.avlAggMethods = dataAgg.getAllAggregationMethod();
	
	      for (i = 0, len1 = avlTimePeriods.length; i < len1; i++) {
	        timePeriod = avlTimePeriods[i].name;
	        time = avlTimePeriods[i].interval;
	        multipliersArr = [];
	
	        for (j = 0, len2 = avlTimeMultiplier[i].length; j < len2; j++) {
	          multiplier = avlTimeMultiplier[i][j];
	          expectedTime = multiplier * time;
	
	          // if ((expectedTime >= minBinSize) && (expectedTime <= maxBinSize)) {
	          if ((expectedTime >= minBinSize)) {
	            multipliersArr.push(avlTimeMultiplier[i][j]);
	          }
	        }
	        if (multipliersArr.length > 0) {
	          config.validTimePeriodMultiplier.push(multipliersArr);
	          config.validTimePeriod.push(timePeriod);
	        }
	      }
	      // console.log('Time Period: ', config.validTimePeriod);
	      // console.log('Number Of Multipliers: ', config.validTimePeriodMultiplier);
	      // console.log('Methods: ', config.avlAggMethods);
	    }
	
	    getCurrentAggreation () {
	      var self = this,
	        config = self.config,
	        dataAgg = config.dataAgg,
	        composition = config.composition,
	        model = composition.reactiveModel,
	        currentAggMethod,
	        suitableInterval,
	        binSize;
	
	      binSize = model.prop('bin-size') - 1;
	
	      if (isFinite(binSize)) {
	        config.canAggregate = true;
	        suitableInterval = dataAgg.timeRules.getSuitableInterval(binSize);
	        currentAggMethod = model.prop('aggregation-fn');
	      } else {
	        config.canAggregate = false;
	        suitableInterval = {
	          name: '',
	          step: ''
	        };
	        config.validTimePeriod = [suitableInterval.name];
	        config.validTimePeriodMultiplier = [[suitableInterval.step]];
	        config.avlAggMethods = {
	          'invalid': {
	            formalName: '',
	            nickName: ''
	          }
	        };
	        currentAggMethod = config.avlAggMethods['invalid'];
	      }
	
	      return {
	        timePeriod: suitableInterval.name,
	        timePeriodMultiplier: suitableInterval.step,
	        aggregationMethod: {
	          value: currentAggMethod.nickName,
	          text: currentAggMethod.formalName
	        }
	      };
	    }
	
	    init (require) {
	      var self = this,
	        config = self.config,
	        toolboxComponent = config.toolboxComponent = {},
	        api,
	        store,
	        composition,
	        saveTo = 'tsObject',
	        requiredParams = [
	          'graphics',
	          'globalReactiveModel',
	          'chart',
	          'spaceManagerInstance',
	          'chartInstance',
	          'smartLabel',
	          function acquire () {
	            let i = 0,
	              ii = requiredParams.length - 1,
	              param = '';
	            self[saveTo] = self[saveTo] || {};
	            self.requiredParams = {};
	            for (i = 0; i < ii; ++i) {
	              param = requiredParams[i];
	              self[saveTo][param] = arguments[i];
	            }
	            // onInit(self[saveTo]);
	          }
	        ];
	      require(requiredParams);
	
	      api = self.tsObject.chartInstance.apiInstance;
	      store = api.getComponentStore();
	      config.composition = composition = store.getCanvasByIndex(0).composition;
	      config.dataAgg = composition.impl.getDataAggregator();
	
	      toolboxComponent.toolbox = dep.FC.getComponent('api', 'toolbox');
	      toolboxComponent.config = {};
	
	      self.toolbars = [];
	
	      self.measurement = {};
	
	      self.toolbars.push(self.createToolbar());
	
	      window.Aggregator = self;
	      return self;
	    }
	
	    createToolbar () {
	      var self = this,
	        group,
	        toolbar,
	        timeMulSelectMenu,
	        timePeriodSelectMenu,
	        aggMethodSelectMenu,
	        resetButton,
	        applyButton,
	        config = self.config,
	        tsObject = self.tsObject,
	        label,
	
	        toolboxComponent = config.toolboxComponent,
	        toolbox = toolboxComponent.toolbox,
	        toolboxCompConfig = toolboxComponent.config,
	        HorizontalToolbar = toolbox.HorizontalToolbar,
	        ComponentGroup = toolbox.ComponentGroup,
	        SymbolStore = toolbox.SymbolStore,
	
	        graphics = tsObject.graphics,
	        paper = graphics.paper,
	        container = graphics.container,
	        chart = tsObject.chart,
	        smartLabel = tsObject.smartLabel,
	
	        multiplierVal,
	        timeMulSelectMenuOpt,
	        selectMenuConfig,
	        dropDownMenuStyle,
	        buttonConfig,
	
	        dependencies = {
	          paper: paper,
	          chart: chart,
	          smartLabel: smartLabel,
	          chartContainer: container
	        },
	        apply = (set) => {
	          var model = config.composition.reactiveModel,
	            timePeriodVal = timePeriodSelectMenu.value(),
	            timePeriodMultiplierVal = timeMulSelectMenu.value(),
	            aggMethodSelectMenuVal = aggMethodSelectMenu.value(),
	            keys,
	            binSize,
	            timeInterval,
	            aggregation = self.aggregation,
	            canvas = config.composition.impl;
	
	          for (keys of config.avlTimePeriods) {
	            if (keys.name === timePeriodVal) {
	              timeInterval = keys.interval;
	              break;
	            }
	          }
	          binSize = timeInterval * Number(timePeriodMultiplierVal);
	          if (set && isFinite(model.prop('bin-size'))) {
	            model
	              .lock()
	              .prop('bin-size-ext', binSize)
	              .prop('aggregation-fn-ext', config.avlAggMethods[aggMethodSelectMenuVal])
	              .unlock();
	            aggregation.binSize = binSize;
	            aggregation.aggregationMethod = aggMethodSelectMenuVal;
	            applyButton.updateVisual('disabled');
	            resetButton.updateVisual('enabled');
	          } else {
	            canvas.resetAggregation();
	            aggregation.binSize = null;
	            aggregation.aggregationMethod = null;
	            resetButton.updateVisual('disabled');
	          }
	        },
	
	        timePeriodOnChange = () => {
	          var timePeriodVal = timePeriodSelectMenu.value(),
	            timePeriodMultiplierVal = timeMulSelectMenu.value(),
	            prevTimePeroidMulVal = timePeriodMultiplierVal,
	            validTimePeriod = config.validTimePeriod,
	            validTimePeriodMultiplier = config.validTimePeriodMultiplier,
	            indexOfTimeUnit,
	            indexOfTimeMul;
	
	          indexOfTimeUnit = validTimePeriod.indexOf(timePeriodVal);
	          indexOfTimeMul = validTimePeriodMultiplier[indexOfTimeUnit].indexOf(Number(timePeriodMultiplierVal));
	
	          timeMulSelectMenuOpt = [];
	          for (multiplierVal of validTimePeriodMultiplier[indexOfTimeUnit]) {
	            timeMulSelectMenuOpt.push({
	              name: multiplierVal.toString(),
	              value: multiplierVal.toString()
	            });
	          }
	
	          timeMulSelectMenu.updateList(timeMulSelectMenuOpt);
	
	          if (indexOfTimeMul < 0) {
	            timeMulSelectMenu.value(validTimePeriodMultiplier[indexOfTimeUnit][0].toString());
	          } else {
	            timeMulSelectMenu.value(prevTimePeroidMulVal);
	          }
	        },
	
	        onChange = (type) => {
	          var currentAgg = self.getCurrentAggreation();
	
	          switch (type) {
	            case 1:
	              if (currentAgg.timePeriodMultiplier.toString() !== timeMulSelectMenu.value()) {
	                applyButton.updateVisual('enabled');
	              } else {
	                applyButton.updateVisual('disabled');
	              }
	              break;
	            case 2:
	              if (currentAgg.timePeriod !== timePeriodSelectMenu.value()) {
	                applyButton.updateVisual('enabled');
	              } else {
	                applyButton.updateVisual('disabled');
	              }
	              break;
	            case 3:
	              if (currentAgg.aggregationMethod.value !== aggMethodSelectMenu.value()) {
	                applyButton.updateVisual('enabled');
	              } else {
	                applyButton.updateVisual('disabled');
	              }
	              break;
	          }
	        };
	
	      group = new ComponentGroup(dependencies);
	      toolbar = new HorizontalToolbar(dependencies);
	
	      group.setConfig({
	        fill: '#fff',
	        borderThickness: 0
	      });
	
	      toolbar.setConfig({
	        fill: '#fff',
	        borderThickness: 0
	      });
	
	      selectMenuConfig = {
	        disabled: {
	          config: {
	            disabled: {
	              fill: '#fff',
	              'stroke-width': 3,
	              stroke: 'rgb(192, 192, 192)'
	            }
	          }
	        }
	      };
	
	      buttonConfig = {
	        disabled: {
	          config: {
	            disabled: {
	              fill: '#bebebe',
	              'stroke-width': 3,
	              stroke: 'rgb(192, 192, 192)',
	              labelFill: '#fff'
	            }
	          }
	        }
	      };
	
	      dropDownMenuStyle = {
	        selected: {
	          container: {
	            style: {
	              fill: '#898b8b'
	            }
	          },
	          text: {
	            style: {
	              fill: '#fff'
	            }
	          }
	        },
	        normal: {
	          container: {
	            style: {
	              fill: '#fff'
	            }
	          },
	          text: {
	            style: {
	              fill: '#000'
	            }
	          }
	        },
	        hover: {
	          container: {
	            style: {
	              fill: '#e6e8e8'
	            }
	          },
	          text: {
	            style: {
	              fill: '#000'
	            }
	          }
	        }
	      };
	
	      label = new toolbox.Label('Aggregate Data:', dependencies, {
	        text: {
	          style: {
	            'font-size': '14',
	            'fill': '#696969'
	          }
	        }
	      });
	
	      toolboxCompConfig.timePeriodSelectMenu = timePeriodSelectMenu = new toolbox.SelectSymbol({
	        width: 90,
	        height: 22
	      }, dependencies, [], {
	        fill: '#fff',
	        labelFill: '#696969',
	        hoverFill: '#fff',
	        hoverStroke: '#696969',
	        hoverStrokeWidth: 1,
	        strokeWidth: 1,
	        radius: 1,
	        stroke: '#c8cecd',
	        symbolStrokeWidth: 0,
	        btnTextStyle: {
	          fontSize: 11
	        },
	        dropDownMenu: dropDownMenuStyle
	      });
	      timePeriodSelectMenu.setStateConfig(selectMenuConfig);
	
	      toolboxCompConfig.timeMulSelectMenu = timeMulSelectMenu = new toolbox.SelectSymbol({
	        width: 50,
	        height: 22
	      }, dependencies, [], {
	        fill: '#fff',
	        labelFill: '#696969',
	        hoverFill: '#fff',
	        hoverStroke: '#696969',
	        hoverStrokeWidth: 1,
	        strokeWidth: 1,
	        radius: 1,
	        stroke: '#c8cecd',
	        symbolStrokeWidth: 0,
	        btnTextStyle: {
	          fontSize: 11
	        },
	        dropDownMenu: dropDownMenuStyle
	      });
	      timeMulSelectMenu.setStateConfig(selectMenuConfig);
	
	      toolboxCompConfig.aggMethodSelectMenu = aggMethodSelectMenu = new toolbox.SelectSymbol({
	        width: 90,
	        height: 22
	      }, dependencies, [], {
	        fill: '#fff',
	        labelFill: '#696969',
	        hoverFill: '#fff',
	        hoverStroke: '#696969',
	        hoverStrokeWidth: 1,
	        strokeWidth: 1,
	        radius: 1,
	        stroke: '#c8cecd',
	        symbolStrokeWidth: 0,
	        btnTextStyle: {
	          fontSize: 11
	        },
	        dropDownMenu: dropDownMenuStyle
	      });
	      aggMethodSelectMenu.setStateConfig(selectMenuConfig);
	
	      toolboxCompConfig.applyButton = applyButton = new toolbox.Symbol('APPLY', true, dependencies, {
	        fill: '#555',
	        labelFill: '#f3f3f3',
	        hoverFill: '#555',
	        radius: 1,
	        width: 30,
	        height: 20,
	        btnTextStyle: {
	          fontSize: 11
	        }
	      }).attachEventHandlers({
	        click: function () {
	          apply(1);
	        }
	      });
	      applyButton.setStateConfig(buttonConfig);
	
	      toolboxCompConfig.resetButton = resetButton = new toolbox.Symbol('RESET', true, dependencies, {
	        fill: '#898b8b',
	        labelFill: '#f3f3f3',
	        hoverFill: '#898b8b',
	        radius: 1,
	        width: 30,
	        height: 20,
	        btnTextStyle: {
	          fontSize: 11
	        }
	      }).attachEventHandlers({
	        click: function () {
	          apply(0);
	        }
	      });
	      resetButton.setStateConfig(buttonConfig);
	
	      group.addSymbol(label);
	      group.addSymbol(timeMulSelectMenu);
	      group.addSymbol(timePeriodSelectMenu);
	      group.addSymbol(aggMethodSelectMenu);
	      group.addSymbol(applyButton);
	      group.addSymbol(resetButton);
	
	      SymbolStore.register('textBoxIcon', function (x, y, rad, w, h, padX, padY) {
	        var x1 = x - w / 2 + padX / 2,
	          x2 = x + w / 2 - padX / 2,
	          y1 = y - h / 2 + padY / 2,
	          y2 = y + h / 2 - padY / 2;
	
	        return ['M', x1, y1, 'L', x2, y1, 'L', x2, y2, 'L', x1, y2, 'Z'];
	      });
	
	      timePeriodSelectMenu.attachEventHandlers({
	        textOnChange: function () {
	          timePeriodOnChange();
	          onChange(2);
	        }
	      });
	
	      timeMulSelectMenu.attachEventHandlers({
	        textOnChange: function () {
	          onChange(1);
	        }
	      });
	
	      aggMethodSelectMenu.attachEventHandlers({
	        textOnChange: function () {
	          onChange(3);
	        }
	      });
	
	      toolbar.addComponent(group);
	
	      return toolbar;
	    }
	
	    getLogicalSpace (availableWidth, availableHeight) {
	      var logicalSpace,
	        width = 0,
	        height = 0,
	        i,
	        ln;
	
	      for (i = 0, ln = this.toolbars.length; i < ln; i++) {
	        logicalSpace = this.toolbars[i].getLogicalSpace();
	        width = Math.max(logicalSpace.width, width);
	        height += logicalSpace.height;
	        this.toolbars[i].width = logicalSpace.width;
	        this.toolbars[i].height = logicalSpace.height;
	      }
	      height += this.padding;
	      return {
	        width: width > availableWidth ? 0 : width,
	        height: height > availableHeight ? 0 : height
	      };
	    }
	
	    placeInCanvas (containerInstance) {
	      var self = this,
	        tsObject = self.tsObject;
	
	      self.padding = 5;
	      tsObject.spaceManagerInstance.add([{
	        name: function () {
	          return 'DataAggregator';
	        },
	        ref: function (obj) {
	          return obj['0'];
	        },
	        self: function () {
	          return self;
	        },
	        priority: function () {
	          return 2;
	        },
	        layout: function (obj) {
	          return obj.inline;
	        },
	        orientation: [{
	          type: function (obj) {
	            return obj.horizontal;
	          },
	          position: [{
	            type: function (obj) {
	              return obj.top;
	            },
	            alignment: [{
	              type: function (obj) {
	                return obj.left;
	              },
	              dimensions: [function () {
	                var parent = this.getParentComponentGroup();
	                return self.getLogicalSpace(parent.getWidth(), parent.getHeight());
	              }]
	            }]
	          }]
	        }]
	      }]);
	    }
	
	    setDrawingConfiguration (x, y, width, height, group) {
	      var mes = this.measurement;
	      mes.x = x;
	      mes.y = y;
	      mes.width = width;
	      mes.height = height;
	
	      this.parentGroup = group;
	
	      return this;
	    }
	
	    draw (x, y, width, height, group) {
	      var self = this,
	        config = self.config,
	        toolboxCompConfig = config.toolboxComponent.config,
	        timePeriodSelectMenu = toolboxCompConfig.timePeriodSelectMenu,
	        timeMulSelectMenu = toolboxCompConfig.timeMulSelectMenu,
	        aggMethodSelectMenu = toolboxCompConfig.aggMethodSelectMenu,
	        applyButton = toolboxCompConfig.applyButton,
	        resetButton = toolboxCompConfig.resetButton,
	        measurement = self.measurement,
	        toolbars = self.toolbars,
	        ln,
	        i,
	        toolbar,
	        model = config.composition.reactiveModel,
	        dataAgg = config.dataAgg,
	
	        timePeriodVal,
	        timePeriodSelectMenuOpt,
	        validTimePeriod,
	        indexOfTimeUnit,
	
	        multiplierVal,
	        timeMulSelectMenuOpt,
	        validTimePeriodMultiplier,
	
	        aggVal,
	        aggMethodSelectMenuOpt,
	        avlAggMethods,
	        rangeOnChange = () => {
	          var aggregation = self.aggregation,
	            currentAggregationObj,
	            timePeriod,
	            timePeriodMultiplier,
	            aggregationMethod;
	
	          self.getValidAggregation();
	          currentAggregationObj = self.getCurrentAggreation();
	          timePeriod = currentAggregationObj.timePeriod;
	          timePeriodMultiplier = currentAggregationObj.timePeriodMultiplier;
	          aggregationMethod = currentAggregationObj.aggregationMethod;
	
	          timePeriodSelectMenuOpt = [];
	          timeMulSelectMenuOpt = [];
	          aggMethodSelectMenuOpt = [];
	
	          validTimePeriod = config.validTimePeriod;
	          validTimePeriodMultiplier = config.validTimePeriodMultiplier;
	          avlAggMethods = config.avlAggMethods;
	
	          applyButton.updateVisual('disabled');
	
	          if (aggregation.binSize !== model.prop('bin-size') &&
	            aggregationMethod.value === config.defaultAggMethod) {
	            aggregation.binSize = null;
	            aggregation.aggregationMethod = null;
	            resetButton.updateVisual('disabled');
	          } else {
	            resetButton.updateVisual('enabled');
	          }
	
	          if (!config.canAggregate) {
	            timePeriodSelectMenu.updateVisual('disabled');
	            timeMulSelectMenu.updateVisual('disabled');
	            aggMethodSelectMenu.updateVisual('disabled');
	            resetButton.updateVisual('disabled');
	          } else {
	            timePeriodSelectMenu.updateVisual('enabled');
	            timeMulSelectMenu.updateVisual('enabled');
	            aggMethodSelectMenu.updateVisual('enabled');
	          }
	
	          for (timePeriodVal of validTimePeriod) {
	            timePeriodSelectMenuOpt.push({
	              name: timePeriodVal,
	              value: timePeriodVal
	            });
	          }
	
	          timePeriodSelectMenu.updateList(timePeriodSelectMenuOpt);
	          timePeriodSelectMenu.value(timePeriod);
	
	          indexOfTimeUnit = validTimePeriod.indexOf(timePeriod);
	
	          if (indexOfTimeUnit >= 0) {
	            for (multiplierVal of validTimePeriodMultiplier[indexOfTimeUnit]) {
	              timeMulSelectMenuOpt.push({
	                name: multiplierVal.toString(),
	                value: multiplierVal.toString()
	              });
	            }
	          }
	
	          timeMulSelectMenu.updateList(timeMulSelectMenuOpt);
	          timeMulSelectMenu.value(timePeriodMultiplier.toString());
	
	          for (aggVal in avlAggMethods) {
	            aggMethodSelectMenuOpt.push({
	              name: avlAggMethods[aggVal].formalName,
	              value: avlAggMethods[aggVal].nickName
	            });
	          }
	
	          aggMethodSelectMenu.updateList(aggMethodSelectMenuOpt);
	          aggMethodSelectMenu.value(aggregationMethod.value);
	        };
	
	      self.getAvailablelAggreagation();
	
	      x = x === undefined ? measurement.x : x;
	      y = y === undefined ? measurement.y : y;
	      width = width === undefined ? measurement.width : width;
	      height = height === undefined ? measurement.height : height;
	      group = group === undefined ? self.parentGroup : group;
	      if (width && height) {
	        for (i = 0, ln = toolbars.length; i < ln; i++) {
	          toolbar = toolbars[i];
	          toolbar.draw(x, y);
	        }
	      }
	      rangeOnChange();
	      applyButton.updateVisual('disabled');
	      resetButton.updateVisual('disabled');
	      config.defaultAggMethod = dataAgg.getDefaultAggregationMethod().nickName;
	
	      model.onPropsChange(['bin-size', 'aggregation-fn'], rangeOnChange);
	    }
	
	    dispose () {
	      // dispose extension
	    }
	  }
	  return Aggregator;
	};


/***/ }
/******/ ]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAgMjRhMjUyYTg2ODYwZDM1MWUwZjAiLCJ3ZWJwYWNrOi8vLy4vc3JjL2luZGV4LmpzIiwid2VicGFjazovLy8uL3NyYy9mY3RzLWV4dC1hZ2dyZWdhdG9yLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSx1QkFBZTtBQUNmO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOzs7QUFHQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOzs7Ozs7Ozs7Ozs7OztBQ3RDQTtBQUNBOztBQUVBLEVBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBRztBQUNIO0FBQ0E7QUFDQSxFQUFDO0FBQ0Q7O0FBRUE7QUFDQSw2RUFBNEUsT0FBTztBQUNuRixJQUFHO0FBQ0gsRUFBQzs7Ozs7OztBQ3JCRDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFpQixPQUFPO0FBQ3hCLG1CQUFrQixPQUFPO0FBQ3pCLG1CQUFrQixPQUFPO0FBQ3pCLG1CQUFrQixPQUFPO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGVBQWM7QUFDZDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUEsa0JBQWlCLFNBQVM7QUFDMUI7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBLGdEQUErQyxVQUFVO0FBQ3pEO0FBQ0E7QUFDQTs7QUFFQSx3REFBdUQsVUFBVTtBQUNqRTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0Esd0RBQXVEO0FBQ3ZEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBdUIsUUFBUTtBQUMvQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFhO0FBQ2I7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLFlBQVc7QUFDWDtBQUNBO0FBQ0EsVUFBUzs7QUFFVDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWU7QUFDZjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZTtBQUNmO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFlO0FBQ2Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFFBQU87O0FBRVA7QUFDQTtBQUNBO0FBQ0EsUUFBTzs7QUFFUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQU87O0FBRVA7QUFDQTtBQUNBO0FBQ0EsUUFBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFTO0FBQ1Q7QUFDQSxRQUFPO0FBQ1A7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsUUFBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFTO0FBQ1Q7QUFDQSxRQUFPO0FBQ1A7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsUUFBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFTO0FBQ1Q7QUFDQSxRQUFPO0FBQ1A7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0EsUUFBTztBQUNQOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBTztBQUNQO0FBQ0E7QUFDQTtBQUNBLFFBQU87QUFDUDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLFFBQU87O0FBRVA7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQU87O0FBRVA7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFPOztBQUVQO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBTzs7QUFFUDs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSw2Q0FBNEMsUUFBUTtBQUNwRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBUztBQUNUO0FBQ0E7QUFDQSxVQUFTO0FBQ1Q7QUFDQTtBQUNBLFVBQVM7QUFDVDtBQUNBO0FBQ0EsVUFBUztBQUNUO0FBQ0E7QUFDQSxVQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsWUFBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLGNBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxnQkFBZTtBQUNmO0FBQ0E7QUFDQTtBQUNBLGdCQUFlO0FBQ2YsY0FBYTtBQUNiLFlBQVc7QUFDWCxVQUFTO0FBQ1QsUUFBTztBQUNQOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFXO0FBQ1g7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBVztBQUNYO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYTtBQUNiOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFlO0FBQ2Y7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYTtBQUNiOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQ0FBeUMsUUFBUTtBQUNqRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImZjdHMtZXh0LWRhdGFhZ2dyZWdhdG9yLWVzNi5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIgXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuXG4gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXG4gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSlcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcblxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0ZXhwb3J0czoge30sXG4gXHRcdFx0aWQ6IG1vZHVsZUlkLFxuIFx0XHRcdGxvYWRlZDogZmFsc2VcbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubG9hZGVkID0gdHJ1ZTtcblxuIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4gXHR9XG5cblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7XG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXygwKTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyB3ZWJwYWNrL2Jvb3RzdHJhcCAyNGEyNTJhODY4NjBkMzUxZTBmMCIsIid1c2Ugc3RyaWN0JztcbmNvbnN0IEFnZ3JlZ2F0b3JHZXR0ZXIgPSByZXF1aXJlKCcuL2ZjdHMtZXh0LWFnZ3JlZ2F0b3InKTtcblxuOyhmdW5jdGlvbiAoZW52LCBmYWN0b3J5KSB7XG4gIGlmICh0eXBlb2YgbW9kdWxlID09PSAnb2JqZWN0JyAmJiBtb2R1bGUuZXhwb3J0cykge1xuICAgIG1vZHVsZS5leHBvcnRzID0gZW52LmRvY3VtZW50XG4gICAgICAgPyBmYWN0b3J5KGVudikgOiBmdW5jdGlvbiAod2luKSB7XG4gICAgICAgICBpZiAoIXdpbi5kb2N1bWVudCkge1xuICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1dpbmRvdyB3aXRoIGRvY3VtZW50IG5vdCBwcmVzZW50Jyk7XG4gICAgICAgICB9XG4gICAgICAgICByZXR1cm4gZmFjdG9yeSh3aW4sIHRydWUpO1xuICAgICAgIH07XG4gIH0gZWxzZSB7XG4gICAgZW52LkFnZ3JlZ2F0b3IgPSBmYWN0b3J5KGVudiwgdHJ1ZSk7XG4gIH1cbn0pKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnID8gd2luZG93IDogdGhpcywgZnVuY3Rpb24gKF93aW5kb3csIHdpbmRvd0V4aXN0cykge1xuICB2YXIgRkMgPSBfd2luZG93LkZ1c2lvbkNoYXJ0cztcblxuICBGQy5yZWdpc3RlcignZXh0ZW5zaW9uJywgWydwcml2YXRlJywgJ2RhdGEtYWdncmVnYXRvcicsIGZ1bmN0aW9uICgpIHtcbiAgICBGQy5yZWdpc3RlckNvbXBvbmVudCgnZXh0ZW5zaW9ucycsICdkYXRhLWFnZ3JlZ2F0b3InLCBBZ2dyZWdhdG9yR2V0dGVyKHtGQzogRkN9KSk7XG4gIH1dKTtcbn0pO1xuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9zcmMvaW5kZXguanNcbi8vIG1vZHVsZSBpZCA9IDFcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiJ3VzZSBzdHJpY3QnO1xuXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChkZXApIHtcbiAgLyoqXG4gICAqIENsYXNzIHJlcHJlc2VudGluZyB0aGUgRGF0YSBBZ2dyZWdhdG9yLlxuICAgKi9cbiAgY2xhc3MgQWdncmVnYXRvciB7XG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGEgQWdncmVnYXRvci5cbiAgICAgKiBAdHlwZWRlZiB7b2JqZWN0fSBBZ2dyZWdhdG9yLmFnZ3JlZ2F0aW9uXG4gICAgICogQHByb3BlcnR5IHtzdHJpbmd9IHRpbWVQZXJpb2QgLSBUaGUgdGltZSBpbnRlcnZhbCBvZiBhZ2dyZWdhdGlvbi5cbiAgICAgKiBAcHJvcGVydHkge251bWJlcn0gdGltZVBlcmlvZE11bHRpcGxpZXIgLSBUaGUgbXVsdGlwbGllciBvZiB0aW1lIGludGVydmFsLlxuICAgICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBhZ2dyZWdhdGlvbk1ldGhvZCAtIFRoZSBtZXRob2QgYXBwbGllZCB0byBhZ2dyZWdhdGUuXG4gICAgICovXG4gICAgY29uc3RydWN0b3IgKCkge1xuICAgICAgLyoqXG4gICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICovXG4gICAgICB0aGlzLmFwcGxpZWRBZ2dyZWdhdGlvbiA9IHtcbiAgICAgICAgYmluU2l6ZTogbnVsbCxcbiAgICAgICAgYWdncmVnYXRpb25NZXRob2Q6IG51bGxcbiAgICAgIH07XG4gICAgICB0aGlzLmNvbmZpZyA9IHt9O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEFuIG9iamVjdCByZXByZXNlbnRpbmcgdGhlIHRpbWVQZXJpb2QsIHRpbWVQZXJpb2RNdWx0aXBsaWVyLCBhZ2dyZWdhdGlvbk1ldGhvZC5cbiAgICAgKiBAdHlwZSB7QWdncmVnYXRvci5hZ2dyZWdhdGlvbn1cbiAgICAgKi9cbiAgICBnZXQgYWdncmVnYXRpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMuYXBwbGllZEFnZ3JlZ2F0aW9uO1xuICAgIH1cblxuICAgIHNldCBhZ2dyZWdhdGlvbiAob2JqKSB7XG4gICAgICB0aGlzLmFwcGxpZWRBZ2dyZWdhdGlvbi50aW1lUGVyaW9kID0gb2JqLnRpbWVQZXJpb2Q7XG4gICAgICB0aGlzLmFwcGxpZWRBZ2dyZWdhdGlvbi50aW1lUGVyaW9kTXVsdGlwbGllciA9IG9iai50aW1lUGVyaW9kTXVsdGlwbGllcjtcbiAgICAgIHRoaXMuYXBwbGllZEFnZ3JlZ2F0aW9uLmFnZ3JlZ2F0aW9uTWV0aG9kID0gb2JqLmFnZ3JlZ2F0aW9uTWV0aG9kO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNldHMgYXZhaWxhYmxlIGFnZ3JlZ2F0aW9uIG9wdGlvbnMgaW4gY29uZmlndXJhdGlvbiBvZiBleHRlbnNpb25cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIGdldEF2YWlsYWJsZWxBZ2dyZWFnYXRpb24gKCkge1xuICAgICAgdmFyIGNvbmZpZyA9IHRoaXMuY29uZmlnLFxuICAgICAgICBkYXRhQWdnID0gY29uZmlnLmRhdGFBZ2csXG4gICAgICAgIGF2bFRpbWVQZXJpb2RzID0gY29uZmlnLmF2bFRpbWVQZXJpb2RzID0gZGF0YUFnZy5nZXRBZ2dyZWdhdGlvblRpbWVSdWxlcygpLFxuICAgICAgICBpLFxuICAgICAgICBsZW47XG5cbiAgICAgIGNvbmZpZy5hdmxUaW1lTXVsdGlwbGllciA9IFtdO1xuICAgICAgbGVuID0gYXZsVGltZVBlcmlvZHMubGVuZ3RoO1xuXG4gICAgICBmb3IgKGkgPSAwOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgY29uZmlnLmF2bFRpbWVNdWx0aXBsaWVyLnB1c2goYXZsVGltZVBlcmlvZHNbaV0ucG9zc2libGVGYWN0b3JzKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDYWxjdWxhdGVzIHZhbGlkIGFnZ3JlZ2F0aW9uIHRpbWUgcGVyaW9kcyBhbmQgY29ycmVzcG9uZGluZyBtdWx0aXBsaWVyc1xuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgZ2V0VmFsaWRBZ2dyZWdhdGlvbiAoKSB7XG4gICAgICB2YXIgc2VsZiA9IHRoaXMsXG4gICAgICAgIGNvbmZpZyA9IHNlbGYuY29uZmlnLFxuICAgICAgICB0c09iamVjdCA9IHNlbGYudHNPYmplY3QsXG4gICAgICAgIGRhdGFBZ2cgPSBjb25maWcuZGF0YUFnZyxcbiAgICAgICAgaSxcbiAgICAgICAgaixcbiAgICAgICAgbGVuMSxcbiAgICAgICAgbGVuMixcbiAgICAgICAgYXZsVGltZVBlcmlvZHMsXG4gICAgICAgIGF2bFRpbWVNdWx0aXBsaWVyLFxuICAgICAgICAvLyBtaW5OdW1PZlBsb3QgPSA1LFxuICAgICAgICBtYXhOdW1PZlBsb3QgPSBjb25maWcuY29tcG9zaXRpb24ucmVhY3RpdmVNb2RlbC5tb2RlbFsnbWF4LXBsb3QtcG9pbnQnXSxcbiAgICAgICAgbXVsdGlwbGllcnNBcnIsXG4gICAgICAgIGN1cnJlbnRUaW1lTGVuZ3RoLFxuICAgICAgICB0aW1lUGVyaW9kLFxuICAgICAgICB0aW1lLFxuICAgICAgICBleHBlY3RlZFRpbWUsXG4gICAgICAgIG11bHRpcGxpZXIsXG4gICAgICAgIG1pbkJpblNpemU7XG4gICAgICAgIC8vIG1heEJpblNpemU7XG5cbiAgICAgIGNvbmZpZy5jdXJyZW50VGltZUxlbmd0aCA9IHRzT2JqZWN0Lmdsb2JhbFJlYWN0aXZlTW9kZWwubW9kZWxbJ3gtYXhpcy12aXNpYmxlLXJhbmdlLWVuZCddIC1cbiAgICAgICAgdHNPYmplY3QuZ2xvYmFsUmVhY3RpdmVNb2RlbC5tb2RlbFsneC1heGlzLXZpc2libGUtcmFuZ2Utc3RhcnQnXTtcblxuICAgICAgYXZsVGltZVBlcmlvZHMgPSBjb25maWcuYXZsVGltZVBlcmlvZHM7XG4gICAgICBhdmxUaW1lTXVsdGlwbGllciA9IGNvbmZpZy5hdmxUaW1lTXVsdGlwbGllcjtcbiAgICAgIGN1cnJlbnRUaW1lTGVuZ3RoID0gY29uZmlnLmN1cnJlbnRUaW1lTGVuZ3RoO1xuXG4gICAgICBjb25maWcubWluQmluU2l6ZSA9IG1pbkJpblNpemUgPSBjdXJyZW50VGltZUxlbmd0aCAvIG1heE51bU9mUGxvdDtcbiAgICAgIC8vIGNvbmZpZy5tYXhCaW5TaXplID0gbWF4QmluU2l6ZSA9IGN1cnJlbnRUaW1lTGVuZ3RoIC8gbWluTnVtT2ZQbG90O1xuXG4gICAgICBjb25maWcudmFsaWRUaW1lUGVyaW9kID0gW107XG4gICAgICBjb25maWcudmFsaWRUaW1lUGVyaW9kTXVsdGlwbGllciA9IFtdO1xuICAgICAgY29uZmlnLmF2bEFnZ01ldGhvZHMgPSBkYXRhQWdnLmdldEFsbEFnZ3JlZ2F0aW9uTWV0aG9kKCk7XG5cbiAgICAgIGZvciAoaSA9IDAsIGxlbjEgPSBhdmxUaW1lUGVyaW9kcy5sZW5ndGg7IGkgPCBsZW4xOyBpKyspIHtcbiAgICAgICAgdGltZVBlcmlvZCA9IGF2bFRpbWVQZXJpb2RzW2ldLm5hbWU7XG4gICAgICAgIHRpbWUgPSBhdmxUaW1lUGVyaW9kc1tpXS5pbnRlcnZhbDtcbiAgICAgICAgbXVsdGlwbGllcnNBcnIgPSBbXTtcblxuICAgICAgICBmb3IgKGogPSAwLCBsZW4yID0gYXZsVGltZU11bHRpcGxpZXJbaV0ubGVuZ3RoOyBqIDwgbGVuMjsgaisrKSB7XG4gICAgICAgICAgbXVsdGlwbGllciA9IGF2bFRpbWVNdWx0aXBsaWVyW2ldW2pdO1xuICAgICAgICAgIGV4cGVjdGVkVGltZSA9IG11bHRpcGxpZXIgKiB0aW1lO1xuXG4gICAgICAgICAgLy8gaWYgKChleHBlY3RlZFRpbWUgPj0gbWluQmluU2l6ZSkgJiYgKGV4cGVjdGVkVGltZSA8PSBtYXhCaW5TaXplKSkge1xuICAgICAgICAgIGlmICgoZXhwZWN0ZWRUaW1lID49IG1pbkJpblNpemUpKSB7XG4gICAgICAgICAgICBtdWx0aXBsaWVyc0Fyci5wdXNoKGF2bFRpbWVNdWx0aXBsaWVyW2ldW2pdKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG11bHRpcGxpZXJzQXJyLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBjb25maWcudmFsaWRUaW1lUGVyaW9kTXVsdGlwbGllci5wdXNoKG11bHRpcGxpZXJzQXJyKTtcbiAgICAgICAgICBjb25maWcudmFsaWRUaW1lUGVyaW9kLnB1c2godGltZVBlcmlvZCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIC8vIGNvbnNvbGUubG9nKCdUaW1lIFBlcmlvZDogJywgY29uZmlnLnZhbGlkVGltZVBlcmlvZCk7XG4gICAgICAvLyBjb25zb2xlLmxvZygnTnVtYmVyIE9mIE11bHRpcGxpZXJzOiAnLCBjb25maWcudmFsaWRUaW1lUGVyaW9kTXVsdGlwbGllcik7XG4gICAgICAvLyBjb25zb2xlLmxvZygnTWV0aG9kczogJywgY29uZmlnLmF2bEFnZ01ldGhvZHMpO1xuICAgIH1cblxuICAgIGdldEN1cnJlbnRBZ2dyZWF0aW9uICgpIHtcbiAgICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgICAgY29uZmlnID0gc2VsZi5jb25maWcsXG4gICAgICAgIGRhdGFBZ2cgPSBjb25maWcuZGF0YUFnZyxcbiAgICAgICAgY29tcG9zaXRpb24gPSBjb25maWcuY29tcG9zaXRpb24sXG4gICAgICAgIG1vZGVsID0gY29tcG9zaXRpb24ucmVhY3RpdmVNb2RlbCxcbiAgICAgICAgY3VycmVudEFnZ01ldGhvZCxcbiAgICAgICAgc3VpdGFibGVJbnRlcnZhbCxcbiAgICAgICAgYmluU2l6ZTtcblxuICAgICAgYmluU2l6ZSA9IG1vZGVsLnByb3AoJ2Jpbi1zaXplJykgLSAxO1xuXG4gICAgICBpZiAoaXNGaW5pdGUoYmluU2l6ZSkpIHtcbiAgICAgICAgY29uZmlnLmNhbkFnZ3JlZ2F0ZSA9IHRydWU7XG4gICAgICAgIHN1aXRhYmxlSW50ZXJ2YWwgPSBkYXRhQWdnLnRpbWVSdWxlcy5nZXRTdWl0YWJsZUludGVydmFsKGJpblNpemUpO1xuICAgICAgICBjdXJyZW50QWdnTWV0aG9kID0gbW9kZWwucHJvcCgnYWdncmVnYXRpb24tZm4nKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbmZpZy5jYW5BZ2dyZWdhdGUgPSBmYWxzZTtcbiAgICAgICAgc3VpdGFibGVJbnRlcnZhbCA9IHtcbiAgICAgICAgICBuYW1lOiAnJyxcbiAgICAgICAgICBzdGVwOiAnJ1xuICAgICAgICB9O1xuICAgICAgICBjb25maWcudmFsaWRUaW1lUGVyaW9kID0gW3N1aXRhYmxlSW50ZXJ2YWwubmFtZV07XG4gICAgICAgIGNvbmZpZy52YWxpZFRpbWVQZXJpb2RNdWx0aXBsaWVyID0gW1tzdWl0YWJsZUludGVydmFsLnN0ZXBdXTtcbiAgICAgICAgY29uZmlnLmF2bEFnZ01ldGhvZHMgPSB7XG4gICAgICAgICAgJ2ludmFsaWQnOiB7XG4gICAgICAgICAgICBmb3JtYWxOYW1lOiAnJyxcbiAgICAgICAgICAgIG5pY2tOYW1lOiAnJ1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgY3VycmVudEFnZ01ldGhvZCA9IGNvbmZpZy5hdmxBZ2dNZXRob2RzWydpbnZhbGlkJ107XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHRpbWVQZXJpb2Q6IHN1aXRhYmxlSW50ZXJ2YWwubmFtZSxcbiAgICAgICAgdGltZVBlcmlvZE11bHRpcGxpZXI6IHN1aXRhYmxlSW50ZXJ2YWwuc3RlcCxcbiAgICAgICAgYWdncmVnYXRpb25NZXRob2Q6IHtcbiAgICAgICAgICB2YWx1ZTogY3VycmVudEFnZ01ldGhvZC5uaWNrTmFtZSxcbiAgICAgICAgICB0ZXh0OiBjdXJyZW50QWdnTWV0aG9kLmZvcm1hbE5hbWVcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9XG5cbiAgICBpbml0IChyZXF1aXJlKSB7XG4gICAgICB2YXIgc2VsZiA9IHRoaXMsXG4gICAgICAgIGNvbmZpZyA9IHNlbGYuY29uZmlnLFxuICAgICAgICB0b29sYm94Q29tcG9uZW50ID0gY29uZmlnLnRvb2xib3hDb21wb25lbnQgPSB7fSxcbiAgICAgICAgYXBpLFxuICAgICAgICBzdG9yZSxcbiAgICAgICAgY29tcG9zaXRpb24sXG4gICAgICAgIHNhdmVUbyA9ICd0c09iamVjdCcsXG4gICAgICAgIHJlcXVpcmVkUGFyYW1zID0gW1xuICAgICAgICAgICdncmFwaGljcycsXG4gICAgICAgICAgJ2dsb2JhbFJlYWN0aXZlTW9kZWwnLFxuICAgICAgICAgICdjaGFydCcsXG4gICAgICAgICAgJ3NwYWNlTWFuYWdlckluc3RhbmNlJyxcbiAgICAgICAgICAnY2hhcnRJbnN0YW5jZScsXG4gICAgICAgICAgJ3NtYXJ0TGFiZWwnLFxuICAgICAgICAgIGZ1bmN0aW9uIGFjcXVpcmUgKCkge1xuICAgICAgICAgICAgbGV0IGkgPSAwLFxuICAgICAgICAgICAgICBpaSA9IHJlcXVpcmVkUGFyYW1zLmxlbmd0aCAtIDEsXG4gICAgICAgICAgICAgIHBhcmFtID0gJyc7XG4gICAgICAgICAgICBzZWxmW3NhdmVUb10gPSBzZWxmW3NhdmVUb10gfHwge307XG4gICAgICAgICAgICBzZWxmLnJlcXVpcmVkUGFyYW1zID0ge307XG4gICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgaWk7ICsraSkge1xuICAgICAgICAgICAgICBwYXJhbSA9IHJlcXVpcmVkUGFyYW1zW2ldO1xuICAgICAgICAgICAgICBzZWxmW3NhdmVUb11bcGFyYW1dID0gYXJndW1lbnRzW2ldO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gb25Jbml0KHNlbGZbc2F2ZVRvXSk7XG4gICAgICAgICAgfVxuICAgICAgICBdO1xuICAgICAgcmVxdWlyZShyZXF1aXJlZFBhcmFtcyk7XG5cbiAgICAgIGFwaSA9IHNlbGYudHNPYmplY3QuY2hhcnRJbnN0YW5jZS5hcGlJbnN0YW5jZTtcbiAgICAgIHN0b3JlID0gYXBpLmdldENvbXBvbmVudFN0b3JlKCk7XG4gICAgICBjb25maWcuY29tcG9zaXRpb24gPSBjb21wb3NpdGlvbiA9IHN0b3JlLmdldENhbnZhc0J5SW5kZXgoMCkuY29tcG9zaXRpb247XG4gICAgICBjb25maWcuZGF0YUFnZyA9IGNvbXBvc2l0aW9uLmltcGwuZ2V0RGF0YUFnZ3JlZ2F0b3IoKTtcblxuICAgICAgdG9vbGJveENvbXBvbmVudC50b29sYm94ID0gZGVwLkZDLmdldENvbXBvbmVudCgnYXBpJywgJ3Rvb2xib3gnKTtcbiAgICAgIHRvb2xib3hDb21wb25lbnQuY29uZmlnID0ge307XG5cbiAgICAgIHNlbGYudG9vbGJhcnMgPSBbXTtcblxuICAgICAgc2VsZi5tZWFzdXJlbWVudCA9IHt9O1xuXG4gICAgICBzZWxmLnRvb2xiYXJzLnB1c2goc2VsZi5jcmVhdGVUb29sYmFyKCkpO1xuXG4gICAgICB3aW5kb3cuQWdncmVnYXRvciA9IHNlbGY7XG4gICAgICByZXR1cm4gc2VsZjtcbiAgICB9XG5cbiAgICBjcmVhdGVUb29sYmFyICgpIHtcbiAgICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgICAgZ3JvdXAsXG4gICAgICAgIHRvb2xiYXIsXG4gICAgICAgIHRpbWVNdWxTZWxlY3RNZW51LFxuICAgICAgICB0aW1lUGVyaW9kU2VsZWN0TWVudSxcbiAgICAgICAgYWdnTWV0aG9kU2VsZWN0TWVudSxcbiAgICAgICAgcmVzZXRCdXR0b24sXG4gICAgICAgIGFwcGx5QnV0dG9uLFxuICAgICAgICBjb25maWcgPSBzZWxmLmNvbmZpZyxcbiAgICAgICAgdHNPYmplY3QgPSBzZWxmLnRzT2JqZWN0LFxuICAgICAgICBsYWJlbCxcblxuICAgICAgICB0b29sYm94Q29tcG9uZW50ID0gY29uZmlnLnRvb2xib3hDb21wb25lbnQsXG4gICAgICAgIHRvb2xib3ggPSB0b29sYm94Q29tcG9uZW50LnRvb2xib3gsXG4gICAgICAgIHRvb2xib3hDb21wQ29uZmlnID0gdG9vbGJveENvbXBvbmVudC5jb25maWcsXG4gICAgICAgIEhvcml6b250YWxUb29sYmFyID0gdG9vbGJveC5Ib3Jpem9udGFsVG9vbGJhcixcbiAgICAgICAgQ29tcG9uZW50R3JvdXAgPSB0b29sYm94LkNvbXBvbmVudEdyb3VwLFxuICAgICAgICBTeW1ib2xTdG9yZSA9IHRvb2xib3guU3ltYm9sU3RvcmUsXG5cbiAgICAgICAgZ3JhcGhpY3MgPSB0c09iamVjdC5ncmFwaGljcyxcbiAgICAgICAgcGFwZXIgPSBncmFwaGljcy5wYXBlcixcbiAgICAgICAgY29udGFpbmVyID0gZ3JhcGhpY3MuY29udGFpbmVyLFxuICAgICAgICBjaGFydCA9IHRzT2JqZWN0LmNoYXJ0LFxuICAgICAgICBzbWFydExhYmVsID0gdHNPYmplY3Quc21hcnRMYWJlbCxcblxuICAgICAgICBtdWx0aXBsaWVyVmFsLFxuICAgICAgICB0aW1lTXVsU2VsZWN0TWVudU9wdCxcbiAgICAgICAgc2VsZWN0TWVudUNvbmZpZyxcbiAgICAgICAgZHJvcERvd25NZW51U3R5bGUsXG4gICAgICAgIGJ1dHRvbkNvbmZpZyxcblxuICAgICAgICBkZXBlbmRlbmNpZXMgPSB7XG4gICAgICAgICAgcGFwZXI6IHBhcGVyLFxuICAgICAgICAgIGNoYXJ0OiBjaGFydCxcbiAgICAgICAgICBzbWFydExhYmVsOiBzbWFydExhYmVsLFxuICAgICAgICAgIGNoYXJ0Q29udGFpbmVyOiBjb250YWluZXJcbiAgICAgICAgfSxcbiAgICAgICAgYXBwbHkgPSAoc2V0KSA9PiB7XG4gICAgICAgICAgdmFyIG1vZGVsID0gY29uZmlnLmNvbXBvc2l0aW9uLnJlYWN0aXZlTW9kZWwsXG4gICAgICAgICAgICB0aW1lUGVyaW9kVmFsID0gdGltZVBlcmlvZFNlbGVjdE1lbnUudmFsdWUoKSxcbiAgICAgICAgICAgIHRpbWVQZXJpb2RNdWx0aXBsaWVyVmFsID0gdGltZU11bFNlbGVjdE1lbnUudmFsdWUoKSxcbiAgICAgICAgICAgIGFnZ01ldGhvZFNlbGVjdE1lbnVWYWwgPSBhZ2dNZXRob2RTZWxlY3RNZW51LnZhbHVlKCksXG4gICAgICAgICAgICBrZXlzLFxuICAgICAgICAgICAgYmluU2l6ZSxcbiAgICAgICAgICAgIHRpbWVJbnRlcnZhbCxcbiAgICAgICAgICAgIGFnZ3JlZ2F0aW9uID0gc2VsZi5hZ2dyZWdhdGlvbixcbiAgICAgICAgICAgIGNhbnZhcyA9IGNvbmZpZy5jb21wb3NpdGlvbi5pbXBsO1xuXG4gICAgICAgICAgZm9yIChrZXlzIG9mIGNvbmZpZy5hdmxUaW1lUGVyaW9kcykge1xuICAgICAgICAgICAgaWYgKGtleXMubmFtZSA9PT0gdGltZVBlcmlvZFZhbCkge1xuICAgICAgICAgICAgICB0aW1lSW50ZXJ2YWwgPSBrZXlzLmludGVydmFsO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgYmluU2l6ZSA9IHRpbWVJbnRlcnZhbCAqIE51bWJlcih0aW1lUGVyaW9kTXVsdGlwbGllclZhbCk7XG4gICAgICAgICAgaWYgKHNldCAmJiBpc0Zpbml0ZShtb2RlbC5wcm9wKCdiaW4tc2l6ZScpKSkge1xuICAgICAgICAgICAgbW9kZWxcbiAgICAgICAgICAgICAgLmxvY2soKVxuICAgICAgICAgICAgICAucHJvcCgnYmluLXNpemUtZXh0JywgYmluU2l6ZSlcbiAgICAgICAgICAgICAgLnByb3AoJ2FnZ3JlZ2F0aW9uLWZuLWV4dCcsIGNvbmZpZy5hdmxBZ2dNZXRob2RzW2FnZ01ldGhvZFNlbGVjdE1lbnVWYWxdKVxuICAgICAgICAgICAgICAudW5sb2NrKCk7XG4gICAgICAgICAgICBhZ2dyZWdhdGlvbi5iaW5TaXplID0gYmluU2l6ZTtcbiAgICAgICAgICAgIGFnZ3JlZ2F0aW9uLmFnZ3JlZ2F0aW9uTWV0aG9kID0gYWdnTWV0aG9kU2VsZWN0TWVudVZhbDtcbiAgICAgICAgICAgIGFwcGx5QnV0dG9uLnVwZGF0ZVZpc3VhbCgnZGlzYWJsZWQnKTtcbiAgICAgICAgICAgIHJlc2V0QnV0dG9uLnVwZGF0ZVZpc3VhbCgnZW5hYmxlZCcpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjYW52YXMucmVzZXRBZ2dyZWdhdGlvbigpO1xuICAgICAgICAgICAgYWdncmVnYXRpb24uYmluU2l6ZSA9IG51bGw7XG4gICAgICAgICAgICBhZ2dyZWdhdGlvbi5hZ2dyZWdhdGlvbk1ldGhvZCA9IG51bGw7XG4gICAgICAgICAgICByZXNldEJ1dHRvbi51cGRhdGVWaXN1YWwoJ2Rpc2FibGVkJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHRpbWVQZXJpb2RPbkNoYW5nZSA9ICgpID0+IHtcbiAgICAgICAgICB2YXIgdGltZVBlcmlvZFZhbCA9IHRpbWVQZXJpb2RTZWxlY3RNZW51LnZhbHVlKCksXG4gICAgICAgICAgICB0aW1lUGVyaW9kTXVsdGlwbGllclZhbCA9IHRpbWVNdWxTZWxlY3RNZW51LnZhbHVlKCksXG4gICAgICAgICAgICBwcmV2VGltZVBlcm9pZE11bFZhbCA9IHRpbWVQZXJpb2RNdWx0aXBsaWVyVmFsLFxuICAgICAgICAgICAgdmFsaWRUaW1lUGVyaW9kID0gY29uZmlnLnZhbGlkVGltZVBlcmlvZCxcbiAgICAgICAgICAgIHZhbGlkVGltZVBlcmlvZE11bHRpcGxpZXIgPSBjb25maWcudmFsaWRUaW1lUGVyaW9kTXVsdGlwbGllcixcbiAgICAgICAgICAgIGluZGV4T2ZUaW1lVW5pdCxcbiAgICAgICAgICAgIGluZGV4T2ZUaW1lTXVsO1xuXG4gICAgICAgICAgaW5kZXhPZlRpbWVVbml0ID0gdmFsaWRUaW1lUGVyaW9kLmluZGV4T2YodGltZVBlcmlvZFZhbCk7XG4gICAgICAgICAgaW5kZXhPZlRpbWVNdWwgPSB2YWxpZFRpbWVQZXJpb2RNdWx0aXBsaWVyW2luZGV4T2ZUaW1lVW5pdF0uaW5kZXhPZihOdW1iZXIodGltZVBlcmlvZE11bHRpcGxpZXJWYWwpKTtcblxuICAgICAgICAgIHRpbWVNdWxTZWxlY3RNZW51T3B0ID0gW107XG4gICAgICAgICAgZm9yIChtdWx0aXBsaWVyVmFsIG9mIHZhbGlkVGltZVBlcmlvZE11bHRpcGxpZXJbaW5kZXhPZlRpbWVVbml0XSkge1xuICAgICAgICAgICAgdGltZU11bFNlbGVjdE1lbnVPcHQucHVzaCh7XG4gICAgICAgICAgICAgIG5hbWU6IG11bHRpcGxpZXJWYWwudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgdmFsdWU6IG11bHRpcGxpZXJWYWwudG9TdHJpbmcoKVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdGltZU11bFNlbGVjdE1lbnUudXBkYXRlTGlzdCh0aW1lTXVsU2VsZWN0TWVudU9wdCk7XG5cbiAgICAgICAgICBpZiAoaW5kZXhPZlRpbWVNdWwgPCAwKSB7XG4gICAgICAgICAgICB0aW1lTXVsU2VsZWN0TWVudS52YWx1ZSh2YWxpZFRpbWVQZXJpb2RNdWx0aXBsaWVyW2luZGV4T2ZUaW1lVW5pdF1bMF0udG9TdHJpbmcoKSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRpbWVNdWxTZWxlY3RNZW51LnZhbHVlKHByZXZUaW1lUGVyb2lkTXVsVmFsKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgb25DaGFuZ2UgPSAodHlwZSkgPT4ge1xuICAgICAgICAgIHZhciBjdXJyZW50QWdnID0gc2VsZi5nZXRDdXJyZW50QWdncmVhdGlvbigpO1xuXG4gICAgICAgICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgIGlmIChjdXJyZW50QWdnLnRpbWVQZXJpb2RNdWx0aXBsaWVyLnRvU3RyaW5nKCkgIT09IHRpbWVNdWxTZWxlY3RNZW51LnZhbHVlKCkpIHtcbiAgICAgICAgICAgICAgICBhcHBseUJ1dHRvbi51cGRhdGVWaXN1YWwoJ2VuYWJsZWQnKTtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBhcHBseUJ1dHRvbi51cGRhdGVWaXN1YWwoJ2Rpc2FibGVkJyk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgIGlmIChjdXJyZW50QWdnLnRpbWVQZXJpb2QgIT09IHRpbWVQZXJpb2RTZWxlY3RNZW51LnZhbHVlKCkpIHtcbiAgICAgICAgICAgICAgICBhcHBseUJ1dHRvbi51cGRhdGVWaXN1YWwoJ2VuYWJsZWQnKTtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBhcHBseUJ1dHRvbi51cGRhdGVWaXN1YWwoJ2Rpc2FibGVkJyk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICAgIGlmIChjdXJyZW50QWdnLmFnZ3JlZ2F0aW9uTWV0aG9kLnZhbHVlICE9PSBhZ2dNZXRob2RTZWxlY3RNZW51LnZhbHVlKCkpIHtcbiAgICAgICAgICAgICAgICBhcHBseUJ1dHRvbi51cGRhdGVWaXN1YWwoJ2VuYWJsZWQnKTtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBhcHBseUJ1dHRvbi51cGRhdGVWaXN1YWwoJ2Rpc2FibGVkJyk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICBncm91cCA9IG5ldyBDb21wb25lbnRHcm91cChkZXBlbmRlbmNpZXMpO1xuICAgICAgdG9vbGJhciA9IG5ldyBIb3Jpem9udGFsVG9vbGJhcihkZXBlbmRlbmNpZXMpO1xuXG4gICAgICBncm91cC5zZXRDb25maWcoe1xuICAgICAgICBmaWxsOiAnI2ZmZicsXG4gICAgICAgIGJvcmRlclRoaWNrbmVzczogMFxuICAgICAgfSk7XG5cbiAgICAgIHRvb2xiYXIuc2V0Q29uZmlnKHtcbiAgICAgICAgZmlsbDogJyNmZmYnLFxuICAgICAgICBib3JkZXJUaGlja25lc3M6IDBcbiAgICAgIH0pO1xuXG4gICAgICBzZWxlY3RNZW51Q29uZmlnID0ge1xuICAgICAgICBkaXNhYmxlZDoge1xuICAgICAgICAgIGNvbmZpZzoge1xuICAgICAgICAgICAgZGlzYWJsZWQ6IHtcbiAgICAgICAgICAgICAgZmlsbDogJyNmZmYnLFxuICAgICAgICAgICAgICAnc3Ryb2tlLXdpZHRoJzogMyxcbiAgICAgICAgICAgICAgc3Ryb2tlOiAncmdiKDE5MiwgMTkyLCAxOTIpJ1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgYnV0dG9uQ29uZmlnID0ge1xuICAgICAgICBkaXNhYmxlZDoge1xuICAgICAgICAgIGNvbmZpZzoge1xuICAgICAgICAgICAgZGlzYWJsZWQ6IHtcbiAgICAgICAgICAgICAgZmlsbDogJyNiZWJlYmUnLFxuICAgICAgICAgICAgICAnc3Ryb2tlLXdpZHRoJzogMyxcbiAgICAgICAgICAgICAgc3Ryb2tlOiAncmdiKDE5MiwgMTkyLCAxOTIpJyxcbiAgICAgICAgICAgICAgbGFiZWxGaWxsOiAnI2ZmZidcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIGRyb3BEb3duTWVudVN0eWxlID0ge1xuICAgICAgICBzZWxlY3RlZDoge1xuICAgICAgICAgIGNvbnRhaW5lcjoge1xuICAgICAgICAgICAgc3R5bGU6IHtcbiAgICAgICAgICAgICAgZmlsbDogJyM4OThiOGInXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICB0ZXh0OiB7XG4gICAgICAgICAgICBzdHlsZToge1xuICAgICAgICAgICAgICBmaWxsOiAnI2ZmZidcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIG5vcm1hbDoge1xuICAgICAgICAgIGNvbnRhaW5lcjoge1xuICAgICAgICAgICAgc3R5bGU6IHtcbiAgICAgICAgICAgICAgZmlsbDogJyNmZmYnXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICB0ZXh0OiB7XG4gICAgICAgICAgICBzdHlsZToge1xuICAgICAgICAgICAgICBmaWxsOiAnIzAwMCdcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGhvdmVyOiB7XG4gICAgICAgICAgY29udGFpbmVyOiB7XG4gICAgICAgICAgICBzdHlsZToge1xuICAgICAgICAgICAgICBmaWxsOiAnI2U2ZThlOCdcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIHRleHQ6IHtcbiAgICAgICAgICAgIHN0eWxlOiB7XG4gICAgICAgICAgICAgIGZpbGw6ICcjMDAwJ1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgbGFiZWwgPSBuZXcgdG9vbGJveC5MYWJlbCgnQWdncmVnYXRlIERhdGE6JywgZGVwZW5kZW5jaWVzLCB7XG4gICAgICAgIHRleHQ6IHtcbiAgICAgICAgICBzdHlsZToge1xuICAgICAgICAgICAgJ2ZvbnQtc2l6ZSc6ICcxNCcsXG4gICAgICAgICAgICAnZmlsbCc6ICcjNjk2OTY5J1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIHRvb2xib3hDb21wQ29uZmlnLnRpbWVQZXJpb2RTZWxlY3RNZW51ID0gdGltZVBlcmlvZFNlbGVjdE1lbnUgPSBuZXcgdG9vbGJveC5TZWxlY3RTeW1ib2woe1xuICAgICAgICB3aWR0aDogOTAsXG4gICAgICAgIGhlaWdodDogMjJcbiAgICAgIH0sIGRlcGVuZGVuY2llcywgW10sIHtcbiAgICAgICAgZmlsbDogJyNmZmYnLFxuICAgICAgICBsYWJlbEZpbGw6ICcjNjk2OTY5JyxcbiAgICAgICAgaG92ZXJGaWxsOiAnI2ZmZicsXG4gICAgICAgIGhvdmVyU3Ryb2tlOiAnIzY5Njk2OScsXG4gICAgICAgIGhvdmVyU3Ryb2tlV2lkdGg6IDEsXG4gICAgICAgIHN0cm9rZVdpZHRoOiAxLFxuICAgICAgICByYWRpdXM6IDEsXG4gICAgICAgIHN0cm9rZTogJyNjOGNlY2QnLFxuICAgICAgICBzeW1ib2xTdHJva2VXaWR0aDogMCxcbiAgICAgICAgYnRuVGV4dFN0eWxlOiB7XG4gICAgICAgICAgZm9udFNpemU6IDExXG4gICAgICAgIH0sXG4gICAgICAgIGRyb3BEb3duTWVudTogZHJvcERvd25NZW51U3R5bGVcbiAgICAgIH0pO1xuICAgICAgdGltZVBlcmlvZFNlbGVjdE1lbnUuc2V0U3RhdGVDb25maWcoc2VsZWN0TWVudUNvbmZpZyk7XG5cbiAgICAgIHRvb2xib3hDb21wQ29uZmlnLnRpbWVNdWxTZWxlY3RNZW51ID0gdGltZU11bFNlbGVjdE1lbnUgPSBuZXcgdG9vbGJveC5TZWxlY3RTeW1ib2woe1xuICAgICAgICB3aWR0aDogNTAsXG4gICAgICAgIGhlaWdodDogMjJcbiAgICAgIH0sIGRlcGVuZGVuY2llcywgW10sIHtcbiAgICAgICAgZmlsbDogJyNmZmYnLFxuICAgICAgICBsYWJlbEZpbGw6ICcjNjk2OTY5JyxcbiAgICAgICAgaG92ZXJGaWxsOiAnI2ZmZicsXG4gICAgICAgIGhvdmVyU3Ryb2tlOiAnIzY5Njk2OScsXG4gICAgICAgIGhvdmVyU3Ryb2tlV2lkdGg6IDEsXG4gICAgICAgIHN0cm9rZVdpZHRoOiAxLFxuICAgICAgICByYWRpdXM6IDEsXG4gICAgICAgIHN0cm9rZTogJyNjOGNlY2QnLFxuICAgICAgICBzeW1ib2xTdHJva2VXaWR0aDogMCxcbiAgICAgICAgYnRuVGV4dFN0eWxlOiB7XG4gICAgICAgICAgZm9udFNpemU6IDExXG4gICAgICAgIH0sXG4gICAgICAgIGRyb3BEb3duTWVudTogZHJvcERvd25NZW51U3R5bGVcbiAgICAgIH0pO1xuICAgICAgdGltZU11bFNlbGVjdE1lbnUuc2V0U3RhdGVDb25maWcoc2VsZWN0TWVudUNvbmZpZyk7XG5cbiAgICAgIHRvb2xib3hDb21wQ29uZmlnLmFnZ01ldGhvZFNlbGVjdE1lbnUgPSBhZ2dNZXRob2RTZWxlY3RNZW51ID0gbmV3IHRvb2xib3guU2VsZWN0U3ltYm9sKHtcbiAgICAgICAgd2lkdGg6IDkwLFxuICAgICAgICBoZWlnaHQ6IDIyXG4gICAgICB9LCBkZXBlbmRlbmNpZXMsIFtdLCB7XG4gICAgICAgIGZpbGw6ICcjZmZmJyxcbiAgICAgICAgbGFiZWxGaWxsOiAnIzY5Njk2OScsXG4gICAgICAgIGhvdmVyRmlsbDogJyNmZmYnLFxuICAgICAgICBob3ZlclN0cm9rZTogJyM2OTY5NjknLFxuICAgICAgICBob3ZlclN0cm9rZVdpZHRoOiAxLFxuICAgICAgICBzdHJva2VXaWR0aDogMSxcbiAgICAgICAgcmFkaXVzOiAxLFxuICAgICAgICBzdHJva2U6ICcjYzhjZWNkJyxcbiAgICAgICAgc3ltYm9sU3Ryb2tlV2lkdGg6IDAsXG4gICAgICAgIGJ0blRleHRTdHlsZToge1xuICAgICAgICAgIGZvbnRTaXplOiAxMVxuICAgICAgICB9LFxuICAgICAgICBkcm9wRG93bk1lbnU6IGRyb3BEb3duTWVudVN0eWxlXG4gICAgICB9KTtcbiAgICAgIGFnZ01ldGhvZFNlbGVjdE1lbnUuc2V0U3RhdGVDb25maWcoc2VsZWN0TWVudUNvbmZpZyk7XG5cbiAgICAgIHRvb2xib3hDb21wQ29uZmlnLmFwcGx5QnV0dG9uID0gYXBwbHlCdXR0b24gPSBuZXcgdG9vbGJveC5TeW1ib2woJ0FQUExZJywgdHJ1ZSwgZGVwZW5kZW5jaWVzLCB7XG4gICAgICAgIGZpbGw6ICcjNTU1JyxcbiAgICAgICAgbGFiZWxGaWxsOiAnI2YzZjNmMycsXG4gICAgICAgIGhvdmVyRmlsbDogJyM1NTUnLFxuICAgICAgICByYWRpdXM6IDEsXG4gICAgICAgIHdpZHRoOiAzMCxcbiAgICAgICAgaGVpZ2h0OiAyMCxcbiAgICAgICAgYnRuVGV4dFN0eWxlOiB7XG4gICAgICAgICAgZm9udFNpemU6IDExXG4gICAgICAgIH1cbiAgICAgIH0pLmF0dGFjaEV2ZW50SGFuZGxlcnMoe1xuICAgICAgICBjbGljazogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGFwcGx5KDEpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIGFwcGx5QnV0dG9uLnNldFN0YXRlQ29uZmlnKGJ1dHRvbkNvbmZpZyk7XG5cbiAgICAgIHRvb2xib3hDb21wQ29uZmlnLnJlc2V0QnV0dG9uID0gcmVzZXRCdXR0b24gPSBuZXcgdG9vbGJveC5TeW1ib2woJ1JFU0VUJywgdHJ1ZSwgZGVwZW5kZW5jaWVzLCB7XG4gICAgICAgIGZpbGw6ICcjODk4YjhiJyxcbiAgICAgICAgbGFiZWxGaWxsOiAnI2YzZjNmMycsXG4gICAgICAgIGhvdmVyRmlsbDogJyM4OThiOGInLFxuICAgICAgICByYWRpdXM6IDEsXG4gICAgICAgIHdpZHRoOiAzMCxcbiAgICAgICAgaGVpZ2h0OiAyMCxcbiAgICAgICAgYnRuVGV4dFN0eWxlOiB7XG4gICAgICAgICAgZm9udFNpemU6IDExXG4gICAgICAgIH1cbiAgICAgIH0pLmF0dGFjaEV2ZW50SGFuZGxlcnMoe1xuICAgICAgICBjbGljazogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGFwcGx5KDApO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHJlc2V0QnV0dG9uLnNldFN0YXRlQ29uZmlnKGJ1dHRvbkNvbmZpZyk7XG5cbiAgICAgIGdyb3VwLmFkZFN5bWJvbChsYWJlbCk7XG4gICAgICBncm91cC5hZGRTeW1ib2wodGltZU11bFNlbGVjdE1lbnUpO1xuICAgICAgZ3JvdXAuYWRkU3ltYm9sKHRpbWVQZXJpb2RTZWxlY3RNZW51KTtcbiAgICAgIGdyb3VwLmFkZFN5bWJvbChhZ2dNZXRob2RTZWxlY3RNZW51KTtcbiAgICAgIGdyb3VwLmFkZFN5bWJvbChhcHBseUJ1dHRvbik7XG4gICAgICBncm91cC5hZGRTeW1ib2wocmVzZXRCdXR0b24pO1xuXG4gICAgICBTeW1ib2xTdG9yZS5yZWdpc3RlcigndGV4dEJveEljb24nLCBmdW5jdGlvbiAoeCwgeSwgcmFkLCB3LCBoLCBwYWRYLCBwYWRZKSB7XG4gICAgICAgIHZhciB4MSA9IHggLSB3IC8gMiArIHBhZFggLyAyLFxuICAgICAgICAgIHgyID0geCArIHcgLyAyIC0gcGFkWCAvIDIsXG4gICAgICAgICAgeTEgPSB5IC0gaCAvIDIgKyBwYWRZIC8gMixcbiAgICAgICAgICB5MiA9IHkgKyBoIC8gMiAtIHBhZFkgLyAyO1xuXG4gICAgICAgIHJldHVybiBbJ00nLCB4MSwgeTEsICdMJywgeDIsIHkxLCAnTCcsIHgyLCB5MiwgJ0wnLCB4MSwgeTIsICdaJ107XG4gICAgICB9KTtcblxuICAgICAgdGltZVBlcmlvZFNlbGVjdE1lbnUuYXR0YWNoRXZlbnRIYW5kbGVycyh7XG4gICAgICAgIHRleHRPbkNoYW5nZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHRpbWVQZXJpb2RPbkNoYW5nZSgpO1xuICAgICAgICAgIG9uQ2hhbmdlKDIpO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgdGltZU11bFNlbGVjdE1lbnUuYXR0YWNoRXZlbnRIYW5kbGVycyh7XG4gICAgICAgIHRleHRPbkNoYW5nZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIG9uQ2hhbmdlKDEpO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgYWdnTWV0aG9kU2VsZWN0TWVudS5hdHRhY2hFdmVudEhhbmRsZXJzKHtcbiAgICAgICAgdGV4dE9uQ2hhbmdlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgb25DaGFuZ2UoMyk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICB0b29sYmFyLmFkZENvbXBvbmVudChncm91cCk7XG5cbiAgICAgIHJldHVybiB0b29sYmFyO1xuICAgIH1cblxuICAgIGdldExvZ2ljYWxTcGFjZSAoYXZhaWxhYmxlV2lkdGgsIGF2YWlsYWJsZUhlaWdodCkge1xuICAgICAgdmFyIGxvZ2ljYWxTcGFjZSxcbiAgICAgICAgd2lkdGggPSAwLFxuICAgICAgICBoZWlnaHQgPSAwLFxuICAgICAgICBpLFxuICAgICAgICBsbjtcblxuICAgICAgZm9yIChpID0gMCwgbG4gPSB0aGlzLnRvb2xiYXJzLmxlbmd0aDsgaSA8IGxuOyBpKyspIHtcbiAgICAgICAgbG9naWNhbFNwYWNlID0gdGhpcy50b29sYmFyc1tpXS5nZXRMb2dpY2FsU3BhY2UoKTtcbiAgICAgICAgd2lkdGggPSBNYXRoLm1heChsb2dpY2FsU3BhY2Uud2lkdGgsIHdpZHRoKTtcbiAgICAgICAgaGVpZ2h0ICs9IGxvZ2ljYWxTcGFjZS5oZWlnaHQ7XG4gICAgICAgIHRoaXMudG9vbGJhcnNbaV0ud2lkdGggPSBsb2dpY2FsU3BhY2Uud2lkdGg7XG4gICAgICAgIHRoaXMudG9vbGJhcnNbaV0uaGVpZ2h0ID0gbG9naWNhbFNwYWNlLmhlaWdodDtcbiAgICAgIH1cbiAgICAgIGhlaWdodCArPSB0aGlzLnBhZGRpbmc7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB3aWR0aDogd2lkdGggPiBhdmFpbGFibGVXaWR0aCA/IDAgOiB3aWR0aCxcbiAgICAgICAgaGVpZ2h0OiBoZWlnaHQgPiBhdmFpbGFibGVIZWlnaHQgPyAwIDogaGVpZ2h0XG4gICAgICB9O1xuICAgIH1cblxuICAgIHBsYWNlSW5DYW52YXMgKGNvbnRhaW5lckluc3RhbmNlKSB7XG4gICAgICB2YXIgc2VsZiA9IHRoaXMsXG4gICAgICAgIHRzT2JqZWN0ID0gc2VsZi50c09iamVjdDtcblxuICAgICAgc2VsZi5wYWRkaW5nID0gNTtcbiAgICAgIHRzT2JqZWN0LnNwYWNlTWFuYWdlckluc3RhbmNlLmFkZChbe1xuICAgICAgICBuYW1lOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuICdEYXRhQWdncmVnYXRvcic7XG4gICAgICAgIH0sXG4gICAgICAgIHJlZjogZnVuY3Rpb24gKG9iaikge1xuICAgICAgICAgIHJldHVybiBvYmpbJzAnXTtcbiAgICAgICAgfSxcbiAgICAgICAgc2VsZjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBzZWxmO1xuICAgICAgICB9LFxuICAgICAgICBwcmlvcml0eTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiAyO1xuICAgICAgICB9LFxuICAgICAgICBsYXlvdXQ6IGZ1bmN0aW9uIChvYmopIHtcbiAgICAgICAgICByZXR1cm4gb2JqLmlubGluZTtcbiAgICAgICAgfSxcbiAgICAgICAgb3JpZW50YXRpb246IFt7XG4gICAgICAgICAgdHlwZTogZnVuY3Rpb24gKG9iaikge1xuICAgICAgICAgICAgcmV0dXJuIG9iai5ob3Jpem9udGFsO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgcG9zaXRpb246IFt7XG4gICAgICAgICAgICB0eXBlOiBmdW5jdGlvbiAob2JqKSB7XG4gICAgICAgICAgICAgIHJldHVybiBvYmoudG9wO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGFsaWdubWVudDogW3tcbiAgICAgICAgICAgICAgdHlwZTogZnVuY3Rpb24gKG9iaikge1xuICAgICAgICAgICAgICAgIHJldHVybiBvYmoubGVmdDtcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgZGltZW5zaW9uczogW2Z1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgcGFyZW50ID0gdGhpcy5nZXRQYXJlbnRDb21wb25lbnRHcm91cCgpO1xuICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLmdldExvZ2ljYWxTcGFjZShwYXJlbnQuZ2V0V2lkdGgoKSwgcGFyZW50LmdldEhlaWdodCgpKTtcbiAgICAgICAgICAgICAgfV1cbiAgICAgICAgICAgIH1dXG4gICAgICAgICAgfV1cbiAgICAgICAgfV1cbiAgICAgIH1dKTtcbiAgICB9XG5cbiAgICBzZXREcmF3aW5nQ29uZmlndXJhdGlvbiAoeCwgeSwgd2lkdGgsIGhlaWdodCwgZ3JvdXApIHtcbiAgICAgIHZhciBtZXMgPSB0aGlzLm1lYXN1cmVtZW50O1xuICAgICAgbWVzLnggPSB4O1xuICAgICAgbWVzLnkgPSB5O1xuICAgICAgbWVzLndpZHRoID0gd2lkdGg7XG4gICAgICBtZXMuaGVpZ2h0ID0gaGVpZ2h0O1xuXG4gICAgICB0aGlzLnBhcmVudEdyb3VwID0gZ3JvdXA7XG5cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIGRyYXcgKHgsIHksIHdpZHRoLCBoZWlnaHQsIGdyb3VwKSB7XG4gICAgICB2YXIgc2VsZiA9IHRoaXMsXG4gICAgICAgIGNvbmZpZyA9IHNlbGYuY29uZmlnLFxuICAgICAgICB0b29sYm94Q29tcENvbmZpZyA9IGNvbmZpZy50b29sYm94Q29tcG9uZW50LmNvbmZpZyxcbiAgICAgICAgdGltZVBlcmlvZFNlbGVjdE1lbnUgPSB0b29sYm94Q29tcENvbmZpZy50aW1lUGVyaW9kU2VsZWN0TWVudSxcbiAgICAgICAgdGltZU11bFNlbGVjdE1lbnUgPSB0b29sYm94Q29tcENvbmZpZy50aW1lTXVsU2VsZWN0TWVudSxcbiAgICAgICAgYWdnTWV0aG9kU2VsZWN0TWVudSA9IHRvb2xib3hDb21wQ29uZmlnLmFnZ01ldGhvZFNlbGVjdE1lbnUsXG4gICAgICAgIGFwcGx5QnV0dG9uID0gdG9vbGJveENvbXBDb25maWcuYXBwbHlCdXR0b24sXG4gICAgICAgIHJlc2V0QnV0dG9uID0gdG9vbGJveENvbXBDb25maWcucmVzZXRCdXR0b24sXG4gICAgICAgIG1lYXN1cmVtZW50ID0gc2VsZi5tZWFzdXJlbWVudCxcbiAgICAgICAgdG9vbGJhcnMgPSBzZWxmLnRvb2xiYXJzLFxuICAgICAgICBsbixcbiAgICAgICAgaSxcbiAgICAgICAgdG9vbGJhcixcbiAgICAgICAgbW9kZWwgPSBjb25maWcuY29tcG9zaXRpb24ucmVhY3RpdmVNb2RlbCxcbiAgICAgICAgZGF0YUFnZyA9IGNvbmZpZy5kYXRhQWdnLFxuXG4gICAgICAgIHRpbWVQZXJpb2RWYWwsXG4gICAgICAgIHRpbWVQZXJpb2RTZWxlY3RNZW51T3B0LFxuICAgICAgICB2YWxpZFRpbWVQZXJpb2QsXG4gICAgICAgIGluZGV4T2ZUaW1lVW5pdCxcblxuICAgICAgICBtdWx0aXBsaWVyVmFsLFxuICAgICAgICB0aW1lTXVsU2VsZWN0TWVudU9wdCxcbiAgICAgICAgdmFsaWRUaW1lUGVyaW9kTXVsdGlwbGllcixcblxuICAgICAgICBhZ2dWYWwsXG4gICAgICAgIGFnZ01ldGhvZFNlbGVjdE1lbnVPcHQsXG4gICAgICAgIGF2bEFnZ01ldGhvZHMsXG4gICAgICAgIHJhbmdlT25DaGFuZ2UgPSAoKSA9PiB7XG4gICAgICAgICAgdmFyIGFnZ3JlZ2F0aW9uID0gc2VsZi5hZ2dyZWdhdGlvbixcbiAgICAgICAgICAgIGN1cnJlbnRBZ2dyZWdhdGlvbk9iaixcbiAgICAgICAgICAgIHRpbWVQZXJpb2QsXG4gICAgICAgICAgICB0aW1lUGVyaW9kTXVsdGlwbGllcixcbiAgICAgICAgICAgIGFnZ3JlZ2F0aW9uTWV0aG9kO1xuXG4gICAgICAgICAgc2VsZi5nZXRWYWxpZEFnZ3JlZ2F0aW9uKCk7XG4gICAgICAgICAgY3VycmVudEFnZ3JlZ2F0aW9uT2JqID0gc2VsZi5nZXRDdXJyZW50QWdncmVhdGlvbigpO1xuICAgICAgICAgIHRpbWVQZXJpb2QgPSBjdXJyZW50QWdncmVnYXRpb25PYmoudGltZVBlcmlvZDtcbiAgICAgICAgICB0aW1lUGVyaW9kTXVsdGlwbGllciA9IGN1cnJlbnRBZ2dyZWdhdGlvbk9iai50aW1lUGVyaW9kTXVsdGlwbGllcjtcbiAgICAgICAgICBhZ2dyZWdhdGlvbk1ldGhvZCA9IGN1cnJlbnRBZ2dyZWdhdGlvbk9iai5hZ2dyZWdhdGlvbk1ldGhvZDtcblxuICAgICAgICAgIHRpbWVQZXJpb2RTZWxlY3RNZW51T3B0ID0gW107XG4gICAgICAgICAgdGltZU11bFNlbGVjdE1lbnVPcHQgPSBbXTtcbiAgICAgICAgICBhZ2dNZXRob2RTZWxlY3RNZW51T3B0ID0gW107XG5cbiAgICAgICAgICB2YWxpZFRpbWVQZXJpb2QgPSBjb25maWcudmFsaWRUaW1lUGVyaW9kO1xuICAgICAgICAgIHZhbGlkVGltZVBlcmlvZE11bHRpcGxpZXIgPSBjb25maWcudmFsaWRUaW1lUGVyaW9kTXVsdGlwbGllcjtcbiAgICAgICAgICBhdmxBZ2dNZXRob2RzID0gY29uZmlnLmF2bEFnZ01ldGhvZHM7XG5cbiAgICAgICAgICBhcHBseUJ1dHRvbi51cGRhdGVWaXN1YWwoJ2Rpc2FibGVkJyk7XG5cbiAgICAgICAgICBpZiAoYWdncmVnYXRpb24uYmluU2l6ZSAhPT0gbW9kZWwucHJvcCgnYmluLXNpemUnKSAmJlxuICAgICAgICAgICAgYWdncmVnYXRpb25NZXRob2QudmFsdWUgPT09IGNvbmZpZy5kZWZhdWx0QWdnTWV0aG9kKSB7XG4gICAgICAgICAgICBhZ2dyZWdhdGlvbi5iaW5TaXplID0gbnVsbDtcbiAgICAgICAgICAgIGFnZ3JlZ2F0aW9uLmFnZ3JlZ2F0aW9uTWV0aG9kID0gbnVsbDtcbiAgICAgICAgICAgIHJlc2V0QnV0dG9uLnVwZGF0ZVZpc3VhbCgnZGlzYWJsZWQnKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmVzZXRCdXR0b24udXBkYXRlVmlzdWFsKCdlbmFibGVkJyk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKCFjb25maWcuY2FuQWdncmVnYXRlKSB7XG4gICAgICAgICAgICB0aW1lUGVyaW9kU2VsZWN0TWVudS51cGRhdGVWaXN1YWwoJ2Rpc2FibGVkJyk7XG4gICAgICAgICAgICB0aW1lTXVsU2VsZWN0TWVudS51cGRhdGVWaXN1YWwoJ2Rpc2FibGVkJyk7XG4gICAgICAgICAgICBhZ2dNZXRob2RTZWxlY3RNZW51LnVwZGF0ZVZpc3VhbCgnZGlzYWJsZWQnKTtcbiAgICAgICAgICAgIHJlc2V0QnV0dG9uLnVwZGF0ZVZpc3VhbCgnZGlzYWJsZWQnKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGltZVBlcmlvZFNlbGVjdE1lbnUudXBkYXRlVmlzdWFsKCdlbmFibGVkJyk7XG4gICAgICAgICAgICB0aW1lTXVsU2VsZWN0TWVudS51cGRhdGVWaXN1YWwoJ2VuYWJsZWQnKTtcbiAgICAgICAgICAgIGFnZ01ldGhvZFNlbGVjdE1lbnUudXBkYXRlVmlzdWFsKCdlbmFibGVkJyk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgZm9yICh0aW1lUGVyaW9kVmFsIG9mIHZhbGlkVGltZVBlcmlvZCkge1xuICAgICAgICAgICAgdGltZVBlcmlvZFNlbGVjdE1lbnVPcHQucHVzaCh7XG4gICAgICAgICAgICAgIG5hbWU6IHRpbWVQZXJpb2RWYWwsXG4gICAgICAgICAgICAgIHZhbHVlOiB0aW1lUGVyaW9kVmFsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICB0aW1lUGVyaW9kU2VsZWN0TWVudS51cGRhdGVMaXN0KHRpbWVQZXJpb2RTZWxlY3RNZW51T3B0KTtcbiAgICAgICAgICB0aW1lUGVyaW9kU2VsZWN0TWVudS52YWx1ZSh0aW1lUGVyaW9kKTtcblxuICAgICAgICAgIGluZGV4T2ZUaW1lVW5pdCA9IHZhbGlkVGltZVBlcmlvZC5pbmRleE9mKHRpbWVQZXJpb2QpO1xuXG4gICAgICAgICAgaWYgKGluZGV4T2ZUaW1lVW5pdCA+PSAwKSB7XG4gICAgICAgICAgICBmb3IgKG11bHRpcGxpZXJWYWwgb2YgdmFsaWRUaW1lUGVyaW9kTXVsdGlwbGllcltpbmRleE9mVGltZVVuaXRdKSB7XG4gICAgICAgICAgICAgIHRpbWVNdWxTZWxlY3RNZW51T3B0LnB1c2goe1xuICAgICAgICAgICAgICAgIG5hbWU6IG11bHRpcGxpZXJWYWwudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICB2YWx1ZTogbXVsdGlwbGllclZhbC50b1N0cmluZygpXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cblxuICAgICAgICAgIHRpbWVNdWxTZWxlY3RNZW51LnVwZGF0ZUxpc3QodGltZU11bFNlbGVjdE1lbnVPcHQpO1xuICAgICAgICAgIHRpbWVNdWxTZWxlY3RNZW51LnZhbHVlKHRpbWVQZXJpb2RNdWx0aXBsaWVyLnRvU3RyaW5nKCkpO1xuXG4gICAgICAgICAgZm9yIChhZ2dWYWwgaW4gYXZsQWdnTWV0aG9kcykge1xuICAgICAgICAgICAgYWdnTWV0aG9kU2VsZWN0TWVudU9wdC5wdXNoKHtcbiAgICAgICAgICAgICAgbmFtZTogYXZsQWdnTWV0aG9kc1thZ2dWYWxdLmZvcm1hbE5hbWUsXG4gICAgICAgICAgICAgIHZhbHVlOiBhdmxBZ2dNZXRob2RzW2FnZ1ZhbF0ubmlja05hbWVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGFnZ01ldGhvZFNlbGVjdE1lbnUudXBkYXRlTGlzdChhZ2dNZXRob2RTZWxlY3RNZW51T3B0KTtcbiAgICAgICAgICBhZ2dNZXRob2RTZWxlY3RNZW51LnZhbHVlKGFnZ3JlZ2F0aW9uTWV0aG9kLnZhbHVlKTtcbiAgICAgICAgfTtcblxuICAgICAgc2VsZi5nZXRBdmFpbGFibGVsQWdncmVhZ2F0aW9uKCk7XG5cbiAgICAgIHggPSB4ID09PSB1bmRlZmluZWQgPyBtZWFzdXJlbWVudC54IDogeDtcbiAgICAgIHkgPSB5ID09PSB1bmRlZmluZWQgPyBtZWFzdXJlbWVudC55IDogeTtcbiAgICAgIHdpZHRoID0gd2lkdGggPT09IHVuZGVmaW5lZCA/IG1lYXN1cmVtZW50LndpZHRoIDogd2lkdGg7XG4gICAgICBoZWlnaHQgPSBoZWlnaHQgPT09IHVuZGVmaW5lZCA/IG1lYXN1cmVtZW50LmhlaWdodCA6IGhlaWdodDtcbiAgICAgIGdyb3VwID0gZ3JvdXAgPT09IHVuZGVmaW5lZCA/IHNlbGYucGFyZW50R3JvdXAgOiBncm91cDtcbiAgICAgIGlmICh3aWR0aCAmJiBoZWlnaHQpIHtcbiAgICAgICAgZm9yIChpID0gMCwgbG4gPSB0b29sYmFycy5sZW5ndGg7IGkgPCBsbjsgaSsrKSB7XG4gICAgICAgICAgdG9vbGJhciA9IHRvb2xiYXJzW2ldO1xuICAgICAgICAgIHRvb2xiYXIuZHJhdyh4LCB5KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmFuZ2VPbkNoYW5nZSgpO1xuICAgICAgYXBwbHlCdXR0b24udXBkYXRlVmlzdWFsKCdkaXNhYmxlZCcpO1xuICAgICAgcmVzZXRCdXR0b24udXBkYXRlVmlzdWFsKCdkaXNhYmxlZCcpO1xuICAgICAgY29uZmlnLmRlZmF1bHRBZ2dNZXRob2QgPSBkYXRhQWdnLmdldERlZmF1bHRBZ2dyZWdhdGlvbk1ldGhvZCgpLm5pY2tOYW1lO1xuXG4gICAgICBtb2RlbC5vblByb3BzQ2hhbmdlKFsnYmluLXNpemUnLCAnYWdncmVnYXRpb24tZm4nXSwgcmFuZ2VPbkNoYW5nZSk7XG4gICAgfVxuXG4gICAgZGlzcG9zZSAoKSB7XG4gICAgICAvLyBkaXNwb3NlIGV4dGVuc2lvblxuICAgIH1cbiAgfVxuICByZXR1cm4gQWdncmVnYXRvcjtcbn07XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL3NyYy9mY3RzLWV4dC1hZ2dyZWdhdG9yLmpzXG4vLyBtb2R1bGUgaWQgPSAyXG4vLyBtb2R1bGUgY2h1bmtzID0gMCJdLCJzb3VyY2VSb290IjoiIn0=