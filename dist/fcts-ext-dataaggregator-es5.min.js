!function(e){function i(o){if(t[o])return t[o].exports;var n=t[o]={exports:{},id:o,loaded:!1};return e[o].call(n.exports,n,n.exports,i),n.loaded=!0,n.exports}var t={};return i.m=e,i.c=t,i.p="",i(0)}([function(e,i,t){"use strict";var o=t(1);!function(e){e(FusionCharts)}(function(e){e.register("extension",["data-aggregator",function(e){var i=this,t=i.extAPI;console.log(e),window.Aggregator=new o,t(window.Aggregator)}])})},function(e,i){"use strict";function t(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,i){for(var t=0;t<i.length;t++){var o=i[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(i,t,o){return t&&e(i.prototype,t),o&&e(i,o),i}}(),n=function(){function e(){t(this,e),this.appliedAggregation={timePeriod:null,timePeriodMultiplier:1,aggregationMethod:null},this.config={}}return o(e,[{key:"getAvailablelAggreagation",value:function(){var e,i,t,o,n=this.config,r=this.x,a=this.chart;for(n.avlAggMethods=a.getAvailableAggregationMethod(),i=n.avlTimePeriods=a.getAvailableTimePeriod(),n.avlTimeMultiplier=[],o=i.length,t=0;t<o;t++)n.avlTimeMultiplier.push(i[t].multipliers);e=r.getCurrentVisibleRange(),n.currentTimeLength=e.endDate-e.startDate}},{key:"getValidAggregation",value:function(){var e,i,t,o,n,r,a,l,g,u,s,d,c,h,f=this.chart.config,v=this.config,p=f.minNumOfPlot,m=f.maxNumOfPlot;for(n=v.avlTimePeriods,r=v.avlTimeMultiplier,l=v.currentTimeLength,v.minTime=c=l/m,v.maxTime=h=l/p,v.validTimePeriod=[],v.validTimePeriodMultiplier=[],e=0,t=n.length;e<t;e++){for(g=Object.keys(n[e])[0],u=n[e][Object.keys(n[e])[0]],a=[],i=0,o=r[e].length;i<o;i++)d=r[e][i],s=d*u,s>=c&&s<=h&&a.push(r[e][i]);a.length>0&&(v.validTimePeriodMultiplier.push(a),v.validTimePeriod.push(g))}console.log("Time Period: ",v.validTimePeriod),console.log("Number Of Multipliers: ",v.validTimePeriodMultiplier),console.log("Methods: ",v.avlAggMethods)}},{key:"setAggregation",value:function(e){var i,t,o,n,r=this.config;return i=r.avlAggMethods,t=r.validTimePeriod,n=r.validTimePeriodMultiplier,i.includes(e.aggregationMethod)&&t.includes(e.timePeriod)?(o=t.indexOf(e.timePeriod),n[o].includes(e.timePeriodMultiplier)?(this.aggregation=e,console.log(this.aggregation),!0):(console.log(this.aggregation),!1)):(console.log(this.aggregation),!1)}},{key:"resetAggregation",value:function(){}},{key:"init",value:function(e){var i=this;e("X-Axis","chart",function(e,t){i.x=e,i.chart=t}),this.getAvailablelAggreagation(),this.getValidAggregation()}},{key:"placeInCanvas",value:function(){}},{key:"draw",value:function(){}},{key:"dispose",value:function(){}},{key:"aggregation",get:function(){return this.appliedAggregation},set:function(e){this.appliedAggregation.timePeriod=e.timePeriod,this.appliedAggregation.timePeriodMultiplier=e.timePeriodMultiplier,this.appliedAggregation.aggregationMethod=e.aggregationMethod}}]),e}();e.exports=n}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vZmN0cy1leHQtZGF0YWFnZ3JlZ2F0b3ItZXM1Lm1pbi5qcyIsIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAgYTgzYjdmODYyZDM4NDc0ZjdmYTciLCJ3ZWJwYWNrOi8vLy4vc3JjL2luZGV4LmpzIiwid2VicGFjazovLy8uL3NyYy9mY3RzLWV4dC1hZ2dyZWdhdG9yLmpzIl0sIm5hbWVzIjpbIm1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJpbnN0YWxsZWRNb2R1bGVzIiwiZXhwb3J0cyIsIm1vZHVsZSIsImlkIiwibG9hZGVkIiwiY2FsbCIsIm0iLCJjIiwicCIsIkFnZ3JlZ2F0b3IiLCJmYWN0b3J5IiwiRnVzaW9uQ2hhcnRzIiwiRkMiLCJyZWdpc3RlciIsImdsb2JhbCIsInRoaXMiLCJleHRBUEkiLCJjb25zb2xlIiwibG9nIiwid2luZG93IiwiX2NsYXNzQ2FsbENoZWNrIiwiaW5zdGFuY2UiLCJDb25zdHJ1Y3RvciIsIlR5cGVFcnJvciIsIl9jcmVhdGVDbGFzcyIsImRlZmluZVByb3BlcnRpZXMiLCJ0YXJnZXQiLCJwcm9wcyIsImkiLCJsZW5ndGgiLCJkZXNjcmlwdG9yIiwiZW51bWVyYWJsZSIsImNvbmZpZ3VyYWJsZSIsIndyaXRhYmxlIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJrZXkiLCJwcm90b1Byb3BzIiwic3RhdGljUHJvcHMiLCJwcm90b3R5cGUiLCJhcHBsaWVkQWdncmVnYXRpb24iLCJ0aW1lUGVyaW9kIiwidGltZVBlcmlvZE11bHRpcGxpZXIiLCJhZ2dyZWdhdGlvbk1ldGhvZCIsImNvbmZpZyIsInZhbHVlIiwiY3VycmVudFZpc2libGVSYW5nZSIsImF2bFRpbWVQZXJpb2RzIiwibGVuIiwieEF4aXMiLCJ4IiwiY2hhcnQiLCJhdmxBZ2dNZXRob2RzIiwiZ2V0QXZhaWxhYmxlQWdncmVnYXRpb25NZXRob2QiLCJnZXRBdmFpbGFibGVUaW1lUGVyaW9kIiwiYXZsVGltZU11bHRpcGxpZXIiLCJwdXNoIiwibXVsdGlwbGllcnMiLCJnZXRDdXJyZW50VmlzaWJsZVJhbmdlIiwiY3VycmVudFRpbWVMZW5ndGgiLCJlbmREYXRlIiwic3RhcnREYXRlIiwiaiIsImxlbjEiLCJsZW4yIiwibXVsdGlwbGllcnNBcnIiLCJ0aW1lIiwiZXhwZWN0ZWRUaW1lIiwibXVsdGlwbGllciIsIm1pblRpbWUiLCJtYXhUaW1lIiwiY2hhcnRDb25maWciLCJtaW5OdW1PZlBsb3QiLCJtYXhOdW1PZlBsb3QiLCJ2YWxpZFRpbWVQZXJpb2QiLCJ2YWxpZFRpbWVQZXJpb2RNdWx0aXBsaWVyIiwia2V5cyIsIm9iaiIsInRpbWVQZXJpb2RJbmRleCIsImluY2x1ZGVzIiwiaW5kZXhPZiIsImFnZ3JlZ2F0aW9uIiwicmVxdWlyZSIsInNlbGYiLCJnZXRBdmFpbGFibGVsQWdncmVhZ2F0aW9uIiwiZ2V0VmFsaWRBZ2dyZWdhdGlvbiIsImdldCIsInNldCJdLCJtYXBwaW5ncyI6IkNBQVMsU0FBVUEsR0NJbkIsUUFBQUMsR0FBQUMsR0FHQSxHQUFBQyxFQUFBRCxHQUNBLE1BQUFDLEdBQUFELEdBQUFFLE9BR0EsSUFBQUMsR0FBQUYsRUFBQUQsSUFDQUUsV0FDQUUsR0FBQUosRUFDQUssUUFBQSxFQVVBLE9BTkFQLEdBQUFFLEdBQUFNLEtBQUFILEVBQUFELFFBQUFDLElBQUFELFFBQUFILEdBR0FJLEVBQUFFLFFBQUEsRUFHQUYsRUFBQUQsUUF2QkEsR0FBQUQsS0FxQ0EsT0FUQUYsR0FBQVEsRUFBQVQsRUFHQUMsRUFBQVMsRUFBQVAsRUFHQUYsRUFBQVUsRUFBQSxHQUdBVixFQUFBLEtETU0sU0FBU0ksRUFBUUQsRUFBU0gsR0U1Q2hDLFlBQ0EsSUFBTVcsR0FBYVgsRUFBUSxJQUUxQixTQUFXWSxHQUNWQSxFQUFRQyxlQUNQLFNBQVVDLEdBQ1hBLEVBQUdDLFNBQVMsYUFBYyxrQkFBbUIsU0FBVVYsR0FDckQsR0FBSVcsR0FBU0MsS0FDVEMsRUFBU0YsRUFBT0UsTUFDcEJDLFNBQVFDLElB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OiJmY3RzLWV4dC1kYXRhYWdncmVnYXRvci1lczUubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqKioqKi8gKGZ1bmN0aW9uKG1vZHVsZXMpIHsgLy8gd2VicGFja0Jvb3RzdHJhcFxuLyoqKioqKi8gXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4vKioqKioqLyBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG4vKioqKioqL1xuLyoqKioqKi8gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuLyoqKioqKi8gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG4vKioqKioqL1xuLyoqKioqKi8gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuLyoqKioqKi8gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKVxuLyoqKioqKi8gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4vKioqKioqL1xuLyoqKioqKi8gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4vKioqKioqLyBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuLyoqKioqKi8gXHRcdFx0ZXhwb3J0czoge30sXG4vKioqKioqLyBcdFx0XHRpZDogbW9kdWxlSWQsXG4vKioqKioqLyBcdFx0XHRsb2FkZWQ6IGZhbHNlXG4vKioqKioqLyBcdFx0fTtcbi8qKioqKiovXG4vKioqKioqLyBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4vKioqKioqLyBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG4vKioqKioqL1xuLyoqKioqKi8gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbi8qKioqKiovIFx0XHRtb2R1bGUubG9hZGVkID0gdHJ1ZTtcbi8qKioqKiovXG4vKioqKioqLyBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbi8qKioqKiovIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4vKioqKioqLyBcdH1cbi8qKioqKiovXG4vKioqKioqL1xuLyoqKioqKi8gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuLyoqKioqKi8gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuLyoqKioqKi9cbi8qKioqKiovIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbi8qKioqKiovIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcbi8qKioqKiovXG4vKioqKioqLyBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4vKioqKioqLyBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG4vKioqKioqL1xuLyoqKioqKi8gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbi8qKioqKiovIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oMCk7XG4vKioqKioqLyB9KVxuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cbi8qKioqKiovIChbXG4vKiAwICovXG4vKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHtcblxuXHQndXNlIHN0cmljdCc7XG5cdFxuXHR2YXIgQWdncmVnYXRvciA9IF9fd2VicGFja19yZXF1aXJlX18oMSk7XG5cdFxuXHQ7KGZ1bmN0aW9uIChmYWN0b3J5KSB7XG5cdCAgZmFjdG9yeShGdXNpb25DaGFydHMpO1xuXHR9KShmdW5jdGlvbiAoRkMpIHtcblx0ICBGQy5yZWdpc3RlcignZXh0ZW5zaW9uJywgWydkYXRhLWFnZ3JlZ2F0b3InLCBmdW5jdGlvbiAoaWQpIHtcblx0ICAgIHZhciBnbG9iYWwgPSB0aGlzO1xuXHQgICAgdmFyIGV4dEFQSSA9IGdsb2JhbC5leHRBUEk7XG5cdCAgICBjb25zb2xlLmxvZyhpZCk7XG5cdFxuXHQgICAgLy8gdmFyIG90aGVyQVBJID0gRnVzaW9uQ2hhcnRzLmdldEV4dENvbXBvbmVudChpZCwgJ2FwaScsICdsZWdhY3lleHRhcGknKTtcblx0ICAgIC8vIHZhciB0b29sQm94QXBpID0gRnVzaW9uQ2hhcnRzLmdldENvbXBvbmVudCgnYXBpJywgJ3Rvb2xib3gnKTtcblx0XG5cdCAgICB3aW5kb3cuQWdncmVnYXRvciA9IG5ldyBBZ2dyZWdhdG9yKCk7XG5cdFxuXHQgICAgZXh0QVBJKHdpbmRvdy5BZ2dyZWdhdG9yKTtcblx0ICB9XSk7XG5cdH0pO1xuXG4vKioqLyB9LFxuLyogMSAqL1xuLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzKSB7XG5cblx0J3VzZSBzdHJpY3QnO1xuXHQvKipcblx0ICogQ2xhc3MgcmVwcmVzZW50aW5nIHRoZSBEYXRhIEFnZ3JlZ2F0b3IuXG5cdCAqL1xuXHRcblx0dmFyIF9jcmVhdGVDbGFzcyA9IGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmIChcInZhbHVlXCIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9IHJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH07IH0oKTtcblx0XG5cdGZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvblwiKTsgfSB9XG5cdFxuXHR2YXIgQWdncmVnYXRvciA9IGZ1bmN0aW9uICgpIHtcblx0ICAvKipcblx0ICAgKiBDcmVhdGUgYSBBZ2dyZWdhdG9yLlxuXHQgICAqIEB0eXBlZGVmIHtvYmplY3R9IEFnZ3JlZ2F0b3IuYWdncmVnYXRpb25cblx0ICAgKiBAcHJvcGVydHkge3N0cmluZ30gdGltZVBlcmlvZCAtIFRoZSB0aW1lIGludGVydmFsIG9mIGFnZ3JlZ2F0aW9uLlxuXHQgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSB0aW1lUGVyaW9kTXVsdGlwbGllciAtIFRoZSBtdWx0aXBsaWVyIG9mIHRpbWUgaW50ZXJ2YWwuXG5cdCAgICogQHByb3BlcnR5IHtzdHJpbmd9IGFnZ3JlZ2F0aW9uTWV0aG9kIC0gVGhlIG1ldGhvZCBhcHBsaWVkIHRvIGFnZ3JlZ2F0ZS5cblx0ICAgKi9cblx0ICBmdW5jdGlvbiBBZ2dyZWdhdG9yKCkge1xuXHQgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEFnZ3JlZ2F0b3IpO1xuXHRcblx0ICAgIC8qKlxuXHQgICAgICogQHByaXZhdGVcblx0ICAgICAqL1xuXHQgICAgdGhpcy5hcHBsaWVkQWdncmVnYXRpb24gPSB7XG5cdCAgICAgIHRpbWVQZXJpb2Q6IG51bGwsXG5cdCAgICAgIHRpbWVQZXJpb2RNdWx0aXBsaWVyOiAxLFxuXHQgICAgICBhZ2dyZWdhdGlvbk1ldGhvZDogbnVsbFxuXHQgICAgfTtcblx0ICAgIHRoaXMuY29uZmlnID0ge307XG5cdCAgfVxuXHRcblx0ICAvKipcblx0ICAgKiBBbiBvYmplY3QgcmVwcmVzZW50aW5nIHRoZSB0aW1lUGVyaW9kLCB0aW1lUGVyaW9kTXVsdGlwbGllciwgYWdncmVnYXRpb25NZXRob2QuXG5cdCAgICogQHR5cGUge0FnZ3JlZ2F0b3IuYWdncmVnYXRpb259XG5cdCAgICovXG5cdFxuXHRcblx0ICBfY3JlYXRlQ2xhc3MoQWdncmVnYXRvciwgW3tcblx0ICAgIGtleTogJ2dldEF2YWlsYWJsZWxBZ2dyZWFnYXRpb24nLFxuXHRcblx0XG5cdCAgICAvKipcblx0ICAgICAqIFNldHMgYXZhaWxhYmxlIGFnZ3JlZ2F0aW9uIG9wdGlvbnMgaW4gY29uZmlndXJhdGlvbiBvZiBleHRlbnNpb25cblx0ICAgICAqIEBwcml2YXRlXG5cdCAgICAgKi9cblx0ICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRBdmFpbGFibGVsQWdncmVhZ2F0aW9uKCkge1xuXHQgICAgICB2YXIgY29uZmlnID0gdGhpcy5jb25maWcsXG5cdCAgICAgICAgICBjdXJyZW50VmlzaWJsZVJhbmdlLFxuXHQgICAgICAgICAgeEF4aXMgPSB0aGlzLngsXG5cdCAgICAgICAgICBjaGFydCA9IHRoaXMuY2hhcnQsXG5cdCAgICAgICAgICBhdmxUaW1lUGVyaW9kcyxcblx0ICAgICAgICAgIGksXG5cdCAgICAgICAgICBsZW47XG5cdFxuXHQgICAgICBjb25maWcuYXZsQWdnTWV0aG9kcyA9IGNoYXJ0LmdldEF2YWlsYWJsZUFnZ3JlZ2F0aW9uTWV0aG9kKCk7XG5cdCAgICAgIGF2bFRpbWVQZXJpb2RzID0gY29uZmlnLmF2bFRpbWVQZXJpb2RzID0gY2hhcnQuZ2V0QXZhaWxhYmxlVGltZVBlcmlvZCgpO1xuXHRcblx0ICAgICAgY29uZmlnLmF2bFRpbWVNdWx0aXBsaWVyID0gW107XG5cdCAgICAgIGxlbiA9IGF2bFRpbWVQZXJpb2RzLmxlbmd0aDtcblx0XG5cdCAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW47IGkrKykge1xuXHQgICAgICAgIGNvbmZpZy5hdmxUaW1lTXVsdGlwbGllci5wdXNoKGF2bFRpbWVQZXJpb2RzW2ldLm11bHRpcGxpZXJzKTtcblx0ICAgICAgfVxuXHRcblx0ICAgICAgY3VycmVudFZpc2libGVSYW5nZSA9IHhBeGlzLmdldEN1cnJlbnRWaXNpYmxlUmFuZ2UoKTtcblx0ICAgICAgY29uZmlnLmN1cnJlbnRUaW1lTGVuZ3RoID0gY3VycmVudFZpc2libGVSYW5nZS5lbmREYXRlIC0gY3VycmVudFZpc2libGVSYW5nZS5zdGFydERhdGU7XG5cdCAgICB9XG5cdFxuXHQgICAgLyoqXG5cdCAgICAgKiBDYWxjdWxhdGVzIHZhbGlkIGFnZ3JlZ2F0aW9uIHRpbWUgcGVyaW9kcyBhbmQgY29ycmVzcG9uZGluZyBtdWx0aXBsaWVyc1xuXHQgICAgICogQHByaXZhdGVcblx0ICAgICAqL1xuXHRcblx0ICB9LCB7XG5cdCAgICBrZXk6ICdnZXRWYWxpZEFnZ3JlZ2F0aW9uJyxcblx0ICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRWYWxpZEFnZ3JlZ2F0aW9uKCkge1xuXHQgICAgICB2YXIgY2hhcnRDb25maWcgPSB0aGlzLmNoYXJ0LmNvbmZpZyxcblx0ICAgICAgICAgIGNvbmZpZyA9IHRoaXMuY29uZmlnLFxuXHQgICAgICAgICAgaSxcblx0ICAgICAgICAgIGosXG5cdCAgICAgICAgICBsZW4xLFxuXHQgICAgICAgICAgbGVuMixcblx0ICAgICAgICAgIGF2bFRpbWVQZXJpb2RzLFxuXHQgICAgICAgICAgYXZsVGltZU11bHRpcGxpZXIsXG5cdCAgICAgICAgICBtaW5OdW1PZlBsb3QgPSBjaGFydENvbmZpZy5taW5OdW1PZlBsb3QsXG5cdCAgICAgICAgICBtYXhOdW1PZlBsb3QgPSBjaGFydENvbmZpZy5tYXhOdW1PZlBsb3QsXG5cdCAgICAgICAgICBtdWx0aXBsaWVyc0Fycixcblx0ICAgICAgICAgIGN1cnJlbnRUaW1lTGVuZ3RoLFxuXHQgICAgICAgICAgdGltZVBlcmlvZCxcblx0ICAgICAgICAgIHRpbWUsXG5cdCAgICAgICAgICBleHBlY3RlZFRpbWUsXG5cdCAgICAgICAgICBtdWx0aXBsaWVyLFxuXHQgICAgICAgICAgbWluVGltZSxcblx0ICAgICAgICAgIG1heFRpbWU7XG5cdFxuXHQgICAgICBhdmxUaW1lUGVyaW9kcyA9IGNvbmZpZy5hdmxUaW1lUGVyaW9kcztcblx0ICAgICAgYXZsVGltZU11bHRpcGxpZXIgPSBjb25maWcuYXZsVGltZU11bHRpcGxpZXI7XG5cdCAgICAgIGN1cnJlbnRUaW1lTGVuZ3RoID0gY29uZmlnLmN1cnJlbnRUaW1lTGVuZ3RoO1xuXHRcblx0ICAgICAgY29uZmlnLm1pblRpbWUgPSBtaW5UaW1lID0gY3VycmVudFRpbWVMZW5ndGggLyBtYXhOdW1PZlBsb3Q7XG5cdCAgICAgIGNvbmZpZy5tYXhUaW1lID0gbWF4VGltZSA9IGN1cnJlbnRUaW1lTGVuZ3RoIC8gbWluTnVtT2ZQbG90O1xuXHRcblx0ICAgICAgY29uZmlnLnZhbGlkVGltZVBlcmlvZCA9IFtdO1xuXHQgICAgICBjb25maWcudmFsaWRUaW1lUGVyaW9kTXVsdGlwbGllciA9IFtdO1xuXHRcblx0ICAgICAgZm9yIChpID0gMCwgbGVuMSA9IGF2bFRpbWVQZXJpb2RzLmxlbmd0aDsgaSA8IGxlbjE7IGkrKykge1xuXHQgICAgICAgIHRpbWVQZXJpb2QgPSBPYmplY3Qua2V5cyhhdmxUaW1lUGVyaW9kc1tpXSlbMF07XG5cdCAgICAgICAgdGltZSA9IGF2bFRpbWVQZXJpb2RzW2ldW09iamVjdC5rZXlzKGF2bFRpbWVQZXJpb2RzW2ldKVswXV07XG5cdCAgICAgICAgbXVsdGlwbGllcnNBcnIgPSBbXTtcblx0XG5cdCAgICAgICAgZm9yIChqID0gMCwgbGVuMiA9IGF2bFRpbWVNdWx0aXBsaWVyW2ldLmxlbmd0aDsgaiA8IGxlbjI7IGorKykge1xuXHQgICAgICAgICAgbXVsdGlwbGllciA9IGF2bFRpbWVNdWx0aXBsaWVyW2ldW2pdO1xuXHQgICAgICAgICAgZXhwZWN0ZWRUaW1lID0gbXVsdGlwbGllciAqIHRpbWU7XG5cdFxuXHQgICAgICAgICAgaWYgKGV4cGVjdGVkVGltZSA+PSBtaW5UaW1lICYmIGV4cGVjdGVkVGltZSA8PSBtYXhUaW1lKSB7XG5cdCAgICAgICAgICAgIG11bHRpcGxpZXJzQXJyLnB1c2goYXZsVGltZU11bHRpcGxpZXJbaV1bal0pO1xuXHQgICAgICAgICAgfVxuXHQgICAgICAgIH1cblx0ICAgICAgICBpZiAobXVsdGlwbGllcnNBcnIubGVuZ3RoID4gMCkge1xuXHQgICAgICAgICAgY29uZmlnLnZhbGlkVGltZVBlcmlvZE11bHRpcGxpZXIucHVzaChtdWx0aXBsaWVyc0Fycik7XG5cdCAgICAgICAgICBjb25maWcudmFsaWRUaW1lUGVyaW9kLnB1c2godGltZVBlcmlvZCk7XG5cdCAgICAgICAgfVxuXHQgICAgICB9XG5cdCAgICAgIGNvbnNvbGUubG9nKCdUaW1lIFBlcmlvZDogJywgY29uZmlnLnZhbGlkVGltZVBlcmlvZCk7XG5cdCAgICAgIGNvbnNvbGUubG9nKCdOdW1iZXIgT2YgTXVsdGlwbGllcnM6ICcsIGNvbmZpZy52YWxpZFRpbWVQZXJpb2RNdWx0aXBsaWVyKTtcblx0ICAgICAgY29uc29sZS5sb2coJ01ldGhvZHM6ICcsIGNvbmZpZy5hdmxBZ2dNZXRob2RzKTtcblx0ICAgIH1cblx0XG5cdCAgICAvKipcblx0ICAgICAqIFNldCBBZ2dyZWdhdGlvbiBvbiB0aW1lIHNlcmllc1xuXHQgICAgICogQHBhcmFtICB7b2JqZWN0fSBvYmpcblx0ICAgICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSB0aW1lUGVyaW9kIC0gVGhlIHRpbWUgaW50ZXJ2YWwgb2YgYWdncmVnYXRpb24uXG5cdCAgICAgKiBAcHJvcGVydHkge251bWJlcn0gdGltZVBlcmlvZE11bHRpcGxpZXIgLSBUaGUgbXVsdGlwbGllciBvZiB0aW1lIGludGVydmFsLlxuXHQgICAgICogQHByb3BlcnR5IHtzdHJpbmd9IGFnZ3JlZ2F0aW9uTWV0aG9kIC0gVGhlIG1ldGhvZCBhcHBsaWVkIHRvIGFnZ3JlZ2F0ZS5cblx0ICAgICAqL1xuXHRcblx0ICB9LCB7XG5cdCAgICBrZXk6ICdzZXRBZ2dyZWdhdGlvbicsXG5cdCAgICB2YWx1ZTogZnVuY3Rpb24gc2V0QWdncmVnYXRpb24ob2JqKSB7XG5cdCAgICAgIHZhciBhdmxBZ2dNZXRob2RzLFxuXHQgICAgICAgICAgdmFsaWRUaW1lUGVyaW9kLFxuXHQgICAgICAgICAgdGltZVBlcmlvZEluZGV4LFxuXHQgICAgICAgICAgdmFsaWRUaW1lUGVyaW9kTXVsdGlwbGllcixcblx0ICAgICAgICAgIGNvbmZpZyA9IHRoaXMuY29uZmlnO1xuXHRcblx0ICAgICAgYXZsQWdnTWV0aG9kcyA9IGNvbmZpZy5hdmxBZ2dNZXRob2RzO1xuXHQgICAgICB2YWxpZFRpbWVQZXJpb2QgPSBjb25maWcudmFsaWRUaW1lUGVyaW9kO1xuXHQgICAgICB2YWxpZFRpbWVQZXJpb2RNdWx0aXBsaWVyID0gY29uZmlnLnZhbGlkVGltZVBlcmlvZE11bHRpcGxpZXI7XG5cdFxuXHQgICAgICBpZiAoYXZsQWdnTWV0aG9kcy5pbmNsdWRlcyhvYmouYWdncmVnYXRpb25NZXRob2QpICYmIHZhbGlkVGltZVBlcmlvZC5pbmNsdWRlcyhvYmoudGltZVBlcmlvZCkpIHtcblx0ICAgICAgICB0aW1lUGVyaW9kSW5kZXggPSB2YWxpZFRpbWVQZXJpb2QuaW5kZXhPZihvYmoudGltZVBlcmlvZCk7XG5cdCAgICAgICAgaWYgKHZhbGlkVGltZVBlcmlvZE11bHRpcGxpZXJbdGltZVBlcmlvZEluZGV4XS5pbmNsdWRlcyhvYmoudGltZVBlcmlvZE11bHRpcGxpZXIpKSB7XG5cdCAgICAgICAgICB0aGlzLmFnZ3JlZ2F0aW9uID0gb2JqO1xuXHQgICAgICAgICAgY29uc29sZS5sb2codGhpcy5hZ2dyZWdhdGlvbik7XG5cdCAgICAgICAgICByZXR1cm4gdHJ1ZTtcblx0ICAgICAgICB9IGVsc2Uge1xuXHQgICAgICAgICAgY29uc29sZS5sb2codGhpcy5hZ2dyZWdhdGlvbik7XG5cdCAgICAgICAgICByZXR1cm4gZmFsc2U7XG5cdCAgICAgICAgfVxuXHQgICAgICB9IGVsc2Uge1xuXHQgICAgICAgIGNvbnNvbGUubG9nKHRoaXMuYWdncmVnYXRpb24pO1xuXHQgICAgICAgIHJldHVybiBmYWxzZTtcblx0ICAgICAgfVxuXHQgICAgfVxuXHRcblx0ICAgIC8qKlxuXHQgICAgICogUmVzZXQgQXBwbGllZCBBZ2dyZWdhdGlvblxuXHQgICAgICovXG5cdFxuXHQgIH0sIHtcblx0ICAgIGtleTogJ3Jlc2V0QWdncmVnYXRpb24nLFxuXHQgICAgdmFsdWU6IGZ1bmN0aW9uIHJlc2V0QWdncmVnYXRpb24oKSB7fVxuXHQgIH0sIHtcblx0ICAgIGtleTogJ2luaXQnLFxuXHQgICAgdmFsdWU6IGZ1bmN0aW9uIGluaXQocmVxdWlyZSkge1xuXHQgICAgICB2YXIgc2VsZiA9IHRoaXM7XG5cdFxuXHQgICAgICByZXF1aXJlKCdYLUF4aXMnLCAnY2hhcnQnLCBmdW5jdGlvbiAoeCwgY2hhcnQpIHtcblx0ICAgICAgICBzZWxmLnggPSB4O1xuXHQgICAgICAgIHNlbGYuY2hhcnQgPSBjaGFydDtcblx0ICAgICAgfSk7XG5cdFxuXHQgICAgICB0aGlzLmdldEF2YWlsYWJsZWxBZ2dyZWFnYXRpb24oKTtcblx0ICAgICAgdGhpcy5nZXRWYWxpZEFnZ3JlZ2F0aW9uKCk7XG5cdCAgICB9XG5cdCAgfSwge1xuXHQgICAga2V5OiAncGxhY2VJbkNhbnZhcycsXG5cdCAgICB2YWx1ZTogZnVuY3Rpb24gcGxhY2VJbkNhbnZhcygpIHtcblx0ICAgICAgLy8gc3BhY2UgbWFuYWdlbWVudFxuXHQgICAgfVxuXHQgIH0sIHtcblx0ICAgIGtleTogJ2RyYXcnLFxuXHQgICAgdmFsdWU6IGZ1bmN0aW9uIGRyYXcoKSB7XG5cdCAgICAgIC8vIGRyYXcgZXh0ZW5zaW9uXG5cdCAgICB9XG5cdCAgfSwge1xuXHQgICAga2V5OiAnZGlzcG9zZScsXG5cdCAgICB2YWx1ZTogZnVuY3Rpb24gZGlzcG9zZSgpIHtcblx0ICAgICAgLy8gZGlzcG9zZSBleHRlbnNpb25cblx0ICAgIH1cblx0ICB9LCB7XG5cdCAgICBrZXk6ICdhZ2dyZWdhdGlvbicsXG5cdCAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHtcblx0ICAgICAgcmV0dXJuIHRoaXMuYXBwbGllZEFnZ3JlZ2F0aW9uO1xuXHQgICAgfSxcblx0ICAgIHNldDogZnVuY3Rpb24gc2V0KG9iaikge1xuXHQgICAgICB0aGlzLmFwcGxpZWRBZ2dyZWdhdGlvbi50aW1lUGVyaW9kID0gb2JqLnRpbWVQZXJpb2Q7XG5cdCAgICAgIHRoaXMuYXBwbGllZEFnZ3JlZ2F0aW9uLnRpbWVQZXJpb2RNdWx0aXBsaWVyID0gb2JqLnRpbWVQZXJpb2RNdWx0aXBsaWVyO1xuXHQgICAgICB0aGlzLmFwcGxpZWRBZ2dyZWdhdGlvbi5hZ2dyZWdhdGlvbk1ldGhvZCA9IG9iai5hZ2dyZWdhdGlvbk1ldGhvZDtcblx0ICAgIH1cblx0ICB9XSk7XG5cdFxuXHQgIHJldHVybiBBZ2dyZWdhdG9yO1xuXHR9KCk7XG5cdFxuXHRtb2R1bGUuZXhwb3J0cyA9IEFnZ3JlZ2F0b3I7XG5cbi8qKiovIH1cbi8qKioqKiovIF0pO1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBmY3RzLWV4dC1kYXRhYWdncmVnYXRvci1lczUubWluLmpzIiwiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pXG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG5cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGV4cG9ydHM6IHt9LFxuIFx0XHRcdGlkOiBtb2R1bGVJZCxcbiBcdFx0XHRsb2FkZWQ6IGZhbHNlXG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmxvYWRlZCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oMCk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gd2VicGFjay9ib290c3RyYXAgYTgzYjdmODYyZDM4NDc0ZjdmYTciLCIndXNlIHN0cmljdCc7XG5jb25zdCBBZ2dyZWdhdG9yID0gcmVxdWlyZSgnLi9mY3RzLWV4dC1hZ2dyZWdhdG9yJyk7XG5cbjsoZnVuY3Rpb24gKGZhY3RvcnkpIHtcbiAgZmFjdG9yeShGdXNpb25DaGFydHMpO1xufSkoZnVuY3Rpb24gKEZDKSB7XG4gIEZDLnJlZ2lzdGVyKCdleHRlbnNpb24nLCBbJ2RhdGEtYWdncmVnYXRvcicsIGZ1bmN0aW9uIChpZCkge1xuICAgIHZhciBnbG9iYWwgPSB0aGlzO1xuICAgIHZhciBleHRBUEkgPSBnbG9iYWwuZXh0QVBJO1xuICAgIGNvbnNvbGUubG9nKGlkKTtcblxuICAgIC8vIHZhciBvdGhlckFQSSA9IEZ1c2lvbkNoYXJ0cy5nZXRFeHRDb21wb25lbnQoaWQsICdhcGknLCAnbGVnYWN5ZXh0YXBpJyk7XG4gICAgLy8gdmFyIHRvb2xCb3hBcGkgPSBGdXNpb25DaGFydHMuZ2V0Q29tcG9uZW50KCdhcGknLCAndG9vbGJveCcpO1xuXG4gICAgd2luZG93LkFnZ3JlZ2F0b3IgPSBuZXcgQWdncmVnYXRvcigpO1xuXG4gICAgZXh0QVBJKHdpbmRvdy5BZ2dyZWdhdG9yKTtcbiAgfV0pO1xufSk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gLi9zcmMvaW5kZXguanMiLCIndXNlIHN0cmljdCc7XG4vKipcbiAqIENsYXNzIHJlcHJlc2VudGluZyB0aGUgRGF0YSBBZ2dyZWdhdG9yLlxuICovXG5jbGFzcyBBZ2dyZWdhdG9yIHtcbiAgLyoqXG4gICAqIENyZWF0ZSBhIEFnZ3JlZ2F0b3IuXG4gICAqIEB0eXBlZGVmIHtvYmplY3R9IEFnZ3JlZ2F0b3IuYWdncmVnYXRpb25cbiAgICogQHByb3BlcnR5IHtzdHJpbmd9IHRpbWVQZXJpb2QgLSBUaGUgdGltZSBpbnRlcnZhbCBvZiBhZ2dyZWdhdGlvbi5cbiAgICogQHByb3BlcnR5IHtudW1iZXJ9IHRpbWVQZXJpb2RNdWx0aXBsaWVyIC0gVGhlIG11bHRpcGxpZXIgb2YgdGltZSBpbnRlcnZhbC5cbiAgICogQHByb3BlcnR5IHtzdHJpbmd9IGFnZ3JlZ2F0aW9uTWV0aG9kIC0gVGhlIG1ldGhvZCBhcHBsaWVkIHRvIGFnZ3JlZ2F0ZS5cbiAgICovXG4gIGNvbnN0cnVjdG9yICgpIHtcbiAgICAvKipcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIHRoaXMuYXBwbGllZEFnZ3JlZ2F0aW9uID0ge1xuICAgICAgdGltZVBlcmlvZDogbnVsbCxcbiAgICAgIHRpbWVQZXJpb2RNdWx0aXBsaWVyOiAxLFxuICAgICAgYWdncmVnYXRpb25NZXRob2Q6IG51bGxcbiAgICB9O1xuICAgIHRoaXMuY29uZmlnID0ge307XG4gIH1cblxuICAvKipcbiAgICogQW4gb2JqZWN0IHJlcHJlc2VudGluZyB0aGUgdGltZVBlcmlvZCwgdGltZVBlcmlvZE11bHRpcGxpZXIsIGFnZ3JlZ2F0aW9uTWV0aG9kLlxuICAgKiBAdHlwZSB7QWdncmVnYXRvci5hZ2dyZWdhdGlvbn1cbiAgICovXG4gIGdldCBhZ2dyZWdhdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMuYXBwbGllZEFnZ3JlZ2F0aW9uO1xuICB9XG5cbiAgc2V0IGFnZ3JlZ2F0aW9uIChvYmopIHtcbiAgICB0aGlzLmFwcGxpZWRBZ2dyZWdhdGlvbi50aW1lUGVyaW9kID0gb2JqLnRpbWVQZXJpb2Q7XG4gICAgdGhpcy5hcHBsaWVkQWdncmVnYXRpb24udGltZVBlcmlvZE11bHRpcGxpZXIgPSBvYmoudGltZVBlcmlvZE11bHRpcGxpZXI7XG4gICAgdGhpcy5hcHBsaWVkQWdncmVnYXRpb24uYWdncmVnYXRpb25NZXRob2QgPSBvYmouYWdncmVnYXRpb25NZXRob2Q7XG4gIH1cblxuICAvKipcbiAgICogU2V0cyBhdmFpbGFibGUgYWdncmVnYXRpb24gb3B0aW9ucyBpbiBjb25maWd1cmF0aW9uIG9mIGV4dGVuc2lvblxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgZ2V0QXZhaWxhYmxlbEFnZ3JlYWdhdGlvbiAoKSB7XG4gICAgdmFyIGNvbmZpZyA9IHRoaXMuY29uZmlnLFxuICAgICAgY3VycmVudFZpc2libGVSYW5nZSxcbiAgICAgIHhBeGlzID0gdGhpcy54LFxuICAgICAgY2hhcnQgPSB0aGlzLmNoYXJ0LFxuICAgICAgYXZsVGltZVBlcmlvZHMsXG4gICAgICBpLFxuICAgICAgbGVuO1xuXG4gICAgY29uZmlnLmF2bEFnZ01ldGhvZHMgPSBjaGFydC5nZXRBdmFpbGFibGVBZ2dyZWdhdGlvbk1ldGhvZCgpO1xuICAgIGF2bFRpbWVQZXJpb2RzID0gY29uZmlnLmF2bFRpbWVQZXJpb2RzID0gY2hhcnQuZ2V0QXZhaWxhYmxlVGltZVBlcmlvZCgpO1xuXG4gICAgY29uZmlnLmF2bFRpbWVNdWx0aXBsaWVyID0gW107XG4gICAgbGVuID0gYXZsVGltZVBlcmlvZHMubGVuZ3RoO1xuXG4gICAgZm9yIChpID0gMDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICBjb25maWcuYXZsVGltZU11bHRpcGxpZXIucHVzaChhdmxUaW1lUGVyaW9kc1tpXS5tdWx0aXBsaWVycyk7XG4gICAgfVxuXG4gICAgY3VycmVudFZpc2libGVSYW5nZSA9IHhBeGlzLmdldEN1cnJlbnRWaXNpYmxlUmFuZ2UoKTtcbiAgICBjb25maWcuY3VycmVudFRpbWVMZW5ndGggPSBjdXJyZW50VmlzaWJsZVJhbmdlLmVuZERhdGUgLSBjdXJyZW50VmlzaWJsZVJhbmdlLnN0YXJ0RGF0ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDYWxjdWxhdGVzIHZhbGlkIGFnZ3JlZ2F0aW9uIHRpbWUgcGVyaW9kcyBhbmQgY29ycmVzcG9uZGluZyBtdWx0aXBsaWVyc1xuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgZ2V0VmFsaWRBZ2dyZWdhdGlvbiAoKSB7XG4gICAgdmFyIGNoYXJ0Q29uZmlnID0gdGhpcy5jaGFydC5jb25maWcsXG4gICAgICBjb25maWcgPSB0aGlzLmNvbmZpZyxcbiAgICAgIGksXG4gICAgICBqLFxuICAgICAgbGVuMSxcbiAgICAgIGxlbjIsXG4gICAgICBhdmxUaW1lUGVyaW9kcyxcbiAgICAgIGF2bFRpbWVNdWx0aXBsaWVyLFxuICAgICAgbWluTnVtT2ZQbG90ID0gY2hhcnRDb25maWcubWluTnVtT2ZQbG90LFxuICAgICAgbWF4TnVtT2ZQbG90ID0gY2hhcnRDb25maWcubWF4TnVtT2ZQbG90LFxuICAgICAgbXVsdGlwbGllcnNBcnIsXG4gICAgICBjdXJyZW50VGltZUxlbmd0aCxcbiAgICAgIHRpbWVQZXJpb2QsXG4gICAgICB0aW1lLFxuICAgICAgZXhwZWN0ZWRUaW1lLFxuICAgICAgbXVsdGlwbGllcixcbiAgICAgIG1pblRpbWUsXG4gICAgICBtYXhUaW1lO1xuXG4gICAgYXZsVGltZVBlcmlvZHMgPSBjb25maWcuYXZsVGltZVBlcmlvZHM7XG4gICAgYXZsVGltZU11bHRpcGxpZXIgPSBjb25maWcuYXZsVGltZU11bHRpcGxpZXI7XG4gICAgY3VycmVudFRpbWVMZW5ndGggPSBjb25maWcuY3VycmVudFRpbWVMZW5ndGg7XG5cbiAgICBjb25maWcubWluVGltZSA9IG1pblRpbWUgPSBjdXJyZW50VGltZUxlbmd0aCAvIG1heE51bU9mUGxvdDtcbiAgICBjb25maWcubWF4VGltZSA9IG1heFRpbWUgPSBjdXJyZW50VGltZUxlbmd0aCAvIG1pbk51bU9mUGxvdDtcblxuICAgIGNvbmZpZy52YWxpZFRpbWVQZXJpb2QgPSBbXTtcbiAgICBjb25maWcudmFsaWRUaW1lUGVyaW9kTXVsdGlwbGllciA9IFtdO1xuXG4gICAgZm9yIChpID0gMCwgbGVuMSA9IGF2bFRpbWVQZXJpb2RzLmxlbmd0aDsgaSA8IGxlbjE7IGkrKykge1xuICAgICAgdGltZVBlcmlvZCA9IE9iamVjdC5rZXlzKGF2bFRpbWVQZXJpb2RzW2ldKVswXTtcbiAgICAgIHRpbWUgPSBhdmxUaW1lUGVyaW9kc1tpXVtPYmplY3Qua2V5cyhhdmxUaW1lUGVyaW9kc1tpXSlbMF1dO1xuICAgICAgbXVsdGlwbGllcnNBcnIgPSBbXTtcblxuICAgICAgZm9yIChqID0gMCwgbGVuMiA9IGF2bFRpbWVNdWx0aXBsaWVyW2ldLmxlbmd0aDsgaiA8IGxlbjI7IGorKykge1xuICAgICAgICBtdWx0aXBsaWVyID0gYXZsVGltZU11bHRpcGxpZXJbaV1bal07XG4gICAgICAgIGV4cGVjdGVkVGltZSA9IG11bHRpcGxpZXIgKiB0aW1lO1xuXG4gICAgICAgIGlmICgoZXhwZWN0ZWRUaW1lID49IG1pblRpbWUpICYmIChleHBlY3RlZFRpbWUgPD0gbWF4VGltZSkpIHtcbiAgICAgICAgICBtdWx0aXBsaWVyc0Fyci5wdXNoKGF2bFRpbWVNdWx0aXBsaWVyW2ldW2pdKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKG11bHRpcGxpZXJzQXJyLmxlbmd0aCA+IDApIHtcbiAgICAgICAgY29uZmlnLnZhbGlkVGltZVBlcmlvZE11bHRpcGxpZXIucHVzaChtdWx0aXBsaWVyc0Fycik7XG4gICAgICAgIGNvbmZpZy52YWxpZFRpbWVQZXJpb2QucHVzaCh0aW1lUGVyaW9kKTtcbiAgICAgIH1cbiAgICB9XG4gICAgY29uc29sZS5sb2coJ1RpbWUgUGVyaW9kOiAnLCBjb25maWcudmFsaWRUaW1lUGVyaW9kKTtcbiAgICBjb25zb2xlLmxvZygnTnVtYmVyIE9mIE11bHRpcGxpZXJzOiAnLCBjb25maWcudmFsaWRUaW1lUGVyaW9kTXVsdGlwbGllcik7XG4gICAgY29uc29sZS5sb2coJ01ldGhvZHM6ICcsIGNvbmZpZy5hdmxBZ2dNZXRob2RzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgQWdncmVnYXRpb24gb24gdGltZSBzZXJpZXNcbiAgICogQHBhcmFtICB7b2JqZWN0fSBvYmpcbiAgICogQHByb3BlcnR5IHtzdHJpbmd9IHRpbWVQZXJpb2QgLSBUaGUgdGltZSBpbnRlcnZhbCBvZiBhZ2dyZWdhdGlvbi5cbiAgICogQHByb3BlcnR5IHtudW1iZXJ9IHRpbWVQZXJpb2RNdWx0aXBsaWVyIC0gVGhlIG11bHRpcGxpZXIgb2YgdGltZSBpbnRlcnZhbC5cbiAgICogQHByb3BlcnR5IHtzdHJpbmd9IGFnZ3JlZ2F0aW9uTWV0aG9kIC0gVGhlIG1ldGhvZCBhcHBsaWVkIHRvIGFnZ3JlZ2F0ZS5cbiAgICovXG4gIHNldEFnZ3JlZ2F0aW9uIChvYmopIHtcbiAgICB2YXIgYXZsQWdnTWV0aG9kcyxcbiAgICAgIHZhbGlkVGltZVBlcmlvZCxcbiAgICAgIHRpbWVQZXJpb2RJbmRleCxcbiAgICAgIHZhbGlkVGltZVBlcmlvZE11bHRpcGxpZXIsXG4gICAgICBjb25maWcgPSB0aGlzLmNvbmZpZztcblxuICAgIGF2bEFnZ01ldGhvZHMgPSBjb25maWcuYXZsQWdnTWV0aG9kcztcbiAgICB2YWxpZFRpbWVQZXJpb2QgPSBjb25maWcudmFsaWRUaW1lUGVyaW9kO1xuICAgIHZhbGlkVGltZVBlcmlvZE11bHRpcGxpZXIgPSBjb25maWcudmFsaWRUaW1lUGVyaW9kTXVsdGlwbGllcjtcblxuICAgIGlmIChhdmxBZ2dNZXRob2RzLmluY2x1ZGVzKG9iai5hZ2dyZWdhdGlvbk1ldGhvZCkgJiYgdmFsaWRUaW1lUGVyaW9kLmluY2x1ZGVzKG9iai50aW1lUGVyaW9kKSkge1xuICAgICAgdGltZVBlcmlvZEluZGV4ID0gdmFsaWRUaW1lUGVyaW9kLmluZGV4T2Yob2JqLnRpbWVQZXJpb2QpO1xuICAgICAgaWYgKHZhbGlkVGltZVBlcmlvZE11bHRpcGxpZXJbdGltZVBlcmlvZEluZGV4XS5pbmNsdWRlcyhvYmoudGltZVBlcmlvZE11bHRpcGxpZXIpKSB7XG4gICAgICAgIHRoaXMuYWdncmVnYXRpb24gPSBvYmo7XG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXMuYWdncmVnYXRpb24pO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXMuYWdncmVnYXRpb24pO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnNvbGUubG9nKHRoaXMuYWdncmVnYXRpb24pO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBSZXNldCBBcHBsaWVkIEFnZ3JlZ2F0aW9uXG4gICAqL1xuICByZXNldEFnZ3JlZ2F0aW9uICgpIHtcblxuICB9XG5cbiAgaW5pdCAocmVxdWlyZSkge1xuICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgIHJlcXVpcmUoJ1gtQXhpcycsICdjaGFydCcsIGZ1bmN0aW9uICh4LCBjaGFydCkge1xuICAgICAgc2VsZi54ID0geDtcbiAgICAgIHNlbGYuY2hhcnQgPSBjaGFydDtcbiAgICB9KTtcblxuICAgIHRoaXMuZ2V0QXZhaWxhYmxlbEFnZ3JlYWdhdGlvbigpO1xuICAgIHRoaXMuZ2V0VmFsaWRBZ2dyZWdhdGlvbigpO1xuICB9XG5cbiAgcGxhY2VJbkNhbnZhcyAoKSB7XG4gICAgLy8gc3BhY2UgbWFuYWdlbWVudFxuICB9XG5cbiAgZHJhdyAoKSB7XG4gICAgLy8gZHJhdyBleHRlbnNpb25cbiAgfVxuXG4gIGRpc3Bvc2UgKCkge1xuICAgIC8vIGRpc3Bvc2UgZXh0ZW5zaW9uXG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBBZ2dyZWdhdG9yO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIC4vc3JjL2ZjdHMtZXh0LWFnZ3JlZ2F0b3IuanMiXSwic291cmNlUm9vdCI6IiJ9