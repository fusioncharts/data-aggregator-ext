!function(e){function t(o){if(i[o])return i[o].exports;var n=i[o]={exports:{},id:o,loaded:!1};return e[o].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t,i){(function(e){"use strict";var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=i(2);!function(i,o){"object"===t(e)&&e.exports?e.exports=i.document?o(i):function(e){if(!e.document)throw new Error("Window with document not present");return o(e,!0)}:i.Aggregator=o(i,!0)}("undefined"!=typeof window?window:void 0,function(e,t){var i=e.FusionCharts;i.register("extension",["private","data-aggregator",function(){i.registerComponent("extensions","data-aggregator",o({FC:i}))}])})}).call(t,i(1)(e))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children=[],e.webpackPolyfill=1),e}},function(e,t){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};e.exports=function(e){var t=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},a=function(e){return"object"===("undefined"==typeof e?"undefined":n(e))&&e.constructor===Object},r=function e(t,i,o){var r;for(r in i)r in t?"object"===n(i[r])&&e(t[r],i[r],o):a(i[r])?t[r]=o.extend2({},i[r]):t[r]=i[r]};Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(e,t){if(null==this)throw new TypeError('"this" is null or not defined');var i=Object(this),o=i.length>>>0;if(0===o)return!1;for(var n=0|t,a=Math.max(n>=0?n:o-Math.abs(n),0);a<o;){if(i[a]===e)return!0;a++}return!1}});var l=function(){function n(){i(this,n),this.appliedAggregation={binSize:null,aggregationMethod:null},this.config={}}return o(n,[{key:"getAvailablelAggreagation",value:function(){var e,t,i=this.config,o=i.dataAgg,n=i.avlTimePeriods=o.getAggregationTimeRules();for(i.avlTimeMultiplier=[],t=n.length,e=0;e<t;e++)i.avlTimeMultiplier.push(n[e].possibleFactors)}},{key:"getValidAggregation",value:function(){var e,t,i,o,n,a,r,l,s,g,u,d,c,f,p=this,m=p.config,h=p.tsObject,v=m.dataAgg,b=m.composition.reactiveModel.model["max-plot-point"],y=h.globalReactiveModel.model["min-plot-point"],M=m.composition.dataset.category.minimumConsecutiveDifference,x=h.globalReactiveModel;for(m.currentTimeLength=x.model["x-axis-visible-range-end"]-x.model["x-axis-visible-range-start"],n=m.avlTimePeriods,a=m.avlTimeMultiplier,l=m.currentTimeLength,c=l/b,f=l/y,m.validTimePeriod=[],m.validTimePeriodMultiplier=[],m.avlAggMethods=v.getAllAggregationMethod(),e=0,i=n.length;e<i;e++){for(s=n[e].name,g=n[e].interval,r=[],t=0,o=a[e].length;t<o;t++)d=a[e][t],u=d*g,u>=c&&u>M&&u<=f&&r.push(a[e][t]);r.length>0&&(m.validTimePeriodMultiplier.push(r),m.validTimePeriod.push(s))}}},{key:"getCurrentAggreation",value:function(){var e,t,i,o=this,n=o.config,a=n.dataAgg,r=n.composition,l=r.reactiveModel;return i=l.prop("bin-size")-1,isFinite(i)&&(t=a.timeRules.getSuitableInterval(i),e=l.prop("aggregation-fn")),{timePeriod:t&&t.name||n.lowestUnit.timePeriod,timePeriodMultiplier:t&&t.step,aggregationMethod:{value:e&&e.nickName,text:e&&e.formalName}}}},{key:"init",value:function(t){var i,o,n,a,r=this,l=r.config,s=l.toolboxComponent={},g="tsObject",u=["graphics","globalReactiveModel","chart","spaceManagerInstance","chartInstance","smartLabel","extData","parentGroup","lib",function(){var e=0,t=u.length-1,i="";for(r[g]=r[g]||{},r.requiredParams={},e=0;e<t;++e)i=u[e],r[g][i]=arguments[e]}];return t(u),i=r.tsObject,l.usrConfig=i.extData,o=i.chartInstance.apiInstance,n=o.getComponentStore(),l.composition=a=n.getCanvasByIndex(0).composition,l.dataAgg=a.impl.getDataAggregator(),s.toolbox=e.FC.getComponent("api","toolbox"),s.config={},r.toolbars=[],r.measurement={},r.toolbars.push(r.createToolbar()),a.reactiveModel.onPropsChange(["bin-size","aggregation-fn"],function(){l.execute&&(l.execute=!1,setTimeout(function(){r.rangeOnChange()},200))}),window.Aggregator=r,r}},{key:"createToolbar",value:function(){function e(e,t,i){var o;for(var n in e)v[t][n]&&(o=i&&v[t][n].states&&v[t][n].states[i]?v[t][n].states[i]:v[t][n].style),o&&C.cssAddRule("."+e[n],o)}function t(t,i,o){var n=w[t]=i(o).setConfig(v[t].attrs);n.setParentGroup(G),n.setConfig({className:v[t].className}),n.namespace("fusioncharts"),n.appendSelector("ext1-"+R++),e(n.getIndividualClassNames(n.getClassName()),t);var a=n.config.states;for(var r in a)e(n.getIndividualClassNames(a[r]),t,r);var l=n.config.dropDownMenu;for(var s in l){var g=l[s];switch(s){case"container":C.cssAddRule("."+g.className,v.dropDown.container.style);break;case"listItem":C.cssAddRule("."+g.className,v.dropDown.listItem.style);var u=g.states;for(var d in u)C.cssAddRule("."+u[d],v.dropDown.listItem.states[d].style)}}for(var c=v[t].eventListeners,f=0,p=c.length;f<p;f+=1){var m=c[f],h={};h[m.type]=m.cb,n.attachEventHandlers(h)}return n}function i(e){return t(e,T.selectButton,[])}function o(e){return t(e,T.button,v[e].attrs.label)}var n,a,l,s,g,u,d,c,f,p,m,h,v,b=this,y=b.config,M=b.tsObject,x=y.toolboxComponent,S=x.toolbox,w=x.config,P=S.HorizontalToolbar,k=S.ComponentGroup,A=M.graphics,C=A.paper,T=C.getInstances().d3,L=A.container,N=M.chart,z=M.smartLabel,O={paper:C,chart:N,smartLabel:z,chartContainer:L},I=function(){var e,t,i,o,n,a=u.value(),r=g.value(),l=r,s=y.validTimePeriod,d=y.validTimePeriodMultiplier,c=0;for(e=s.indexOf(a),t=d[e].indexOf(Number(r)),m=[],n=d[e],c=0,o=n.length;c<o;c++)i=n[c],m.push({name:i.toString(),value:i.toString()});g.updateList(m),t<0?g.value(d[e][0].toString()):g.value(l)},j=function(e){var t=b.getCurrentAggreation();t.timePeriodMultiplier=t.timePeriodMultiplier&&t.timePeriodMultiplier.toString(),t.timePeriodMultiplier!==g.value()||t.timePeriod!==u.value()||t.aggregationMethod.value!==d.value()?f.removeState("disabled"):f.setState("disabled"),d.value()||d.value(y.defaultAggMethod),u.value()&&g.value()||(u.value(y.validTimePeriod[0]),I())};n=new k(O,{hPadding:4}),a=new k(O,{hPadding:0}),l=new k(O,{hPadding:0}),s=new P(O),h=y.usrConfig;var F={container:{style:{fill:"#fff",stroke:"#c8cecd","stroke-width":"1"},states:{selected:{stroke:"#1e1f1f"},hover:{cursor:"pointer"}}},text:{style:{fill:"#696969","font-size":"11px","font-family":'"Lucida Grande", sans-serif'}},arrow:{style:{fill:"#696969"}},attrs:{radius:2,width:50,height:22,margin:{right:3}}},D={label:{className:"data-aggregator-"+C.getId(),container:{height:22,style:{}},margin:{right:2},text:{style:{"font-size":"13px","font-family":'"Lucida Grande", sans-serif',fill:"#696969","font-weight":"bold"}}},timeMulSelectMenu:{container:F.container,text:F.text,arrow:F.arrow,attrs:{radius:2,width:50,height:22,margin:{right:3,left:0},padding:{left:10,right:8}},eventListeners:[{type:"change",cb:j}]},timePeriodSelectMenu:{container:F.container,text:F.text,arrow:F.arrow,attrs:{radius:2,width:90,height:22,margin:{right:9,left:0},padding:{left:10,right:8}},eventListeners:[{type:"change",cb:function(){I(),j()}}]},aggMethodSelectMenu:{container:F.container,text:F.text,arrow:F.arrow,attrs:{radius:2,width:100,height:22,margin:{right:8,left:0},padding:{left:10,right:8}},eventListeners:[{type:"change",cb:j}]},dropDown:{container:{style:{background:"#fff","border-color":"#898b8b","border-radius":"2px","border-style":"solid","border-width":"1px","font-size":"11px","font-family":'"Lucida Grande", sans-serif',"box-shadow":"rgb(153, 153, 153) 0px 0px 5px"}},listItem:{style:{},states:{hover:{className:void 0,style:{background:"#e6e8e8",color:"#696969",cursor:"pointer"}},selected:{className:void 0,style:{background:"#898b8b",color:"#fff"}}}}},applyButton:{container:{style:{fill:"#555",stroke:"#ced5d4","stroke-width":0},states:{disabled:{fill:"#bebebe","stroke-width":0,stroke:"#ced5d4"},hover:{cursor:"pointer"}}},text:{style:{fill:"#f3f3f3",fontSize:"11px",fontFamily:'"Lucida Grande", sans-serif'},states:{disabled:{fill:"#f3f3f3"}}},attrs:{radius:1,width:54,height:22,margin:{right:3,left:0},label:"APPLY"},eventListeners:[{type:"click",cb:function(){b.apply(1)}}]},resetButton:{container:{style:{fill:"#898b8b",stroke:"#ced5d4",strokeWidth:0},states:{hover:{cursor:"pointer"},disabled:{fill:"#bebebe","stroke-width":0,stroke:"#ced5d4",cursor:"default"}}},text:{style:{fill:"#f3f3f3",fontSize:"11px",fontFamily:'"Lucida Grande", sans-serif'},states:{disabled:{fill:"#f3f3f3"}}},attrs:{radius:1,shadow:{fill:"#000",opacity:.35},width:54,height:22,margin:{right:3,left:0},label:"RESET"},eventListeners:[{type:"click",cb:function(){b.apply(0)}}]}};v=D,h.styles&&(r(h.styles,D,this.tsObject.lib),v=h.styles),p=new S.Label("Aggregate Data:",O,v.label),p.setConfig({className:v.label.className}),e(p.getIndividualClassNames(p.getClassName()),"label");var G=M.parentGroup,R=0;return n.addSymbol(p),n.setConfig({margin:{right:0}}),g=i("timeMulSelectMenu"),u=i("timePeriodSelectMenu"),d=i("aggMethodSelectMenu"),f=o("applyButton"),c=o("resetButton"),a.addSymbol(g),a.addSymbol(u),a.addSymbol(d),l.addSymbol(f),l.addSymbol(c),s.addComponent(n),s.addComponent(a),s.addComponent(l),s}},{key:"getLogicalSpace",value:function(e,t){var i,o,n,a=0,r=0;for(o=0,n=this.toolbars.length;o<n;o++)i=this.toolbars[o].getLogicalSpace(e,t),a=Math.max(i.width,a),r+=i.height,this.toolbars[o].width=i.width,this.toolbars[o].height=i.height;return r+=this.padding,{width:a,height:r}}},{key:"placeInCanvas",value:function(e){var t=this,i=t.tsObject,o=t.config.usrConfig;t.padding=5,i.spaceManagerInstance.add([{name:function(){return"data-aggregator"},ref:function(e){return e[0]},self:function(){return t},priority:function(){return 2},layout:function(e){return e[o.layout||"inline"]},orientation:[{type:function(e){return e[o.orientation||"horizontal"]},position:[{type:function(e){return e[o.position||"bottom"]},alignment:[{type:function(e){return e[o.alignment||"right"]},dimensions:[function(){var e=this.getParentComponentGroup();return t.getLogicalSpace(e.getWidth(),e.getHeight())}]}]}]}]}])}},{key:"setDrawingConfiguration",value:function(e,t,i,o,n){var a=this.measurement;return a.x=e,a.y=t,a.width=i,a.height=o,this.parentGroup=n,this}},{key:"apply",value:function(e){var t,i,o,n,a,r,l,s,g,u,d,c,f,p,m,h=this,v=h.config,b=v.toolboxComponent.config,y=b.timePeriodSelectMenu,M=b.timeMulSelectMenu,x=b.aggMethodSelectMenu,S=b.applyButton,w=b.resetButton,P=h.tsObject.extData.aggregate||{},k=v.composition.reactiveModel,A=h.aggregation,C=v.composition.impl;if(e){if(v.drawn){for(l=y.value(),s=M.value(),g=x.value(),f=v.avlTimePeriods,p=0,m=f.length;p<m;p++)if(u=f[p],u.name===l){c=u.interval;break}d=c*Number(s),k.lock().prop("bin-size-ext",d).prop("aggregation-fn-ext",v.avlAggMethods[g]).unlock(),A.binSize=d,A.aggregationMethod=g,S.setState("disabled"),w.removeState("disabled")}else if(l=P.timeUnit&&P.timeUnit.toString().toLowerCase(),s=P.timeMultiplier,g=P.method&&P.method.toString(),h.getValidAggregation(),t=v.validTimePeriod,i=v.validTimePeriodMultiplier,o=v.avlAggMethods,t.includes(l)&&(n=t.indexOf(l),i[n].includes(Number(s))||(s=i[n][0]),a=!0),o[g]&&(r=!0),a||r){if(a){for(f=v.avlTimePeriods,p=0,m=f.length;p<m;p++)if(u=f[p],u.name===l){c=u.interval;break}d=c*Number(s),k.lock().prop("bin-size-ext",d).unlock(),A.binSize=d}r&&(k.lock().prop("aggregation-fn-ext",v.avlAggMethods[g]).unlock(),A.aggregationMethod=g),S.setState("disabled"),w.removeState("disabled")}}else C.resetAggregation(),A.binSize=null,A.aggregationMethod=null,w.setState("disabled")}},{key:"rangeOnChange",value:function(){var e,i,o,n,a,r,l,s,g,u,d,c,f,p,m,h,v,b=this,y=b.config,M=y.toolboxComponent.config,x=M.timePeriodSelectMenu,S=M.timeMulSelectMenu,w=M.aggMethodSelectMenu,P=M.applyButton,k=M.resetButton,A=y.composition.reactiveModel,C=y.composition.reactiveModel.model["max-plot-point"],T=b.tsObject.globalReactiveModel.model["min-plot-point"],L=y.currentTimeLength,N=L/C,z=L/T,O=A.prop("bin-size"),I=b.aggregation;for(b.getValidAggregation(),d=b.getCurrentAggreation(),c=d.timePeriod,f=d.timePeriodMultiplier,p=d.aggregationMethod,i=[],r=[],g=[],o=y.validTimePeriod,l=y.validTimePeriodMultiplier,u=y.avlAggMethods,P.setState("disabled"),null!==I.binSize&&(O<N||O>z)&&l.length>0&&(c=o[0]),I.binSize===O||p.value!==y.defaultAggMethod&&p.value?k.removeState("disabled"):(I.binSize=null,I.aggregationMethod=null,k.setState("disabled")),m=0,h=o.length;m<h;m++)e=o[m],i.push({name:t(e),value:e});if(x.updateList(i),c&&O?x.value(c):x.setPlaceHolderValue(t(y.lowestUnit.timePeriod)),n=o.indexOf(c),n>=0)for(v=l[n],m=0,h=v.length;m<h;m++)a=v[m],r.push({name:a.toString(),value:a.toString()});S.updateList(r),f?S.value(f.toString()):S.setPlaceHolderValue(y.lowestUnit.multiplier),null!==I.binSize&&(O<N?(S.value(l[0][0].toString()),x.value(o[0]),b.apply(1)):O>z&&(l.length>0?(S.value(l[0][l[0].length-1].toString()),x.value(o[0]),b.apply(1)):b.apply(0)));for(s in u)g.push({name:t(u[s].formalName),value:u[s].nickName});w.updateList(o.length>0?g:[]),p.value?w.value(p.value):w.setPlaceHolderValue("No Formula"),y.execute=!0}},{key:"draw",value:function(e,t,i,o,n){var a,r,l,s,g,u,d,c=this,f=c.config,p=c.measurement,m=c.toolbars,h=f.dataAgg,v=f.composition.dataset.category.minimumConsecutiveDifference,b=h.getAggregationTimeRules();if(c.getAvailablelAggreagation(),e=void 0===e?p.x:e,t=void 0===t?p.y:t,i=void 0===i?p.width:i,o=void 0===o?p.height:o,n=void 0===n?c.parentGroup:n,i&&o){for(r=0,a=m.length;r<a;r++)u=m[r],u.draw(e,t,n);for(f.defaultAggMethod=h.getDefaultAggregationMethod().nickName,!f.drawn&&c.apply(1),r=0,a=b.length;r<a;r++){if(d=v/b[r].interval,d>=b[r].possibleFactors[0]&&d<=b[r].possibleFactors[b[r].possibleFactors.length-1]){for(l=0;l<b[r].possibleFactors.length;l++)if(d===b[r].possibleFactors[l]||d<b[r].possibleFactors[l]){s=b[r].possibleFactors[l],g=b[r];break}break}if(d<1){s=1,g=b[r];break}}f.lowestUnit={multiplier:s&&s.toString(),timePeriod:g&&g.name},c.rangeOnChange(),f.drawn=!0}}},{key:"dispose",value:function(){}},{key:"aggregation",get:function(){return this.appliedAggregation},set:function(e){this.appliedAggregation.timePeriod=e.timePeriod,this.appliedAggregation.timePeriodMultiplier=e.timePeriodMultiplier,this.appliedAggregation.aggregationMethod=e.aggregationMethod}}]),n}();return l}}]);
//# sourceMappingURL=data-aggregator-es5.min.js.map