!function(e){function i(n){if(t[n])return t[n].exports;var r=t[n]={exports:{},id:n,loaded:!1};return e[n].call(r.exports,r,r.exports,i),r.loaded=!0,r.exports}var t={};return i.m=e,i.c=t,i.p="",i(0)}([function(e,i,t){"use strict";var n=t(1);!function(e){e(FusionCharts)}(function(e){e.register("extension",["data-aggregator",function(e){var i=this,t=i.extAPI;console.log(e),window.Aggregator=new n,t(window.Aggregator)}])})},function(e,i){"use strict";function t(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,i){for(var t=0;t<i.length;t++){var n=i[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(i,t,n){return t&&e(i.prototype,t),n&&e(i,n),i}}(),r=function(){function e(){t(this,e),this.appliedAggregation={timePeriod:null,timePeriodMultiplier:1,aggregationMethod:null},this.config={}}return n(e,[{key:"getAvailablelAggreagation",value:function(){var e,i,t,n,r=this.config,o=this.x,a=this.chart;e=a.getAvailableAggregationMethod(),i=a.getAvailableTimePeriod(),t=o.getCurrentVisibleRange(),n=t.endDate-t.startDate,r.avlTimePeriods=i,r.avlAggMethods=e,r.currentTimeLength=n}},{key:"getValidTimeMultiplier",value:function(){var e,i,t,n,r,o=this.config,a=this.x,l=a.max-a.min,g=o.avlTimePeriods,u=function(e){return Array.from({length:e},function(e,i){return i+1})};for(o.avlTimeMultiplier=[],i=g.length,e=0;e<i;e++)t=g[e],n=g[e+1],r=n?n[Object.keys(n)[0]]/t[Object.keys(t)[0]]:l/t[Object.keys(t)[0]],o.avlTimeMultiplier.push(u(r))}},{key:"getValidAggregation",value:function(){var e,i,t,n,r,o,a,l,g,u,s,c,d,h,f=this.chart.config,v=this.config,m=f.minNumOfPlot,p=f.minPlotWidth,A=f.canvasWidth,P=function(e){return Array.from({length:e},function(e,i){return i+1})};for(r=v.avlTimePeriods,o=v.avlTimeMultiplier,a=v.currentTimeLength,v.minTime=d=a/A*p,v.maxTime=h=a/m,v.validTimePeriod=[],v.validTimePeriodMultiplier=[],e=0,t=r.length;e<t;e++){for(l=Object.keys(r[e])[0],g=r[e][Object.keys(r[e])[0]],c=0,i=0,n=o[e].length;i<n;i++)s=o[e][i],u=s*g,u>=d&&u<=h&&c++;c&&(v.validTimePeriodMultiplier.push(P(c)),v.validTimePeriod.push(l))}console.log("Months: ",v.validTimePeriod),console.log("Number Of Multipliers: ",v.validTimePeriodMultiplier),console.log("Methods: ",v.avlAggMethods)}},{key:"setAggregation",value:function(e){var i,t,n,r,o=this.config;return i=o.avlAggMethods,t=o.validTimePeriod,r=o.validTimePeriodMultiplier,i.includes(e.aggregationMethod)&&t.includes(e.timePeriod)?(n=t.indexOf(e.timePeriod),r[n].includes(e.timePeriodMultiplier)?(this.aggregation=e,console.log(this.aggregation),!0):(console.log(this.aggregation),!1)):(console.log(this.aggregation),!1)}},{key:"resetAggregation",value:function(){}},{key:"init",value:function(e){var i=this;e("X-Axis","chart",function(e,t){i.x=e,i.chart=t}),this.getAvailablelAggreagation(),this.getValidTimeMultiplier(),this.getValidAggregation()}},{key:"placeInCanvas",value:function(){}},{key:"draw",value:function(){}},{key:"dispose",value:function(){}},{key:"aggregation",get:function(){return this.appliedAggregation},set:function(e){this.appliedAggregation.timePeriod=e.timePeriod,this.appliedAggregation.timePeriodMultiplier=e.timePeriodMultiplier,this.appliedAggregation.aggregationMethod=e.aggregationMethod}}]),e}();e.exports=r}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vZmN0cy1leHQtZGF0YWFnZ3JlZ2F0b3ItZXM1Lm1pbi5qcyIsIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAgNWMzYWRhZWZjMGM2YjM4OTZmMzkiLCJ3ZWJwYWNrOi8vLy4vc3JjL2luZGV4LmpzIiwid2VicGFjazovLy8uL3NyYy9mY3RzLWV4dC1hZ2dyZWdhdG9yLmpzIl0sIm5hbWVzIjpbIm1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJpbnN0YWxsZWRNb2R1bGVzIiwiZXhwb3J0cyIsIm1vZHVsZSIsImlkIiwibG9hZGVkIiwiY2FsbCIsIm0iLCJjIiwicCIsIkFnZ3JlZ2F0b3IiLCJmYWN0b3J5IiwiRnVzaW9uQ2hhcnRzIiwiRkMiLCJyZWdpc3RlciIsImdsb2JhbCIsInRoaXMiLCJleHRBUEkiLCJjb25zb2xlIiwibG9nIiwid2luZG93IiwiX2NsYXNzQ2FsbENoZWNrIiwiaW5zdGFuY2UiLCJDb25zdHJ1Y3RvciIsIlR5cGVFcnJvciIsIl9jcmVhdGVDbGFzcyIsImRlZmluZVByb3BlcnRpZXMiLCJ0YXJnZXQiLCJwcm9wcyIsImkiLCJsZW5ndGgiLCJkZXNjcmlwdG9yIiwiZW51bWVyYWJsZSIsImNvbmZpZ3VyYWJsZSIsIndyaXRhYmxlIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJrZXkiLCJwcm90b1Byb3BzIiwic3RhdGljUHJvcHMiLCJwcm90b3R5cGUiLCJhcHBsaWVkQWdncmVnYXRpb24iLCJ0aW1lUGVyaW9kIiwidGltZVBlcmlvZE11bHRpcGxpZXIiLCJhZ2dyZWdhdGlvbk1ldGhvZCIsImNvbmZpZyIsInZhbHVlIiwiYXZsQWdnTWV0aG9kcyIsImF2bFRpbWVQZXJpb2RzIiwiY3VycmVudFZpc2libGVSYW5nZSIsImN1cnJlbnRUaW1lTGVuZ3RoIiwieEF4aXMiLCJ4IiwiY2hhcnQiLCJnZXRBdmFpbGFibGVBZ2dyZWdhdGlvbk1ldGhvZCIsImdldEF2YWlsYWJsZVRpbWVQZXJpb2QiLCJnZXRDdXJyZW50VmlzaWJsZVJhbmdlIiwiZW5kRGF0ZSIsInN0YXJ0RGF0ZSIsImxlbiIsImN1cnJUaW1lUGVyaW9kIiwibmV4dFRpbWVQZXJpb2QiLCJudW1PZk11bHRpcGxpZXIiLCJtYXgiLCJtaW4iLCJnZXRNdWx0aXBsaWVyQXJyYXkiLCJudW0iLCJBcnJheSIsImZyb20iLCJ2IiwiayIsImF2bFRpbWVNdWx0aXBsaWVyIiwia2V5cyIsInB1c2giLCJqIiwibGVuMSIsImxlbjIiLCJ0aW1lIiwiZXhwZWN0ZWRUaW1lIiwibXVsdGlwbGllciIsIm11bHRpcGxpZXJDb3VudGVyIiwibWluVGltZSIsIm1heFRpbWUiLCJjaGFydENvbmZpZyIsIm1pbk51bU9mUGxvdCIsIm1pblBsb3RXaWR0aCIsImNhbnZhc1dpZHRoIiwidmFsaWRUaW1lUGVyaW9kIiwidmFsaWRUaW1lUGVyaW9kTXVsdGlwbGllciIsIm9iaiIsInRpbWVQZXJpb2RJbmRleCIsImluY2x1ZGVzIiwiaW5kZXhPZiIsImFnZ3JlZ2F0aW9uIiwicmVxdWlyZSIsInNlbGYiLCJnZXRBdmFpbGFibGVsQWdncmVhZ2F0aW9uIiwiZ2V0VmFsaWRUaW1lTXVsdGlwbGllciIsImdldFZhbGlkQWdncmVnYXRpb24iLCJnZXQiLCJzZXQiXSwibWFwcGluZ3MiOiJDQUFTLFNBQVVBLEdDSW5CLFFBQUFDLEdBQUFDLEdBR0EsR0FBQUMsRUFBQUQsR0FDQSxNQUFBQyxHQUFBRCxHQUFBRSxPQUdBLElBQUFDLEdBQUFGLEVBQUFELElBQ0FFLFdBQ0FFLEdBQUFKLEVBQ0FLLFFBQUEsRUFVQSxPQU5BUCxHQUFBRSxHQUFBTSxLQUFBSCxFQUFBRCxRQUFBQyxJQUFBRCxRQUFBSCxHQUdBSSxFQUFBRSxRQUFBLEVBR0FGLEVBQUFELFFBdkJBLEdBQUFELEtBcUNBLE9BVEFGLEdBQUFRLEVBQUFULEVBR0FDLEVBQUFTLEVBQUFQLEVBR0FGLEVBQUFVLEVBQUEsR0FHQVYsRUFBQSxLRE1NLFNBQVNJLEVBQVFELEVBQVNILEdFNUNoQyxZ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QkksU0FBU0YsRUFBSS9DLGFBQ2hGZ0QsRUFBa0JILEVBQWdCSyxRQUFRSCxFQUFJL0MsWUFDMUM4QyxFQUEwQkUsR0FBaUJDLFNBQVNGLEVBQUk5Qyx1QkFDMUQzQixLQUFLNkUsWUFBY0osRUFDbkJ2RSxRQUFRQyxJQUFJSCxLQUFLNkUsY0FDVixJQUVQM0UsUUFBUUMsSUFBSUgsS0FBSzZFLGNBQ1YsS0FHVDNFLFFBQVFDLElBQUlILEtBQUs2RSxjQUNWLE1Ia0dSeEQsSUFBSyxtQkFDTFMsTUFBTyxlQUVQVCxJQUFLLE9BQ0xTLE1BQU8sU0czRkpnRCxHQUNKLEdBQUlDLEdBQU8vRSxJQUVYOEUsR0FBUSxTQUFVLFFBQVMsU0FBVTFDLEVBQUdDLEdBQ3RDMEMsRUFBSzNDLEVBQUlBLEVBQ1QyQyxFQUFLMUMsTUFBUUEsSUFHZnJDLEtBQUtnRiw0QkFDTGhGLEtBQUtpRix5QkFDTGpGLEtBQUtrRix5Qkg4Rko3RCxJQUFLLGdCQUNMUyxNQUFPLGVBSVBULElBQUssT0FDTFMsTUFBTyxlQUlQVCxJQUFLLFVBQ0xTLE1BQU8sZUFJUFQsSUFBSyxjQUNMOEQsSUFBSyxXRy9STixNQUFPbkYsTUFBS3lCLG9CSGtTWDJELElBQUssU0cvUlNYLEdBQ2Z6RSxLQUFLeUIsbUJBQW1CQyxXQUFhK0MsRUFBSS9DLFdBQ3pDMUIsS0FBS3lCLG1CQUFtQkUscUJBQXVCOEMsRUFBSTlDLHFCQUNuRDNCLEtBQUt5QixtQkFBbUJHLGtCQUFvQjZDLEVBQUk3QyxzQkhtUzFDbEMsSUd4R1ZQLEdBQU9ELFFBQVVRIiwiZmlsZSI6ImZjdHMtZXh0LWRhdGFhZ2dyZWdhdG9yLWVzNS5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKioqKioqLyAoZnVuY3Rpb24obW9kdWxlcykgeyAvLyB3ZWJwYWNrQm9vdHN0cmFwXG4vKioqKioqLyBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbi8qKioqKiovIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcbi8qKioqKiovXG4vKioqKioqLyBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4vKioqKioqLyBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcbi8qKioqKiovXG4vKioqKioqLyBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4vKioqKioqLyBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pXG4vKioqKioqLyBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbi8qKioqKiovXG4vKioqKioqLyBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbi8qKioqKiovIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4vKioqKioqLyBcdFx0XHRleHBvcnRzOiB7fSxcbi8qKioqKiovIFx0XHRcdGlkOiBtb2R1bGVJZCxcbi8qKioqKiovIFx0XHRcdGxvYWRlZDogZmFsc2Vcbi8qKioqKiovIFx0XHR9O1xuLyoqKioqKi9cbi8qKioqKiovIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbi8qKioqKiovIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcbi8qKioqKiovXG4vKioqKioqLyBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuLyoqKioqKi8gXHRcdG1vZHVsZS5sb2FkZWQgPSB0cnVlO1xuLyoqKioqKi9cbi8qKioqKiovIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuLyoqKioqKi8gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbi8qKioqKiovIFx0fVxuLyoqKioqKi9cbi8qKioqKiovXG4vKioqKioqLyBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4vKioqKioqLyBcdF9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7XG4vKioqKioqL1xuLyoqKioqKi8gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuLyoqKioqKi8gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuLyoqKioqKi9cbi8qKioqKiovIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbi8qKioqKiovIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcbi8qKioqKiovXG4vKioqKioqLyBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuLyoqKioqKi8gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXygwKTtcbi8qKioqKiovIH0pXG4vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuLyoqKioqKi8gKFtcbi8qIDAgKi9cbi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykge1xuXG5cdCd1c2Ugc3RyaWN0Jztcblx0XG5cdHZhciBBZ2dyZWdhdG9yID0gX193ZWJwYWNrX3JlcXVpcmVfXygxKTtcblx0XG5cdDsoZnVuY3Rpb24gKGZhY3RvcnkpIHtcblx0ICBmYWN0b3J5KEZ1c2lvbkNoYXJ0cyk7XG5cdH0pKGZ1bmN0aW9uIChGQykge1xuXHQgIEZDLnJlZ2lzdGVyKCdleHRlbnNpb24nLCBbJ2RhdGEtYWdncmVnYXRvcicsIGZ1bmN0aW9uIChpZCkge1xuXHQgICAgdmFyIGdsb2JhbCA9IHRoaXM7XG5cdCAgICB2YXIgZXh0QVBJID0gZ2xvYmFsLmV4dEFQSTtcblx0ICAgIGNvbnNvbGUubG9nKGlkKTtcblx0XG5cdCAgICAvLyB2YXIgb3RoZXJBUEkgPSBGdXNpb25DaGFydHMuZ2V0RXh0Q29tcG9uZW50KGlkLCAnYXBpJywgJ2xlZ2FjeWV4dGFwaScpO1xuXHQgICAgLy8gdmFyIHRvb2xCb3hBcGkgPSBGdXNpb25DaGFydHMuZ2V0Q29tcG9uZW50KCdhcGknLCAndG9vbGJveCcpO1xuXHRcblx0ICAgIHdpbmRvdy5BZ2dyZWdhdG9yID0gbmV3IEFnZ3JlZ2F0b3IoKTtcblx0XG5cdCAgICBleHRBUEkod2luZG93LkFnZ3JlZ2F0b3IpO1xuXHQgIH1dKTtcblx0fSk7XG5cbi8qKiovIH0sXG4vKiAxICovXG4vKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHtcblxuXHQndXNlIHN0cmljdCc7XG5cdC8qKlxuXHQgKiBDbGFzcyByZXByZXNlbnRpbmcgdGhlIERhdGEgQWdncmVnYXRvci5cblx0ICovXG5cdFxuXHR2YXIgX2NyZWF0ZUNsYXNzID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKFwidmFsdWVcIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSgpO1xuXHRcblx0ZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uXCIpOyB9IH1cblx0XG5cdHZhciBBZ2dyZWdhdG9yID0gZnVuY3Rpb24gKCkge1xuXHQgIC8qKlxuXHQgICAqIENyZWF0ZSBhIEFnZ3JlZ2F0b3IuXG5cdCAgICogQHR5cGVkZWYge29iamVjdH0gQWdncmVnYXRvci5hZ2dyZWdhdGlvblxuXHQgICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSB0aW1lUGVyaW9kIC0gVGhlIHRpbWUgaW50ZXJ2YWwgb2YgYWdncmVnYXRpb24uXG5cdCAgICogQHByb3BlcnR5IHtudW1iZXJ9IHRpbWVQZXJpb2RNdWx0aXBsaWVyIC0gVGhlIG11bHRpcGxpZXIgb2YgdGltZSBpbnRlcnZhbC5cblx0ICAgKiBAcHJvcGVydHkge3N0cmluZ30gYWdncmVnYXRpb25NZXRob2QgLSBUaGUgbWV0aG9kIGFwcGxpZWQgdG8gYWdncmVnYXRlLlxuXHQgICAqL1xuXHQgIGZ1bmN0aW9uIEFnZ3JlZ2F0b3IoKSB7XG5cdCAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgQWdncmVnYXRvcik7XG5cdFxuXHQgICAgLyoqXG5cdCAgICAgKiBAcHJpdmF0ZVxuXHQgICAgICovXG5cdCAgICB0aGlzLmFwcGxpZWRBZ2dyZWdhdGlvbiA9IHtcblx0ICAgICAgdGltZVBlcmlvZDogbnVsbCxcblx0ICAgICAgdGltZVBlcmlvZE11bHRpcGxpZXI6IDEsXG5cdCAgICAgIGFnZ3JlZ2F0aW9uTWV0aG9kOiBudWxsXG5cdCAgICB9O1xuXHQgICAgdGhpcy5jb25maWcgPSB7fTtcblx0ICB9XG5cdFxuXHQgIC8qKlxuXHQgICAqIEFuIG9iamVjdCByZXByZXNlbnRpbmcgdGhlIHRpbWVQZXJpb2QsIHRpbWVQZXJpb2RNdWx0aXBsaWVyLCBhZ2dyZWdhdGlvbk1ldGhvZC5cblx0ICAgKiBAdHlwZSB7QWdncmVnYXRvci5hZ2dyZWdhdGlvbn1cblx0ICAgKi9cblx0XG5cdFxuXHQgIF9jcmVhdGVDbGFzcyhBZ2dyZWdhdG9yLCBbe1xuXHQgICAga2V5OiAnZ2V0QXZhaWxhYmxlbEFnZ3JlYWdhdGlvbicsXG5cdFxuXHRcblx0ICAgIC8qKlxuXHQgICAgICogU2V0cyBhdmFpbGFibGUgYWdncmVnYXRpb24gb3B0aW9ucyBpbiBjb25maWd1cmF0aW9uIG9mIGV4dGVuc2lvblxuXHQgICAgICogQHByaXZhdGVcblx0ICAgICAqL1xuXHQgICAgdmFsdWU6IGZ1bmN0aW9uIGdldEF2YWlsYWJsZWxBZ2dyZWFnYXRpb24oKSB7XG5cdCAgICAgIHZhciBjb25maWcgPSB0aGlzLmNvbmZpZyxcblx0ICAgICAgICAgIGF2bEFnZ01ldGhvZHMsXG5cdCAgICAgICAgICBhdmxUaW1lUGVyaW9kcyxcblx0ICAgICAgICAgIGN1cnJlbnRWaXNpYmxlUmFuZ2UsXG5cdCAgICAgICAgICBjdXJyZW50VGltZUxlbmd0aCxcblx0ICAgICAgICAgIHhBeGlzID0gdGhpcy54LFxuXHQgICAgICAgICAgY2hhcnQgPSB0aGlzLmNoYXJ0O1xuXHRcblx0ICAgICAgYXZsQWdnTWV0aG9kcyA9IGNoYXJ0LmdldEF2YWlsYWJsZUFnZ3JlZ2F0aW9uTWV0aG9kKCk7XG5cdCAgICAgIGF2bFRpbWVQZXJpb2RzID0gY2hhcnQuZ2V0QXZhaWxhYmxlVGltZVBlcmlvZCgpO1xuXHRcblx0ICAgICAgY3VycmVudFZpc2libGVSYW5nZSA9IHhBeGlzLmdldEN1cnJlbnRWaXNpYmxlUmFuZ2UoKTtcblx0ICAgICAgY3VycmVudFRpbWVMZW5ndGggPSBjdXJyZW50VmlzaWJsZVJhbmdlLmVuZERhdGUgLSBjdXJyZW50VmlzaWJsZVJhbmdlLnN0YXJ0RGF0ZTtcblx0XG5cdCAgICAgIGNvbmZpZy5hdmxUaW1lUGVyaW9kcyA9IGF2bFRpbWVQZXJpb2RzO1xuXHQgICAgICBjb25maWcuYXZsQWdnTWV0aG9kcyA9IGF2bEFnZ01ldGhvZHM7XG5cdCAgICAgIGNvbmZpZy5jdXJyZW50VGltZUxlbmd0aCA9IGN1cnJlbnRUaW1lTGVuZ3RoO1xuXHQgICAgfVxuXHRcblx0ICAgIC8qKlxuXHQgICAgICogQ2FsY3VsYXRlcyB2YWxpZCB0aW1lIG11bHRpcGxpZXJzIG9mIGF2YWlsYWJsZSB0aW1lIHBlcmlvZHNcblx0ICAgICAqIEBwcml2YXRlXG5cdCAgICAgKi9cblx0XG5cdCAgfSwge1xuXHQgICAga2V5OiAnZ2V0VmFsaWRUaW1lTXVsdGlwbGllcicsXG5cdCAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0VmFsaWRUaW1lTXVsdGlwbGllcigpIHtcblx0ICAgICAgdmFyIGNvbmZpZyA9IHRoaXMuY29uZmlnLFxuXHQgICAgICAgICAgeEF4aXMgPSB0aGlzLngsXG5cdCAgICAgICAgICBpLFxuXHQgICAgICAgICAgbGVuLFxuXHQgICAgICAgICAgY3VyclRpbWVQZXJpb2QsXG5cdCAgICAgICAgICBuZXh0VGltZVBlcmlvZCxcblx0ICAgICAgICAgIG51bU9mTXVsdGlwbGllcixcblx0ICAgICAgICAgIGN1cnJlbnRUaW1lTGVuZ3RoID0geEF4aXMubWF4IC0geEF4aXMubWluLFxuXHQgICAgICAgICAgYXZsVGltZVBlcmlvZHMgPSBjb25maWcuYXZsVGltZVBlcmlvZHMsXG5cdCAgICAgICAgICBnZXRNdWx0aXBsaWVyQXJyYXkgPSBmdW5jdGlvbiBnZXRNdWx0aXBsaWVyQXJyYXkobnVtKSB7XG5cdCAgICAgICAgcmV0dXJuIEFycmF5LmZyb20oeyBsZW5ndGg6IG51bSB9LCBmdW5jdGlvbiAodiwgaykge1xuXHQgICAgICAgICAgcmV0dXJuIGsgKyAxO1xuXHQgICAgICAgIH0pO1xuXHQgICAgICB9O1xuXHRcblx0ICAgICAgY29uZmlnLmF2bFRpbWVNdWx0aXBsaWVyID0gW107XG5cdCAgICAgIGxlbiA9IGF2bFRpbWVQZXJpb2RzLmxlbmd0aDtcblx0XG5cdCAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW47IGkrKykge1xuXHQgICAgICAgIGN1cnJUaW1lUGVyaW9kID0gYXZsVGltZVBlcmlvZHNbaV07XG5cdCAgICAgICAgbmV4dFRpbWVQZXJpb2QgPSBhdmxUaW1lUGVyaW9kc1tpICsgMV07XG5cdFxuXHQgICAgICAgIGlmIChuZXh0VGltZVBlcmlvZCkge1xuXHQgICAgICAgICAgbnVtT2ZNdWx0aXBsaWVyID0gbmV4dFRpbWVQZXJpb2RbT2JqZWN0LmtleXMobmV4dFRpbWVQZXJpb2QpWzBdXSAvIGN1cnJUaW1lUGVyaW9kW09iamVjdC5rZXlzKGN1cnJUaW1lUGVyaW9kKVswXV07XG5cdCAgICAgICAgfSBlbHNlIHtcblx0ICAgICAgICAgIG51bU9mTXVsdGlwbGllciA9IGN1cnJlbnRUaW1lTGVuZ3RoIC8gY3VyclRpbWVQZXJpb2RbT2JqZWN0LmtleXMoY3VyclRpbWVQZXJpb2QpWzBdXTtcblx0ICAgICAgICB9XG5cdCAgICAgICAgY29uZmlnLmF2bFRpbWVNdWx0aXBsaWVyLnB1c2goZ2V0TXVsdGlwbGllckFycmF5KG51bU9mTXVsdGlwbGllcikpO1xuXHQgICAgICB9XG5cdCAgICB9XG5cdFxuXHQgICAgLyoqXG5cdCAgICAgKiBDYWxjdWxhdGVzIHZhbGlkIGFnZ3JlZ2F0aW9uIHRpbWUgcGVyaW9kcyBhbmQgY29ycmVzcG9uZGluZyBtdWx0aXBsaWVyc1xuXHQgICAgICogQHByaXZhdGVcblx0ICAgICAqL1xuXHRcblx0ICB9LCB7XG5cdCAgICBrZXk6ICdnZXRWYWxpZEFnZ3JlZ2F0aW9uJyxcblx0ICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRWYWxpZEFnZ3JlZ2F0aW9uKCkge1xuXHQgICAgICB2YXIgY2hhcnRDb25maWcgPSB0aGlzLmNoYXJ0LmNvbmZpZyxcblx0ICAgICAgICAgIGNvbmZpZyA9IHRoaXMuY29uZmlnLFxuXHQgICAgICAgICAgaSxcblx0ICAgICAgICAgIGosXG5cdCAgICAgICAgICBsZW4xLFxuXHQgICAgICAgICAgbGVuMixcblx0ICAgICAgICAgIGF2bFRpbWVQZXJpb2RzLFxuXHQgICAgICAgICAgYXZsVGltZU11bHRpcGxpZXIsXG5cdCAgICAgICAgICBtaW5OdW1PZlBsb3QgPSBjaGFydENvbmZpZy5taW5OdW1PZlBsb3QsXG5cdCAgICAgICAgICBtaW5QbG90V2lkdGggPSBjaGFydENvbmZpZy5taW5QbG90V2lkdGgsXG5cdCAgICAgICAgICBjYW52YXNXaWR0aCA9IGNoYXJ0Q29uZmlnLmNhbnZhc1dpZHRoLFxuXHQgICAgICAgICAgY3VycmVudFRpbWVMZW5ndGgsXG5cdCAgICAgICAgICB0aW1lUGVyaW9kLFxuXHQgICAgICAgICAgdGltZSxcblx0ICAgICAgICAgIGV4cGVjdGVkVGltZSxcblx0ICAgICAgICAgIG11bHRpcGxpZXIsXG5cdCAgICAgICAgICBtdWx0aXBsaWVyQ291bnRlcixcblx0ICAgICAgICAgIGdldE11bHRpcGxpZXJBcnJheSA9IGZ1bmN0aW9uIGdldE11bHRpcGxpZXJBcnJheShudW0pIHtcblx0ICAgICAgICByZXR1cm4gQXJyYXkuZnJvbSh7IGxlbmd0aDogbnVtIH0sIGZ1bmN0aW9uICh2LCBrKSB7XG5cdCAgICAgICAgICByZXR1cm4gayArIDE7XG5cdCAgICAgICAgfSk7XG5cdCAgICAgIH0sXG5cdCAgICAgICAgICBtaW5UaW1lLFxuXHQgICAgICAgICAgbWF4VGltZTtcblx0XG5cdCAgICAgIGF2bFRpbWVQZXJpb2RzID0gY29uZmlnLmF2bFRpbWVQZXJpb2RzO1xuXHQgICAgICBhdmxUaW1lTXVsdGlwbGllciA9IGNvbmZpZy5hdmxUaW1lTXVsdGlwbGllcjtcblx0ICAgICAgY3VycmVudFRpbWVMZW5ndGggPSBjb25maWcuY3VycmVudFRpbWVMZW5ndGg7XG5cdFxuXHQgICAgICBjb25maWcubWluVGltZSA9IG1pblRpbWUgPSBjdXJyZW50VGltZUxlbmd0aCAvIGNhbnZhc1dpZHRoICogbWluUGxvdFdpZHRoO1xuXHQgICAgICBjb25maWcubWF4VGltZSA9IG1heFRpbWUgPSBjdXJyZW50VGltZUxlbmd0aCAvIG1pbk51bU9mUGxvdDtcblx0XG5cdCAgICAgIGNvbmZpZy52YWxpZFRpbWVQZXJpb2QgPSBbXTtcblx0ICAgICAgY29uZmlnLnZhbGlkVGltZVBlcmlvZE11bHRpcGxpZXIgPSBbXTtcblx0XG5cdCAgICAgIGZvciAoaSA9IDAsIGxlbjEgPSBhdmxUaW1lUGVyaW9kcy5sZW5ndGg7IGkgPCBsZW4xOyBpKyspIHtcblx0ICAgICAgICB0aW1lUGVyaW9kID0gT2JqZWN0LmtleXMoYXZsVGltZVBlcmlvZHNbaV0pWzBdO1xuXHQgICAgICAgIHRpbWUgPSBhdmxUaW1lUGVyaW9kc1tpXVtPYmplY3Qua2V5cyhhdmxUaW1lUGVyaW9kc1tpXSlbMF1dO1xuXHQgICAgICAgIG11bHRpcGxpZXJDb3VudGVyID0gMDtcblx0XG5cdCAgICAgICAgZm9yIChqID0gMCwgbGVuMiA9IGF2bFRpbWVNdWx0aXBsaWVyW2ldLmxlbmd0aDsgaiA8IGxlbjI7IGorKykge1xuXHQgICAgICAgICAgbXVsdGlwbGllciA9IGF2bFRpbWVNdWx0aXBsaWVyW2ldW2pdO1xuXHQgICAgICAgICAgZXhwZWN0ZWRUaW1lID0gbXVsdGlwbGllciAqIHRpbWU7XG5cdFxuXHQgICAgICAgICAgaWYgKGV4cGVjdGVkVGltZSA+PSBtaW5UaW1lICYmIGV4cGVjdGVkVGltZSA8PSBtYXhUaW1lKSB7XG5cdCAgICAgICAgICAgIG11bHRpcGxpZXJDb3VudGVyKys7XG5cdCAgICAgICAgICB9XG5cdCAgICAgICAgfVxuXHQgICAgICAgIGlmIChtdWx0aXBsaWVyQ291bnRlcikge1xuXHQgICAgICAgICAgY29uZmlnLnZhbGlkVGltZVBlcmlvZE11bHRpcGxpZXIucHVzaChnZXRNdWx0aXBsaWVyQXJyYXkobXVsdGlwbGllckNvdW50ZXIpKTtcblx0ICAgICAgICAgIGNvbmZpZy52YWxpZFRpbWVQZXJpb2QucHVzaCh0aW1lUGVyaW9kKTtcblx0ICAgICAgICB9XG5cdCAgICAgIH1cblx0ICAgICAgY29uc29sZS5sb2coJ01vbnRoczogJywgY29uZmlnLnZhbGlkVGltZVBlcmlvZCk7XG5cdCAgICAgIGNvbnNvbGUubG9nKCdOdW1iZXIgT2YgTXVsdGlwbGllcnM6ICcsIGNvbmZpZy52YWxpZFRpbWVQZXJpb2RNdWx0aXBsaWVyKTtcblx0ICAgICAgY29uc29sZS5sb2coJ01ldGhvZHM6ICcsIGNvbmZpZy5hdmxBZ2dNZXRob2RzKTtcblx0ICAgIH1cblx0XG5cdCAgICAvKipcblx0ICAgICAqIFNldCBBZ2dyZWdhdGlvbiBvbiB0aW1lIHNlcmllc1xuXHQgICAgICogQHBhcmFtICB7b2JqZWN0fSBvYmpcblx0ICAgICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSB0aW1lUGVyaW9kIC0gVGhlIHRpbWUgaW50ZXJ2YWwgb2YgYWdncmVnYXRpb24uXG5cdCAgICAgKiBAcHJvcGVydHkge251bWJlcn0gdGltZVBlcmlvZE11bHRpcGxpZXIgLSBUaGUgbXVsdGlwbGllciBvZiB0aW1lIGludGVydmFsLlxuXHQgICAgICogQHByb3BlcnR5IHtzdHJpbmd9IGFnZ3JlZ2F0aW9uTWV0aG9kIC0gVGhlIG1ldGhvZCBhcHBsaWVkIHRvIGFnZ3JlZ2F0ZS5cblx0ICAgICAqL1xuXHRcblx0ICB9LCB7XG5cdCAgICBrZXk6ICdzZXRBZ2dyZWdhdGlvbicsXG5cdCAgICB2YWx1ZTogZnVuY3Rpb24gc2V0QWdncmVnYXRpb24ob2JqKSB7XG5cdCAgICAgIHZhciBhdmxBZ2dNZXRob2RzLFxuXHQgICAgICAgICAgdmFsaWRUaW1lUGVyaW9kLFxuXHQgICAgICAgICAgdGltZVBlcmlvZEluZGV4LFxuXHQgICAgICAgICAgdmFsaWRUaW1lUGVyaW9kTXVsdGlwbGllcixcblx0ICAgICAgICAgIGNvbmZpZyA9IHRoaXMuY29uZmlnO1xuXHRcblx0ICAgICAgYXZsQWdnTWV0aG9kcyA9IGNvbmZpZy5hdmxBZ2dNZXRob2RzO1xuXHQgICAgICB2YWxpZFRpbWVQZXJpb2QgPSBjb25maWcudmFsaWRUaW1lUGVyaW9kO1xuXHQgICAgICB2YWxpZFRpbWVQZXJpb2RNdWx0aXBsaWVyID0gY29uZmlnLnZhbGlkVGltZVBlcmlvZE11bHRpcGxpZXI7XG5cdFxuXHQgICAgICBpZiAoYXZsQWdnTWV0aG9kcy5pbmNsdWRlcyhvYmouYWdncmVnYXRpb25NZXRob2QpICYmIHZhbGlkVGltZVBlcmlvZC5pbmNsdWRlcyhvYmoudGltZVBlcmlvZCkpIHtcblx0ICAgICAgICB0aW1lUGVyaW9kSW5kZXggPSB2YWxpZFRpbWVQZXJpb2QuaW5kZXhPZihvYmoudGltZVBlcmlvZCk7XG5cdCAgICAgICAgaWYgKHZhbGlkVGltZVBlcmlvZE11bHRpcGxpZXJbdGltZVBlcmlvZEluZGV4XS5pbmNsdWRlcyhvYmoudGltZVBlcmlvZE11bHRpcGxpZXIpKSB7XG5cdCAgICAgICAgICB0aGlzLmFnZ3JlZ2F0aW9uID0gb2JqO1xuXHQgICAgICAgICAgY29uc29sZS5sb2codGhpcy5hZ2dyZWdhdGlvbik7XG5cdCAgICAgICAgICByZXR1cm4gdHJ1ZTtcblx0ICAgICAgICB9IGVsc2Uge1xuXHQgICAgICAgICAgY29uc29sZS5sb2codGhpcy5hZ2dyZWdhdGlvbik7XG5cdCAgICAgICAgICByZXR1cm4gZmFsc2U7XG5cdCAgICAgICAgfVxuXHQgICAgICB9IGVsc2Uge1xuXHQgICAgICAgIGNvbnNvbGUubG9nKHRoaXMuYWdncmVnYXRpb24pO1xuXHQgICAgICAgIHJldHVybiBmYWxzZTtcblx0ICAgICAgfVxuXHQgICAgfVxuXHRcblx0ICAgIC8qKlxuXHQgICAgICogUmVzZXQgQXBwbGllZCBBZ2dyZWdhdGlvblxuXHQgICAgICovXG5cdFxuXHQgIH0sIHtcblx0ICAgIGtleTogJ3Jlc2V0QWdncmVnYXRpb24nLFxuXHQgICAgdmFsdWU6IGZ1bmN0aW9uIHJlc2V0QWdncmVnYXRpb24oKSB7fVxuXHQgIH0sIHtcblx0ICAgIGtleTogJ2luaXQnLFxuXHQgICAgdmFsdWU6IGZ1bmN0aW9uIGluaXQocmVxdWlyZSkge1xuXHQgICAgICB2YXIgc2VsZiA9IHRoaXM7XG5cdFxuXHQgICAgICByZXF1aXJlKCdYLUF4aXMnLCAnY2hhcnQnLCBmdW5jdGlvbiAoeCwgY2hhcnQpIHtcblx0ICAgICAgICBzZWxmLnggPSB4O1xuXHQgICAgICAgIHNlbGYuY2hhcnQgPSBjaGFydDtcblx0ICAgICAgfSk7XG5cdFxuXHQgICAgICB0aGlzLmdldEF2YWlsYWJsZWxBZ2dyZWFnYXRpb24oKTtcblx0ICAgICAgdGhpcy5nZXRWYWxpZFRpbWVNdWx0aXBsaWVyKCk7XG5cdCAgICAgIHRoaXMuZ2V0VmFsaWRBZ2dyZWdhdGlvbigpO1xuXHQgICAgfVxuXHQgIH0sIHtcblx0ICAgIGtleTogJ3BsYWNlSW5DYW52YXMnLFxuXHQgICAgdmFsdWU6IGZ1bmN0aW9uIHBsYWNlSW5DYW52YXMoKSB7XG5cdCAgICAgIC8vIHNwYWNlIG1hbmFnZW1lbnRcblx0ICAgIH1cblx0ICB9LCB7XG5cdCAgICBrZXk6ICdkcmF3Jyxcblx0ICAgIHZhbHVlOiBmdW5jdGlvbiBkcmF3KCkge1xuXHQgICAgICAvLyBkcmF3IGV4dGVuc2lvblxuXHQgICAgfVxuXHQgIH0sIHtcblx0ICAgIGtleTogJ2Rpc3Bvc2UnLFxuXHQgICAgdmFsdWU6IGZ1bmN0aW9uIGRpc3Bvc2UoKSB7XG5cdCAgICAgIC8vIGRpc3Bvc2UgZXh0ZW5zaW9uXG5cdCAgICB9XG5cdCAgfSwge1xuXHQgICAga2V5OiAnYWdncmVnYXRpb24nLFxuXHQgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7XG5cdCAgICAgIHJldHVybiB0aGlzLmFwcGxpZWRBZ2dyZWdhdGlvbjtcblx0ICAgIH0sXG5cdCAgICBzZXQ6IGZ1bmN0aW9uIHNldChvYmopIHtcblx0ICAgICAgdGhpcy5hcHBsaWVkQWdncmVnYXRpb24udGltZVBlcmlvZCA9IG9iai50aW1lUGVyaW9kO1xuXHQgICAgICB0aGlzLmFwcGxpZWRBZ2dyZWdhdGlvbi50aW1lUGVyaW9kTXVsdGlwbGllciA9IG9iai50aW1lUGVyaW9kTXVsdGlwbGllcjtcblx0ICAgICAgdGhpcy5hcHBsaWVkQWdncmVnYXRpb24uYWdncmVnYXRpb25NZXRob2QgPSBvYmouYWdncmVnYXRpb25NZXRob2Q7XG5cdCAgICB9XG5cdCAgfV0pO1xuXHRcblx0ICByZXR1cm4gQWdncmVnYXRvcjtcblx0fSgpO1xuXHRcblx0bW9kdWxlLmV4cG9ydHMgPSBBZ2dyZWdhdG9yO1xuXG4vKioqLyB9XG4vKioqKioqLyBdKTtcblxuXG4vKiogV0VCUEFDSyBGT09URVIgKipcbiAqKiBmY3RzLWV4dC1kYXRhYWdncmVnYXRvci1lczUubWluLmpzXG4gKiovIiwiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pXG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG5cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGV4cG9ydHM6IHt9LFxuIFx0XHRcdGlkOiBtb2R1bGVJZCxcbiBcdFx0XHRsb2FkZWQ6IGZhbHNlXG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmxvYWRlZCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oMCk7XG5cblxuXG4vKiogV0VCUEFDSyBGT09URVIgKipcbiAqKiB3ZWJwYWNrL2Jvb3RzdHJhcCA1YzNhZGFlZmMwYzZiMzg5NmYzOVxuICoqLyIsIid1c2Ugc3RyaWN0JztcbmNvbnN0IEFnZ3JlZ2F0b3IgPSByZXF1aXJlKCcuL2ZjdHMtZXh0LWFnZ3JlZ2F0b3InKTtcblxuOyhmdW5jdGlvbiAoZmFjdG9yeSkge1xuICBmYWN0b3J5KEZ1c2lvbkNoYXJ0cyk7XG59KShmdW5jdGlvbiAoRkMpIHtcbiAgRkMucmVnaXN0ZXIoJ2V4dGVuc2lvbicsIFsnZGF0YS1hZ2dyZWdhdG9yJywgZnVuY3Rpb24gKGlkKSB7XG4gICAgdmFyIGdsb2JhbCA9IHRoaXM7XG4gICAgdmFyIGV4dEFQSSA9IGdsb2JhbC5leHRBUEk7XG4gICAgY29uc29sZS5sb2coaWQpO1xuXG4gICAgLy8gdmFyIG90aGVyQVBJID0gRnVzaW9uQ2hhcnRzLmdldEV4dENvbXBvbmVudChpZCwgJ2FwaScsICdsZWdhY3lleHRhcGknKTtcbiAgICAvLyB2YXIgdG9vbEJveEFwaSA9IEZ1c2lvbkNoYXJ0cy5nZXRDb21wb25lbnQoJ2FwaScsICd0b29sYm94Jyk7XG5cbiAgICB3aW5kb3cuQWdncmVnYXRvciA9IG5ldyBBZ2dyZWdhdG9yKCk7XG5cbiAgICBleHRBUEkod2luZG93LkFnZ3JlZ2F0b3IpO1xuICB9XSk7XG59KTtcblxuXG5cbi8qKiBXRUJQQUNLIEZPT1RFUiAqKlxuICoqIC4vc3JjL2luZGV4LmpzXG4gKiovIiwiJ3VzZSBzdHJpY3QnO1xuLyoqXG4gKiBDbGFzcyByZXByZXNlbnRpbmcgdGhlIERhdGEgQWdncmVnYXRvci5cbiAqL1xuY2xhc3MgQWdncmVnYXRvciB7XG4gIC8qKlxuICAgKiBDcmVhdGUgYSBBZ2dyZWdhdG9yLlxuICAgKiBAdHlwZWRlZiB7b2JqZWN0fSBBZ2dyZWdhdG9yLmFnZ3JlZ2F0aW9uXG4gICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSB0aW1lUGVyaW9kIC0gVGhlIHRpbWUgaW50ZXJ2YWwgb2YgYWdncmVnYXRpb24uXG4gICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSB0aW1lUGVyaW9kTXVsdGlwbGllciAtIFRoZSBtdWx0aXBsaWVyIG9mIHRpbWUgaW50ZXJ2YWwuXG4gICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBhZ2dyZWdhdGlvbk1ldGhvZCAtIFRoZSBtZXRob2QgYXBwbGllZCB0byBhZ2dyZWdhdGUuXG4gICAqL1xuICBjb25zdHJ1Y3RvciAoKSB7XG4gICAgLyoqXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICB0aGlzLmFwcGxpZWRBZ2dyZWdhdGlvbiA9IHtcbiAgICAgIHRpbWVQZXJpb2Q6IG51bGwsXG4gICAgICB0aW1lUGVyaW9kTXVsdGlwbGllcjogMSxcbiAgICAgIGFnZ3JlZ2F0aW9uTWV0aG9kOiBudWxsXG4gICAgfTtcbiAgICB0aGlzLmNvbmZpZyA9IHt9O1xuICB9XG5cbiAgLyoqXG4gICAqIEFuIG9iamVjdCByZXByZXNlbnRpbmcgdGhlIHRpbWVQZXJpb2QsIHRpbWVQZXJpb2RNdWx0aXBsaWVyLCBhZ2dyZWdhdGlvbk1ldGhvZC5cbiAgICogQHR5cGUge0FnZ3JlZ2F0b3IuYWdncmVnYXRpb259XG4gICAqL1xuICBnZXQgYWdncmVnYXRpb24gKCkge1xuICAgIHJldHVybiB0aGlzLmFwcGxpZWRBZ2dyZWdhdGlvbjtcbiAgfVxuXG4gIHNldCBhZ2dyZWdhdGlvbiAob2JqKSB7XG4gICAgdGhpcy5hcHBsaWVkQWdncmVnYXRpb24udGltZVBlcmlvZCA9IG9iai50aW1lUGVyaW9kO1xuICAgIHRoaXMuYXBwbGllZEFnZ3JlZ2F0aW9uLnRpbWVQZXJpb2RNdWx0aXBsaWVyID0gb2JqLnRpbWVQZXJpb2RNdWx0aXBsaWVyO1xuICAgIHRoaXMuYXBwbGllZEFnZ3JlZ2F0aW9uLmFnZ3JlZ2F0aW9uTWV0aG9kID0gb2JqLmFnZ3JlZ2F0aW9uTWV0aG9kO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldHMgYXZhaWxhYmxlIGFnZ3JlZ2F0aW9uIG9wdGlvbnMgaW4gY29uZmlndXJhdGlvbiBvZiBleHRlbnNpb25cbiAgICogQHByaXZhdGVcbiAgICovXG4gIGdldEF2YWlsYWJsZWxBZ2dyZWFnYXRpb24gKCkge1xuICAgIHZhciBjb25maWcgPSB0aGlzLmNvbmZpZyxcbiAgICAgIGF2bEFnZ01ldGhvZHMsXG4gICAgICBhdmxUaW1lUGVyaW9kcyxcbiAgICAgIGN1cnJlbnRWaXNpYmxlUmFuZ2UsXG4gICAgICBjdXJyZW50VGltZUxlbmd0aCxcbiAgICAgIHhBeGlzID0gdGhpcy54LFxuICAgICAgY2hhcnQgPSB0aGlzLmNoYXJ0O1xuXG4gICAgYXZsQWdnTWV0aG9kcyA9IGNoYXJ0LmdldEF2YWlsYWJsZUFnZ3JlZ2F0aW9uTWV0aG9kKCk7XG4gICAgYXZsVGltZVBlcmlvZHMgPSBjaGFydC5nZXRBdmFpbGFibGVUaW1lUGVyaW9kKCk7XG5cbiAgICBjdXJyZW50VmlzaWJsZVJhbmdlID0geEF4aXMuZ2V0Q3VycmVudFZpc2libGVSYW5nZSgpO1xuICAgIGN1cnJlbnRUaW1lTGVuZ3RoID0gY3VycmVudFZpc2libGVSYW5nZS5lbmREYXRlIC0gY3VycmVudFZpc2libGVSYW5nZS5zdGFydERhdGU7XG5cbiAgICBjb25maWcuYXZsVGltZVBlcmlvZHMgPSBhdmxUaW1lUGVyaW9kcztcbiAgICBjb25maWcuYXZsQWdnTWV0aG9kcyA9IGF2bEFnZ01ldGhvZHM7XG4gICAgY29uZmlnLmN1cnJlbnRUaW1lTGVuZ3RoID0gY3VycmVudFRpbWVMZW5ndGg7XG4gIH1cblxuICAvKipcbiAgICogQ2FsY3VsYXRlcyB2YWxpZCB0aW1lIG11bHRpcGxpZXJzIG9mIGF2YWlsYWJsZSB0aW1lIHBlcmlvZHNcbiAgICogQHByaXZhdGVcbiAgICovXG4gIGdldFZhbGlkVGltZU11bHRpcGxpZXIgKCkge1xuICAgIHZhciBjb25maWcgPSB0aGlzLmNvbmZpZyxcbiAgICAgIHhBeGlzID0gdGhpcy54LFxuICAgICAgaSxcbiAgICAgIGxlbixcbiAgICAgIGN1cnJUaW1lUGVyaW9kLFxuICAgICAgbmV4dFRpbWVQZXJpb2QsXG4gICAgICBudW1PZk11bHRpcGxpZXIsXG4gICAgICBjdXJyZW50VGltZUxlbmd0aCA9IHhBeGlzLm1heCAtIHhBeGlzLm1pbixcbiAgICAgIGF2bFRpbWVQZXJpb2RzID0gY29uZmlnLmF2bFRpbWVQZXJpb2RzLFxuICAgICAgZ2V0TXVsdGlwbGllckFycmF5ID0gbnVtID0+IEFycmF5LmZyb20oe2xlbmd0aDogbnVtfSwgKHYsIGspID0+IGsgKyAxKTtcblxuICAgIGNvbmZpZy5hdmxUaW1lTXVsdGlwbGllciA9IFtdO1xuICAgIGxlbiA9IGF2bFRpbWVQZXJpb2RzLmxlbmd0aDtcblxuICAgIGZvciAoaSA9IDA7IGkgPCBsZW47IGkrKykge1xuICAgICAgY3VyclRpbWVQZXJpb2QgPSBhdmxUaW1lUGVyaW9kc1tpXTtcbiAgICAgIG5leHRUaW1lUGVyaW9kID0gYXZsVGltZVBlcmlvZHNbKGkgKyAxKV07XG5cbiAgICAgIGlmIChuZXh0VGltZVBlcmlvZCkge1xuICAgICAgICBudW1PZk11bHRpcGxpZXIgPVxuICAgICAgICAgIG5leHRUaW1lUGVyaW9kW09iamVjdC5rZXlzKG5leHRUaW1lUGVyaW9kKVswXV0gLyBjdXJyVGltZVBlcmlvZFtPYmplY3Qua2V5cyhjdXJyVGltZVBlcmlvZClbMF1dO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbnVtT2ZNdWx0aXBsaWVyID1cbiAgICAgICAgICBjdXJyZW50VGltZUxlbmd0aCAvIGN1cnJUaW1lUGVyaW9kW09iamVjdC5rZXlzKGN1cnJUaW1lUGVyaW9kKVswXV07XG4gICAgICB9XG4gICAgICBjb25maWcuYXZsVGltZU11bHRpcGxpZXIucHVzaChnZXRNdWx0aXBsaWVyQXJyYXkobnVtT2ZNdWx0aXBsaWVyKSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENhbGN1bGF0ZXMgdmFsaWQgYWdncmVnYXRpb24gdGltZSBwZXJpb2RzIGFuZCBjb3JyZXNwb25kaW5nIG11bHRpcGxpZXJzXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBnZXRWYWxpZEFnZ3JlZ2F0aW9uICgpIHtcbiAgICB2YXIgY2hhcnRDb25maWcgPSB0aGlzLmNoYXJ0LmNvbmZpZyxcbiAgICAgIGNvbmZpZyA9IHRoaXMuY29uZmlnLFxuICAgICAgaSxcbiAgICAgIGosXG4gICAgICBsZW4xLFxuICAgICAgbGVuMixcbiAgICAgIGF2bFRpbWVQZXJpb2RzLFxuICAgICAgYXZsVGltZU11bHRpcGxpZXIsXG4gICAgICBtaW5OdW1PZlBsb3QgPSBjaGFydENvbmZpZy5taW5OdW1PZlBsb3QsXG4gICAgICBtaW5QbG90V2lkdGggPSBjaGFydENvbmZpZy5taW5QbG90V2lkdGgsXG4gICAgICBjYW52YXNXaWR0aCA9IGNoYXJ0Q29uZmlnLmNhbnZhc1dpZHRoLFxuICAgICAgY3VycmVudFRpbWVMZW5ndGgsXG4gICAgICB0aW1lUGVyaW9kLFxuICAgICAgdGltZSxcbiAgICAgIGV4cGVjdGVkVGltZSxcbiAgICAgIG11bHRpcGxpZXIsXG4gICAgICBtdWx0aXBsaWVyQ291bnRlcixcbiAgICAgIGdldE11bHRpcGxpZXJBcnJheSA9IG51bSA9PiBBcnJheS5mcm9tKHtsZW5ndGg6IG51bX0sICh2LCBrKSA9PiBrICsgMSksXG4gICAgICBtaW5UaW1lLFxuICAgICAgbWF4VGltZTtcblxuICAgIGF2bFRpbWVQZXJpb2RzID0gY29uZmlnLmF2bFRpbWVQZXJpb2RzO1xuICAgIGF2bFRpbWVNdWx0aXBsaWVyID0gY29uZmlnLmF2bFRpbWVNdWx0aXBsaWVyO1xuICAgIGN1cnJlbnRUaW1lTGVuZ3RoID0gY29uZmlnLmN1cnJlbnRUaW1lTGVuZ3RoO1xuXG4gICAgY29uZmlnLm1pblRpbWUgPSBtaW5UaW1lID0gKGN1cnJlbnRUaW1lTGVuZ3RoIC8gY2FudmFzV2lkdGgpICogbWluUGxvdFdpZHRoO1xuICAgIGNvbmZpZy5tYXhUaW1lID0gbWF4VGltZSA9IGN1cnJlbnRUaW1lTGVuZ3RoIC8gbWluTnVtT2ZQbG90O1xuXG4gICAgY29uZmlnLnZhbGlkVGltZVBlcmlvZCA9IFtdO1xuICAgIGNvbmZpZy52YWxpZFRpbWVQZXJpb2RNdWx0aXBsaWVyID0gW107XG5cbiAgICBmb3IgKGkgPSAwLCBsZW4xID0gYXZsVGltZVBlcmlvZHMubGVuZ3RoOyBpIDwgbGVuMTsgaSsrKSB7XG4gICAgICB0aW1lUGVyaW9kID0gT2JqZWN0LmtleXMoYXZsVGltZVBlcmlvZHNbaV0pWzBdO1xuICAgICAgdGltZSA9IGF2bFRpbWVQZXJpb2RzW2ldW09iamVjdC5rZXlzKGF2bFRpbWVQZXJpb2RzW2ldKVswXV07XG4gICAgICBtdWx0aXBsaWVyQ291bnRlciA9IDA7XG5cbiAgICAgIGZvciAoaiA9IDAsIGxlbjIgPSBhdmxUaW1lTXVsdGlwbGllcltpXS5sZW5ndGg7IGogPCBsZW4yOyBqKyspIHtcbiAgICAgICAgbXVsdGlwbGllciA9IGF2bFRpbWVNdWx0aXBsaWVyW2ldW2pdO1xuICAgICAgICBleHBlY3RlZFRpbWUgPSBtdWx0aXBsaWVyICogdGltZTtcblxuICAgICAgICBpZiAoKGV4cGVjdGVkVGltZSA+PSBtaW5UaW1lKSAmJiAoZXhwZWN0ZWRUaW1lIDw9IG1heFRpbWUpKSB7XG4gICAgICAgICAgbXVsdGlwbGllckNvdW50ZXIrKztcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKG11bHRpcGxpZXJDb3VudGVyKSB7XG4gICAgICAgIGNvbmZpZy52YWxpZFRpbWVQZXJpb2RNdWx0aXBsaWVyLnB1c2goZ2V0TXVsdGlwbGllckFycmF5KG11bHRpcGxpZXJDb3VudGVyKSk7XG4gICAgICAgIGNvbmZpZy52YWxpZFRpbWVQZXJpb2QucHVzaCh0aW1lUGVyaW9kKTtcbiAgICAgIH1cbiAgICB9XG4gICAgY29uc29sZS5sb2coJ01vbnRoczogJywgY29uZmlnLnZhbGlkVGltZVBlcmlvZCk7XG4gICAgY29uc29sZS5sb2coJ051bWJlciBPZiBNdWx0aXBsaWVyczogJywgY29uZmlnLnZhbGlkVGltZVBlcmlvZE11bHRpcGxpZXIpO1xuICAgIGNvbnNvbGUubG9nKCdNZXRob2RzOiAnLCBjb25maWcuYXZsQWdnTWV0aG9kcyk7XG4gIH1cblxuICAvKipcbiAgICogU2V0IEFnZ3JlZ2F0aW9uIG9uIHRpbWUgc2VyaWVzXG4gICAqIEBwYXJhbSAge29iamVjdH0gb2JqXG4gICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSB0aW1lUGVyaW9kIC0gVGhlIHRpbWUgaW50ZXJ2YWwgb2YgYWdncmVnYXRpb24uXG4gICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSB0aW1lUGVyaW9kTXVsdGlwbGllciAtIFRoZSBtdWx0aXBsaWVyIG9mIHRpbWUgaW50ZXJ2YWwuXG4gICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBhZ2dyZWdhdGlvbk1ldGhvZCAtIFRoZSBtZXRob2QgYXBwbGllZCB0byBhZ2dyZWdhdGUuXG4gICAqL1xuICBzZXRBZ2dyZWdhdGlvbiAob2JqKSB7XG4gICAgdmFyIGF2bEFnZ01ldGhvZHMsXG4gICAgICB2YWxpZFRpbWVQZXJpb2QsXG4gICAgICB0aW1lUGVyaW9kSW5kZXgsXG4gICAgICB2YWxpZFRpbWVQZXJpb2RNdWx0aXBsaWVyLFxuICAgICAgY29uZmlnID0gdGhpcy5jb25maWc7XG5cbiAgICBhdmxBZ2dNZXRob2RzID0gY29uZmlnLmF2bEFnZ01ldGhvZHM7XG4gICAgdmFsaWRUaW1lUGVyaW9kID0gY29uZmlnLnZhbGlkVGltZVBlcmlvZDtcbiAgICB2YWxpZFRpbWVQZXJpb2RNdWx0aXBsaWVyID0gY29uZmlnLnZhbGlkVGltZVBlcmlvZE11bHRpcGxpZXI7XG5cbiAgICBpZiAoYXZsQWdnTWV0aG9kcy5pbmNsdWRlcyhvYmouYWdncmVnYXRpb25NZXRob2QpICYmIHZhbGlkVGltZVBlcmlvZC5pbmNsdWRlcyhvYmoudGltZVBlcmlvZCkpIHtcbiAgICAgIHRpbWVQZXJpb2RJbmRleCA9IHZhbGlkVGltZVBlcmlvZC5pbmRleE9mKG9iai50aW1lUGVyaW9kKTtcbiAgICAgIGlmICh2YWxpZFRpbWVQZXJpb2RNdWx0aXBsaWVyW3RpbWVQZXJpb2RJbmRleF0uaW5jbHVkZXMob2JqLnRpbWVQZXJpb2RNdWx0aXBsaWVyKSkge1xuICAgICAgICB0aGlzLmFnZ3JlZ2F0aW9uID0gb2JqO1xuICAgICAgICBjb25zb2xlLmxvZyh0aGlzLmFnZ3JlZ2F0aW9uKTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zb2xlLmxvZyh0aGlzLmFnZ3JlZ2F0aW9uKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBjb25zb2xlLmxvZyh0aGlzLmFnZ3JlZ2F0aW9uKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmVzZXQgQXBwbGllZCBBZ2dyZWdhdGlvblxuICAgKi9cbiAgcmVzZXRBZ2dyZWdhdGlvbiAoKSB7XG5cbiAgfVxuXG4gIGluaXQgKHJlcXVpcmUpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICByZXF1aXJlKCdYLUF4aXMnLCAnY2hhcnQnLCBmdW5jdGlvbiAoeCwgY2hhcnQpIHtcbiAgICAgIHNlbGYueCA9IHg7XG4gICAgICBzZWxmLmNoYXJ0ID0gY2hhcnQ7XG4gICAgfSk7XG5cbiAgICB0aGlzLmdldEF2YWlsYWJsZWxBZ2dyZWFnYXRpb24oKTtcbiAgICB0aGlzLmdldFZhbGlkVGltZU11bHRpcGxpZXIoKTtcbiAgICB0aGlzLmdldFZhbGlkQWdncmVnYXRpb24oKTtcbiAgfVxuXG4gIHBsYWNlSW5DYW52YXMgKCkge1xuICAgIC8vIHNwYWNlIG1hbmFnZW1lbnRcbiAgfVxuXG4gIGRyYXcgKCkge1xuICAgIC8vIGRyYXcgZXh0ZW5zaW9uXG4gIH1cblxuICBkaXNwb3NlICgpIHtcbiAgICAvLyBkaXNwb3NlIGV4dGVuc2lvblxuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gQWdncmVnYXRvcjtcblxuXG5cbi8qKiBXRUJQQUNLIEZPT1RFUiAqKlxuICoqIC4vc3JjL2ZjdHMtZXh0LWFnZ3JlZ2F0b3IuanNcbiAqKi8iXSwic291cmNlUm9vdCI6IiJ9