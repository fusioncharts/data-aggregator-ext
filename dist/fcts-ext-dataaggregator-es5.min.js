!function(e){function i(n){if(t[n])return t[n].exports;var r=t[n]={exports:{},id:n,loaded:!1};return e[n].call(r.exports,r,r.exports,i),r.loaded=!0,r.exports}var t={};return i.m=e,i.c=t,i.p="",i(0)}([function(e,i,t){"use strict";var n=t(1),r=t(2);r.register("extension",["data-aggregator",function(e){var i=this,t=i.extAPI;console.log(e),t(new n)}])},function(e,i){(function(i){"use strict";function t(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,i){for(var t=0;t<i.length;t++){var n=i[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(i,t,n){return t&&e(i.prototype,t),n&&e(i,n),i}}(),r=function(){function e(){t(this,e),this.appliedAggregation={timePeriod:null,timePeriodMultiplier:1,aggregationMethod:null},this.config={}}return n(e,[{key:"getTimeMultiplier",value:function(){}},{key:"getAvailablelAggreagation",value:function(){var e,t,n,r,o=this.config,a=i.x,l=i.chart;e=l.getAvailableAggregationMethod(),t=t=l.getAvailableTimePeriod(),n=a.getCurrentVisibleRange(),r=n.endDate-n.startDate,o.avlTimePeriods=t,o.avlAggMethods=e,o.currentTimeLength=r}},{key:"getValidTimeMultiplier",value:function(){var e,t,n,r,o,a=this.config,l=i.x,g=l.max-l.min,u=a.avlTimePeriods,s=function(e){return Array.from({length:e},function(e,i){return i+1})};for(a.avlTimeMultiplier=[],t=u.length,e=0;e<t;e++)n=u[e],r=u[e+1],o=r?r[Object.keys(r)[0]]/n[Object.keys(n)[0]]:g/n[Object.keys(n)[0]],a.avlTimeMultiplier.push(s(o))}},{key:"getValidAggregation",value:function(){var e,t,n,r,o,a,l,g,u,s,c,d,f,h,m=i.chart.config,v=this.config,p=m.minNumOfPlot,P=m.minPlotWidth,A=m.canvasWidth,y=function(e){return Array.from({length:e},function(e,i){return i+1})};for(o=v.avlTimePeriods,a=v.avlTimeMultiplier,l=v.currentTimeLength,v.minTime=f=l/A*P,v.maxTime=h=l/p,v.validTimePeriod=[],v.validTimePeriodMultiplier=[],e=0,n=o.length;e<n;e++){for(g=Object.keys(o[e])[0],u=o[e][Object.keys(o[e])[0]],d=0,t=0,r=a[e].length;t<r;t++)c=a[e][t],s=c*u,s>=f&&s<=h&&d++;d&&(v.validTimePeriodMultiplier.push(y(d)),v.validTimePeriod.push(g))}console.log(v.validTimePeriod,v.validTimePeriodMultiplier,v.avlAggMethods)}},{key:"setAggregation",value:function(e){var i,t,n,r,o=this.config;return this.getValidAggregation(),i=o.avlAggMethods,t=o.validTimePeriod,r=o.validTimePeriodMultiplier,i.includes(e.aggregationMethod)&&t.includes(e.timePeriod)?(n=t.indexOf(e.timePeriod),r[n].includes(e.timePeriodMultiplier)?(this.aggregation=e,console.log(this.aggregation),!0):(console.log(this.aggregation),!1)):(console.log(this.aggregation),!1)}},{key:"resetAggregation",value:function(){}},{key:"init",value:function(e){e("X-Axis","chart",function(e,t){i.x=e,i.chart=t}),this.getAvailablelAggreagation(),this.getValidTimeMultiplier()}},{key:"placeInCanvas",value:function(){}},{key:"draw",value:function(){}},{key:"dispose",value:function(){}},{key:"aggregation",get:function(){return this.appliedAggregation},set:function(e){this.appliedAggregation.timePeriod=e.timePeriod,this.appliedAggregation.timePeriodMultiplier=e.timePeriodMultiplier,this.appliedAggregation.aggregationMethod=e.aggregationMethod}}]),e}();e.exports=r}).call(i,function(){return this}())},function(e,i){"use strict";var t=function(){};t.register=function(e,i){var t=i[0],n=i[1];console.log("Currently active extension: "+t),n.bind(this,565)()},t.getComponent=function(e,i){var t={x:24,y:56,width:100,height:20,index:4};return"api"===e&&"toolbox"===i?t:null},t.extAPI=function(e){e.init(function(){for(var e=[],i=arguments[arguments.length-1],t=function(){return["sum","average","custom"]},n=function(){return[{x:"100"},{y:"200"},{z:"1000"}]},r=function(){return{startDate:0,endDate:1e3}},o=0;o<arguments.length-1;o++)"X-Axis"===arguments[o]?e.push({getCurrentVisibleRange:r,min:0,max:2e3}):"chart"===arguments[o]&&e.push({getAvailableAggregationMethod:t,getAvailableTimePeriod:n,config:{minNumOfPlot:5,minPlotWidth:3,canvasWidth:1e3}});i.apply(this,e)}),e.placeInCanvas(),e.draw(),e.dispose(),e.setAggregation({timePeriod:"x",timePeriodMultiplier:2,aggregationMethod:"sum"})},e.exports=t}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vZmN0cy1leHQtZGF0YWFnZ3JlZ2F0b3ItZXM1Lm1pbi5qcyIsIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAgY2U2NDk5OWVhY2Y5YjFlYzQ3MjIiLCJ3ZWJwYWNrOi8vLy4vc3JjL2luZGV4LmpzIiwid2VicGFjazovLy8uL3NyYy9mY3RzLWV4dC1hZ2dyZWdhdG9yLmpzIiwid2VicGFjazovLy8uL2xpYi9mdXNpb25jaGFydHMuanMiXSwibmFtZXMiOlsibW9kdWxlcyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImluc3RhbGxlZE1vZHVsZXMiLCJleHBvcnRzIiwibW9kdWxlIiwiaWQiLCJsb2FkZWQiLCJjYWxsIiwibSIsImMiLCJwIiwiQWdncmVnYXRvciIsIkZ1c2lvbkNoYXJ0cyIsInJlZ2lzdGVyIiwiZ2xvYmFsIiwidGhpcyIsImV4dEFQSSIsImNvbnNvbGUiLCJsb2ciLCJfY2xhc3NDYWxsQ2hlY2siLCJpbnN0YW5jZSIsIkNvbnN0cnVjdG9yIiwiVHlwZUVycm9yIiwiX2NyZWF0ZUNsYXNzIiwiZGVmaW5lUHJvcGVydGllcyIsInRhcmdldCIsInByb3BzIiwiaSIsImxlbmd0aCIsImRlc2NyaXB0b3IiLCJlbnVtZXJhYmxlIiwiY29uZmlndXJhYmxlIiwid3JpdGFibGUiLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImtleSIsInByb3RvUHJvcHMiLCJzdGF0aWNQcm9wcyIsInByb3RvdHlwZSIsImFwcGxpZWRBZ2dyZWdhdGlvbiIsInRpbWVQZXJpb2QiLCJ0aW1lUGVyaW9kTXVsdGlwbGllciIsImFnZ3JlZ2F0aW9uTWV0aG9kIiwiY29uZmlnIiwidmFsdWUiLCJhdmxBZ2dNZXRob2RzIiwiYXZsVGltZVBlcmlvZHMiLCJjdXJyZW50VmlzaWJsZVJhbmdlIiwiY3VycmVudFRpbWVMZW5ndGgiLCJ4QXhpcyIsIngiLCJjaGFydCIsImdldEF2YWlsYWJsZUFnZ3JlZ2F0aW9uTWV0aG9kIiwiZ2V0QXZhaWxhYmxlVGltZVBlcmlvZCIsImdldEN1cnJlbnRWaXNpYmxlUmFuZ2UiLCJlbmREYXRlIiwic3RhcnREYXRlIiwibGVuIiwiY3VyclRpbWVQZXJpb2QiLCJuZXh0VGltZVBlcmlvZCIsIm51bU9mTXVsdGlwbGllciIsIm1heCIsIm1pbiIsImdldE11bHRpcGxpZXJBcnJheSIsIm51bSIsIkFycmF5IiwiZnJvbSIsInYiLCJrIiwiYXZsVGltZU11bHRpcGxpZXIiLCJrZXlzIiwicHVzaCIsImoiLCJsZW4xIiwibGVuMiIsInRpbWUiLCJleHBlY3RlZFRpbWUiLCJtdWx0aXBsaWVyIiwibXVsdGlwbGllckNvdW50ZXIiLCJtaW5UaW1lIiwibWF4VGltZSIsImNoYXJ0Q29uZmlnIiwibWluTnVtT2ZQbG90IiwibWluUGxvdFdpZHRoIiwiY2FudmFzV2lkdGgiLCJ2YWxpZFRpbWVQZXJpb2QiLCJ2YWxpZFRpbWVQZXJpb2RNdWx0aXBsaWVyIiwib2JqIiwidGltZVBlcmlvZEluZGV4IiwiZ2V0VmFsaWRBZ2dyZWdhdGlvbiIsImluY2x1ZGVzIiwiaW5kZXhPZiIsImFnZ3JlZ2F0aW9uIiwicmVxdWlyZSIsImdldEF2YWlsYWJsZWxBZ2dyZWFnYXRpb24iLCJnZXRWYWxpZFRpbWVNdWx0aXBsaWVyIiwiZ2V0Iiwic2V0IiwiZXh0IiwiYXJyIiwiZXh0TmFtZSIsImZuIiwiYmluZCIsImdldENvbXBvbmVudCIsImNvbXBvbmVudFR5cGUiLCJjb21wb25lbnROYW1lIiwidG9vbEJveCIsInkiLCJ3aWR0aCIsImhlaWdodCIsImluZGV4IiwiaW5pdCIsImFyZ3NUb0FwcGx5IiwiY2IiLCJhcmd1bWVudHMiLCJ6IiwiYXBwbHkiLCJwbGFjZUluQ2FudmFzIiwiZHJhdyIsImRpc3Bvc2UiLCJzZXRBZ2dyZWdhdGlvbiJdLCJtYXBwaW5ncyI6IkNBQVMsU0FBVUEsR0NJbkIsUUFBQUMsR0FBQUMsR0FHQSxHQUFBQyxFQUFBRCxHQUNBLE1BQUFDLEdBQUFELEdBQUFFLE9BR0EsSUFBQUMsR0FBQUYsRUFBQUQs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bi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKioqKiovIChmdW5jdGlvbihtb2R1bGVzKSB7IC8vIHdlYnBhY2tCb290c3RyYXBcbi8qKioqKiovIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuLyoqKioqKi8gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuLyoqKioqKi9cbi8qKioqKiovIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbi8qKioqKiovIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuLyoqKioqKi9cbi8qKioqKiovIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbi8qKioqKiovIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSlcbi8qKioqKiovIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuLyoqKioqKi9cbi8qKioqKiovIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuLyoqKioqKi8gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbi8qKioqKiovIFx0XHRcdGV4cG9ydHM6IHt9LFxuLyoqKioqKi8gXHRcdFx0aWQ6IG1vZHVsZUlkLFxuLyoqKioqKi8gXHRcdFx0bG9hZGVkOiBmYWxzZVxuLyoqKioqKi8gXHRcdH07XG4vKioqKioqL1xuLyoqKioqKi8gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuLyoqKioqKi8gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuLyoqKioqKi9cbi8qKioqKiovIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4vKioqKioqLyBcdFx0bW9kdWxlLmxvYWRlZCA9IHRydWU7XG4vKioqKioqL1xuLyoqKioqKi8gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4vKioqKioqLyBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuLyoqKioqKi8gXHR9XG4vKioqKioqL1xuLyoqKioqKi9cbi8qKioqKiovIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbi8qKioqKiovIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcbi8qKioqKiovXG4vKioqKioqLyBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4vKioqKioqLyBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG4vKioqKioqL1xuLyoqKioqKi8gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuLyoqKioqKi8gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiO1xuLyoqKioqKi9cbi8qKioqKiovIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4vKioqKioqLyBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKDApO1xuLyoqKioqKi8gfSlcbi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG4vKioqKioqLyAoW1xuLyogMCAqL1xuLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7XG5cblx0J3VzZSBzdHJpY3QnO1xuXHRcblx0dmFyIEFnZ3JlZ2F0b3IgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEpO1xuXHR2YXIgRnVzaW9uQ2hhcnRzID0gX193ZWJwYWNrX3JlcXVpcmVfXygyKTtcblx0XG5cdEZ1c2lvbkNoYXJ0cy5yZWdpc3RlcignZXh0ZW5zaW9uJywgWydkYXRhLWFnZ3JlZ2F0b3InLCBmdW5jdGlvbiAoaWQpIHtcblx0ICB2YXIgZ2xvYmFsID0gdGhpcztcblx0ICB2YXIgZXh0QVBJID0gZ2xvYmFsLmV4dEFQSTtcblx0ICBjb25zb2xlLmxvZyhpZCk7XG5cdFxuXHQgIC8vIHZhciBvdGhlckFQSSA9IEZ1c2lvbkNoYXJ0cy5nZXRFeHRDb21wb25lbnQoaWQsICdhcGknLCAnbGVnYWN5ZXh0YXBpJyk7XG5cdCAgLy8gdmFyIHRvb2xCb3hBcGkgPSBGdXNpb25DaGFydHMuZ2V0Q29tcG9uZW50KCdhcGknLCAndG9vbGJveCcpO1xuXHRcblx0ICBleHRBUEkobmV3IEFnZ3JlZ2F0b3IoKSk7XG5cdH1dKTtcblxuLyoqKi8gfSxcbi8qIDEgKi9cbi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cykge1xuXG5cdC8qIFdFQlBBQ0sgVkFSIElOSkVDVElPTiAqLyhmdW5jdGlvbihnbG9iYWwpIHsndXNlIHN0cmljdCc7XG5cdC8qKlxuXHQgKiBDbGFzcyByZXByZXNlbnRpbmcgdGhlIERhdGEgQWdncmVnYXRvci5cblx0ICovXG5cdFxuXHR2YXIgX2NyZWF0ZUNsYXNzID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKFwidmFsdWVcIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSgpO1xuXHRcblx0ZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uXCIpOyB9IH1cblx0XG5cdHZhciBBZ2dyZWdhdG9yID0gZnVuY3Rpb24gKCkge1xuXHQgIC8qKlxuXHQgICAqIENyZWF0ZSBhIEFnZ3JlZ2F0b3IuXG5cdCAgICogQHR5cGVkZWYge29iamVjdH0gQWdncmVnYXRvci5hZ2dyZWdhdGlvblxuXHQgICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSB0aW1lUGVyaW9kIC0gVGhlIHRpbWUgaW50ZXJ2YWwgb2YgYWdncmVnYXRpb24uXG5cdCAgICogQHByb3BlcnR5IHtudW1iZXJ9IHRpbWVQZXJpb2RNdWx0aXBsaWVyIC0gVGhlIG11bHRpcGxpZXIgb2YgdGltZSBpbnRlcnZhbC5cblx0ICAgKiBAcHJvcGVydHkge3N0cmluZ30gYWdncmVnYXRpb25NZXRob2QgLSBUaGUgbWV0aG9kIGFwcGxpZWQgdG8gYWdncmVnYXRlLlxuXHQgICAqL1xuXHQgIGZ1bmN0aW9uIEFnZ3JlZ2F0b3IoKSB7XG5cdCAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgQWdncmVnYXRvcik7XG5cdFxuXHQgICAgLyoqXG5cdCAgICAgKiBAcHJpdmF0ZVxuXHQgICAgICovXG5cdCAgICB0aGlzLmFwcGxpZWRBZ2dyZWdhdGlvbiA9IHtcblx0ICAgICAgdGltZVBlcmlvZDogbnVsbCxcblx0ICAgICAgdGltZVBlcmlvZE11bHRpcGxpZXI6IDEsXG5cdCAgICAgIGFnZ3JlZ2F0aW9uTWV0aG9kOiBudWxsXG5cdCAgICB9O1xuXHQgICAgdGhpcy5jb25maWcgPSB7fTtcblx0ICB9XG5cdFxuXHQgIC8qKlxuXHQgICAqIEFuIG9iamVjdCByZXByZXNlbnRpbmcgdGhlIHRpbWVQZXJpb2QsIHRpbWVQZXJpb2RNdWx0aXBsaWVyLCBhZ2dyZWdhdGlvbk1ldGhvZC5cblx0ICAgKiBAdHlwZSB7QWdncmVnYXRvci5hZ2dyZWdhdGlvbn1cblx0ICAgKi9cblx0XG5cdFxuXHQgIF9jcmVhdGVDbGFzcyhBZ2dyZWdhdG9yLCBbe1xuXHQgICAga2V5OiAnZ2V0VGltZU11bHRpcGxpZXInLFxuXHQgICAgdmFsdWU6IGZ1bmN0aW9uIGdldFRpbWVNdWx0aXBsaWVyKCkge31cblx0ICB9LCB7XG5cdCAgICBrZXk6ICdnZXRBdmFpbGFibGVsQWdncmVhZ2F0aW9uJyxcblx0ICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRBdmFpbGFibGVsQWdncmVhZ2F0aW9uKCkge1xuXHQgICAgICB2YXIgY29uZmlnID0gdGhpcy5jb25maWcsXG5cdCAgICAgICAgICBhdmxBZ2dNZXRob2RzLFxuXHQgICAgICAgICAgYXZsVGltZVBlcmlvZHMsXG5cdCAgICAgICAgICBjdXJyZW50VmlzaWJsZVJhbmdlLFxuXHQgICAgICAgICAgY3VycmVudFRpbWVMZW5ndGgsXG5cdCAgICAgICAgICB4QXhpcyA9IGdsb2JhbC54LFxuXHQgICAgICAgICAgY2hhcnQgPSBnbG9iYWwuY2hhcnQ7XG5cdFxuXHQgICAgICBhdmxBZ2dNZXRob2RzID0gY2hhcnQuZ2V0QXZhaWxhYmxlQWdncmVnYXRpb25NZXRob2QoKTtcblx0ICAgICAgYXZsVGltZVBlcmlvZHMgPSBhdmxUaW1lUGVyaW9kcyA9IGNoYXJ0LmdldEF2YWlsYWJsZVRpbWVQZXJpb2QoKTtcblx0XG5cdCAgICAgIGN1cnJlbnRWaXNpYmxlUmFuZ2UgPSB4QXhpcy5nZXRDdXJyZW50VmlzaWJsZVJhbmdlKCk7XG5cdCAgICAgIGN1cnJlbnRUaW1lTGVuZ3RoID0gY3VycmVudFZpc2libGVSYW5nZS5lbmREYXRlIC0gY3VycmVudFZpc2libGVSYW5nZS5zdGFydERhdGU7XG5cdFxuXHQgICAgICBjb25maWcuYXZsVGltZVBlcmlvZHMgPSBhdmxUaW1lUGVyaW9kcztcblx0ICAgICAgY29uZmlnLmF2bEFnZ01ldGhvZHMgPSBhdmxBZ2dNZXRob2RzO1xuXHQgICAgICBjb25maWcuY3VycmVudFRpbWVMZW5ndGggPSBjdXJyZW50VGltZUxlbmd0aDtcblx0ICAgIH1cblx0ICB9LCB7XG5cdCAgICBrZXk6ICdnZXRWYWxpZFRpbWVNdWx0aXBsaWVyJyxcblx0ICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRWYWxpZFRpbWVNdWx0aXBsaWVyKCkge1xuXHQgICAgICB2YXIgY29uZmlnID0gdGhpcy5jb25maWcsXG5cdCAgICAgICAgICB4QXhpcyA9IGdsb2JhbC54LFxuXHQgICAgICAgICAgaSxcblx0ICAgICAgICAgIGxlbixcblx0ICAgICAgICAgIGN1cnJUaW1lUGVyaW9kLFxuXHQgICAgICAgICAgbmV4dFRpbWVQZXJpb2QsXG5cdCAgICAgICAgICBudW1PZk11bHRpcGxpZXIsXG5cdCAgICAgICAgICBjdXJyZW50VGltZUxlbmd0aCA9IHhBeGlzLm1heCAtIHhBeGlzLm1pbixcblx0ICAgICAgICAgIGF2bFRpbWVQZXJpb2RzID0gY29uZmlnLmF2bFRpbWVQZXJpb2RzLFxuXHQgICAgICAgICAgZ2V0TXVsdGlwbGllckFycmF5ID0gZnVuY3Rpb24gZ2V0TXVsdGlwbGllckFycmF5KG51bSkge1xuXHQgICAgICAgIHJldHVybiBBcnJheS5mcm9tKHsgbGVuZ3RoOiBudW0gfSwgZnVuY3Rpb24gKHYsIGspIHtcblx0ICAgICAgICAgIHJldHVybiBrICsgMTtcblx0ICAgICAgICB9KTtcblx0ICAgICAgfTtcblx0XG5cdCAgICAgIGNvbmZpZy5hdmxUaW1lTXVsdGlwbGllciA9IFtdO1xuXHQgICAgICBsZW4gPSBhdmxUaW1lUGVyaW9kcy5sZW5ndGg7XG5cdFxuXHQgICAgICBmb3IgKGkgPSAwOyBpIDwgbGVuOyBpKyspIHtcblx0ICAgICAgICBjdXJyVGltZVBlcmlvZCA9IGF2bFRpbWVQZXJpb2RzW2ldO1xuXHQgICAgICAgIG5leHRUaW1lUGVyaW9kID0gYXZsVGltZVBlcmlvZHNbaSArIDFdO1xuXHRcblx0ICAgICAgICBpZiAobmV4dFRpbWVQZXJpb2QpIHtcblx0ICAgICAgICAgIG51bU9mTXVsdGlwbGllciA9IG5leHRUaW1lUGVyaW9kW09iamVjdC5rZXlzKG5leHRUaW1lUGVyaW9kKVswXV0gLyBjdXJyVGltZVBlcmlvZFtPYmplY3Qua2V5cyhjdXJyVGltZVBlcmlvZClbMF1dO1xuXHQgICAgICAgIH0gZWxzZSB7XG5cdCAgICAgICAgICBudW1PZk11bHRpcGxpZXIgPSBjdXJyZW50VGltZUxlbmd0aCAvIGN1cnJUaW1lUGVyaW9kW09iamVjdC5rZXlzKGN1cnJUaW1lUGVyaW9kKVswXV07XG5cdCAgICAgICAgfVxuXHQgICAgICAgIGNvbmZpZy5hdmxUaW1lTXVsdGlwbGllci5wdXNoKGdldE11bHRpcGxpZXJBcnJheShudW1PZk11bHRpcGxpZXIpKTtcblx0ICAgICAgfVxuXHQgICAgfVxuXHQgIH0sIHtcblx0ICAgIGtleTogJ2dldFZhbGlkQWdncmVnYXRpb24nLFxuXHQgICAgdmFsdWU6IGZ1bmN0aW9uIGdldFZhbGlkQWdncmVnYXRpb24oKSB7XG5cdCAgICAgIHZhciBjaGFydENvbmZpZyA9IGdsb2JhbC5jaGFydC5jb25maWcsXG5cdCAgICAgICAgICBjb25maWcgPSB0aGlzLmNvbmZpZyxcblx0ICAgICAgICAgIGksXG5cdCAgICAgICAgICBqLFxuXHQgICAgICAgICAgbGVuMSxcblx0ICAgICAgICAgIGxlbjIsXG5cdCAgICAgICAgICBhdmxUaW1lUGVyaW9kcyxcblx0ICAgICAgICAgIGF2bFRpbWVNdWx0aXBsaWVyLFxuXHQgICAgICAgICAgbWluTnVtT2ZQbG90ID0gY2hhcnRDb25maWcubWluTnVtT2ZQbG90LFxuXHQgICAgICAgICAgbWluUGxvdFdpZHRoID0gY2hhcnRDb25maWcubWluUGxvdFdpZHRoLFxuXHQgICAgICAgICAgY2FudmFzV2lkdGggPSBjaGFydENvbmZpZy5jYW52YXNXaWR0aCxcblx0ICAgICAgICAgIGN1cnJlbnRUaW1lTGVuZ3RoLFxuXHQgICAgICAgICAgdGltZVBlcmlvZCxcblx0ICAgICAgICAgIHRpbWUsXG5cdCAgICAgICAgICBleHBlY3RlZFRpbWUsXG5cdCAgICAgICAgICBtdWx0aXBsaWVyLFxuXHQgICAgICAgICAgbXVsdGlwbGllckNvdW50ZXIsXG5cdCAgICAgICAgICBnZXRNdWx0aXBsaWVyQXJyYXkgPSBmdW5jdGlvbiBnZXRNdWx0aXBsaWVyQXJyYXkobnVtKSB7XG5cdCAgICAgICAgcmV0dXJuIEFycmF5LmZyb20oeyBsZW5ndGg6IG51bSB9LCBmdW5jdGlvbiAodiwgaykge1xuXHQgICAgICAgICAgcmV0dXJuIGsgKyAxO1xuXHQgICAgICAgIH0pO1xuXHQgICAgICB9LFxuXHQgICAgICAgICAgbWluVGltZSxcblx0ICAgICAgICAgIG1heFRpbWU7XG5cdFxuXHQgICAgICBhdmxUaW1lUGVyaW9kcyA9IGNvbmZpZy5hdmxUaW1lUGVyaW9kcztcblx0ICAgICAgYXZsVGltZU11bHRpcGxpZXIgPSBjb25maWcuYXZsVGltZU11bHRpcGxpZXI7XG5cdCAgICAgIGN1cnJlbnRUaW1lTGVuZ3RoID0gY29uZmlnLmN1cnJlbnRUaW1lTGVuZ3RoO1xuXHRcblx0ICAgICAgY29uZmlnLm1pblRpbWUgPSBtaW5UaW1lID0gY3VycmVudFRpbWVMZW5ndGggLyBjYW52YXNXaWR0aCAqIG1pblBsb3RXaWR0aDtcblx0ICAgICAgY29uZmlnLm1heFRpbWUgPSBtYXhUaW1lID0gY3VycmVudFRpbWVMZW5ndGggLyBtaW5OdW1PZlBsb3Q7XG5cdFxuXHQgICAgICBjb25maWcudmFsaWRUaW1lUGVyaW9kID0gW107XG5cdCAgICAgIGNvbmZpZy52YWxpZFRpbWVQZXJpb2RNdWx0aXBsaWVyID0gW107XG5cdFxuXHQgICAgICBmb3IgKGkgPSAwLCBsZW4xID0gYXZsVGltZVBlcmlvZHMubGVuZ3RoOyBpIDwgbGVuMTsgaSsrKSB7XG5cdCAgICAgICAgdGltZVBlcmlvZCA9IE9iamVjdC5rZXlzKGF2bFRpbWVQZXJpb2RzW2ldKVswXTtcblx0ICAgICAgICB0aW1lID0gYXZsVGltZVBlcmlvZHNbaV1bT2JqZWN0LmtleXMoYXZsVGltZVBlcmlvZHNbaV0pWzBdXTtcblx0ICAgICAgICBtdWx0aXBsaWVyQ291bnRlciA9IDA7XG5cdFxuXHQgICAgICAgIGZvciAoaiA9IDAsIGxlbjIgPSBhdmxUaW1lTXVsdGlwbGllcltpXS5sZW5ndGg7IGogPCBsZW4yOyBqKyspIHtcblx0ICAgICAgICAgIG11bHRpcGxpZXIgPSBhdmxUaW1lTXVsdGlwbGllcltpXVtqXTtcblx0ICAgICAgICAgIGV4cGVjdGVkVGltZSA9IG11bHRpcGxpZXIgKiB0aW1lO1xuXHRcblx0ICAgICAgICAgIGlmIChleHBlY3RlZFRpbWUgPj0gbWluVGltZSAmJiBleHBlY3RlZFRpbWUgPD0gbWF4VGltZSkge1xuXHQgICAgICAgICAgICBtdWx0aXBsaWVyQ291bnRlcisrO1xuXHQgICAgICAgICAgfVxuXHQgICAgICAgIH1cblx0ICAgICAgICBpZiAobXVsdGlwbGllckNvdW50ZXIpIHtcblx0ICAgICAgICAgIGNvbmZpZy52YWxpZFRpbWVQZXJpb2RNdWx0aXBsaWVyLnB1c2goZ2V0TXVsdGlwbGllckFycmF5KG11bHRpcGxpZXJDb3VudGVyKSk7XG5cdCAgICAgICAgICBjb25maWcudmFsaWRUaW1lUGVyaW9kLnB1c2godGltZVBlcmlvZCk7XG5cdCAgICAgICAgfVxuXHQgICAgICB9XG5cdCAgICAgIGNvbnNvbGUubG9nKGNvbmZpZy52YWxpZFRpbWVQZXJpb2QsIGNvbmZpZy52YWxpZFRpbWVQZXJpb2RNdWx0aXBsaWVyLCBjb25maWcuYXZsQWdnTWV0aG9kcyk7XG5cdCAgICB9XG5cdFxuXHQgICAgLyoqXG5cdCAgICAgKiBTZXQgQWdncmVnYXRpb24gb24gdGltZSBzZXJpZXNcblx0ICAgICAqL1xuXHRcblx0ICB9LCB7XG5cdCAgICBrZXk6ICdzZXRBZ2dyZWdhdGlvbicsXG5cdCAgICB2YWx1ZTogZnVuY3Rpb24gc2V0QWdncmVnYXRpb24ob2JqKSB7XG5cdCAgICAgIHZhciBhdmxBZ2dNZXRob2RzLFxuXHQgICAgICAgICAgdmFsaWRUaW1lUGVyaW9kLFxuXHQgICAgICAgICAgdGltZVBlcmlvZEluZGV4LFxuXHQgICAgICAgICAgdmFsaWRUaW1lUGVyaW9kTXVsdGlwbGllcixcblx0ICAgICAgICAgIGNvbmZpZyA9IHRoaXMuY29uZmlnO1xuXHRcblx0ICAgICAgdGhpcy5nZXRWYWxpZEFnZ3JlZ2F0aW9uKCk7XG5cdFxuXHQgICAgICBhdmxBZ2dNZXRob2RzID0gY29uZmlnLmF2bEFnZ01ldGhvZHM7XG5cdCAgICAgIHZhbGlkVGltZVBlcmlvZCA9IGNvbmZpZy52YWxpZFRpbWVQZXJpb2Q7XG5cdCAgICAgIHZhbGlkVGltZVBlcmlvZE11bHRpcGxpZXIgPSBjb25maWcudmFsaWRUaW1lUGVyaW9kTXVsdGlwbGllcjtcblx0XG5cdCAgICAgIGlmIChhdmxBZ2dNZXRob2RzLmluY2x1ZGVzKG9iai5hZ2dyZWdhdGlvbk1ldGhvZCkgJiYgdmFsaWRUaW1lUGVyaW9kLmluY2x1ZGVzKG9iai50aW1lUGVyaW9kKSkge1xuXHQgICAgICAgIHRpbWVQZXJpb2RJbmRleCA9IHZhbGlkVGltZVBlcmlvZC5pbmRleE9mKG9iai50aW1lUGVyaW9kKTtcblx0ICAgICAgICBpZiAodmFsaWRUaW1lUGVyaW9kTXVsdGlwbGllclt0aW1lUGVyaW9kSW5kZXhdLmluY2x1ZGVzKG9iai50aW1lUGVyaW9kTXVsdGlwbGllcikpIHtcblx0ICAgICAgICAgIHRoaXMuYWdncmVnYXRpb24gPSBvYmo7XG5cdCAgICAgICAgICBjb25zb2xlLmxvZyh0aGlzLmFnZ3JlZ2F0aW9uKTtcblx0ICAgICAgICAgIHJldHVybiB0cnVlO1xuXHQgICAgICAgIH0gZWxzZSB7XG5cdCAgICAgICAgICBjb25zb2xlLmxvZyh0aGlzLmFnZ3JlZ2F0aW9uKTtcblx0ICAgICAgICAgIHJldHVybiBmYWxzZTtcblx0ICAgICAgICB9XG5cdCAgICAgIH0gZWxzZSB7XG5cdCAgICAgICAgY29uc29sZS5sb2codGhpcy5hZ2dyZWdhdGlvbik7XG5cdCAgICAgICAgcmV0dXJuIGZhbHNlO1xuXHQgICAgICB9XG5cdCAgICB9XG5cdFxuXHQgICAgLyoqXG5cdCAgICAgKiBSZXNldCBBcHBsaWVkIEFnZ3JlZ2F0aW9uXG5cdCAgICAgKi9cblx0XG5cdCAgfSwge1xuXHQgICAga2V5OiAncmVzZXRBZ2dyZWdhdGlvbicsXG5cdCAgICB2YWx1ZTogZnVuY3Rpb24gcmVzZXRBZ2dyZWdhdGlvbigpIHt9XG5cdCAgfSwge1xuXHQgICAga2V5OiAnaW5pdCcsXG5cdCAgICB2YWx1ZTogZnVuY3Rpb24gaW5pdChyZXF1aXJlKSB7XG5cdCAgICAgIHJlcXVpcmUoJ1gtQXhpcycsICdjaGFydCcsIGZ1bmN0aW9uICh4LCBjaGFydCkge1xuXHQgICAgICAgIGdsb2JhbC54ID0geDtcblx0ICAgICAgICBnbG9iYWwuY2hhcnQgPSBjaGFydDtcblx0ICAgICAgfSk7XG5cdFxuXHQgICAgICB0aGlzLmdldEF2YWlsYWJsZWxBZ2dyZWFnYXRpb24oKTtcblx0ICAgICAgdGhpcy5nZXRWYWxpZFRpbWVNdWx0aXBsaWVyKCk7XG5cdCAgICB9XG5cdCAgfSwge1xuXHQgICAga2V5OiAncGxhY2VJbkNhbnZhcycsXG5cdCAgICB2YWx1ZTogZnVuY3Rpb24gcGxhY2VJbkNhbnZhcygpIHtcblx0ICAgICAgLy8gc3BhY2UgbWFuYWdlbWVudFxuXHQgICAgfVxuXHQgIH0sIHtcblx0ICAgIGtleTogJ2RyYXcnLFxuXHQgICAgdmFsdWU6IGZ1bmN0aW9uIGRyYXcoKSB7XG5cdCAgICAgIC8vIGRyYXcgZXh0ZW5zaW9uXG5cdCAgICB9XG5cdCAgfSwge1xuXHQgICAga2V5OiAnZGlzcG9zZScsXG5cdCAgICB2YWx1ZTogZnVuY3Rpb24gZGlzcG9zZSgpIHtcblx0ICAgICAgLy8gZGlzcG9zZSBleHRlbnNpb25cblx0ICAgIH1cblx0ICB9LCB7XG5cdCAgICBrZXk6ICdhZ2dyZWdhdGlvbicsXG5cdCAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHtcblx0ICAgICAgcmV0dXJuIHRoaXMuYXBwbGllZEFnZ3JlZ2F0aW9uO1xuXHQgICAgfSxcblx0ICAgIHNldDogZnVuY3Rpb24gc2V0KG9iaikge1xuXHQgICAgICB0aGlzLmFwcGxpZWRBZ2dyZWdhdGlvbi50aW1lUGVyaW9kID0gb2JqLnRpbWVQZXJpb2Q7XG5cdCAgICAgIHRoaXMuYXBwbGllZEFnZ3JlZ2F0aW9uLnRpbWVQZXJpb2RNdWx0aXBsaWVyID0gb2JqLnRpbWVQZXJpb2RNdWx0aXBsaWVyO1xuXHQgICAgICB0aGlzLmFwcGxpZWRBZ2dyZWdhdGlvbi5hZ2dyZWdhdGlvbk1ldGhvZCA9IG9iai5hZ2dyZWdhdGlvbk1ldGhvZDtcblx0ICAgIH1cblx0ICB9XSk7XG5cdFxuXHQgIHJldHVybiBBZ2dyZWdhdG9yO1xuXHR9KCk7XG5cdFxuXHRtb2R1bGUuZXhwb3J0cyA9IEFnZ3JlZ2F0b3I7XG5cdC8qIFdFQlBBQ0sgVkFSIElOSkVDVElPTiAqL30uY2FsbChleHBvcnRzLCAoZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzOyB9KCkpKSlcblxuLyoqKi8gfSxcbi8qIDIgKi9cbi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cykge1xuXG5cdCd1c2Ugc3RyaWN0Jztcblx0XG5cdHZhciBGdXNpb25DaGFydHMgPSBmdW5jdGlvbiBGdXNpb25DaGFydHMoKSB7fTtcblx0XG5cdEZ1c2lvbkNoYXJ0cy5yZWdpc3RlciA9IGZ1bmN0aW9uIChleHQsIGFycikge1xuXHQgIHZhciBleHROYW1lID0gYXJyWzBdO1xuXHQgIHZhciBmbiA9IGFyclsxXTtcblx0ICBjb25zb2xlLmxvZygnQ3VycmVudGx5IGFjdGl2ZSBleHRlbnNpb246ICcgKyBleHROYW1lKTtcblx0ICBmbi5iaW5kKHRoaXMsIDU2NSkoKTtcblx0fTtcblx0XG5cdEZ1c2lvbkNoYXJ0cy5nZXRDb21wb25lbnQgPSBmdW5jdGlvbiAoY29tcG9uZW50VHlwZSwgY29tcG9uZW50TmFtZSkge1xuXHQgIHZhciB0b29sQm94ID0ge1xuXHQgICAgeDogMjQsXG5cdCAgICB5OiA1Nixcblx0ICAgIHdpZHRoOiAxMDAsXG5cdCAgICBoZWlnaHQ6IDIwLFxuXHQgICAgaW5kZXg6IDRcblx0ICB9O1xuXHRcblx0ICBpZiAoY29tcG9uZW50VHlwZSA9PT0gJ2FwaScgJiYgY29tcG9uZW50TmFtZSA9PT0gJ3Rvb2xib3gnKSB7XG5cdCAgICByZXR1cm4gdG9vbEJveDtcblx0ICB9XG5cdFxuXHQgIHJldHVybiBudWxsO1xuXHR9O1xuXHRcblx0RnVzaW9uQ2hhcnRzLmV4dEFQSSA9IGZ1bmN0aW9uIChvYmopIHtcblx0ICBvYmouaW5pdChmdW5jdGlvbiAoKSB7XG5cdCAgICB2YXIgYXJnc1RvQXBwbHkgPSBbXTtcblx0ICAgIHZhciBjYiA9IGFyZ3VtZW50c1thcmd1bWVudHMubGVuZ3RoIC0gMV07XG5cdFxuXHQgICAgdmFyIGdldEF2YWlsYWJsZUFnZ3JlZ2F0aW9uTWV0aG9kID0gZnVuY3Rpb24gZ2V0QXZhaWxhYmxlQWdncmVnYXRpb25NZXRob2QoKSB7XG5cdCAgICAgIHJldHVybiBbJ3N1bScsICdhdmVyYWdlJywgJ2N1c3RvbSddO1xuXHQgICAgfTtcblx0XG5cdCAgICB2YXIgZ2V0QXZhaWxhYmxlVGltZVBlcmlvZCA9IGZ1bmN0aW9uIGdldEF2YWlsYWJsZVRpbWVQZXJpb2QoKSB7XG5cdCAgICAgIHJldHVybiBbe1xuXHQgICAgICAgICd4JzogJzEwMCdcblx0ICAgICAgfSwge1xuXHQgICAgICAgICd5JzogJzIwMCdcblx0ICAgICAgfSwge1xuXHQgICAgICAgICd6JzogJzEwMDAnXG5cdCAgICAgIH1dO1xuXHQgICAgfTtcblx0XG5cdCAgICB2YXIgZ2V0Q3VycmVudFZpc2libGVSYW5nZSA9IGZ1bmN0aW9uIGdldEN1cnJlbnRWaXNpYmxlUmFuZ2UoKSB7XG5cdCAgICAgIHJldHVybiB7XG5cdCAgICAgICAgc3RhcnREYXRlOiAwLFxuXHQgICAgICAgIGVuZERhdGU6IDEwMDBcblx0ICAgICAgfTtcblx0ICAgIH07XG5cdFxuXHQgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcmd1bWVudHMubGVuZ3RoIC0gMTsgaSsrKSB7XG5cdCAgICAgIGlmIChhcmd1bWVudHNbaV0gPT09ICdYLUF4aXMnKSB7XG5cdCAgICAgICAgYXJnc1RvQXBwbHkucHVzaCh7XG5cdCAgICAgICAgICBnZXRDdXJyZW50VmlzaWJsZVJhbmdlOiBnZXRDdXJyZW50VmlzaWJsZVJhbmdlLFxuXHQgICAgICAgICAgbWluOiAwLFxuXHQgICAgICAgICAgbWF4OiAyMDAwXG5cdCAgICAgICAgfSk7XG5cdCAgICAgIH0gZWxzZSBpZiAoYXJndW1lbnRzW2ldID09PSAnY2hhcnQnKSB7XG5cdCAgICAgICAgYXJnc1RvQXBwbHkucHVzaCh7XG5cdCAgICAgICAgICBnZXRBdmFpbGFibGVBZ2dyZWdhdGlvbk1ldGhvZDogZ2V0QXZhaWxhYmxlQWdncmVnYXRpb25NZXRob2QsXG5cdCAgICAgICAgICBnZXRBdmFpbGFibGVUaW1lUGVyaW9kOiBnZXRBdmFpbGFibGVUaW1lUGVyaW9kLFxuXHQgICAgICAgICAgY29uZmlnOiB7XG5cdCAgICAgICAgICAgIG1pbk51bU9mUGxvdDogNSxcblx0ICAgICAgICAgICAgbWluUGxvdFdpZHRoOiAzLFxuXHQgICAgICAgICAgICBjYW52YXNXaWR0aDogMTAwMFxuXHQgICAgICAgICAgfVxuXHQgICAgICAgIH0pO1xuXHQgICAgICB9XG5cdCAgICB9XG5cdCAgICBjYi5hcHBseSh0aGlzLCBhcmdzVG9BcHBseSk7XG5cdCAgfSk7XG5cdFxuXHQgIG9iai5wbGFjZUluQ2FudmFzKCk7XG5cdFxuXHQgIG9iai5kcmF3KCk7XG5cdFxuXHQgIG9iai5kaXNwb3NlKCk7XG5cdFxuXHQgIG9iai5zZXRBZ2dyZWdhdGlvbih7XG5cdCAgICB0aW1lUGVyaW9kOiAneCcsXG5cdCAgICB0aW1lUGVyaW9kTXVsdGlwbGllcjogMixcblx0ICAgIGFnZ3JlZ2F0aW9uTWV0aG9kOiAnc3VtJ1xuXHQgIH0pO1xuXHR9O1xuXHRcblx0bW9kdWxlLmV4cG9ydHMgPSBGdXNpb25DaGFydHM7XG5cbi8qKiovIH1cbi8qKioqKiovIF0pO1xuXG5cbi8qKiBXRUJQQUNLIEZPT1RFUiAqKlxuICoqIGZjdHMtZXh0LWRhdGFhZ2dyZWdhdG9yLWVzNS5taW4uanNcbiAqKi8iLCIgXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuXG4gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXG4gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSlcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcblxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0ZXhwb3J0czoge30sXG4gXHRcdFx0aWQ6IG1vZHVsZUlkLFxuIFx0XHRcdGxvYWRlZDogZmFsc2VcbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubG9hZGVkID0gdHJ1ZTtcblxuIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4gXHR9XG5cblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7XG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXygwKTtcblxuXG5cbi8qKiBXRUJQQUNLIEZPT1RFUiAqKlxuICoqIHdlYnBhY2svYm9vdHN0cmFwIGNlNjQ5OTllYWNmOWIxZWM0NzIyXG4gKiovIiwiJ3VzZSBzdHJpY3QnO1xuY29uc3QgQWdncmVnYXRvciA9IHJlcXVpcmUoJy4vZmN0cy1leHQtYWdncmVnYXRvcicpO1xuY29uc3QgRnVzaW9uQ2hhcnRzID0gcmVxdWlyZSgnLi4vbGliL2Z1c2lvbmNoYXJ0cycpO1xuXG5GdXNpb25DaGFydHMucmVnaXN0ZXIoJ2V4dGVuc2lvbicsIFsnZGF0YS1hZ2dyZWdhdG9yJywgZnVuY3Rpb24gKGlkKSB7XG4gIHZhciBnbG9iYWwgPSB0aGlzO1xuICB2YXIgZXh0QVBJID0gZ2xvYmFsLmV4dEFQSTtcbiAgY29uc29sZS5sb2coaWQpO1xuXG4gIC8vIHZhciBvdGhlckFQSSA9IEZ1c2lvbkNoYXJ0cy5nZXRFeHRDb21wb25lbnQoaWQsICdhcGknLCAnbGVnYWN5ZXh0YXBpJyk7XG4gIC8vIHZhciB0b29sQm94QXBpID0gRnVzaW9uQ2hhcnRzLmdldENvbXBvbmVudCgnYXBpJywgJ3Rvb2xib3gnKTtcblxuICBleHRBUEkobmV3IEFnZ3JlZ2F0b3IoKSk7XG59XSk7XG5cblxuXG4vKiogV0VCUEFDSyBGT09URVIgKipcbiAqKiAuL3NyYy9pbmRleC5qc1xuICoqLyIsIid1c2Ugc3RyaWN0Jztcbi8qKlxuICogQ2xhc3MgcmVwcmVzZW50aW5nIHRoZSBEYXRhIEFnZ3JlZ2F0b3IuXG4gKi9cbmNsYXNzIEFnZ3JlZ2F0b3Ige1xuICAvKipcbiAgICogQ3JlYXRlIGEgQWdncmVnYXRvci5cbiAgICogQHR5cGVkZWYge29iamVjdH0gQWdncmVnYXRvci5hZ2dyZWdhdGlvblxuICAgKiBAcHJvcGVydHkge3N0cmluZ30gdGltZVBlcmlvZCAtIFRoZSB0aW1lIGludGVydmFsIG9mIGFnZ3JlZ2F0aW9uLlxuICAgKiBAcHJvcGVydHkge251bWJlcn0gdGltZVBlcmlvZE11bHRpcGxpZXIgLSBUaGUgbXVsdGlwbGllciBvZiB0aW1lIGludGVydmFsLlxuICAgKiBAcHJvcGVydHkge3N0cmluZ30gYWdncmVnYXRpb25NZXRob2QgLSBUaGUgbWV0aG9kIGFwcGxpZWQgdG8gYWdncmVnYXRlLlxuICAgKi9cbiAgY29uc3RydWN0b3IgKCkge1xuICAgIC8qKlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgdGhpcy5hcHBsaWVkQWdncmVnYXRpb24gPSB7XG4gICAgICB0aW1lUGVyaW9kOiBudWxsLFxuICAgICAgdGltZVBlcmlvZE11bHRpcGxpZXI6IDEsXG4gICAgICBhZ2dyZWdhdGlvbk1ldGhvZDogbnVsbFxuICAgIH07XG4gICAgdGhpcy5jb25maWcgPSB7fTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBbiBvYmplY3QgcmVwcmVzZW50aW5nIHRoZSB0aW1lUGVyaW9kLCB0aW1lUGVyaW9kTXVsdGlwbGllciwgYWdncmVnYXRpb25NZXRob2QuXG4gICAqIEB0eXBlIHtBZ2dyZWdhdG9yLmFnZ3JlZ2F0aW9ufVxuICAgKi9cbiAgZ2V0IGFnZ3JlZ2F0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5hcHBsaWVkQWdncmVnYXRpb247XG4gIH1cblxuICBzZXQgYWdncmVnYXRpb24gKG9iaikge1xuICAgIHRoaXMuYXBwbGllZEFnZ3JlZ2F0aW9uLnRpbWVQZXJpb2QgPSBvYmoudGltZVBlcmlvZDtcbiAgICB0aGlzLmFwcGxpZWRBZ2dyZWdhdGlvbi50aW1lUGVyaW9kTXVsdGlwbGllciA9IG9iai50aW1lUGVyaW9kTXVsdGlwbGllcjtcbiAgICB0aGlzLmFwcGxpZWRBZ2dyZWdhdGlvbi5hZ2dyZWdhdGlvbk1ldGhvZCA9IG9iai5hZ2dyZWdhdGlvbk1ldGhvZDtcbiAgfVxuXG4gIGdldFRpbWVNdWx0aXBsaWVyICgpIHtcblxuICB9XG5cbiAgZ2V0QXZhaWxhYmxlbEFnZ3JlYWdhdGlvbiAoKSB7XG4gICAgdmFyIGNvbmZpZyA9IHRoaXMuY29uZmlnLFxuICAgICAgYXZsQWdnTWV0aG9kcyxcbiAgICAgIGF2bFRpbWVQZXJpb2RzLFxuICAgICAgY3VycmVudFZpc2libGVSYW5nZSxcbiAgICAgIGN1cnJlbnRUaW1lTGVuZ3RoLFxuICAgICAgeEF4aXMgPSBnbG9iYWwueCxcbiAgICAgIGNoYXJ0ID0gZ2xvYmFsLmNoYXJ0O1xuXG4gICAgYXZsQWdnTWV0aG9kcyA9IGNoYXJ0LmdldEF2YWlsYWJsZUFnZ3JlZ2F0aW9uTWV0aG9kKCk7XG4gICAgYXZsVGltZVBlcmlvZHMgPSBhdmxUaW1lUGVyaW9kcyA9IGNoYXJ0LmdldEF2YWlsYWJsZVRpbWVQZXJpb2QoKTtcblxuICAgIGN1cnJlbnRWaXNpYmxlUmFuZ2UgPSB4QXhpcy5nZXRDdXJyZW50VmlzaWJsZVJhbmdlKCk7XG4gICAgY3VycmVudFRpbWVMZW5ndGggPSBjdXJyZW50VmlzaWJsZVJhbmdlLmVuZERhdGUgLSBjdXJyZW50VmlzaWJsZVJhbmdlLnN0YXJ0RGF0ZTtcblxuICAgIGNvbmZpZy5hdmxUaW1lUGVyaW9kcyA9IGF2bFRpbWVQZXJpb2RzO1xuICAgIGNvbmZpZy5hdmxBZ2dNZXRob2RzID0gYXZsQWdnTWV0aG9kcztcbiAgICBjb25maWcuY3VycmVudFRpbWVMZW5ndGggPSBjdXJyZW50VGltZUxlbmd0aDtcbiAgfVxuXG4gIGdldFZhbGlkVGltZU11bHRpcGxpZXIgKCkge1xuICAgIHZhciBjb25maWcgPSB0aGlzLmNvbmZpZyxcbiAgICAgIHhBeGlzID0gZ2xvYmFsLngsXG4gICAgICBpLFxuICAgICAgbGVuLFxuICAgICAgY3VyclRpbWVQZXJpb2QsXG4gICAgICBuZXh0VGltZVBlcmlvZCxcbiAgICAgIG51bU9mTXVsdGlwbGllcixcbiAgICAgIGN1cnJlbnRUaW1lTGVuZ3RoID0geEF4aXMubWF4IC0geEF4aXMubWluLFxuICAgICAgYXZsVGltZVBlcmlvZHMgPSBjb25maWcuYXZsVGltZVBlcmlvZHMsXG4gICAgICBnZXRNdWx0aXBsaWVyQXJyYXkgPSBudW0gPT4gQXJyYXkuZnJvbSh7bGVuZ3RoOiBudW19LCAodiwgaykgPT4gayArIDEpO1xuXG4gICAgY29uZmlnLmF2bFRpbWVNdWx0aXBsaWVyID0gW107XG4gICAgbGVuID0gYXZsVGltZVBlcmlvZHMubGVuZ3RoO1xuXG4gICAgZm9yIChpID0gMDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICBjdXJyVGltZVBlcmlvZCA9IGF2bFRpbWVQZXJpb2RzW2ldO1xuICAgICAgbmV4dFRpbWVQZXJpb2QgPSBhdmxUaW1lUGVyaW9kc1soaSArIDEpXTtcblxuICAgICAgaWYgKG5leHRUaW1lUGVyaW9kKSB7XG4gICAgICAgIG51bU9mTXVsdGlwbGllciA9XG4gICAgICAgICAgbmV4dFRpbWVQZXJpb2RbT2JqZWN0LmtleXMobmV4dFRpbWVQZXJpb2QpWzBdXSAvIGN1cnJUaW1lUGVyaW9kW09iamVjdC5rZXlzKGN1cnJUaW1lUGVyaW9kKVswXV07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBudW1PZk11bHRpcGxpZXIgPVxuICAgICAgICAgIGN1cnJlbnRUaW1lTGVuZ3RoIC8gY3VyclRpbWVQZXJpb2RbT2JqZWN0LmtleXMoY3VyclRpbWVQZXJpb2QpWzBdXTtcbiAgICAgIH1cbiAgICAgIGNvbmZpZy5hdmxUaW1lTXVsdGlwbGllci5wdXNoKGdldE11bHRpcGxpZXJBcnJheShudW1PZk11bHRpcGxpZXIpKTtcbiAgICB9XG4gIH1cblxuICBnZXRWYWxpZEFnZ3JlZ2F0aW9uICgpIHtcbiAgICB2YXIgY2hhcnRDb25maWcgPSBnbG9iYWwuY2hhcnQuY29uZmlnLFxuICAgICAgY29uZmlnID0gdGhpcy5jb25maWcsXG4gICAgICBpLFxuICAgICAgaixcbiAgICAgIGxlbjEsXG4gICAgICBsZW4yLFxuICAgICAgYXZsVGltZVBlcmlvZHMsXG4gICAgICBhdmxUaW1lTXVsdGlwbGllcixcbiAgICAgIG1pbk51bU9mUGxvdCA9IGNoYXJ0Q29uZmlnLm1pbk51bU9mUGxvdCxcbiAgICAgIG1pblBsb3RXaWR0aCA9IGNoYXJ0Q29uZmlnLm1pblBsb3RXaWR0aCxcbiAgICAgIGNhbnZhc1dpZHRoID0gY2hhcnRDb25maWcuY2FudmFzV2lkdGgsXG4gICAgICBjdXJyZW50VGltZUxlbmd0aCxcbiAgICAgIHRpbWVQZXJpb2QsXG4gICAgICB0aW1lLFxuICAgICAgZXhwZWN0ZWRUaW1lLFxuICAgICAgbXVsdGlwbGllcixcbiAgICAgIG11bHRpcGxpZXJDb3VudGVyLFxuICAgICAgZ2V0TXVsdGlwbGllckFycmF5ID0gbnVtID0+IEFycmF5LmZyb20oe2xlbmd0aDogbnVtfSwgKHYsIGspID0+IGsgKyAxKSxcbiAgICAgIG1pblRpbWUsXG4gICAgICBtYXhUaW1lO1xuXG4gICAgYXZsVGltZVBlcmlvZHMgPSBjb25maWcuYXZsVGltZVBlcmlvZHM7XG4gICAgYXZsVGltZU11bHRpcGxpZXIgPSBjb25maWcuYXZsVGltZU11bHRpcGxpZXI7XG4gICAgY3VycmVudFRpbWVMZW5ndGggPSBjb25maWcuY3VycmVudFRpbWVMZW5ndGg7XG5cbiAgICBjb25maWcubWluVGltZSA9IG1pblRpbWUgPSAoY3VycmVudFRpbWVMZW5ndGggLyBjYW52YXNXaWR0aCkgKiBtaW5QbG90V2lkdGg7XG4gICAgY29uZmlnLm1heFRpbWUgPSBtYXhUaW1lID0gY3VycmVudFRpbWVMZW5ndGggLyBtaW5OdW1PZlBsb3Q7XG5cbiAgICBjb25maWcudmFsaWRUaW1lUGVyaW9kID0gW107XG4gICAgY29uZmlnLnZhbGlkVGltZVBlcmlvZE11bHRpcGxpZXIgPSBbXTtcblxuICAgIGZvciAoaSA9IDAsIGxlbjEgPSBhdmxUaW1lUGVyaW9kcy5sZW5ndGg7IGkgPCBsZW4xOyBpKyspIHtcbiAgICAgIHRpbWVQZXJpb2QgPSBPYmplY3Qua2V5cyhhdmxUaW1lUGVyaW9kc1tpXSlbMF07XG4gICAgICB0aW1lID0gYXZsVGltZVBlcmlvZHNbaV1bT2JqZWN0LmtleXMoYXZsVGltZVBlcmlvZHNbaV0pWzBdXTtcbiAgICAgIG11bHRpcGxpZXJDb3VudGVyID0gMDtcblxuICAgICAgZm9yIChqID0gMCwgbGVuMiA9IGF2bFRpbWVNdWx0aXBsaWVyW2ldLmxlbmd0aDsgaiA8IGxlbjI7IGorKykge1xuICAgICAgICBtdWx0aXBsaWVyID0gYXZsVGltZU11bHRpcGxpZXJbaV1bal07XG4gICAgICAgIGV4cGVjdGVkVGltZSA9IG11bHRpcGxpZXIgKiB0aW1lO1xuXG4gICAgICAgIGlmICgoZXhwZWN0ZWRUaW1lID49IG1pblRpbWUpICYmIChleHBlY3RlZFRpbWUgPD0gbWF4VGltZSkpIHtcbiAgICAgICAgICBtdWx0aXBsaWVyQ291bnRlcisrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAobXVsdGlwbGllckNvdW50ZXIpIHtcbiAgICAgICAgY29uZmlnLnZhbGlkVGltZVBlcmlvZE11bHRpcGxpZXIucHVzaChnZXRNdWx0aXBsaWVyQXJyYXkobXVsdGlwbGllckNvdW50ZXIpKTtcbiAgICAgICAgY29uZmlnLnZhbGlkVGltZVBlcmlvZC5wdXNoKHRpbWVQZXJpb2QpO1xuICAgICAgfVxuICAgIH1cbiAgICBjb25zb2xlLmxvZyhjb25maWcudmFsaWRUaW1lUGVyaW9kLCBjb25maWcudmFsaWRUaW1lUGVyaW9kTXVsdGlwbGllciwgY29uZmlnLmF2bEFnZ01ldGhvZHMpO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldCBBZ2dyZWdhdGlvbiBvbiB0aW1lIHNlcmllc1xuICAgKi9cbiAgc2V0QWdncmVnYXRpb24gKG9iaikge1xuICAgIHZhciBhdmxBZ2dNZXRob2RzLFxuICAgICAgdmFsaWRUaW1lUGVyaW9kLFxuICAgICAgdGltZVBlcmlvZEluZGV4LFxuICAgICAgdmFsaWRUaW1lUGVyaW9kTXVsdGlwbGllcixcbiAgICAgIGNvbmZpZyA9IHRoaXMuY29uZmlnO1xuXG4gICAgdGhpcy5nZXRWYWxpZEFnZ3JlZ2F0aW9uKCk7XG5cbiAgICBhdmxBZ2dNZXRob2RzID0gY29uZmlnLmF2bEFnZ01ldGhvZHM7XG4gICAgdmFsaWRUaW1lUGVyaW9kID0gY29uZmlnLnZhbGlkVGltZVBlcmlvZDtcbiAgICB2YWxpZFRpbWVQZXJpb2RNdWx0aXBsaWVyID0gY29uZmlnLnZhbGlkVGltZVBlcmlvZE11bHRpcGxpZXI7XG5cbiAgICBpZiAoYXZsQWdnTWV0aG9kcy5pbmNsdWRlcyhvYmouYWdncmVnYXRpb25NZXRob2QpICYmIHZhbGlkVGltZVBlcmlvZC5pbmNsdWRlcyhvYmoudGltZVBlcmlvZCkpIHtcbiAgICAgIHRpbWVQZXJpb2RJbmRleCA9IHZhbGlkVGltZVBlcmlvZC5pbmRleE9mKG9iai50aW1lUGVyaW9kKTtcbiAgICAgIGlmICh2YWxpZFRpbWVQZXJpb2RNdWx0aXBsaWVyW3RpbWVQZXJpb2RJbmRleF0uaW5jbHVkZXMob2JqLnRpbWVQZXJpb2RNdWx0aXBsaWVyKSkge1xuICAgICAgICB0aGlzLmFnZ3JlZ2F0aW9uID0gb2JqO1xuICAgICAgICBjb25zb2xlLmxvZyh0aGlzLmFnZ3JlZ2F0aW9uKTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zb2xlLmxvZyh0aGlzLmFnZ3JlZ2F0aW9uKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBjb25zb2xlLmxvZyh0aGlzLmFnZ3JlZ2F0aW9uKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmVzZXQgQXBwbGllZCBBZ2dyZWdhdGlvblxuICAgKi9cbiAgcmVzZXRBZ2dyZWdhdGlvbiAoKSB7XG5cbiAgfVxuXG4gIGluaXQgKHJlcXVpcmUpIHtcbiAgICByZXF1aXJlKCdYLUF4aXMnLCAnY2hhcnQnLCBmdW5jdGlvbiAoeCwgY2hhcnQpIHtcbiAgICAgIGdsb2JhbC54ID0geDtcbiAgICAgIGdsb2JhbC5jaGFydCA9IGNoYXJ0O1xuICAgIH0pO1xuXG4gICAgdGhpcy5nZXRBdmFpbGFibGVsQWdncmVhZ2F0aW9uKCk7XG4gICAgdGhpcy5nZXRWYWxpZFRpbWVNdWx0aXBsaWVyKCk7XG4gIH1cblxuICBwbGFjZUluQ2FudmFzICgpIHtcbiAgICAvLyBzcGFjZSBtYW5hZ2VtZW50XG4gIH1cblxuICBkcmF3ICgpIHtcbiAgICAvLyBkcmF3IGV4dGVuc2lvblxuICB9XG5cbiAgZGlzcG9zZSAoKSB7XG4gICAgLy8gZGlzcG9zZSBleHRlbnNpb25cbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IEFnZ3JlZ2F0b3I7XG5cblxuXG4vKiogV0VCUEFDSyBGT09URVIgKipcbiAqKiAuL3NyYy9mY3RzLWV4dC1hZ2dyZWdhdG9yLmpzXG4gKiovIiwiJ3VzZSBzdHJpY3QnO1xudmFyIEZ1c2lvbkNoYXJ0cyA9IGZ1bmN0aW9uICgpIHt9O1xuXG5GdXNpb25DaGFydHMucmVnaXN0ZXIgPSBmdW5jdGlvbiAoZXh0LCBhcnIpIHtcbiAgdmFyIGV4dE5hbWUgPSBhcnJbMF07XG4gIHZhciBmbiA9IGFyclsxXTtcbiAgY29uc29sZS5sb2coJ0N1cnJlbnRseSBhY3RpdmUgZXh0ZW5zaW9uOiAnICsgZXh0TmFtZSk7XG4gIGZuLmJpbmQodGhpcywgNTY1KSgpO1xufTtcblxuRnVzaW9uQ2hhcnRzLmdldENvbXBvbmVudCA9IGZ1bmN0aW9uIChjb21wb25lbnRUeXBlLCBjb21wb25lbnROYW1lKSB7XG4gIHZhciB0b29sQm94ID0ge1xuICAgIHg6IDI0LFxuICAgIHk6IDU2LFxuICAgIHdpZHRoOiAxMDAsXG4gICAgaGVpZ2h0OiAyMCxcbiAgICBpbmRleDogNFxuICB9O1xuXG4gIGlmIChjb21wb25lbnRUeXBlID09PSAnYXBpJyAmJiBjb21wb25lbnROYW1lID09PSAndG9vbGJveCcpIHtcbiAgICByZXR1cm4gdG9vbEJveDtcbiAgfVxuXG4gIHJldHVybiBudWxsO1xufTtcblxuRnVzaW9uQ2hhcnRzLmV4dEFQSSA9IGZ1bmN0aW9uIChvYmopIHtcbiAgb2JqLmluaXQoZnVuY3Rpb24gKCkge1xuICAgIHZhciBhcmdzVG9BcHBseSA9IFtdO1xuICAgIHZhciBjYiA9IGFyZ3VtZW50c1thcmd1bWVudHMubGVuZ3RoIC0gMV07XG5cbiAgICB2YXIgZ2V0QXZhaWxhYmxlQWdncmVnYXRpb25NZXRob2QgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gWydzdW0nLCAnYXZlcmFnZScsICdjdXN0b20nXTtcbiAgICB9O1xuXG4gICAgdmFyIGdldEF2YWlsYWJsZVRpbWVQZXJpb2QgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gW3tcbiAgICAgICAgJ3gnOiAnMTAwJ1xuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgJ3knOiAnMjAwJ1xuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgJ3onOiAnMTAwMCdcbiAgICAgIH1dO1xuICAgIH07XG5cbiAgICB2YXIgZ2V0Q3VycmVudFZpc2libGVSYW5nZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN0YXJ0RGF0ZTogMCxcbiAgICAgICAgZW5kRGF0ZTogMTAwMCxcbiAgICAgIH07XG4gICAgfTtcblxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJndW1lbnRzLmxlbmd0aCAtIDE7IGkrKykge1xuICAgICAgaWYgKGFyZ3VtZW50c1tpXSA9PT0gJ1gtQXhpcycpIHtcbiAgICAgICAgYXJnc1RvQXBwbHkucHVzaCh7XG4gICAgICAgICAgZ2V0Q3VycmVudFZpc2libGVSYW5nZTogZ2V0Q3VycmVudFZpc2libGVSYW5nZSxcbiAgICAgICAgICBtaW46IDAsXG4gICAgICAgICAgbWF4OiAyMDAwXG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIGlmIChhcmd1bWVudHNbaV0gPT09ICdjaGFydCcpIHtcbiAgICAgICAgYXJnc1RvQXBwbHkucHVzaCh7XG4gICAgICAgICAgZ2V0QXZhaWxhYmxlQWdncmVnYXRpb25NZXRob2Q6IGdldEF2YWlsYWJsZUFnZ3JlZ2F0aW9uTWV0aG9kLFxuICAgICAgICAgIGdldEF2YWlsYWJsZVRpbWVQZXJpb2Q6IGdldEF2YWlsYWJsZVRpbWVQZXJpb2QsXG4gICAgICAgICAgY29uZmlnOiB7XG4gICAgICAgICAgICBtaW5OdW1PZlBsb3Q6IDUsXG4gICAgICAgICAgICBtaW5QbG90V2lkdGg6IDMsXG4gICAgICAgICAgICBjYW52YXNXaWR0aDogMTAwMFxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICAgIGNiLmFwcGx5KHRoaXMsIGFyZ3NUb0FwcGx5KTtcbiAgfSk7XG5cbiAgb2JqLnBsYWNlSW5DYW52YXMoKTtcblxuICBvYmouZHJhdygpO1xuXG4gIG9iai5kaXNwb3NlKCk7XG5cbiAgb2JqLnNldEFnZ3JlZ2F0aW9uKHtcbiAgICB0aW1lUGVyaW9kOiAneCcsXG4gICAgdGltZVBlcmlvZE11bHRpcGxpZXI6IDIsXG4gICAgYWdncmVnYXRpb25NZXRob2Q6ICdzdW0nXG4gIH0pO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBGdXNpb25DaGFydHM7XG5cblxuXG4vKiogV0VCUEFDSyBGT09URVIgKipcbiAqKiAuL2xpYi9mdXNpb25jaGFydHMuanNcbiAqKi8iXSwic291cmNlUm9vdCI6IiJ9