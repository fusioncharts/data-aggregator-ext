(function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p='',b(0)})([function(a,b,c){'use strict';const d=c(1);(function(e,f){'object'==typeof a&&a.exports?a.exports=e.document?f(e):function(g){if(!g.document)throw new Error('Window with document not present');return f(g,!0)}:e.Aggregator=f(e,!0)})('undefined'==typeof window?this:window,function(e){var f=e.FusionCharts;f.register('extension',['private','data-aggregator',function(){f.registerComponent('extensions','data-aggregator',d({FC:f}))}])})},function(a){'use strict';a.exports=function(b){var c=function(g){return g.charAt(0).toUpperCase()+g.slice(1)},d=function(g){return'object'==typeof g&&g.constructor===Object},e=function g(h,l,m){for(var p in l)p in h?'object'==typeof l[p]&&g(h[p],l[p],m):h[p]=d(l[p])?m.extend2({},l[p]):l[p]};Array.prototype.includes||Object.defineProperty(Array.prototype,'includes',{value:function(g,h){if(null==this)throw new TypeError('"this" is null or not defined');var l=Object(this),m=l.length>>>0;if(0==m)return!1;for(var p=0|h,q=Math.max(0<=p?p:m-Math.abs(p),0);q<m;){if(l[q]===g)return!0;q++}return!1}});class f{constructor(){this.appliedAggregation={binSize:null,aggregationMethod:null},this.config={}}get aggregation(){return this.appliedAggregation}set aggregation(g){this.appliedAggregation.timePeriod=g.timePeriod,this.appliedAggregation.timePeriodMultiplier=g.timePeriodMultiplier,this.appliedAggregation.aggregationMethod=g.aggregationMethod}getAvailablelAggreagation(){var m,p,g=this.config,h=g.dataAgg,l=g.avlTimePeriods=h.getAggregationTimeRules();for(g.avlTimeMultiplier=[],p=l.length,m=0;m<p;m++)g.avlTimeMultiplier.push(l[m].possibleFactors)}getValidAggregation(){var p,q,r,s,t,u,A,B,C,D,E,F,H,I,g=this,h=g.config,l=g.tsObject,m=h.dataAgg,v=h.composition.reactiveModel.model['max-plot-point'],w=l.globalReactiveModel.model['min-plot-point'],z=h.composition.dataset.category.minimumConsecutiveDifference,G=l.globalReactiveModel;for(h.currentTimeLength=G.model['x-axis-visible-range-end']-G.model['x-axis-visible-range-start'],t=h.avlTimePeriods,u=h.avlTimeMultiplier,B=h.currentTimeLength,H=B/v,I=B/w,h.validTimePeriod=[],h.validTimePeriodMultiplier=[],h.avlAggMethods=m.getAllAggregationMethod(),(p=0,r=t.length);p<r;p++){for(C=t[p].name,D=t[p].interval,A=[],(q=0,s=u[p].length);q<s;q++)F=u[p][q],E=F*D,E>=H&&E>z&&E<=I&&A.push(u[p][q]);0<A.length&&(h.validTimePeriodMultiplier.push(A),h.validTimePeriod.push(C))}}getCurrentAggreation(){var q,r,s,g=this,h=g.config,l=h.dataAgg,m=h.composition,p=m.reactiveModel;return s=p.prop('bin-size')-1,isFinite(s)&&(r=l.timeRules.getSuitableInterval(s),q=p.prop('aggregation-fn')),{timePeriod:r&&r.name||h.lowestUnit.timePeriod,timePeriodMultiplier:r&&r.step,aggregationMethod:{value:q&&q.nickName,text:q&&q.formalName}}}init(g){var m,q,r,s,h=this,l=h.config,p=l.toolboxComponent={},t='tsObject',u=['graphics','globalReactiveModel','chart','spaceManagerInstance','chartInstance','smartLabel','extData','parentGroup','lib',function(){let w=0,z=u.length-1,A='';for(h[t]=h[t]||{},h.requiredParams={},w=0;w<z;++w)A=u[w],h[t][A]=arguments[w]}];return g(u),m=h.tsObject,l.usrConfig=m.extData,q=m.chartInstance.apiInstance,r=q.getComponentStore(),l.composition=s=r.getCanvasByIndex(0).composition,l.dataAgg=s.impl.getDataAggregator(),p.toolbox=b.FC.getComponent('api','toolbox'),p.config={},h.toolbars=[],h.measurement={},h.toolbars.push(h.createToolbar()),s.reactiveModel.onPropsChange(['bin-size','aggregation-fn'],function(){l.execute&&(l.execute=!1,setTimeout(()=>{h.rangeOnChange()},200))}),window.Aggregator=h,h}createToolbar(){function g(Z,$,_){var aa;for(var ba in Z)R[$][ba]&&(_&&R[$][ba].states&&R[$][ba].states[_]?aa=R[$][ba].states[_]:aa=R[$][ba].style),aa&&K.cssAddRule('.'+Z[ba],aa)}function h(Z,$,_){var aa=G[Z]=$(_).setConfig(R[Z].attrs);aa.setParentGroup(X),aa.setConfig({className:R[Z].className}),aa.namespace('fusioncharts'),aa.appendSelector('ext1-'+Y++),g(aa.getIndividualClassNames(aa.getClassName()),Z);var ba=aa.config.states;for(var ca in ba)g(aa.getIndividualClassNames(ba[ca]),Z,ca);var da=aa.config.dropDownMenu;for(var ea in da){var fa=da[ea];switch(ea){case'container':K.cssAddRule('.'+fa.className,R.dropDown.container.style);break;case'listItem':K.cssAddRule('.'+fa.className,R.dropDown.listItem.style);var ga=fa.states;for(var ha in ga)K.cssAddRule('.'+ga[ha],R.dropDown.listItem.states[ha].style);}}var ia=R[Z].eventListeners;for(var ja=0,ka=ia.length;ja<ka;ja+=1){var la=ia[ja],ma={};ma[la.type]=la.cb,aa.attachEventHandlers(ma)}return aa}function l(Z){return h(Z,L.selectButton,[])}function m(Z){return h(Z,L.button,R[Z].attrs.label)}var q,r,s,t,u,v,w,z,A,D,P,Q,R,p=this,B=p.config,C=p.tsObject,E=B.toolboxComponent,F=E.toolbox,G=E.config,H=F.HorizontalToolbar,I=F.ComponentGroup,J=C.graphics,K=J.paper,L=K.getInstances().d3,M=J.container,N=C.chart,O=C.smartLabel,S={paper:K,chart:N,smartLabel:O,chartContainer:M},T=()=>{var ba,ca,da,ea,fa,Z=v.value(),$=u.value(),_=B.validTimePeriod,aa=B.validTimePeriodMultiplier,ga=0;for(ba=_.indexOf(Z),ca=aa[ba].indexOf(+$),P=[],fa=aa[ba],(ga=0,ea=fa.length);ga<ea;ga++)da=fa[ga],P.push({name:da.toString(),value:da.toString()});u.updateList(P),0>ca?u.value(aa[ba][0].toString()):u.value($)},U=()=>{var Z=p.getCurrentAggreation();Z.timePeriodMultiplier=Z.timePeriodMultiplier&&Z.timePeriodMultiplier.toString(),Z.timePeriodMultiplier!==u.value()||Z.timePeriod!==v.value()||Z.aggregationMethod.value!==w.value()?A.removeState('disabled'):A.setState('disabled'),w.value()||w.value(B.defaultAggMethod),v.value()&&u.value()||(v.value(B.validTimePeriod[0]),T())};q=new I(S,{hPadding:4}),r=new I(S,{hPadding:0}),s=new I(S,{hPadding:0}),t=new H(S),Q=B.usrConfig;var V={container:{style:{fill:'#fff',stroke:'#c8cecd','stroke-width':'1'},states:{selected:{stroke:'#1e1f1f'},hover:{cursor:'pointer'}}},text:{style:{fill:'#696969','font-size':'11px','font-family':'"Lucida Grande", sans-serif'}},arrow:{style:{fill:'#696969'}},attrs:{radius:2,width:50,height:22,margin:{right:3}}},W={label:{className:'data-aggregator-'+K.getId(),container:{height:22,style:{}},margin:{right:2},text:{style:{'font-size':'13px','font-family':'"Lucida Grande", sans-serif',fill:'#696969','font-weight':'bold'}}},timeMulSelectMenu:{container:V.container,text:V.text,arrow:V.arrow,attrs:{radius:2,width:50,height:22,margin:{right:3,left:0},padding:{left:10,right:8}},eventListeners:[{type:'change',cb:U}]},timePeriodSelectMenu:{container:V.container,text:V.text,arrow:V.arrow,attrs:{radius:2,width:90,height:22,margin:{right:9,left:0},padding:{left:10,right:8}},eventListeners:[{type:'change',cb:function(){T(),U()}}]},aggMethodSelectMenu:{container:V.container,text:V.text,arrow:V.arrow,attrs:{radius:2,width:100,height:22,margin:{right:8,left:0},padding:{left:10,right:8}},eventListeners:[{type:'change',cb:U}]},dropDown:{container:{style:{background:'#fff','border-color':'#898b8b','border-radius':'2px','border-style':'solid','border-width':'1px','font-size':'11px','font-family':'"Lucida Grande", sans-serif','box-shadow':'rgb(153, 153, 153) 0px 0px 5px'}},listItem:{style:{},states:{hover:{className:void 0,style:{background:'#e6e8e8',color:'#696969',cursor:'pointer'}},selected:{className:void 0,style:{background:'#898b8b',color:'#fff'}}}}},applyButton:{container:{style:{fill:'#555',stroke:'#ced5d4','stroke-width':0},states:{disabled:{fill:'#bebebe','stroke-width':0,stroke:'#ced5d4'},hover:{cursor:'pointer'}}},text:{style:{fill:'#f3f3f3',fontSize:'11px',fontFamily:'"Lucida Grande", sans-serif'},states:{disabled:{fill:'#f3f3f3'}}},attrs:{radius:1,width:54,height:22,margin:{right:3,left:0},label:'APPLY'},eventListeners:[{type:'click',cb:function(){p.apply(1)}}]},resetButton:{container:{style:{fill:'#898b8b',stroke:'#ced5d4',strokeWidth:0},states:{hover:{cursor:'pointer'},disabled:{fill:'#bebebe','stroke-width':0,stroke:'#ced5d4',cursor:'default'}}},text:{style:{fill:'#f3f3f3',fontSize:'11px',fontFamily:'"Lucida Grande", sans-serif'},states:{disabled:{fill:'#f3f3f3'}}},attrs:{radius:1,shadow:{fill:'#000',opacity:0.35},width:54,height:22,margin:{right:3,left:0},label:'RESET'},eventListeners:[{type:'click',cb:function(){p.apply(0)}}]}};R=W,Q.styles&&(e(Q.styles,W,this.tsObject.lib),R=Q.styles),D=new F.Label('Aggregate Data:',S,R.label),D.setConfig({className:R.label.className}),g(D.getIndividualClassNames(D.getClassName()),'label');var X=C.parentGroup,Y=0;return q.addSymbol(D),q.setConfig({margin:{right:0}}),u=l('timeMulSelectMenu'),v=l('timePeriodSelectMenu'),w=l('aggMethodSelectMenu'),A=m('applyButton'),z=m('resetButton'),r.addSymbol(u),r.addSymbol(v),r.addSymbol(w),s.addSymbol(A),s.addSymbol(z),t.addComponent(q),t.addComponent(r),t.addComponent(s),t}getLogicalSpace(g,h){var l,q,r,m=0,p=0;for(q=0,r=this.toolbars.length;q<r;q++)l=this.toolbars[q].getLogicalSpace(g,h),m=Math.max(l.width,m),p+=l.height,this.toolbars[q].width=l.width,this.toolbars[q].height=l.height;return p+=this.padding,{width:m,height:p}}placeInCanvas(){var g=this,h=g.tsObject,l=g.config.usrConfig;g.padding=5,h.spaceManagerInstance.add([{name:function(){return'data-aggregator'},ref:function(m){return m['0']},self:function(){return g},priority:function(){return 2},layout:function(m){return m[l.layout||'inline']},orientation:[{type:function(m){return m[l.orientation||'horizontal']},position:[{type:function(m){return m[l.position||'bottom']},alignment:[{type:function(m){return m[l.alignment||'right']},dimensions:[function(){var m=this.getParentComponentGroup();return g.getLogicalSpace(m.getWidth(),m.getHeight())}]}]}]}]}])}setDrawingConfiguration(g,h,l,m,p){var q=this.measurement;return q.x=g,q.y=h,q.width=l,q.height=m,this.parentGroup=p,this}apply(g){var v,w,z,A,B,C,E,F,G,H,I,J,L,M,N,h=this,l=h.config,m=l.toolboxComponent.config,p=m.timePeriodSelectMenu,q=m.timeMulSelectMenu,r=m.aggMethodSelectMenu,s=m.applyButton,t=m.resetButton,u=h.tsObject.extData.aggregate||{},D=l.composition.reactiveModel,K=h.aggregation,O=l.composition.impl;if(!g)O.resetAggregation(),K.binSize=null,K.aggregationMethod=null,t.setState('disabled');else if(!!l.drawn){for(E=p.value(),F=q.value(),G=r.value(),L=l.avlTimePeriods,(M=0,N=L.length);M<N;M++)if(H=L[M],H.name===E){J=H.interval;break}I=J*+F,D.lock().prop('bin-size-ext',I).prop('aggregation-fn-ext',l.avlAggMethods[G]).unlock(),K.binSize=I,K.aggregationMethod=G,s.setState('disabled'),t.removeState('disabled')}else if(E=u.timeUnit&&u.timeUnit.toString().toLowerCase(),F=u.timeMultiplier,G=u.method&&u.method.toString(),h.getValidAggregation(),v=l.validTimePeriod,w=l.validTimePeriodMultiplier,z=l.avlAggMethods,v.includes(E)&&(A=v.indexOf(E),!w[A].includes(+F)&&(F=w[A][0]),B=!0),z[G]&&(C=!0),B||C){if(B){for(L=l.avlTimePeriods,M=0,N=L.length;M<N;M++)if(H=L[M],H.name===E){J=H.interval;break}I=J*+F,D.lock().prop('bin-size-ext',I).unlock(),K.binSize=I}C&&(D.lock().prop('aggregation-fn-ext',l.avlAggMethods[G]).unlock(),K.aggregationMethod=G),s.setState('disabled'),t.removeState('disabled')}}rangeOnChange(){var C,D,E,F,G,H,I,J,K,L,N,O,P,Q,R,S,T,g=this,h=g.config,l=h.toolboxComponent.config,m=l.timePeriodSelectMenu,p=l.timeMulSelectMenu,q=l.aggMethodSelectMenu,r=l.applyButton,s=l.resetButton,t=h.composition.reactiveModel,u=h.composition.reactiveModel.model['max-plot-point'],v=g.tsObject.globalReactiveModel.model['min-plot-point'],w=h.currentTimeLength,z=w/u,A=w/v,B=t.prop('bin-size'),M=g.aggregation;for(g.getValidAggregation(),N=g.getCurrentAggreation(),O=N.timePeriod,P=N.timePeriodMultiplier,Q=N.aggregationMethod,D=[],H=[],K=[],E=h.validTimePeriod,I=h.validTimePeriodMultiplier,L=h.avlAggMethods,r.setState('disabled'),null!==M.binSize&&(B<z||B>A)&&0<I.length&&(O=E[0]),M.binSize===B||Q.value!==h.defaultAggMethod&&Q.value?s.removeState('disabled'):(M.binSize=null,M.aggregationMethod=null,s.setState('disabled')),(R=0,S=E.length);R<S;R++)C=E[R],D.push({name:c(C),value:C});if(m.updateList(D),O&&B?m.value(O):m.setPlaceHolderValue(c(h.lowestUnit.timePeriod)),F=E.indexOf(O),0<=F)for(T=I[F],R=0,S=T.length;R<S;R++)G=T[R],H.push({name:G.toString(),value:G.toString()});for(J in p.updateList(H),P?p.value(P.toString()):p.setPlaceHolderValue(h.lowestUnit.multiplier),null!==M.binSize&&(B<z?(p.value(I[0][0].toString()),m.value(E[0]),g.apply(1)):B>A&&(0<I.length?(p.value(I[0][I[0].length-1].toString()),m.value(E[0]),g.apply(1)):g.apply(0))),L)K.push({name:c(L[J].formalName),value:L[J].nickName});q.updateList(0<E.length?K:[]),Q.value?q.value(Q.value):q.setPlaceHolderValue('No Formula'),h.execute=!0}draw(g,h,l,m,p){var u,v,w,z,A,B,C,q=this,r=q.config,s=q.measurement,t=q.toolbars,D=r.dataAgg,E=r.composition.dataset.category.minimumConsecutiveDifference,F=D.getAggregationTimeRules();if(q.getAvailablelAggreagation(),g=void 0===g?s.x:g,h=void 0===h?s.y:h,l=void 0===l?s.width:l,m=void 0===m?s.height:m,p=void 0===p?q.parentGroup:p,l&&m){for(v=0,u=t.length;v<u;v++)B=t[v],B.draw(g,h,p);for(r.defaultAggMethod=D.getDefaultAggregationMethod().nickName,r.drawn||q.apply(1),(v=0,u=F.length);v<u;v++)if(C=E/F[v].interval,C>=F[v].possibleFactors[0]&&C<=F[v].possibleFactors[F[v].possibleFactors.length-1]){for(w=0;w<F[v].possibleFactors.length;w++)if(C===F[v].possibleFactors[w]||C<F[v].possibleFactors[w]){z=F[v].possibleFactors[w],A=F[v];break}break}else if(1>C){z=1,A=F[v];break}r.lowestUnit={multiplier:z&&z.toString(),timePeriod:A&&A.name},q.rangeOnChange(),r.drawn=!0}}dispose(){}}return f}}]);
//# sourceMappingURL=data-aggregator.min.js.map